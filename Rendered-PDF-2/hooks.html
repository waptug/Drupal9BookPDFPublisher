<!DOCTYPE html>
<html lang="en-US"><head><meta charset="utf-8"/><meta content="IE=Edge" http-equiv="X-UA-Compatible"/><link href="https://selwynpolit.github.io/d9book/assets/css/just-the-docs-default.css" rel="stylesheet"/> <script async="" src="https://www.googletagmanager.com/gtag/js?id=8V22RQEJ71"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', '8V22RQEJ71', { 'anonymize_ip': true }); </script> <script src="https://selwynpolit.github.io/d9book/assets/js/vendor/lunr.min.js"></script> <script src="https://selwynpolit.github.io/d9book/assets/js/just-the-docs.js"></script><meta content="width=device-width, initial-scale=1" name="viewport"/><link href="https://selwynpolit.github.io/d9book/assets/images/favicon.ico" rel="icon" type="image/x-icon"/><title>Hooks | Drupal Book</title><meta content="Jekyll v4.3.2" name="generator"><meta content="Hooks" property="og:title"><meta content="en_US" property="og:locale"><meta content="Drupal at your fingertips" name="description"/><meta content="Drupal at your fingertips" property="og:description"/><link href="https://selwynpolit.github.io/d9book/d9book/hooks" rel="canonical"><meta content="https://selwynpolit.github.io/d9book/d9book/hooks" property="og:url"/><meta content="Drupal Book" property="og:site_name"/><meta content="website" property="og:type"/><meta content="summary" name="twitter:card"/><meta content="Hooks" property="twitter:title"/> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Drupal at your fingertips","headline":"Hooks","url":"https://selwynpolit.github.io/d9book/d9book/hooks"}</script><body> <a class="skip-to-main" href="https://selwynpolit.github.io/d9book/hooks#main-content">Skip to main content</a> <svg class="d-none" xmlns="http://www.w3.org/2000/svg"> <symbol id="svg-link" viewbox="0 0 24 24"><title>Link</title><svg class="feather feather-link" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewbox="0 0 24 24"><title>Menu</title><svg class="feather feather-menu" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><line x1="3" x2="21" y1="12" y2="12"></line><line x1="3" x2="21" y1="6" y2="6"></line><line x1="3" x2="21" y1="18" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewbox="0 0 24 24"><title>Expand</title><svg class="feather feather-chevron-right" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol class="feather feather-external-link" fill="none" height="24" id="svg-external-link" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24"><title id="svg-external-link-title">(external link)</title><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" x2="21" y1="14" y2="3"></line> </symbol> <symbol id="svg-doc" viewbox="0 0 24 24"><title>Document</title><svg class="feather feather-file" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewbox="0 0 24 24"><title>Search</title><svg class="feather feather-search" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"> <circle cx="11" cy="11" r="8"></circle><line x1="21" x2="16.65" y1="21" y2="16.65"></line> </svg> </symbol> <symbol id="svg-copy" viewbox="0 0 16 16"><title>Copy</title><svg class="bi bi-clipboard" fill="currentColor" height="16" viewbox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"></path><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"></path> </svg> </symbol> <symbol id="svg-copied" viewbox="0 0 16 16"><title>Copied</title><svg class="bi bi-clipboard-check-fill" fill="currentColor" height="16" viewbox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"></path><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"></path> </svg> </symbol> </svg><div class="side-bar"><div class="site-header"> <a class="site-title lh-tight" href="https://selwynpolit.github.io/d9book/"> Drupal Book </a> <a class="site-button" href="https://selwynpolit.github.io/d9book/hooks" id="menu-button"> <svg class="icon" viewbox="0 0 24 24"><use xlink:href="#svg-menu"></use></svg> </a></div><nav aria-label="Main" class="site-nav" id="site-nav"><ul class="nav-list"><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/">Home</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/actions">Actions</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/attribution">Attribution</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/bq">Batch and Queue</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/blocks">Blocks</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/caching">Caching</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/composer">Composer</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/config">Config</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/cron">Cron</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/dates">Dates and Times</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/debugging">Debugging</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/development">Development</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/drush">Drush</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/email">Email</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/entities">Entities</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/forms">Forms</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/general">General</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/off-island">Getting off the Island</a><li class="nav-list-item active"><a class="nav-list-link active" href="https://selwynpolit.github.io/d9book/hooks">Hooks</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/learn">Learning</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/links">Links</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/logging">Logging</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/menus">Menus</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/migrate">Migrate</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/modals">Modals</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/nodes-and-fields">Nodes and Fields</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/queries">Queries</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/redirects">Redirects</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/render">Render Arrays</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/routes">Routes</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/security">Security</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/services">Services</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/state">State</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/taxonomy">Taxonomy</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/dtt">Tests</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/twig">Twig</a></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></ul><ul class="nav-list"><li class="nav-list-item external"> <a class="nav-list-link external" href="https://github.com/selwynpolit/d9book/fork"> Fork me on GitHub <svg aria-labelledby="svg-external-link-title" viewbox="0 0 24 24"><use xlink:href="#svg-external-link"></use></svg> </a></li></ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer></div><div class="main" id="top"><div class="main-header" id="main-header"><div class="search"><div class="search-input-wrap"> <input aria-label="Search Drupal Book" autocomplete="off" class="search-input" id="search-input" placeholder="Search Drupal Book" tabindex="0" type="text"/> <label class="search-label" for="search-input"><svg class="search-icon" viewbox="0 0 24 24"><use xlink:href="#svg-search"></use></svg></label></div><div class="search-results" id="search-results"></div></div><nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a class="site-button" href="https://twitter.com/selwynpolit" rel="noopener noreferrer" target="_blank"> <img alt="Twitter logo" src="https://atuin.ru/demo/simple-icons/icons/twitter.svg" style="width: 30px; height: 30px;" title="Author in Twitter"/> </a><li class="aux-nav-list-item"> <a class="site-button" href="https://github.com/selwynpolit/d9book/tree/gh-pages" rel="noopener noreferrer" target="_blank"> <img alt="GitHub logo" src="https://atuin.ru/demo/simple-icons/icons/github.svg" style="width: 30px; height: 30px;" title="D9Book on GitHub"/> </a></li></li></ul></nav></div><div class="main-content-wrap" id="main-content-wrap"><div class="main-content" id="main-content" role="main"><h1 class="no_toc fw-500" id="hooks"> <a aria-labelledby="hooks" class="anchor-heading" href="https://selwynpolit.github.io/d9book/hooks#hooks"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Hooks</h1><h2 class="no_toc text-delta" id="table-of-contents"> <a aria-labelledby="table-of-contents" class="anchor-heading" href="https://selwynpolit.github.io/d9book/hooks#table-of-contents"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Table of contents</h2><ul id="markdown-toc"><li><a href="https://selwynpolit.github.io/d9book/hooks#overview" id="markdown-toc-overview">Overview</a><li><a href="https://selwynpolit.github.io/d9book/hooks#modify-the-login-form" id="markdown-toc-modify-the-login-form">Modify the login form</a><li><a href="https://selwynpolit.github.io/d9book/hooks#modify-the-node-edit-form" id="markdown-toc-modify-the-node-edit-form">Modify the node edit form</a><li><a href="https://selwynpolit.github.io/d9book/hooks#modify-fields-in-a-node" id="markdown-toc-modify-fields-in-a-node">Modify fields in a node</a><li><a href="https://selwynpolit.github.io/d9book/hooks#hook_update" id="markdown-toc-hook_update">hook_update</a><li><a href="https://selwynpolit.github.io/d9book/hooks#theme-hooks" id="markdown-toc-theme-hooks">Theme hooks</a><ul><li><a href="https://selwynpolit.github.io/d9book/hooks#hook_preprocess" id="markdown-toc-hook_preprocess">Hook_preprocess</a><li><a href="https://selwynpolit.github.io/d9book/hooks#hook_preprocess_node-example-1" id="markdown-toc-hook_preprocess_node-example-1">hook_preprocess_node example 1</a><li><a href="https://selwynpolit.github.io/d9book/hooks#hook_preprocess_node-example-2" id="markdown-toc-hook_preprocess_node-example-2">hook_preprocess_node example 2</a></li></li></li></ul><li><a href="https://selwynpolit.github.io/d9book/hooks#organizing-your-hooks-code-the-oop-way" id="markdown-toc-organizing-your-hooks-code-the-oop-way">Organizing your hooks code the OOP way</a><li><a href="https://selwynpolit.github.io/d9book/hooks#reference" id="markdown-toc-reference">Reference</a><ul><li><a href="https://selwynpolit.github.io/d9book/hooks#entity-hooks" id="markdown-toc-entity-hooks">Entity hooks</a><ul><li><a href="https://selwynpolit.github.io/d9book/hooks#create-operations" id="markdown-toc-create-operations">Create operations</a><li><a href="https://selwynpolit.github.io/d9book/hooks#readload-operations" id="markdown-toc-readload-operations">Read/Load operations</a><li><a href="https://selwynpolit.github.io/d9book/hooks#save-operations" id="markdown-toc-save-operations">Save operations</a><li><a href="https://selwynpolit.github.io/d9book/hooks#editing-operations" id="markdown-toc-editing-operations">Editing operations</a><li><a href="https://selwynpolit.github.io/d9book/hooks#delete-operations" id="markdown-toc-delete-operations">Delete operations</a><li><a href="https://selwynpolit.github.io/d9book/hooks#viewrender-operations" id="markdown-toc-viewrender-operations">View/render operations</a><li><a href="https://selwynpolit.github.io/d9book/hooks#other-entity-hooks" id="markdown-toc-other-entity-hooks">Other entity hooks</a></li></li></li></li></li></li></li></ul><li><a href="https://selwynpolit.github.io/d9book/hooks#theme-hooks-1" id="markdown-toc-theme-hooks-1">Theme hooks</a><ul><li><a href="https://selwynpolit.github.io/d9book/hooks#overriding-theme-hooks" id="markdown-toc-overriding-theme-hooks">Overriding Theme Hooks</a><li><a href="https://selwynpolit.github.io/d9book/hooks#preprocessing-for-template-files" id="markdown-toc-preprocessing-for-template-files">Preprocessing for Template Files</a><li><a href="https://selwynpolit.github.io/d9book/hooks#theme-hook-suggestions" id="markdown-toc-theme-hook-suggestions">Theme hook suggestions</a><li><a href="https://selwynpolit.github.io/d9book/hooks#altering-theme-hook-suggestions" id="markdown-toc-altering-theme-hook-suggestions">Altering theme hook suggestions</a></li></li></li></li></ul><li><a href="https://selwynpolit.github.io/d9book/hooks#reference-links" id="markdown-toc-reference-links">Reference Links</a></li></li></li></ul></li></li></li></li></li></li></li></li></ul><p><img alt="views" src="https://api.visitor.plantree.me/visitor-badge/pv?label=views&amp;color=informational&amp;namespace=d9book&amp;key=hooks.md"/></p><hr/><h2 id="overview"> <a aria-labelledby="overview" class="anchor-heading" href="https://selwynpolit.github.io/d9book/hooks#overview"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Overview</h2><p>Drupal hooks allow modules to alter and extend the behavior of Drupal core, or another module. They provide a way that code components in Drupal can communicate with one another. Using hooks, a module developer can change how core, or other modules work without changing the existing code. As a Drupal developer, understanding how to implement and invoke hooks is essential. (More at <a href="https://drupalize.me/tutorial/what-are-hooks?p=2766">https://drupalize.me/tutorial/what-are-hooks?p=2766</a>)</p><p>According to ChapGPT: Hooks are a key aspect of Drupal's module system, and allow developers to interact with the core functionality of Drupal 9 or Drupal 10. They can be used to alter or extend the behavior of Drupal's core features, such as adding custom validation to a form, changing the way content is displayed, or adding new actions to the administrative interface. Hooks provide a powerful and flexible way to customize Drupal to meet the needs of a specific project or site, without having to modify the core code. They are essential for developers who want to build custom modules or themes, and are a fundamental part of the Drupal development process.</p><h2 id="modify-the-login-form"> <a aria-labelledby="modify-the-login-form" class="anchor-heading" href="https://selwynpolit.github.io/d9book/hooks#modify-the-login-form"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Modify the login form</h2><p>Here is code from hook_examples.module that modifies the user login form by adding a button. It passes the username and password that were entered to the mythical third party login endpoint.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cd">/**
 * Implements hook_form_FORM_ID_alter().
 */</span>
<span class="k">function</span> <span class="n">hook_examples_form_user_login_form_alter</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$form</span><span class="p">,</span> <span class="nc">\Drupal\Core\Form\FormStateInterface</span> <span class="nv">$form_state</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Add a custom submit button to the login form.</span>
  <span class="nv">$form</span><span class="p">[</span><span class="s1">'third_party_login'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'submit'</span><span class="p">,</span>
    <span class="s1">'#value'</span> <span class="o">=&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'Login with Third-Party Provider'</span><span class="p">),</span>
    <span class="s1">'#submit'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'hook_examples_user_login_form_submit'</span><span class="p">],</span> <span class="c1">// Call the custom submit function.</span>
  <span class="p">];</span>
<span class="p">}</span>

<span class="cd">/**
 * Custom submit function for the login form.
 */</span>
<span class="k">function</span> <span class="n">hook_examples_user_login_form_submit</span><span class="p">(</span><span class="kt">array</span> <span class="o">&amp;</span><span class="nv">$form</span><span class="p">,</span> <span class="nc">\Drupal\Core\Form\FormStateInterface</span> <span class="nv">$form_state</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Get the username and password from the form state.</span>
  <span class="nv">$username</span> <span class="o">=</span> <span class="nv">$form_state</span><span class="o">-&gt;</span><span class="nf">getValue</span><span class="p">(</span><span class="s1">'name'</span><span class="p">);</span>
  <span class="nv">$password</span> <span class="o">=</span> <span class="nv">$form_state</span><span class="o">-&gt;</span><span class="nf">getValue</span><span class="p">(</span><span class="s1">'pass'</span><span class="p">);</span>

  <span class="c1">// Build the URL for the third-party login page, including the username and password as query parameters.</span>
  <span class="nv">$login_url</span> <span class="o">=</span> <span class="s1">'https://thirdpartyprovider.com/login?username='</span> <span class="mf">.</span> <span class="nb">urlencode</span><span class="p">(</span><span class="nv">$username</span><span class="p">)</span> <span class="mf">.</span> <span class="s1">'&amp;password='</span> <span class="mf">.</span> <span class="nb">urlencode</span><span class="p">(</span><span class="nv">$password</span><span class="p">);</span>

  <span class="c1">// Redirect the user to the third-party login page.</span>
  <span class="nv">$form_state</span><span class="o">-&gt;</span><span class="nf">setRedirect</span><span class="p">(</span><span class="nv">$login_url</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div><p>In the above code, the <strong>hook_examples_form_user_login_form_alter()</strong> function implements the <strong>hook_form_FORM_ID_alter()</strong> hook, where <strong>FORM_ID</strong> is the ID of the form being altered, in this case <strong>user_login_form</strong>. The function modifies the login form by adding a custom submit button, with a submit handler function of <strong>hook_examples_user_login_form_submit()</strong>.</p><p>When the button is clicked, the <strong>hook_examples_user_login_form_submit()</strong> function gets the username and password from the form state , builds the URL for the third-party login page, including the username and password as query parameters. Finally, the user is redirected to this URL using the <strong>$form_state-&gt;setRedirect()</strong> method.</p><h2 id="modify-the-node-edit-form"> <a aria-labelledby="modify-the-node-edit-form" class="anchor-heading" href="https://selwynpolit.github.io/d9book/hooks#modify-the-node-edit-form"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Modify the node edit form</h2><p>In this example, the save button is changed from saying "save" to "update event"</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">Drupal\Core\Form\FormStateInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Drupal\node\Entity\Node</span><span class="p">;</span>

<span class="cd">/**
 * Implements hook_form_alter().
 */</span>
<span class="k">function</span> <span class="n">hook_examples_form_alter</span><span class="p">(</span><span class="kt">array</span> <span class="o">&amp;</span><span class="nv">$form</span><span class="p">,</span> <span class="kt">FormStateInterface</span> <span class="nv">$form_state</span><span class="p">,</span> <span class="nv">$form_id</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$form_id</span> <span class="o">===</span> <span class="s1">'node_event_edit_form'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$node</span> <span class="o">=</span> <span class="nv">$form_state</span><span class="o">-&gt;</span><span class="nf">getFormObject</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getEntity</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$node</span> <span class="k">instanceof</span> <span class="nc">Node</span> <span class="o">&amp;&amp;</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">bundle</span><span class="p">()</span> <span class="o">===</span> <span class="s1">'event'</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$form</span><span class="p">[</span><span class="s1">'actions'</span><span class="p">][</span><span class="s1">'submit'</span><span class="p">][</span><span class="s1">'#value'</span><span class="p">]</span> <span class="o">=</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'Update Event'</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p>This code uses the <strong>hook_form_alter</strong> hook to alter the node edit form and modify the value of the submit button for nodes of type <strong>event</strong>. The <strong>$form_id</strong> argument is used to check if the form being altered is the node edit form for nodes of type <strong>event</strong>, and if it is, the submit button's value is changed to "Update Event". A redundant check is added to ensure the node is of type "event" for clarity.</p><h2 id="modify-fields-in-a-node"> <a aria-labelledby="modify-fields-in-a-node" class="anchor-heading" href="https://selwynpolit.github.io/d9book/hooks#modify-fields-in-a-node"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Modify fields in a node</h2><p>This example does all sorts of interesting things to the node as it is about to be saved.</p><p>It grabs some dates, fills out some fields if the user is anonymous, does some date calculations, changes the title of the node, looks up if to see if there is a connected node and grabs some info from it and updates a date field. Finally it invalidates some cache tags. Phew!</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cd">/**
 * Implements hook_ENTITY_TYPE_presave().
 */</span>
<span class="k">function</span> <span class="n">ogg_mods_node_presave</span><span class="p">(</span><span class="kt">NodeInterface</span> <span class="nv">$node</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$type</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nb">getType</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$type</span> <span class="o">==</span> <span class="s1">'catalog_notice'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$end_date</span> <span class="o">=</span> <span class="kc">NULL</span> <span class="o">!=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'field_cn_start_end_dates'</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">end_value</span> <span class="o">?</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'field_cn_start_end_dates'</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">end_value</span> <span class="o">:</span> <span class="s1">'n/a'</span><span class="p">;</span>
    <span class="nv">$govt_body</span> <span class="o">=</span> <span class="kc">NULL</span> <span class="o">!=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="n">field_cn_governmental_body</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">?</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="n">field_cn_governmental_body</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">:</span> <span class="s1">'Unnamed Government Body'</span><span class="p">;</span>
    <span class="nv">$start_date_val</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'field_cn_start_date'</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>

    <span class="nv">$accountProxy</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">currentUser</span><span class="p">();</span>
    <span class="nv">$account</span> <span class="o">=</span> <span class="nv">$accountProxy</span><span class="o">-&gt;</span><span class="nf">getAccount</span><span class="p">();</span>
    <span class="c1">// Anonymous users automatically fill out the end_date.</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$account</span><span class="o">-&gt;</span><span class="nf">hasPermission</span><span class="p">(</span><span class="s1">'administer catalog notice'</span><span class="p">))</span> <span class="p">{</span>
      <span class="nv">$days</span> <span class="o">=</span> <span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'field_cn_suspension_length'</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>

      <span class="nv">$end_date</span> <span class="o">=</span> <span class="nc">DrupalDateTime</span><span class="o">::</span><span class="nf">createFromFormat</span><span class="p">(</span><span class="s1">'Y-m-d'</span><span class="p">,</span> <span class="nv">$start_date_val</span><span class="p">);</span>
      <span class="nv">$end_date</span><span class="o">-&gt;</span><span class="nf">modify</span><span class="p">(</span><span class="s2">"+</span><span class="nv">$days</span><span class="s2"> days"</span><span class="p">);</span>
      <span class="nv">$end_date</span> <span class="o">=</span> <span class="nv">$end_date</span><span class="o">-&gt;</span><span class="nf">format</span><span class="p">(</span><span class="s2">"Y-m-d"</span><span class="p">);</span>
      <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="s1">'field_cn_end_date'</span><span class="p">,</span> <span class="nv">$end_date</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Always reset the title.</span>
    <span class="nv">$title</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$govt_body</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span> <span class="mf">.</span> <span class="s2">" - </span><span class="nv">$start_date_val</span><span class="s2">"</span><span class="p">;</span>
    <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">setTitle</span><span class="p">(</span><span class="nv">$title</span><span class="p">);</span>

    <span class="cm">/*
     *  Fill in Initial start and end dates if this is an extension of
     * a previously submitted notice.
     */</span>
    <span class="nv">$extension</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'field_cn_extension'</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$extension</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$previous_notice_nid</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'field_cn_original_notice'</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">target_id</span><span class="p">;</span>
      <span class="nv">$previous_notice</span> <span class="o">=</span> <span class="nc">Node</span><span class="o">::</span><span class="nf">load</span><span class="p">(</span><span class="nv">$previous_notice_nid</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nv">$previous_notice</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$initial_start</span> <span class="o">=</span> <span class="nv">$previous_notice</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'field_cn_start_date'</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
        <span class="nv">$initial_end</span> <span class="o">=</span> <span class="nv">$previous_notice</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'field_cn_end_date'</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
        <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="s1">'field_cn_initial_start_date'</span><span class="p">,</span> <span class="nv">$initial_start</span><span class="p">);</span>
        <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="s1">'field_cn_initial_end_date'</span><span class="p">,</span> <span class="nv">$initial_end</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nv">$tags</span><span class="p">[]</span><span class="o">=</span> <span class="s1">'ogg:node:'</span> <span class="mf">.</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nb">getType</span><span class="p">();</span>
  <span class="nv">$tags</span><span class="p">[]</span><span class="o">=</span> <span class="s1">'ogg:node:'</span> <span class="mf">.</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">();</span>
  <span class="nf">ogg_mods_invalidate_node</span><span class="p">(</span><span class="nv">$node</span><span class="p">);</span>
  <span class="nc">Cache</span><span class="o">::</span><span class="nf">invalidateTags</span><span class="p">(</span><span class="nv">$tags</span><span class="p">);</span>
<span class="p">}</span>

<span class="cd">/**
 * Invalidate cache associated with various nodes.
 *
 * @param \Drupal\node\NodeInterface $node
 *
 * @throws \Drupal\Component\Plugin\Exception\InvalidPluginDefinitionException
 * @throws \Drupal\Component\Plugin\Exception\PluginNotFoundException
 */</span>
<span class="k">function</span> <span class="n">ogg_mods_invalidate_node</span><span class="p">(</span><span class="kt">NodeInterface</span> <span class="nv">$node</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$tags</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="nv">$node_type</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nb">getType</span><span class="p">();</span>
  <span class="nv">$tags</span><span class="p">[]</span> <span class="o">=</span> <span class="s1">'ogg:node:'</span> <span class="mf">.</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">();</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nv">$node_type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s1">'news'</span><span class="o">:</span>
      <span class="nv">$tags</span><span class="p">[]</span> <span class="o">=</span> <span class="s1">'ogg:node:home'</span><span class="p">;</span>
      <span class="nv">$tags</span><span class="p">[]</span> <span class="o">=</span> <span class="s1">'ogg:node:landing_page_news'</span><span class="p">;</span>
      <span class="nv">$tags</span><span class="p">[]</span> <span class="o">=</span> <span class="s1">'ogg:node:news'</span><span class="p">;</span>
      <span class="nv">$tags</span><span class="p">[]</span> <span class="o">=</span> <span class="s1">'ogg:views:home_recent_news'</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">default</span><span class="o">:</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$tags</span><span class="p">))</span> <span class="p">{</span>
    <span class="nc">Cache</span><span class="o">::</span><span class="nf">invalidateTags</span><span class="p">(</span><span class="nv">$tags</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p>You can read more about using hook_entity_presave at <a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_entity_presave/10">https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_entity_presave/10</a> as well as hook_ENTITY_TYPE_presave at <a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_ENTITY_TYPE_presave/10">https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_ENTITY_TYPE_presave/10</a></p><h2 id="hook_update"> <a aria-labelledby="hook_update" class="anchor-heading" href="https://selwynpolit.github.io/d9book/hooks#hook_update"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> hook_update</h2><p>Almost every project that runs for a while will require some hook_updates. This is the facility used to do automated changes to your sites. Here is an example that updates a menu item with a title 'Support'.</p><p>This code comes from a .install file:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">partridge_update_8002</span><span class="p">()</span> <span class="p">{</span>

  <span class="nv">$mids</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityQuery</span><span class="p">(</span><span class="s1">'menu_link_content'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'menu_name'</span><span class="p">,</span> <span class="s1">'part-wide-utility'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>

  <span class="k">foreach</span><span class="p">(</span><span class="nv">$mids</span> <span class="k">as</span> <span class="nv">$mid</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$menu_link</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityTypeManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getStorage</span><span class="p">(</span><span class="s1">'menu_link_content'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">load</span><span class="p">(</span><span class="nv">$mid</span><span class="p">);</span>

    <span class="nv">$title</span> <span class="o">=</span> <span class="nv">$menu_link</span><span class="o">-&gt;</span><span class="nf">getTitle</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$title</span> <span class="o">===</span> <span class="s1">'Support'</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$menu_link</span><span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="s1">'weight'</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
      <span class="nv">$menu_link</span><span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="s1">'expanded'</span><span class="p">,</span> <span class="kc">TRUE</span><span class="p">);</span>
      <span class="nv">$menu_link</span><span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="s1">'link'</span><span class="p">,</span> <span class="s1">'https://www.google.com'</span><span class="p">);</span>
      <span class="nv">$menu_link</span><span class="o">-&gt;</span><span class="nf">save</span><span class="p">();</span>

    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="theme-hooks"> <a aria-labelledby="theme-hooks" class="anchor-heading" href="https://selwynpolit.github.io/d9book/hooks#theme-hooks"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Theme hooks</h2><p>Here is an excerpt from the Theme System Overview at <a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Render%21theme.api.php/group/themeable/10">https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Render%21theme.api.php/group/themeable/10</a>:</p><p><strong>Preprocessing for Template Files</strong></p><p>Several functions are called before the template file is invoked to modify the variables that are passed to the template. These make up the "preprocessing" phase, and are executed (if they exist), in the following order (note that in the following list, HOOK indicates the hook being called or a less specific hook. For example, if '#theme'=&gt;'node__article' is called, hook is node__article and node.</p><p>MODULE indicates a module name, THEME indicates a theme name, and ENGINE indicates a theme engine name). Modules, themes, and theme engines can provide these functions to modify how the data is preprocessed, before it is passed to the theme template:</p><ul><li><p><strong><a href="https://api.drupal.org/api/drupal/core%21includes%21theme.inc/function/template_preprocess/10">template_preprocess</a>(&amp;$variables, $hook)</strong>: Creates a default set of variables for all theme hooks with template implementations. Provided by Drupal Core.</p><li><p><strong>template_preprocess_HOOK(&amp;$variables)</strong>: Should be implemented by the module that registers the theme hook, to set up default variables.</p><li><p><strong>MODULE_preprocess(&amp;$variables, $hook)</strong>: hook_preprocess() is invoked on all implementing modules.</p><li><p><strong>MODULE_preprocess_HOOK(&amp;$variables)</strong>: hook_preprocess_HOOK() is invoked on all implementing modules, so that modules that didn't define the theme hook can alter the variables.</p><li><p><strong>ENGINE_engine_preprocess(&amp;$variables, $hook)</strong>: Allows the theme engine to set necessary variables for all theme hooks with template implementations.</p><li><p><strong>ENGINE_engine_preprocess_HOOK(&amp;$variables)</strong>: Allows the theme engine to set necessary variables for the particular theme hook.</p><li><p><strong>THEME_preprocess(&amp;$variables, $hook)</strong>: Allows the theme to set necessary variables for all theme hooks with template implementations.</p><li><p><strong>THEME_preprocess_HOOK(&amp;$variables)</strong>: Allows the theme to set necessary variables specific to the particular theme hook.</p></li></li></li></li></li></li></li></li></ul><h3 id="hook_preprocess"> <a aria-labelledby="hook_preprocess" class="anchor-heading" href="https://selwynpolit.github.io/d9book/hooks#hook_preprocess"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Hook_preprocess</h3><p>Generall, <code class="language-plaintext highlighter-rouge">.theme</code> files will include the following to create or alter variables for :</p><ul><li><p><strong>hook_preprocess_html()</strong> the html template</p><li><p><strong>hook_preprocess_page()</strong> the page template</p><li><p><strong>hook_preprocess_node()</strong> the node template. Note hook_node_type_preprocess_node() also works where you can specify the node type e.g. wc_product_preprocess_node() which expects a content type of wc_product.</p></li></li></li></ul><h3 id="hook_preprocess_node-example-1"> <a aria-labelledby="hook_preprocess_node-example-1" class="anchor-heading" href="https://selwynpolit.github.io/d9book/hooks#hook_preprocess_node-example-1"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> hook_preprocess_node example 1</h3><p>To add a custom variable to be displayed in your template, add a function in your .theme file like the one listed below. This example also adds a #suffix to the field_image which renders that string after the field_image is rendered.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">mytheme_preprocess_node</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$variables</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$variables</span><span class="p">[</span><span class="s1">'custom_variable'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Bananas are yellow"</span><span class="p">;</span>
  <span class="nv">$variables</span><span class="p">[</span><span class="s1">'content'</span><span class="p">][</span><span class="s1">'field_image'</span><span class="p">][</span><span class="s1">'#suffix'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"this suffix on the image"</span><span class="p">;</span>
  <span class="nf">kint</span><span class="p">(</span><span class="nv">$variables</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div><p>The render array you want to change will be in the content variable which shows up in the kint output as <code class="language-plaintext highlighter-rouge">$variables['content']</code></p><p>Usually fields such as field_image will be automatically rendered by the node template (unless you’ve tweaked it to display in some other template.)</p><p>In your node's Twig template you would specify `` to have it display on every node.</p><h3 id="hook_preprocess_node-example-2"> <a aria-labelledby="hook_preprocess_node-example-2" class="anchor-heading" href="https://selwynpolit.github.io/d9book/hooks#hook_preprocess_node-example-2"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> hook_preprocess_node example 2</h3><p>This code is used to make a date range like <code class="language-plaintext highlighter-rouge">3/30/2023 -- 3/31/2023</code> appear as <code class="language-plaintext highlighter-rouge">Mar 30-31, 2023</code></p><p>The date values are stored in the field_date which is a date range field. This code is from the .theme file. Here we retrieve the starting and ending date values:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$from</span> <span class="o">=</span> <span class="nv">$variables</span><span class="p">[</span><span class="s2">"node"</span><span class="p">]</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'field_date'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">getValue</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'value'</span><span class="p">];</span>
<span class="nv">$to</span> <span class="o">=</span> <span class="nv">$variables</span><span class="p">[</span><span class="s2">"node"</span><span class="p">]</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'field_date'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">getValue</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'end_value'</span><span class="p">];</span>
</code></pre></div></div><p>Here is the hook_preprocess_node()</p><p>Notice that we are creating a Twig variable called “scrunch_date” which we want to display.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">Drupal\Core\Datetime\DrupalDateTime</span><span class="p">;</span>


<span class="cd">/**
 * Implements hook_preprocess_node
 *
 * @param $variables
 */</span>
<span class="k">function</span> <span class="n">veryst_preprocess_node</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$variables</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$variables</span><span class="p">[</span><span class="s1">'content'</span><span class="p">][</span><span class="s1">'field_date'</span><span class="p">]))</span> <span class="p">{</span>
    <span class="nv">$date</span> <span class="o">=</span> <span class="nv">$variables</span><span class="p">[</span><span class="s1">'content'</span><span class="p">][</span><span class="s1">'field_date'</span><span class="p">];</span>

    <span class="nv">$from</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DrupalDateTime</span><span class="p">(</span><span class="nv">$variables</span><span class="p">[</span><span class="s2">"node"</span><span class="p">]</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'field_date'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">getValue</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'value'</span><span class="p">]);</span>
    <span class="nv">$date_array</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s2">"-"</span><span class="p">,</span> <span class="nv">$from</span><span class="p">);</span>
    <span class="nv">$from_day</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$date_array</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
    <span class="nv">$from_month</span> <span class="o">=</span> <span class="nv">$date_array</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

    <span class="nv">$to</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DrupalDateTime</span><span class="p">(</span><span class="nv">$variables</span><span class="p">[</span><span class="s2">"node"</span><span class="p">]</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'field_date'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">getValue</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'end_value'</span><span class="p">]);</span>
    <span class="nv">$date_array</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s2">"-"</span><span class="p">,</span> <span class="nv">$to</span><span class="p">);</span>
    <span class="nv">$to_day</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$date_array</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
    <span class="nv">$to_month</span> <span class="o">=</span> <span class="nv">$date_array</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$from_month</span> <span class="o">===</span> <span class="nv">$to_month</span> <span class="o">&amp;&amp;</span> <span class="nv">$from_day</span> <span class="o">!=</span> <span class="nv">$to_day</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$variables</span><span class="p">[</span><span class="s1">'scrunch_date'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'markup'</span><span class="p">,</span>
        <span class="s1">'#markup'</span> <span class="o">=&gt;</span> <span class="nv">$from</span><span class="o">-&gt;</span><span class="nf">format</span><span class="p">(</span><span class="s2">"M j-"</span><span class="p">)</span> <span class="mf">.</span> <span class="nv">$to</span><span class="o">-&gt;</span><span class="nf">format</span><span class="p">(</span><span class="s2">"j, Y"</span><span class="p">),</span>
      <span class="p">];</span>
    <span class="p">}</span>

  <span class="p">}</span>
<span class="c1">//  kint($variables);</span>
<span class="p">}</span>
</code></pre></div></div><p>Now in the twig template we can output the scrunch_date we created in the template file: <code class="language-plaintext highlighter-rouge">web/themes/mytheme/templates/node/node--seminar--teaser.html.twig</code></p><div class="language-twig highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div><h2 id="organizing-your-hooks-code-the-oop-way"> <a aria-labelledby="organizing-your-hooks-code-the-oop-way" class="anchor-heading" href="https://selwynpolit.github.io/d9book/hooks#organizing-your-hooks-code-the-oop-way"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Organizing your hooks code the OOP way</h2><p>from <a href="https://www.berramou.com/blog/drupal-8-how-organise-your-hooks-code-classes-object-oriented-way">Drupal 8 How to organise your hooks code in classes (Object-oriented way)</a></p><p>To implement a hook example like <a href="https://api.drupal.org/api/drupal/core!lib!Drupal!Core!Form!form.api.php/function/hook_form_FORM_ID_alter/8.2.x">hook_form_FORM_ID_alter</a> for <em>node_article_edit_form.</em></p><p>So instead of do something like:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">Drupal\Core\Form\FormStateInterface</span><span class="p">;</span>

<span class="cd">/**
 * Implements hook_form_BASE_FORM_ID_alter().
 */</span>
<span class="k">function</span> <span class="n">MY_MODULE_form_node_article_edit_form_alter</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$form</span><span class="p">,</span> <span class="nc">FormStateInterface</span> <span class="nv">$form_state</span><span class="p">,</span> <span class="nv">$form_id</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Your code here the two following lines just an examples.</span>
  <span class="c1">// Hide some fields.</span>
  <span class="nv">$form</span><span class="p">[</span><span class="s1">'field_SOME_FIELD_NAME'</span><span class="p">][</span><span class="s1">'#access'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">;</span>
  <span class="c1">// Attach some library ....</span>
  <span class="nv">$form</span><span class="p">[</span><span class="s1">'#attached'</span><span class="p">][</span><span class="s1">'library'</span><span class="p">][]</span> <span class="o">=</span> <span class="s1">'MY_MODULE/SOME_LIBRARY'</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><p>You can create a class called <strong>NodeArticleEditFormHandler</strong> inside your <strong>src</strong> folder like the following:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">namespace</span> <span class="nn">Drupal\MY_MODULE</span><span class="p">;</span>


<span class="kn">use</span> <span class="nc">Drupal\Core\Form\FormStateInterface</span><span class="p">;</span>

<span class="cd">/**
 * Class NodeArticleEditFormHandler
 *
 * @package Drupal\MY_MODULE
 */</span>
<span class="kd">class</span> <span class="nc">NodeArticleEditFormHandler</span> <span class="p">{</span>

  <span class="cd">/**
   * Alter Form.
   *
   * @param array $form
   *   Form array.
   * @param \Drupal\Core\Form\FormStateInterface $form_state
   *    The current state of the form.
   * @param $form_id
   *    String representing the id of the form.
   */</span>
  <span class="k">public</span> <span class="k">function</span> <span class="n">alterForm</span><span class="p">(</span><span class="kt">array</span> <span class="o">&amp;</span><span class="nv">$form</span><span class="p">,</span> <span class="kt">FormStateInterface</span> <span class="nv">$form_state</span><span class="p">,</span> <span class="nv">$form_id</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Your code here the two following lines just an examples.</span>
    <span class="c1">// Hide some fields.</span>
    <span class="nv">$form</span><span class="p">[</span><span class="s1">'field_SOME_FIELD_NAME'</span><span class="p">][</span><span class="s1">'#access'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">;</span>
    <span class="c1">// Attach some library ....</span>
    <span class="nv">$form</span><span class="p">[</span><span class="s1">'#attached'</span><span class="p">][</span><span class="s1">'library'</span><span class="p">][]</span> <span class="o">=</span> <span class="s1">'MY_MODULE/SOME_LIBRARY'</span><span class="p">;</span>
  <span class="p">}</span>

<span class="p">}</span>
</code></pre></div></div><p>In case you need other services you can inject your dependencies by make your class <a href="https://api.drupal.org/api/drupal/core!lib!Drupal!Core!DependencyInjection!ContainerInjectionInterface.php/interface/ContainerInjectionInterface/8.2.x">implements ContainerInjectionInterface</a> here is an example with <code class="language-plaintext highlighter-rouge">current user</code> service injection:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">namespace</span> <span class="nn">Drupal\MY_MODULE</span><span class="p">;</span>


<span class="kn">use</span> <span class="nc">Drupal\Core\DependencyInjection\ContainerInjectionInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Drupal\Core\Form\FormStateInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Drupal\Core\Session\AccountProxyInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Symfony\Component\DependencyInjection\ContainerInterface</span><span class="p">;</span>

<span class="cd">/**
 * Class NodeArticleEditFormHandler
 *
 * @package Drupal\MY_MODULE
 */</span>
<span class="kd">class</span> <span class="nc">NodeArticleEditFormHandler</span> <span class="kd">implements</span> <span class="nc">ContainerInjectionInterface</span> <span class="p">{</span>

  <span class="cd">/**
   * The current user account.
   *
   * @var \Drupal\Core\Session\AccountProxyInterface
   */</span>
  <span class="k">protected</span> <span class="nv">$currentUser</span><span class="p">;</span>

  <span class="cd">/**
   * NodeArticleEditFormHandler constructor.
   *
   * @param \Drupal\Core\Session\AccountProxyInterface $current_user
   *   The current user.
   */</span>
  <span class="k">public</span> <span class="k">function</span> <span class="n">__construct</span><span class="p">(</span><span class="kt">AccountProxyInterface</span> <span class="nv">$current_user</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">currentUser</span> <span class="o">=</span> <span class="nv">$current_user</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cd">/**
   * @inheritDoc
   */</span>
  <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="n">create</span><span class="p">(</span><span class="kt">ContainerInterface</span> <span class="nv">$container</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">static</span><span class="p">(</span>
      <span class="nv">$container</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'current_user'</span><span class="p">)</span>
    <span class="p">);</span>
  <span class="p">}</span>

  <span class="cd">/**
   * Alter Form.
   *
   * @param array $form
   *   Form array.
   * @param \Drupal\Core\Form\FormStateInterface $form_state
   *    The current state of the form.
   * @param $form_id
   *    String representing the id of the form.
   */</span>
  <span class="k">public</span> <span class="k">function</span> <span class="n">alterForm</span><span class="p">(</span><span class="kt">array</span> <span class="o">&amp;</span><span class="nv">$form</span><span class="p">,</span> <span class="kt">FormStateInterface</span> <span class="nv">$form_state</span><span class="p">,</span> <span class="nv">$form_id</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Example to get current user.</span>
    <span class="nv">$currentUser</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">currentUser</span><span class="p">;</span>
    <span class="c1">// Your code here the two following lines just an examples.</span>
    <span class="c1">// Hide some fields.</span>
    <span class="nv">$form</span><span class="p">[</span><span class="s1">'field_SOME_FIELD_NAME'</span><span class="p">][</span><span class="s1">'#access'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">;</span>
    <span class="c1">// Attach some library ....</span>
    <span class="nv">$form</span><span class="p">[</span><span class="s1">'#attached'</span><span class="p">][</span><span class="s1">'library'</span><span class="p">][]</span> <span class="o">=</span> <span class="s1">'MY_MODULE/SOME_LIBRARY'</span><span class="p">;</span>
  <span class="p">}</span>

<span class="p">}</span>
</code></pre></div></div><p>And after that change your hook into:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nf">Drupal\MY_MODULE</span><span class="nc">\NodeArticleEditFormHandler</span><span class="p">;</span>

<span class="cd">/**
 * Implements hook_form_BASE_FORM_ID_alter().
 */</span>
<span class="k">function</span> <span class="n">MY_MODULE_form_node_article_edit_form_alter</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$form</span><span class="p">,</span> <span class="nc">FormStateInterface</span> <span class="nv">$form_state</span><span class="p">,</span> <span class="nv">$form_id</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">service</span><span class="p">(</span><span class="s1">'class_resolver'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">getInstanceFromDefinition</span><span class="p">(</span><span class="nc">NodeArticleEditFormHandler</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">alterForm</span><span class="p">(</span><span class="nv">$form</span><span class="p">,</span> <span class="nv">$form_state</span><span class="p">,</span> <span class="nv">$form_id</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div><p>We are done! Now your <code class="language-plaintext highlighter-rouge">.module</code> file is more clean, readable and maintainable with less code. You can do that with every hook for instance <strong>EntityHandler</strong> like:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nf">Drupal\MY_MODULE</span><span class="nc">\EntityHandler</span><span class="p">;</span>

<span class="cd">/**
 * Implements hook_entity_presave().
 */</span>
<span class="k">function</span> <span class="n">MY_MODULE_entity_presave</span><span class="p">(</span><span class="kt">EntityInterface</span> <span class="nv">$entity</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">service</span><span class="p">(</span><span class="s1">'class_resolver'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">getInstanceFromDefinition</span><span class="p">(</span><span class="nc">EntityHandler</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">entityPresave</span><span class="p">(</span><span class="nv">$entity</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div><p>And so on! You can <a href="https://git.drupalcode.org/project/drupal/-/blob/9.2.x/core/modules/content_moderation/content_moderation.module#L164">see another example in Drupal core from the content moderation form</a></p><h2 id="reference"> <a aria-labelledby="reference" class="anchor-heading" href="https://selwynpolit.github.io/d9book/hooks#reference"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Reference</h2><h3 id="entity-hooks"> <a aria-labelledby="entity-hooks" class="anchor-heading" href="https://selwynpolit.github.io/d9book/hooks#entity-hooks"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Entity hooks</h3><p>Here is an excerpt from the Drupal API at <a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/group/entity_crud/10">https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/group/entity_crud/10</a>:</p><h4 id="create-operations"> <a aria-labelledby="create-operations" class="anchor-heading" href="https://selwynpolit.github.io/d9book/hooks#create-operations"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Create operations</h4><p>To create an entity:</p><p>$entity = $storage-&gt;<a href="https://api.drupal.org/api/drupal/10/search/create"><strong>create</strong></a>();</p><p>// Add code here to set properties on the entity. // Until you call save(), the entity is just in memory.</p><p>$entity-&gt;<a href="https://api.drupal.org/api/drupal/10/search/save"><strong>save</strong></a>();</p><p>There is also a shortcut method on entity classes, which creates an entity with an array of provided property values: <code class="language-plaintext highlighter-rouge">\Drupal\Core\Entity::create()</code>.</p><p>Hooks invoked during the create operation:</p><ul><li><p><a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_ENTITY_TYPE_create/10">hook_ENTITY_TYPE_create</a>()</p><li><p><a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_entity_create/10">hook_entity_create</a>()</p><li><p>When handling content entities, if a new translation is added to the entity object:</p><ul><li><p><a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_ENTITY_TYPE_translation_create/10">hook_ENTITY_TYPE_translation_create</a>()</p><li><p><a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_entity_translation_create/10">hook_entity_translation_create</a>()</p></li></li></ul></li></li></li></ul><p>See <a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/group/entity_crud/10#save">Save operations</a> below for the save portion of the operation.</p><h4 id="readload-operations"> <a aria-labelledby="readload-operations" class="anchor-heading" href="https://selwynpolit.github.io/d9book/hooks#readload-operations"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Read/Load operations</h4><p>To load (read) a single entity:</p><p>$entity = $storage-&gt;<a href="https://api.drupal.org/api/drupal/10/search/load"><strong>load</strong></a>($id);</p><p>To load multiple entities: $entities = $storage-&gt;<strong>loadMultiple</strong>($ids);</p><p>Since load() calls loadMultiple(), these are really the same operation. Here is the order of hooks and other operations that take place during entity loading:</p><ul><li>Entity is loaded from storage.<li>postLoad() is called on the entity class, passing in all of the loaded entities.<li><a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_entity_load/10">hook_entity_load</a>()<li><a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_ENTITY_TYPE_load/10">hook_ENTITY_TYPE_load</a>()</li></li></li></li></ul><p>When an entity is loaded, normally the default entity revision is loaded. It is also possible to load a different revision, for entities that support revisions, with this code:</p><p>$entity = $storage-&gt;<strong>loadRevision</strong>($revision_id);</p><p>This involves the same hooks and operations as regular entity loading.</p><p>The "latest revision" of an entity is the most recently created one, regardless of it being default or pending. If the entity is translatable, revision translations are not taken into account either. In other words, any time a new revision is created, that becomes the latest revision for the entity overall, regardless of the affected translations. To load the latest revision of an entity:</p><p>$revision_id = $storage-&gt;<strong>getLatestRevisionId</strong>($entity_id);</p><p>$entity = $storage-&gt;<strong>loadRevision</strong>($revision_id);</p><p>As usual, if the entity is translatable, this code instantiates into $entity the default translation of the revision, even if the latest revision contains only changes to a different translation:</p><p>$is_default = $entity-&gt;<strong>isDefaultTranslation</strong>(); // returns TRUE</p><p>The "latest translation-affected revision" is the most recently created one that affects the specified translation. For example, when a new revision introducing some changes to an English translation is saved, that becomes the new "latest revision". However, if an existing Italian translation was not affected by those changes, then the "latest translation-affected revision" for Italian remains what it was. To load the Italian translation at its latest translation-affected revision:</p><p>$revision_id = $storage-&gt;<strong>getLatestTranslationAffectedRevisionId</strong>($entity_id, 'it'); $it_translation = $storage -&gt;<strong>loadRevision</strong>($revision_id) -&gt;<strong>getTranslation</strong>('it');</p><h4 id="save-operations"> <a aria-labelledby="save-operations" class="anchor-heading" href="https://selwynpolit.github.io/d9book/hooks#save-operations"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Save operations</h4><p>To update an existing entity, you will need to load it, change properties, and then save; as described above, when creating a new entity, you will also need to save it. Here is the order of hooks and other events that happen during an entity save:</p><ul><li><p>preSave() is called on the entity object, and field objects.</p><li><p><a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_ENTITY_TYPE_presave/10">hook_ENTITY_TYPE_presave</a>()</p><li><p><a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_entity_presave/10">hook_entity_presave</a>()</p><li><p>Entity is saved to storage.</p><li><p>For updates on content entities, if there is a translation added that was not previously present:</p><ul><li><p><a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_ENTITY_TYPE_translation_insert/10">hook_ENTITY_TYPE_translation_insert</a>()</p><li><p><a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_entity_translation_insert/10">hook_entity_translation_insert</a>()</p></li></li></ul><li><p>For updates on content entities, if there was a translation removed:</p><ul><li><p><a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_ENTITY_TYPE_translation_delete/10">hook_ENTITY_TYPE_translation_delete</a>()</p><li><p><a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_entity_translation_delete/10">hook_entity_translation_delete</a>()</p></li></li></ul><li><p>postSave() is called on the entity object.</p><li><p><a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_ENTITY_TYPE_insert/10">hook_ENTITY_TYPE_insert</a>() (new) or hook_ENTITY_TYPE_update() (update)</p><li><p><a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_entity_insert/10">hook_entity_insert</a>() (new) or hook_entity_update() (update)</p></li></li></li></li></li></li></li></li></li></ul><p>Some specific entity types invoke hooks during preSave() or postSave() operations. Examples:</p><ul><li><p><strong>Field configuration preSave()</strong>: hook_field_storage_config_update_forbid()</p><li><p><strong>Node postSave()</strong>: hook_node_access_records() and hook_node_access_records_alter()</p><li><p>Config entities that are acting as entity bundles in postSave(): hook_entity_bundle_create()</p><li><p><strong>Comment</strong>: hook_comment_publish() and hook_comment_unpublish() as appropriate.</p></li></li></li></li></ul><p>Note that all translations available for the entity are stored during a save operation. When saving a new revision, a copy of every translation is stored, regardless of it being affected by the revision.</p><h4 id="editing-operations"> <a aria-labelledby="editing-operations" class="anchor-heading" href="https://selwynpolit.github.io/d9book/hooks#editing-operations"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Editing operations</h4><p>When an entity's add/edit form is used to add or edit an entity, there are several hooks that are invoked:</p><ul><li><p><a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_entity_prepare_form/10">hook_entity_prepare_form</a>()</p><li><p><a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_ENTITY_TYPE_prepare_form/10">hook_ENTITY_TYPE_prepare_form</a>()</p><li><p><a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_entity_form_display_alter/10">hook_entity_form_display_alter</a>() (for content entities only)</p></li></li></li></ul><h4 id="delete-operations"> <a aria-labelledby="delete-operations" class="anchor-heading" href="https://selwynpolit.github.io/d9book/hooks#delete-operations"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Delete operations</h4><p>To delete one or more entities, load them and then delete them:</p><p>$entities = $storage-&gt;<strong>loadMultiple</strong>($ids);</p><p>$storage-&gt;<a href="https://api.drupal.org/api/drupal/10/search/delete"><strong>delete</strong></a>($entities);</p><p>During the delete operation, the following hooks and other events happen:</p><ul><li><p>preDelete() is called on the entity class.</p><li><p><a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_ENTITY_TYPE_predelete/10">hook_ENTITY_TYPE_predelete</a>()</p><li><p><a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_entity_predelete/10">hook_entity_predelete</a>()</p><li><p>Entity and field information is removed from storage.</p><li><p>postDelete() is called on the entity class.</p><li><p><a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_ENTITY_TYPE_delete/10">hook_ENTITY_TYPE_delete</a>()</p><li><p><a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_entity_delete/10">hook_entity_delete</a>()</p></li></li></li></li></li></li></li></ul><p>Some specific entity types invoke hooks during the delete process. Examples:</p><ul><li><strong>Entity bundle postDelete()</strong>: hook_entity_bundle_delete()</li></ul><p>Individual revisions of an entity can also be deleted:</p><p>$storage-&gt;<strong>deleteRevision</strong>($revision_id);</p><p>This operation invokes the following operations and hooks:</p><ul><li><p>Revision is loaded (see <a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/group/entity_crud/10#load">Read/Load operations</a> above).</p><li><p>Revision and field information is removed from the database.</p><li><p><a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_ENTITY_TYPE_revision_delete/10">hook_ENTITY_TYPE_revision_delete</a>()</p><li><p><a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_entity_revision_delete/10">hook_entity_revision_delete</a>()</p></li></li></li></li></ul><h4 id="viewrender-operations"> <a aria-labelledby="viewrender-operations" class="anchor-heading" href="https://selwynpolit.github.io/d9book/hooks#viewrender-operations"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> View/render operations</h4><p>To make a render array for a loaded entity:</p><p>// You can omit the language ID if the default language is being used.</p><p>$build = $view_builder</p><p>-&gt;<a href="https://api.drupal.org/api/drupal/10/search/view"><strong>view</strong></a>($entity, 'view_mode_name', $language-&gt;<strong>getId</strong>());</p><p>You can also use the viewMultiple() method to view multiple entities.</p><p>Hooks invoked during the operation of building a render array:</p><ul><li><p><a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_entity_view_mode_alter/10">hook_entity_view_mode_alter</a>()</p><li><p><a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_ENTITY_TYPE_build_defaults_alter/10">hook_ENTITY_TYPE_build_defaults_alter</a>()</p><li><p><a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_entity_build_defaults_alter/10">hook_entity_build_defaults_alter</a>()</p></li></li></li></ul><p>View builders for some types override these hooks, notably:</p><ul><li><p>The Tour view builder does not invoke any hooks.</p><li><p>The Block view builder invokes hook_block_view_alter() and hook_block_view_BASE_BLOCK_ID_alter(). Note that in other view builders, the view alter hooks are run later in the process.</p></li></li></ul><p>During the rendering operation, the default entity viewer runs the following hooks and operations in the pre-render step:</p><ul><li><p><a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_entity_view_display_alter/10">hook_entity_view_display_alter</a>()</p><li><p><a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_entity_prepare_view/10">hook_entity_prepare_view</a>()</p><li><p>Entity fields are loaded, and render arrays are built for them using their formatters.</p><li><p><a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_entity_display_build_alter/10">hook_entity_display_build_alter</a>()</p><li><p><a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_ENTITY_TYPE_view/10">hook_ENTITY_TYPE_view</a>()</p><li><p><a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_entity_view/10">hook_entity_view</a>()</p><li><p><a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_ENTITY_TYPE_view_alter/10">hook_ENTITY_TYPE_view_alter</a>()</p><li><p><a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_entity_view_alter/10">hook_entity_view_alter</a>()</p></li></li></li></li></li></li></li></li></ul><p>Some specific builders have specific hooks:</p><ul><li><p>The Node view builder invokes hook_node_links_alter().</p><li><p>The Comment view builder invokes hook_comment_links_alter().</p></li></li></ul><p>After this point in rendering, the theme system takes over. See the <a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Render%21theme.api.php/group/theme_render/10">Theme system and render API topic</a> for more information.</p><h4 id="other-entity-hooks"> <a aria-labelledby="other-entity-hooks" class="anchor-heading" href="https://selwynpolit.github.io/d9book/hooks#other-entity-hooks"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Other entity hooks</h4><p>Some types of entities invoke hooks for specific operations:</p><ul><li><p>Searching nodes:</p><ul><li><p><a href="https://api.drupal.org/api/drupal/core%21modules%21node%21node.api.php/function/hook_ranking/10">hook_ranking</a>()</p><li><p>Query is executed to find matching nodes</p><li><p>Resulting node is loaded</p><li><p>Node render array is built</p><li><p><a href="https://api.drupal.org/api/drupal/core%21modules%21comment%21comment.module/function/comment_node_update_index/10">comment_node_update_index</a>() is called (this adds "N comments" text)</p><li><p><a href="https://api.drupal.org/api/drupal/core%21modules%21node%21node.api.php/function/hook_node_search_result/10">hook_node_search_result</a>()</p></li></li></li></li></li></li></ul><li><p>Search indexing nodes:</p><ul><li><p>Node is loaded</p><li><p>Node render array is built</p><li><p><a href="https://api.drupal.org/api/drupal/core%21modules%21node%21node.api.php/function/hook_node_update_index/10">hook_node_update_index</a>()</p></li></li></li></ul></li></li></ul><h3 id="theme-hooks-1"> <a aria-labelledby="theme-hooks-1" class="anchor-heading" href="https://selwynpolit.github.io/d9book/hooks#theme-hooks-1"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Theme hooks</h3><p>Here is an excerpt from the Theme System Overview at <a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Render%21theme.api.php/group/themeable/10">https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Render%21theme.api.php/group/themeable/10</a>:</p><p>The theme system is invoked in <a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Render%21Renderer.php/function/Renderer%3A%3AdoRender/10">\Drupal\Core\Render\Renderer::doRender</a>() by calling the <a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Theme%21ThemeManagerInterface.php/function/ThemeManagerInterface%3A%3Arender/10">\Drupal\Core\Theme\ThemeManagerInterface::render</a>() function, which operates on the concept of "theme hooks". Theme hooks define how a particular type of data should be rendered. They are registered by modules by implementing hook_theme(), which specifies the name of the hook, the input "variables" used to provide data and options, and other information. Modules implementing hook_theme() also need to provide a default implementation for each of their theme hooks in a Twig file, and they may also provide preprocessing functions. For example, the core Search module defines a theme hook for a search result item in search_theme():</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">return</span> <span class="k">array</span><span class="p">(</span>
  <span class="s1">'search_result'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">'variables'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
      <span class="s1">'result'</span> <span class="o">=&gt;</span> <span class="kc">NULL</span><span class="p">,</span>
      <span class="s1">'plugin_id'</span> <span class="o">=&gt;</span> <span class="kc">NULL</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s1">'file'</span> <span class="o">=&gt;</span> <span class="s1">'search.pages.inc'</span><span class="p">,</span>
  <span class="p">),</span>
<span class="p">);</span>
</code></pre></div></div><p>Given this definition, the template file with the default implementation is <a href="https://api.drupal.org/api/drupal/10/search/search-result.html.twig">search-result.html.twig</a>, which can be found in the core/modules/search/templates directory, and the variables for rendering are the search result and the plugin ID. In addition, there is a function template_preprocess_search_result(), located in file <a href="https://api.drupal.org/api/drupal/core%21modules%21search%21search.pages.inc/10">search.pages.inc</a>, which preprocesses the information from the input variables so that it can be rendered by the Twig template; the processed variables that the Twig template receives are documented in the header of the default Twig template file.</p><h4 id="overriding-theme-hooks"> <a aria-labelledby="overriding-theme-hooks" class="anchor-heading" href="https://selwynpolit.github.io/d9book/hooks#overriding-theme-hooks"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Overriding Theme Hooks</h4><p>Themes may register new theme hooks within a <a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Render%21theme.api.php/function/hook_theme/10">hook_theme</a>() implementation, but it is more common for themes to override default implementations provided by modules than to register entirely new theme hooks. Themes can override a default implementation by creating a template file with the same name as the default implementation; for example, to override the display of search results, a theme would add a file called <a href="https://api.drupal.org/api/drupal/10/search/search-result.html.twig">search-result.html.twig</a> to its templates directory. A good starting point for doing this is normally to copy the default implementation template, and then modifying it as desired.</p><h4 id="preprocessing-for-template-files"> <a aria-labelledby="preprocessing-for-template-files" class="anchor-heading" href="https://selwynpolit.github.io/d9book/hooks#preprocessing-for-template-files"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Preprocessing for Template Files</h4><p>Several functions are called before the template file is invoked to modify the variables that are passed to the template. These make up the "preprocessing" phase, and are executed (if they exist), in the following order (note that in the following list, HOOK indicates the hook being called or a less specific hook. For example, if '#theme'=&gt;'node__article' is called, hook is node__article and node. MODULE indicates a module name, THEME indicates a theme name, and ENGINE indicates a theme engine name). Modules, themes, and theme engines can provide these functions to modify how the data is preprocessed, before it is passed to the theme template:</p><ul><li><p><strong><a href="https://api.drupal.org/api/drupal/core%21includes%21theme.inc/function/template_preprocess/10">template_preprocess</a>(&amp;$variables, $hook)</strong>: Creates a default set of variables for all theme hooks with template implementations. Provided by Drupal Core.</p><li><p><strong>template_preprocess_HOOK(&amp;$variables)</strong>: Should be implemented by the module that registers the theme hook, to set up default variables.</p><li><p><strong>MODULE_preprocess(&amp;$variables, $hook)</strong>: hook_preprocess() is invoked on all implementing modules.</p><li><p><strong>MODULE_preprocess_HOOK(&amp;$variables)</strong>: hook_preprocess_HOOK() is invoked on all implementing modules, so that modules that didn't define the theme hook can alter the variables.</p><li><p><strong>ENGINE_engine_preprocess(&amp;$variables, $hook)</strong>: Allows the theme engine to set necessary variables for all theme hooks with template implementations.</p><li><p><strong>ENGINE_engine_preprocess_HOOK(&amp;$variables)</strong>: Allows the theme engine to set necessary variables for the particular theme hook.</p><li><p><strong>THEME_preprocess(&amp;$variables, $hook)</strong>: Allows the theme to set necessary variables for all theme hooks with template implementations.</p><li><p><strong>THEME_preprocess_HOOK(&amp;$variables)</strong>: Allows the theme to set necessary variables specific to the particular theme hook.</p></li></li></li></li></li></li></li></li></ul><h4 id="theme-hook-suggestions"> <a aria-labelledby="theme-hook-suggestions" class="anchor-heading" href="https://selwynpolit.github.io/d9book/hooks#theme-hook-suggestions"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Theme hook suggestions</h4><p>In some cases, instead of calling the base theme hook implementation (either the default provided by the module that defined the hook, or the override provided by the theme), the theme system will instead look for "suggestions" of other hook names to look for. Suggestions can be specified in several ways:</p><ul><li><p>In a render array, the '#theme' property (which gives the name of the hook to use) can be an array of theme hook names instead of a single hook name. In this case, the render system will look first for the highest-priority hook name, and if no implementation is found, look for the second, and so on. Note that the highest-priority suggestion is at the end of the array.</p><li><p>In a render array, the '#theme' property can be set to the name of a hook with a '__SUGGESTION' suffix. For example, in search results theming, the hook 'item_list__search_results' is given. In this case, the render system will look for theme templates called <a href="https://api.drupal.org/api/drupal/10/search/item-list--search-results.html.twig">item-list--search-results.html.twig</a>, which would only be used for rendering item lists containing search results, and if this template is not found, it will fall back to using the base <a href="https://api.drupal.org/api/drupal/10/search/item-list.html.twig">item-list.html.twig</a> template. This type of suggestion can also be combined with providing an array of theme hook names as described above.</p><li><p>A module can implement hook_theme_suggestions_HOOK(). This allows the module that defines the theme template to dynamically return an array containing specific theme hook names (presumably with '__' suffixes as defined above) to use as suggestions. For example, the Search module does this in search_theme_suggestions_search_result() to suggest search_result__PLUGIN as the theme hook for search result items, where PLUGIN is the machine name of the particular search plugin type that was used for the search (such as node_search or user_search).</p></li></li></li></ul><p>For further information on overriding theme hooks see <a href="https://www.drupal.org/node/2186401">https://www.drupal.org/node/2186401</a></p><h4 id="altering-theme-hook-suggestions"> <a aria-labelledby="altering-theme-hook-suggestions" class="anchor-heading" href="https://selwynpolit.github.io/d9book/hooks#altering-theme-hook-suggestions"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Altering theme hook suggestions</h4><p>Modules can also alter the theme suggestions provided using the mechanisms of the previous section. There are two hooks for this: the theme-hook-specific hook_theme_suggestions_HOOK_alter() and the generic hook_theme_suggestions_alter(). These hooks get the current list of suggestions as input, and can change this array (adding suggestions and removing them).</p><h3 id="reference-links"> <a aria-labelledby="reference-links" class="anchor-heading" href="https://selwynpolit.github.io/d9book/hooks#reference-links"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Reference Links</h3><ul><li><a href="https://drupalize.me/tutorial/what-are-hooks?p=2766">What are hooks? from Drupalize.me March 2022</a><li><a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Render%21theme.api.php/group/themeable/10">Theme system overview on api.drupal.org</a><li><a href="https://www.berramou.com/blog/drupal-8-how-organise-your-hooks-code-classes-object-oriented-way">How to organize your hooks the object oriented way by Azz-eddine BERRAMOU Mar 2020</a></li></li></li></ul><hr/> <script async="" crossorigin="anonymous" data-category="Q&amp;A" data-category-id="MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMyMjY2NDE4" data-emit-metadata="0" data-input-position="bottom" data-lang="en" data-mapping="title" data-reactions-enabled="1" data-repo="selwynpolit/d9book" data-repo-id="MDEwOlJlcG9zaXRvcnkzMjUxNTQ1Nzg=" data-strict="0" data-theme="preferred_color_scheme" src="https://giscus.app/client.js"> </script><hr/><footer><p><a href="https://selwynpolit.github.io/d9book/hooks#top" id="back-to-top">Back to top</a></p><p class="text-small text-grey-dk-100 mb-0"><span xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/"> <a href="http://www.selwynpolit.github.io/d9book" property="dct:title" rel="cc:attributionURL">Drupal at your fingertips</a> by <a href="http://www.drupal.org/u/selwynpolit" property="cc:attributionName" rel="cc:attributionURL dct:creator">Selwyn Polit</a> is licensed under <a href="http://creativecommons.org/licenses/by/4.0/" rel="license noopener noreferrer" target="_blank">CC BY 4.0 <img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg" style="height:16px!important;vertical-align:text-bottom;"/> <img src="https://mirrors.creativecommons.org/presskit/icons/by.svg" style="height:16px!important;vertical-align:text-bottom;"/> </a></span></p><div class="d-flex mt-2"><p class="text-small text-grey-dk-000 mb-0 mr-2"> Page last modified: <span class="d-inline-block">May 14 2023</span>.</p><p class="text-small text-grey-dk-000 mb-0"> <a href="https://github.com/selwynpolit/d9book/tree/gh-pages/book/hooks.md" id="edit-this-page">Edit this page on GitHub</a></p></div></footer></div></div><div class="search-overlay"></div></div>
</body></link></meta></meta></meta></head></html>