<!DOCTYPE html>
<html lang="en-US"><head><meta charset="utf-8"/><meta content="IE=Edge" http-equiv="X-UA-Compatible"/><link href="https://selwynpolit.github.io/d9book/assets/css/just-the-docs-default.css" rel="stylesheet"/> <script async="" src="https://www.googletagmanager.com/gtag/js?id=8V22RQEJ71"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', '8V22RQEJ71', { 'anonymize_ip': true }); </script> <script src="https://selwynpolit.github.io/d9book/assets/js/vendor/lunr.min.js"></script> <script src="https://selwynpolit.github.io/d9book/assets/js/just-the-docs.js"></script><meta content="width=device-width, initial-scale=1" name="viewport"/><link href="https://selwynpolit.github.io/d9book/assets/images/favicon.ico" rel="icon" type="image/x-icon"/><title>Menus | Drupal Book</title><meta content="Jekyll v4.3.2" name="generator"><meta content="Menus" property="og:title"><meta content="en_US" property="og:locale"><meta content="Drupal at your fingertips" name="description"/><meta content="Drupal at your fingertips" property="og:description"/><link href="https://selwynpolit.github.io/d9book/d9book/menus" rel="canonical"><meta content="https://selwynpolit.github.io/d9book/d9book/menus" property="og:url"/><meta content="Drupal Book" property="og:site_name"/><meta content="website" property="og:type"/><meta content="summary" name="twitter:card"/><meta content="Menus" property="twitter:title"/> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Drupal at your fingertips","headline":"Menus","url":"https://selwynpolit.github.io/d9book/d9book/menus"}</script><body> <a class="skip-to-main" href="https://selwynpolit.github.io/d9book/menus#main-content">Skip to main content</a> <svg class="d-none" xmlns="http://www.w3.org/2000/svg"> <symbol id="svg-link" viewbox="0 0 24 24"><title>Link</title><svg class="feather feather-link" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewbox="0 0 24 24"><title>Menu</title><svg class="feather feather-menu" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><line x1="3" x2="21" y1="12" y2="12"></line><line x1="3" x2="21" y1="6" y2="6"></line><line x1="3" x2="21" y1="18" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewbox="0 0 24 24"><title>Expand</title><svg class="feather feather-chevron-right" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol class="feather feather-external-link" fill="none" height="24" id="svg-external-link" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24"><title id="svg-external-link-title">(external link)</title><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" x2="21" y1="14" y2="3"></line> </symbol> <symbol id="svg-doc" viewbox="0 0 24 24"><title>Document</title><svg class="feather feather-file" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewbox="0 0 24 24"><title>Search</title><svg class="feather feather-search" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"> <circle cx="11" cy="11" r="8"></circle><line x1="21" x2="16.65" y1="21" y2="16.65"></line> </svg> </symbol> <symbol id="svg-copy" viewbox="0 0 16 16"><title>Copy</title><svg class="bi bi-clipboard" fill="currentColor" height="16" viewbox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"></path><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"></path> </svg> </symbol> <symbol id="svg-copied" viewbox="0 0 16 16"><title>Copied</title><svg class="bi bi-clipboard-check-fill" fill="currentColor" height="16" viewbox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"></path><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"></path> </svg> </symbol> </svg><div class="side-bar"><div class="site-header"> <a class="site-title lh-tight" href="https://selwynpolit.github.io/d9book/"> Drupal Book </a> <a class="site-button" href="https://selwynpolit.github.io/d9book/menus" id="menu-button"> <svg class="icon" viewbox="0 0 24 24"><use xlink:href="#svg-menu"></use></svg> </a></div><nav aria-label="Main" class="site-nav" id="site-nav"><ul class="nav-list"><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/">Home</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/actions">Actions</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/attribution">Attribution</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/bq">Batch and Queue</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/blocks">Blocks</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/caching">Caching</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/composer">Composer</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/config">Config</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/cron">Cron</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/dates">Dates and Times</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/debugging">Debugging</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/development">Development</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/drush">Drush</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/email">Email</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/entities">Entities</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/forms">Forms</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/general">General</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/off-island">Getting off the Island</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/hooks">Hooks</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/learn">Learning</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/links">Links</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/logging">Logging</a><li class="nav-list-item active"><a class="nav-list-link active" href="https://selwynpolit.github.io/d9book/menus">Menus</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/migrate">Migrate</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/modals">Modals</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/nodes-and-fields">Nodes and Fields</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/queries">Queries</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/redirects">Redirects</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/render">Render Arrays</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/routes">Routes</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/security">Security</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/services">Services</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/state">State</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/taxonomy">Taxonomy</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/dtt">Tests</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/twig">Twig</a></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></ul><ul class="nav-list"><li class="nav-list-item external"> <a class="nav-list-link external" href="https://github.com/selwynpolit/d9book/fork"> Fork me on GitHub <svg aria-labelledby="svg-external-link-title" viewbox="0 0 24 24"><use xlink:href="#svg-external-link"></use></svg> </a></li></ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer></div><div class="main" id="top"><div class="main-header" id="main-header"><div class="search"><div class="search-input-wrap"> <input aria-label="Search Drupal Book" autocomplete="off" class="search-input" id="search-input" placeholder="Search Drupal Book" tabindex="0" type="text"/> <label class="search-label" for="search-input"><svg class="search-icon" viewbox="0 0 24 24"><use xlink:href="#svg-search"></use></svg></label></div><div class="search-results" id="search-results"></div></div><nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a class="site-button" href="https://twitter.com/selwynpolit" rel="noopener noreferrer" target="_blank"> <img alt="Twitter logo" src="https://atuin.ru/demo/simple-icons/icons/twitter.svg" style="width: 30px; height: 30px;" title="Author in Twitter"/> </a><li class="aux-nav-list-item"> <a class="site-button" href="https://github.com/selwynpolit/d9book/tree/gh-pages" rel="noopener noreferrer" target="_blank"> <img alt="GitHub logo" src="https://atuin.ru/demo/simple-icons/icons/github.svg" style="width: 30px; height: 30px;" title="D9Book on GitHub"/> </a></li></li></ul></nav></div><div class="main-content-wrap" id="main-content-wrap"><div class="main-content" id="main-content" role="main"><h1 class="no_toc fw-500" id="menus"> <a aria-labelledby="menus" class="anchor-heading" href="https://selwynpolit.github.io/d9book/menus#menus"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Menus</h1><h2 class="no_toc text-delta" id="table-of-contents"> <a aria-labelledby="table-of-contents" class="anchor-heading" href="https://selwynpolit.github.io/d9book/menus#table-of-contents"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Table of contents</h2><ul id="markdown-toc"><li><a href="https://selwynpolit.github.io/d9book/menus#dynamically-change-menu-items-with-hook_preprocess_menu" id="markdown-toc-dynamically-change-menu-items-with-hook_preprocess_menu">Dynamically change menu items with hook_preprocess_menu</a><li><a href="https://selwynpolit.github.io/d9book/menus#permanently-update-menu-links-in-a-hook_update-using-entityquery" id="markdown-toc-permanently-update-menu-links-in-a-hook_update-using-entityquery">Permanently update menu links in a hook_update using entityQuery</a><li><a href="https://selwynpolit.github.io/d9book/menus#add-menu-items-with-hook_update" id="markdown-toc-add-menu-items-with-hook_update">Add menu items with hook_update</a><li><a href="https://selwynpolit.github.io/d9book/menus#permanently-modify-or-delete-menu-items-with-hook_update" id="markdown-toc-permanently-modify-or-delete-menu-items-with-hook_update">Permanently modify or delete menu items with hook_update</a><li><a href="https://selwynpolit.github.io/d9book/menus#peer-up-a-menu-to-its-parents-to-see-if-it-is-a-child-of-a-content-type" id="markdown-toc-peer-up-a-menu-to-its-parents-to-see-if-it-is-a-child-of-a-content-type">Peer up a menu to its parents to see if it is a child of a content type</a><li><a href="https://selwynpolit.github.io/d9book/menus#find-all-the-children-of-a-menu" id="markdown-toc-find-all-the-children-of-a-menu">Find all the children of a menu</a><li><a href="https://selwynpolit.github.io/d9book/menus#build-a-menu-and-all-its-children" id="markdown-toc-build-a-menu-and-all-its-children">Build a menu and all its children</a><li><a href="https://selwynpolit.github.io/d9book/menus#create-custom-twig-extension-for-rendering-a-menu" id="markdown-toc-create-custom-twig-extension-for-rendering-a-menu">Create custom Twig extension for rendering a menu</a><li><a href="https://selwynpolit.github.io/d9book/menus#active-trail" id="markdown-toc-active-trail">Active Trail</a><li><a href="https://selwynpolit.github.io/d9book/menus#get-a-nodes-menu-item-and-more" id="markdown-toc-get-a-nodes-menu-item-and-more">Get a node’s menu item and more</a><li><a href="https://selwynpolit.github.io/d9book/menus#create-menu-items-in-your-custom-module" id="markdown-toc-create-menu-items-in-your-custom-module">Create menu items in your custom module</a><li><a href="https://selwynpolit.github.io/d9book/menus#resources" id="markdown-toc-resources">Resources</a></li></li></li></li></li></li></li></li></li></li></li></li></ul><p><img alt="views" src="https://api.visitor.plantree.me/visitor-badge/pv?label=views&amp;color=informational&amp;namespace=d9book&amp;key=menus.md"/></p><hr/><h2 id="dynamically-change-menu-items-with-hook_preprocess_menu"> <a aria-labelledby="dynamically-change-menu-items-with-hook_preprocess_menu" class="anchor-heading" href="https://selwynpolit.github.io/d9book/menus#dynamically-change-menu-items-with-hook_preprocess_menu"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Dynamically change menu items with hook_preprocess_menu</h2><p>In the example below, we’re changing the labels of items in the user menu. The labels are changed from “login” and “log out” to “log the flock in” and “log the flock out.” This can be implemented in a theme file as it is here.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cd">/**
 * Implements hook_preprocess_menu().
 */</span>
<span class="k">function</span> <span class="n">pega_academy_theme_preprocess_menu</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$vars</span><span class="p">,</span> <span class="nv">$hook</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$hook</span> <span class="o">==</span> <span class="s1">'menu__account'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$items</span> <span class="o">=</span> <span class="nv">$vars</span><span class="p">[</span><span class="s1">'items'</span><span class="p">];</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$items</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$item</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nv">$key</span> <span class="o">==</span> <span class="s1">'user.page'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$vars</span><span class="p">[</span><span class="s1">'items'</span><span class="p">][</span><span class="nv">$key</span><span class="p">][</span><span class="s1">'title'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
          <span class="s1">'#markup'</span> <span class="o">=&gt;</span> <span class="s1">'Log the &lt;i&gt;flock&lt;/i&gt; in!'</span><span class="p">,</span>
          <span class="s1">'#allowed_tags'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'i'</span><span class="p">],</span>
        <span class="p">];</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nv">$key</span> <span class="o">==</span> <span class="s1">'user.logout'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$vars</span><span class="p">[</span><span class="s1">'items'</span><span class="p">][</span><span class="nv">$key</span><span class="p">][</span><span class="s1">'title'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
          <span class="s1">'#markup'</span> <span class="o">=&gt;</span> <span class="s1">'Log the &lt;i&gt;flock&lt;/i&gt; out!'</span><span class="p">,</span>
          <span class="s1">'#allowed_tags'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'i'</span><span class="p">],</span>
        <span class="p">];</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="permanently-update-menu-links-in-a-hook_update-using-entityquery"> <a aria-labelledby="permanently-update-menu-links-in-a-hook_update-using-entityquery" class="anchor-heading" href="https://selwynpolit.github.io/d9book/menus#permanently-update-menu-links-in-a-hook_update-using-entityquery"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Permanently update menu links in a hook_update using entityQuery</h2><p>To update menu item links, you can use the following code (from a .install file).</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">pdq_academy_core_update_8002</span><span class="p">()</span> <span class="p">{</span>

  <span class="nv">$mids</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityQuery</span><span class="p">(</span><span class="s1">'menu_link_content'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'menu_name'</span><span class="p">,</span> <span class="s1">'pdq-wide-utility'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>

  <span class="k">foreach</span><span class="p">(</span><span class="nv">$mids</span> <span class="k">as</span> <span class="nv">$mid</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$menu_link</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityTypeManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getStorage</span><span class="p">(</span><span class="s1">'menu_link_content'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">load</span><span class="p">(</span><span class="nv">$mid</span><span class="p">);</span>

    <span class="nv">$title</span> <span class="o">=</span> <span class="nv">$menu_link</span><span class="o">-&gt;</span><span class="nf">getTitle</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$title</span> <span class="o">===</span> <span class="s1">'Support'</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$menu_link</span><span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="s1">'weight'</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
      <span class="nv">$menu_link</span><span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="s1">'expanded'</span><span class="p">,</span> <span class="kc">TRUE</span><span class="p">);</span>
<span class="c1">//      $menu_link-&gt;set('title','yomama');</span>
      <span class="nv">$menu_link</span><span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="s1">'link'</span><span class="p">,</span> <span class="s1">'https://www.google.com'</span><span class="p">);</span>
      <span class="nv">$menu_link</span><span class="o">-&gt;</span><span class="nf">save</span><span class="p">();</span>

    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="add-menu-items-with-hook_update"> <a aria-labelledby="add-menu-items-with-hook_update" class="anchor-heading" href="https://selwynpolit.github.io/d9book/menus#add-menu-items-with-hook_update"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Add menu items with hook_update</h2><p>Menus are config entities while menu items are content entities. Here, a hook_update creates some menu items and adds them to an existing menu.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">pdq_archive_core_update_8001</span><span class="p">()</span> <span class="p">{</span>
  <span class="nv">$items</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'1'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'Training'</span><span class="p">,</span> <span class="s1">'https://abc.pdq.com/'</span><span class="p">,</span> <span class="o">-</span><span class="mi">51</span><span class="p">,</span> <span class="kc">TRUE</span><span class="p">],</span>
    <span class="s1">'2'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'Support'</span><span class="p">,</span> <span class="s1">'https://abc.pdq.com/search/product-support'</span><span class="p">,</span> <span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="kc">TRUE</span><span class="p">],</span>
  <span class="p">];</span>

  <span class="k">foreach</span><span class="p">(</span><span class="nv">$items</span> <span class="k">as</span> <span class="nv">$item</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$menu_link</span> <span class="o">=</span> <span class="nc">Drupal\menu_link_content\Entity\MenuLinkContent</span><span class="o">::</span><span class="nf">create</span><span class="p">([</span>
      <span class="s1">'title'</span> <span class="o">=&gt;</span> <span class="nv">$item</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
      <span class="s1">'link'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'uri'</span> <span class="o">=&gt;</span> <span class="nv">$item</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
      <span class="s1">'menu_name'</span> <span class="o">=&gt;</span> <span class="s1">'pdq-wide-utility'</span><span class="p">,</span>
      <span class="s1">'weight'</span> <span class="o">=&gt;</span> <span class="nv">$item</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
      <span class="s1">'expanded'</span> <span class="o">=&gt;</span> <span class="nv">$item</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
    <span class="p">]);</span>
    <span class="nv">$menu_link</span><span class="o">-&gt;</span><span class="nf">save</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="permanently-modify-or-delete-menu-items-with-hook_update"> <a aria-labelledby="permanently-modify-or-delete-menu-items-with-hook_update" class="anchor-heading" href="https://selwynpolit.github.io/d9book/menus#permanently-modify-or-delete-menu-items-with-hook_update"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Permanently modify or delete menu items with hook_update</h2><p>Below, we use hook_update to grab all the menu items in the menu called pdf-wide-utility, then loop thru them, delete some, and change the weight of some.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">pdq_archive_core_update_8001</span><span class="p">()</span> <span class="p">{</span>

  <span class="c1">// Update and remove unused menu items</span>
  <span class="nv">$mids</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityQuery</span><span class="p">(</span><span class="s1">'menu_link_content'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'menu_name'</span><span class="p">,</span> <span class="s1">'pdq-wide-utility'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>

  <span class="k">foreach</span><span class="p">(</span><span class="nv">$mids</span> <span class="k">as</span> <span class="nv">$mid</span><span class="p">)</span> <span class="p">{</span>

    <span class="nv">$menu_link</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityTypeManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getStorage</span><span class="p">(</span><span class="s1">'menu_link_content'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">load</span><span class="p">(</span><span class="nv">$mid</span><span class="p">);</span>

    <span class="nv">$title</span> <span class="o">=</span> <span class="nv">$menu_link</span><span class="o">-&gt;</span><span class="nf">getTitle</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$title</span> <span class="o">===</span> <span class="s1">'Pdq.com'</span> <span class="o">||</span> <span class="nv">$title</span> <span class="o">===</span> <span class="s1">'PDQ Community'</span> <span class="o">||</span> <span class="nv">$title</span> <span class="o">===</span> <span class="s1">'Careers'</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$menu_link</span><span class="o">-&gt;</span><span class="nb">delete</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$title</span> <span class="o">===</span> <span class="s1">'Support'</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$menu_link</span><span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="s1">'weight'</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
      <span class="nv">$menu_link</span><span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="s1">'expanded'</span><span class="p">,</span> <span class="kc">TRUE</span><span class="p">);</span>
      <span class="c1">//      $menu_link-&gt;set('title','yomama');</span>
      <span class="c1">//      $menu_link-&gt;set('link', 'https://www.google.com');</span>
      <span class="nv">$menu_link</span><span class="o">-&gt;</span><span class="nf">save</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p>If you need to get the parent value so you can make a menu item a child, use:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$parent_id</span> <span class="o">=</span> <span class="nv">$menu_link</span><span class="o">-&gt;</span><span class="nf">getPluginId</span><span class="p">();</span>
</code></pre></div></div><p>and</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$menu_link</span><span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="s1">'parent'</span><span class="p">,</span> <span class="nv">$parent_id</span><span class="p">);</span>
</code></pre></div></div><h2 id="peer-up-a-menu-to-its-parents-to-see-if-it-is-a-child-of-a-content-type"> <a aria-labelledby="peer-up-a-menu-to-its-parents-to-see-if-it-is-a-child-of-a-content-type" class="anchor-heading" href="https://selwynpolit.github.io/d9book/menus#peer-up-a-menu-to-its-parents-to-see-if-it-is-a-child-of-a-content-type"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Peer up a menu to its parents to see if it is a child of a content type</h2><p>Here, we need to display a sidebar if the current node is both a page and a child (or any level of offspring, e.g., grandchild, great-grandchild, etc.) of a content type “unit.” This means we need to “peer” up the menu chain to see what kind of parent the node has.</p><p>This example was implemented in a .theme file.</p><p>When hook_preprocess_node is called for my content type, and we are viewing a full node, we grab the nid and call the _check_ancestry_for_unit(), which looks up the menu chain for a menu item that points to a node of type “unit”. If there is one, we display the sidebar, i.e., we set the $variables [‘show_sidebar_menu’] to TRUE.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">txg_preprocess_node</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$variables</span><span class="p">)</span> <span class="p">{</span>
<span class="nv">$node</span> <span class="o">=</span> <span class="nv">$variables</span><span class="p">[</span><span class="s1">'node'</span><span class="p">];</span>

<span class="k">if</span> <span class="p">((</span><span class="nv">$node</span><span class="o">-&gt;</span><span class="nb">getType</span><span class="p">()</span> <span class="o">==</span> <span class="s1">'page'</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$view_mode</span> <span class="o">==</span> <span class="s1">'full'</span><span class="p">))</span> <span class="p">{</span>
  <span class="c1">// This will only be true if it is a node route.</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$node</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">request</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">attributes</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'node'</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">is_string</span><span class="p">(</span><span class="nv">$node</span><span class="p">))</span> <span class="p">{</span>
      <span class="nv">$node_id</span> <span class="o">=</span> <span class="nv">$node</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="nv">$node_id</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nv">$show_sidebar</span> <span class="o">=</span> <span class="nf">_check_ancestry_for_unit</span><span class="p">(</span><span class="nv">$node_id</span><span class="p">);</span>
  <span class="nv">$variables</span><span class="p">[</span><span class="s1">'show_sidebar_menu'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$show_sidebar</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><p>Here is the function _check_ancestry_for_unit():</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cd">/**
 * Go look up the menu chain for a unit.
 *
 * @param int $node_id
 *   Start with this node.
 * @param int $unit_nid
 *   Fill in the unit nid that you found.
 *
 * @return bool
 *   Return TRUE if there is a unit in the lineage.
 *
 * @throws \Drupal\Component\Plugin\Exception\PluginException
 */</span>
<span class="k">function</span> <span class="n">_check_ancestry_for_unit</span><span class="p">(</span><span class="kt">int</span> <span class="nv">$node_id</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$unit_nid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$menu_item_title</span> <span class="o">=</span> <span class="s1">''</span><span class="p">)</span> <span class="p">{</span>
  <span class="cd">/** @var \Drupal\Core\Menu\MenuLinkManagerInterface $menu_link_manager */</span>
  <span class="nv">$menu_link_manager</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">service</span><span class="p">(</span><span class="s1">'plugin.manager.menu.link'</span><span class="p">);</span>
  <span class="nv">$links</span> <span class="o">=</span> <span class="nv">$menu_link_manager</span><span class="o">-&gt;</span><span class="nf">loadLinksByRoute</span><span class="p">(</span><span class="s1">'entity.node.canonical'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'node'</span> <span class="o">=&gt;</span> <span class="nv">$node_id</span><span class="p">]);</span>

  <span class="cd">/** @var \Drupal\Core\Menu\MenuLinkContent $link */</span>
  <span class="nv">$link</span> <span class="o">=</span> <span class="nb">reset</span><span class="p">(</span><span class="nv">$links</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$link</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="nv">$parent_menu_id</span> <span class="o">=</span> <span class="nv">$link</span><span class="o">-&gt;</span><span class="nf">getParent</span><span class="p">())</span> <span class="p">{</span>

      <span class="c1">// Create a menu item.</span>
      <span class="cd">/** @var \Drupal\Core\Menu\MenuLinkInterface $parent */</span>
      <span class="nv">$parent_menu_item</span> <span class="o">=</span> <span class="nv">$menu_link_manager</span><span class="o">-&gt;</span><span class="nf">createInstance</span><span class="p">(</span><span class="nv">$parent_menu_id</span><span class="p">);</span>
      <span class="nv">$parent_url</span> <span class="o">=</span> <span class="nv">$parent_menu_item</span><span class="o">-&gt;</span><span class="nf">getUrlObject</span><span class="p">();</span>

      <span class="c1">// Is the parent an External link e.g. nytimes.com?</span>
      <span class="nv">$external</span> <span class="o">=</span> <span class="nv">$parent_url</span><span class="o">-&gt;</span><span class="nf">isExternal</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="nv">$external</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">FALSE</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="c1">// Internal links (could be &lt;nolink&gt;)</span>
      <span class="nv">$internal</span> <span class="o">=</span> <span class="nv">$parent_url</span><span class="o">-&gt;</span><span class="nf">isRouted</span><span class="p">();</span>
      <span class="nv">$parent_route</span> <span class="o">=</span> <span class="nv">$parent_url</span><span class="o">-&gt;</span><span class="nf">getRouteParameters</span><span class="p">();</span>
      <span class="c1">// When $parent_route is &lt;nolink&gt;.</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$parent_route</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">FALSE</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="c1">// Parent is an internal link.</span>
      <span class="c1">// Does parent menu item refer to a unit?</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$parent_route</span><span class="p">[</span><span class="s1">'node'</span><span class="p">]))</span> <span class="p">{</span>
        <span class="nv">$parent_nid</span> <span class="o">=</span> <span class="nv">$parent_route</span><span class="p">[</span><span class="s1">'node'</span><span class="p">];</span>
        <span class="nv">$parent_node</span> <span class="o">=</span> <span class="nc">Node</span><span class="o">::</span><span class="nf">load</span><span class="p">(</span><span class="nv">$parent_nid</span><span class="p">);</span>
        <span class="nv">$parent_type</span> <span class="o">=</span> <span class="nv">$parent_node</span><span class="o">-&gt;</span><span class="nb">getType</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$parent_type</span> <span class="o">==</span> <span class="s1">'unit'</span><span class="p">)</span> <span class="p">{</span>
          <span class="nv">$unit_nid</span> <span class="o">=</span> <span class="nv">$parent_nid</span><span class="p">;</span>
          <span class="nv">$menu_item_title</span> <span class="o">=</span> <span class="nv">$parent_menu_item</span><span class="o">-&gt;</span><span class="nf">getTitle</span><span class="p">();</span>
          <span class="k">return</span> <span class="kc">TRUE</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nv">$links</span> <span class="o">=</span> <span class="nv">$menu_link_manager</span><span class="o">-&gt;</span><span class="nf">loadLinksByRoute</span><span class="p">(</span><span class="s1">'entity.node.canonical'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'node'</span> <span class="o">=&gt;</span> <span class="nv">$parent_nid</span><span class="p">]);</span>
        <span class="nv">$link</span> <span class="o">=</span> <span class="nb">reset</span><span class="p">(</span><span class="nv">$links</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// Some other kind of internal link.</span>
        <span class="k">return</span> <span class="kc">FALSE</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kc">FALSE</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="find-all-the-children-of-a-menu"> <a aria-labelledby="find-all-the-children-of-a-menu" class="anchor-heading" href="https://selwynpolit.github.io/d9book/menus#find-all-the-children-of-a-menu"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Find all the children of a menu</h2><p>From a .module file, I needed to load a dropdown with items from the main menu.</p><p>You can load the menu up with this:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">Drupal\Core\Menu\MenuTreeParameters</span><span class="p">;</span>


<span class="k">function</span> <span class="n">get_menutree</span><span class="p">(</span><span class="nv">$menu_name</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$parameters</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MenuTreeParameters</span><span class="p">();</span>

  <span class="c1">// Only enabled items.</span>
  <span class="nv">$parameters</span><span class="o">-&gt;</span><span class="nf">onlyEnabledLinks</span><span class="p">();</span>

  <span class="c1">// Load the tree.</span>
  <span class="nv">$tree</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">menuTree</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">load</span><span class="p">(</span><span class="nv">$menu_name</span><span class="p">,</span> <span class="nv">$parameters</span><span class="p">);</span>
  <span class="k">return</span> <span class="nv">$tree</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><p>This is basically the same as:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$sub_nav</span> <span class="o">=</span> <span class="nv">$menu_tree</span><span class="o">-&gt;</span><span class="nf">load</span><span class="p">(</span><span class="s1">'main'</span><span class="p">,</span> <span class="k">new</span> <span class="nc">\Drupal\Core\Menu\MenuTreeParameters</span><span class="p">());</span>
</code></pre></div></div><p>And here we call get_menutree() and then loop through the menu items to build some arrays to be rendered via a twig template. We loop through the top level, skipping non-nodes:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">get_offices</span><span class="p">()</span> <span class="p">{</span>

  <span class="c1">//Get drupal main menu</span>
  <span class="nv">$tree</span> <span class="o">=</span> <span class="nf">get_menutree</span><span class="p">(</span><span class="s1">'main'</span><span class="p">);</span>
  <span class="nv">$menu_tree</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">menuTree</span><span class="p">();</span>

  <span class="c1">// Build a renderable array from the tree which fills in all the children in</span>
  <span class="c1">// item['below']</span>
  <span class="nv">$menu_render_array</span> <span class="o">=</span> <span class="nv">$menu_tree</span><span class="o">-&gt;</span><span class="nf">build</span><span class="p">(</span><span class="nv">$tree</span><span class="p">);</span>
  <span class="nv">$storage</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="nv">$nid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">foreach</span> <span class="p">(</span><span class="nv">$menu_render_array</span><span class="p">[</span><span class="s1">'#items'</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$item</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$url</span> <span class="o">=</span> <span class="nv">$item</span><span class="p">[</span><span class="s2">"url"</span><span class="p">];</span>
    <span class="nv">$route</span> <span class="o">=</span> <span class="nv">$url</span><span class="o">-&gt;</span><span class="nf">getRouteParameters</span><span class="p">();</span>
    <span class="c1">// Skip menu items that aren't nodes.</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">isset</span><span class="p">(</span><span class="nv">$route</span><span class="p">[</span><span class="s1">'node'</span><span class="p">]))</span> <span class="p">{</span>
      <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nv">$nid</span> <span class="o">=</span> <span class="nv">$route</span><span class="p">[</span><span class="s2">"node"</span><span class="p">];</span>
    <span class="nv">$node</span> <span class="o">=</span> <span class="nc">Node</span><span class="o">::</span><span class="nf">load</span><span class="p">(</span><span class="nv">$nid</span><span class="p">);</span>
    <span class="nv">$type</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nb">getType</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$type</span> <span class="o">=</span> <span class="s2">"area_of_focus"</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$storage</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">'title'</span> <span class="o">=&gt;</span> <span class="nv">$item</span><span class="p">[</span><span class="s1">'title'</span><span class="p">],</span>
        <span class="s1">'value'</span> <span class="o">=&gt;</span> <span class="nv">$nid</span>
      <span class="p">];</span>
    <span class="p">}</span>

    <span class="c1">// Process children:</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$item</span><span class="p">[</span><span class="s1">'below'</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$child</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$url</span> <span class="o">=</span> <span class="nv">$child</span><span class="p">[</span><span class="s2">"url"</span><span class="p">];</span>
      <span class="nv">$route</span> <span class="o">=</span> <span class="nv">$url</span><span class="o">-&gt;</span><span class="nf">getRouteParameters</span><span class="p">();</span>
      <span class="nv">$nid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="nv">$type</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$route</span><span class="p">[</span><span class="s1">'node'</span><span class="p">]))</span> <span class="p">{</span>
        <span class="nv">$nid</span> <span class="o">=</span> <span class="nv">$route</span><span class="p">[</span><span class="s2">"node"</span><span class="p">];</span>
        <span class="nv">$node</span> <span class="o">=</span> <span class="nc">Node</span><span class="o">::</span><span class="nf">load</span><span class="p">(</span><span class="nv">$nid</span><span class="p">);</span>
        <span class="nv">$type</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nb">getType</span><span class="p">();</span>

      <span class="p">}</span>
      <span class="c1">// Only add units.</span>
      <span class="k">if</span> <span class="p">(</span><span class="nv">$type</span> <span class="o">==</span> <span class="s1">'unit'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$storage</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[</span>
          <span class="s1">'title'</span> <span class="o">=&gt;</span> <span class="s1">'--'</span> <span class="mf">.</span> <span class="nv">$child</span><span class="p">[</span><span class="s1">'title'</span><span class="p">]</span> <span class="mf">.</span> <span class="s1">' ('</span> <span class="mf">.</span> <span class="nv">$type</span> <span class="mf">.</span> <span class="s1">')'</span><span class="p">,</span>
          <span class="s1">'value'</span> <span class="o">=&gt;</span> <span class="nv">$nid</span>
        <span class="p">];</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nv">$storage</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><p>And the template that is used to display the dropdown, node--news-stories-landing-page.html.twig:</p><div class="language-twig highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"#"</span> <span class="na">class=</span><span class="s">"filter-form"</span><span class="nt">&gt;</span>
 <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"search-form"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"search"</span> <span class="na">placeholder=</span><span class="s">"Search Events by Keyword"</span> <span class="na">title=</span><span class="s">"Type search text here"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span><span class="nt">&gt;&lt;i</span> <span class="na">class=</span><span class="s">"icon icon-search"</span><span class="nt">&gt;&lt;/i&gt;&lt;span</span> <span class="na">class=</span><span class="s">"show-for-sr"</span><span class="nt">&gt;</span>Search<span class="nt">&lt;/span&gt;&lt;/button&gt;</span>
 <span class="nt">&lt;/div&gt;</span>
 <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"grid-x grid-margin-x align-justify"</span><span class="nt">&gt;</span>
    
 <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre></div></div><p>And the form looks like this:</p><p><img alt="Dropdown menu image" src="https://selwynpolit.github.io/d9book/assets/images/dropdown_menus.png"/></p><h2 id="build-a-menu-and-all-its-children"> <a aria-labelledby="build-a-menu-and-all-its-children" class="anchor-heading" href="https://selwynpolit.github.io/d9book/menus#build-a-menu-and-all-its-children"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Build a menu and all its children</h2><p>This also looks pretty interesting, but I haven’t tried it. It is from <a href="https://stackoverflow.com/questions/54245942/drupal-8-menulinkcontent-get-all-children-via-loadbyproperties/54254491">https://stackoverflow.com/questions/54245942/drupal-8-menulinkcontent-get-all-children-via-loadbyproperties/54254491</a></p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">generateSubMenuTree</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$output</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$input</span><span class="p">,</span> <span class="nv">$parent</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$input</span> <span class="o">=</span> <span class="nb">array_values</span><span class="p">(</span><span class="nv">$input</span><span class="p">);</span>
  <span class="k">foreach</span> <span class="p">(</span><span class="nv">$input</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$item</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//If menu element disabled skip this branch</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$item</span><span class="o">-&gt;</span><span class="n">link</span><span class="o">-&gt;</span><span class="nf">isEnabled</span><span class="p">())</span> <span class="p">{</span>
      <span class="nv">$key</span> <span class="o">=</span> <span class="s1">'submenu-'</span> <span class="mf">.</span> <span class="nv">$key</span><span class="p">;</span>
      <span class="nv">$name</span> <span class="o">=</span> <span class="nv">$item</span><span class="o">-&gt;</span><span class="n">link</span><span class="o">-&gt;</span><span class="nf">getTitle</span><span class="p">();</span>
      <span class="nv">$url</span> <span class="o">=</span> <span class="nv">$item</span><span class="o">-&gt;</span><span class="n">link</span><span class="o">-&gt;</span><span class="nf">getUrlObject</span><span class="p">();</span>
      <span class="nv">$url_string</span> <span class="o">=</span> <span class="nv">$url</span><span class="o">-&gt;</span><span class="nf">toString</span><span class="p">();</span>

      <span class="c1">//If not root element, add as child</span>
      <span class="k">if</span> <span class="p">(</span><span class="nv">$parent</span> <span class="o">===</span> <span class="kc">FALSE</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$output</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
          <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="nv">$name</span><span class="p">,</span>
          <span class="s1">'tid'</span> <span class="o">=&gt;</span> <span class="nv">$key</span><span class="p">,</span>
          <span class="s1">'url_str'</span> <span class="o">=&gt;</span> <span class="nv">$url_string</span>
        <span class="p">];</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$parent</span> <span class="o">=</span> <span class="s1">'submenu-'</span> <span class="mf">.</span> <span class="nv">$parent</span><span class="p">;</span>
        <span class="nv">$output</span><span class="p">[</span><span class="s1">'child'</span><span class="p">][</span><span class="nv">$key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
          <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="nv">$name</span><span class="p">,</span>
          <span class="s1">'tid'</span> <span class="o">=&gt;</span> <span class="nv">$key</span><span class="p">,</span>
          <span class="s1">'url_str'</span> <span class="o">=&gt;</span> <span class="nv">$url_string</span>
        <span class="p">];</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="nv">$item</span><span class="o">-&gt;</span><span class="n">hasChildren</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$item</span><span class="o">-&gt;</span><span class="n">depth</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
          <span class="nf">generateSubMenuTree</span><span class="p">(</span><span class="nv">$output</span><span class="p">[</span><span class="nv">$key</span><span class="p">],</span> <span class="nv">$item</span><span class="o">-&gt;</span><span class="n">subtree</span><span class="p">,</span> <span class="nv">$key</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
          <span class="nf">generateSubMenuTree</span><span class="p">(</span><span class="nv">$output</span><span class="p">[</span><span class="s1">'child'</span><span class="p">][</span><span class="nv">$key</span><span class="p">],</span> <span class="nv">$item</span><span class="o">-&gt;</span><span class="n">subtree</span><span class="p">,</span> <span class="nv">$key</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p>It is called with:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//Get drupal menu</span>
<span class="nv">$sub_nav</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">menuTree</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">load</span><span class="p">(</span><span class="s1">'main'</span><span class="p">,</span> <span class="k">new</span> <span class="nc">\Drupal\Core\Menu\MenuTreeParameters</span><span class="p">());</span>

<span class="c1">//Generate array</span>
<span class="nf">generateSubMenuTree</span><span class="p">(</span><span class="nv">$menu_tree2</span><span class="p">,</span> <span class="nv">$sub_nav</span><span class="p">);</span>
</code></pre></div></div><h2 id="create-custom-twig-extension-for-rendering-a-menu"> <a aria-labelledby="create-custom-twig-extension-for-rendering-a-menu" class="anchor-heading" href="https://selwynpolit.github.io/d9book/menus#create-custom-twig-extension-for-rendering-a-menu"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Create custom Twig extension for rendering a menu</h2><p>Note. The module <a href="https://www.drupal.org/project/twig_tweak">twig_tweak module</a> can do all this with one line of code:</p><div class="language-twig highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">{{</span> <span class="nv">drupal_menu</span><span class="p">(</span><span class="s1">'main'</span><span class="p">,</span> <span class="nv">2</span><span class="p">,</span> <span class="nv">3</span><span class="p">,</span> <span class="nv">TRUE</span><span class="p">)</span> <span class="cp">}}</span>
</code></pre></div></div><p>More at: <a href="https://www.drupal.org/docs/8/modules/twig-tweak/cheat-sheet">https://www.drupal.org/docs/8/modules/twig-tweak/cheat-sheet</a></p><p>From <a href="https://www.drupal.org/forum/support/theme-development/2015-01-29/rendering-a-menu-in-twig-drupal-8">https://www.drupal.org/forum/support/theme-development/2015-01-29/rendering-a-menu-in-twig-drupal-8</a>, Peter from Dusseldorf shows how to render a menu into a render array. He runs through the whole load, transform (with manipulators) and build. He does this through the magic of a twig extension. So, in modules/custom/custom_module/src/Twig/RenderMenuExtension.php:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">namespace</span> <span class="nn">Drupal\custom_module\Twig</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">RenderMenuExtension</span> <span class="kd">extends</span> <span class="nc">\Twig_Extension</span> <span class="p">{</span>

  <span class="cd">/**
   * @return array
   */</span>
  <span class="k">public</span> <span class="k">function</span> <span class="n">getFunctions</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span>
      <span class="k">new</span> <span class="nc">\Twig_SimpleFunction</span><span class="p">(</span><span class="s1">'renderMenu'</span><span class="p">,</span> <span class="p">[</span><span class="nv">$this</span><span class="p">,</span> <span class="s1">'renderMenu'</span><span class="p">]),</span>
    <span class="p">];</span>
  <span class="p">}</span>

  <span class="cd">/**
   * Provides function to programmatically rendering a menu
   *
   * @param String $menu_name
   *   The machine configuration id of the menu to render
   */</span>
  <span class="k">public</span> <span class="k">function</span> <span class="n">renderMenu</span><span class="p">(</span><span class="kt">string</span> <span class="nv">$menu_name</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$menu_tree</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">menuTree</span><span class="p">();</span>

    <span class="c1">// Build the typical default set of menu tree parameters.</span>
    <span class="nv">$parameters</span> <span class="o">=</span> <span class="nv">$menu_tree</span><span class="o">-&gt;</span><span class="nf">getCurrentRouteMenuTreeParameters</span><span class="p">(</span><span class="nv">$menu_name</span><span class="p">);</span>

    <span class="c1">// Load the tree based on this set of parameters.</span>
    <span class="nv">$tree</span> <span class="o">=</span> <span class="nv">$menu_tree</span><span class="o">-&gt;</span><span class="nf">load</span><span class="p">(</span><span class="nv">$menu_name</span><span class="p">,</span> <span class="nv">$parameters</span><span class="p">);</span>

    <span class="c1">// Transform the tree using the manipulators you want.</span>
    <span class="nv">$manipulators</span> <span class="o">=</span> <span class="p">[</span>
      <span class="c1">// Only show links that are accessible for the current user.</span>
      <span class="p">[</span><span class="s1">'callable'</span> <span class="o">=&gt;</span> <span class="s1">'menu.default_tree_manipulators:checkAccess'</span><span class="p">],</span>
      <span class="c1">// Use the default sorting of menu links.</span>
      <span class="p">[</span><span class="s1">'callable'</span> <span class="o">=&gt;</span> <span class="s1">'menu.default_tree_manipulators:generateIndexAndSort'</span><span class="p">],</span>
    <span class="p">];</span>
    <span class="nv">$tree</span> <span class="o">=</span> <span class="nv">$menu_tree</span><span class="o">-&gt;</span><span class="nf">transform</span><span class="p">(</span><span class="nv">$tree</span><span class="p">,</span> <span class="nv">$manipulators</span><span class="p">);</span>

    <span class="c1">// Finally, build a renderable array from the transformed tree.</span>
    <span class="nv">$menu</span> <span class="o">=</span> <span class="nv">$menu_tree</span><span class="o">-&gt;</span><span class="nf">build</span><span class="p">(</span><span class="nv">$tree</span><span class="p">);</span>

    <span class="nv">$menu</span><span class="p">[</span><span class="s1">'#attributes'</span><span class="p">][</span><span class="s1">'class'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'menu '</span> <span class="mf">.</span> <span class="nv">$menu_name</span><span class="p">;</span>

    <span class="k">return</span> <span class="p">[</span><span class="s1">'#markup'</span> <span class="o">=&gt;</span> <span class="nf">drupal_render</span><span class="p">(</span><span class="nv">$menu</span><span class="p">)];</span>
  <span class="p">}</span>

<span class="p">}</span>
</code></pre></div></div><p>Oh, and you do need to implement the getFunctions() in your class. It looks something like this:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="n">getFunctions</span><span class="p">()</span> <span class="p">{</span>
  <span class="nv">$context_options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'needs_context'</span> <span class="o">=&gt;</span> <span class="kc">TRUE</span><span class="p">];</span>
  <span class="nv">$all_options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'needs_environment'</span> <span class="o">=&gt;</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="s1">'needs_context'</span> <span class="o">=&gt;</span> <span class="kc">TRUE</span><span class="p">];</span>
  <span class="k">return</span> <span class="p">[</span>
    <span class="k">new</span> <span class="nc">\Twig_SimpleFunction</span><span class="p">(</span><span class="s1">'drupal_render'</span><span class="p">,</span> <span class="p">[</span><span class="nv">$this</span><span class="p">,</span> <span class="s1">'renderMenu'</span><span class="p">]),</span>
  <span class="p">];</span>
<span class="p">}</span>
</code></pre></div></div><p>In custom_module.services.yml:</p><div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">custom_module.render_menu_extension</span><span class="pi">:</span>
    <span class="na">class</span><span class="pi">:</span> <span class="s">Drupal\custom_module\Twig\RenderMenuExtension</span>
    <span class="na">tags</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="pi">{</span> <span class="nv">name</span><span class="pi">:</span> <span class="nv">twig.extension</span> <span class="pi">}</span>
</code></pre></div></div><p>To render your menu in the template via this twig function call:</p><div class="language-twig highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">{{</span> <span class="nv">renderMenu</span><span class="p">(</span><span class="s1">'main'</span><span class="p">)</span> <span class="cp">}}</span>
</code></pre></div></div><h2 id="active-trail"> <a aria-labelledby="active-trail" class="anchor-heading" href="https://selwynpolit.github.io/d9book/menus#active-trail"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Active Trail</h2><p>From https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Menu%21MenuTreeParameters.php/property/MenuTreeParameters%3A%3AactiveTrail/9.3.x</p><p>The IDs from the currently active menu link to the root of the whole tree.</p><p>Active trail is an array of menu link plugin IDs, representing the trail from the currently active menu link to the ("real") root of that menu link's menu. This does not affect the way the tree is built. It is only used to set the value of the inActiveTrail property for each tree element.</p><p>In the code below, I grab the active trail for an item that is in a menu. Then, I grab all the links for the current node_id, pull off the first one, grab the plugin (which is <code class="language-plaintext highlighter-rouge">menu_link_content:957297e4-38eb-4502-868a-668407c71a44</code> – the id from the menu_tree table), and get the parameters (all the juicy goodness about this menu item). You can find a nice trail back up the menu chain along the active_trail. See activeTrail in the debug variable dump below.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Get current item's menu</span>
<span class="cd">/** @var \Drupal\Core\Menu\MenuLinkManagerInterface $menu_link_manager */</span>
<span class="nv">$menu_link_manager</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">service</span><span class="p">(</span><span class="s1">'plugin.manager.menu.link'</span><span class="p">);</span>
<span class="nv">$links</span> <span class="o">=</span> <span class="nv">$menu_link_manager</span><span class="o">-&gt;</span><span class="nf">loadLinksByRoute</span><span class="p">(</span><span class="s1">'entity.node.canonical'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'node'</span> <span class="o">=&gt;</span> <span class="nv">$node_id</span><span class="p">]);</span>
<span class="cd">/** @var \Drupal\Core\Menu\MenuLinkContent $currentMenuItem */</span>
<span class="nv">$currentMenuItem</span> <span class="o">=</span> <span class="nb">reset</span><span class="p">(</span><span class="nv">$links</span><span class="p">);</span>

<span class="c1">// grab plugin for the current item</span>
<span class="nv">$pluginId</span> <span class="o">=</span> <span class="nv">$currentMenuItem</span><span class="o">-&gt;</span><span class="nf">getPluginId</span><span class="p">();</span>

<span class="cd">/** @var \Drupal\Core\Menu\MenuLinkTreeInterface $menu_tree */</span>
<span class="nv">$menu_tree</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">service</span><span class="p">(</span><span class="s1">'menu.link_tree'</span><span class="p">);</span>
<span class="nv">$parameters</span> <span class="o">=</span> <span class="nv">$menu_tree</span><span class="o">-&gt;</span><span class="nf">getCurrentRouteMenuTreeParameters</span><span class="p">(</span><span class="nv">$menu_name</span><span class="p">);</span>

<span class="c1">// grab the active trail.</span>
<span class="nv">$active_trail</span> <span class="o">=</span> <span class="nb">array_keys</span><span class="p">(</span><span class="nv">$parameters</span><span class="o">-&gt;</span><span class="n">activeTrail</span><span class="p">);</span>
</code></pre></div></div><p><img alt="Menu debug display" src="https://selwynpolit.github.io/d9book/assets/images/menu_debug_dump.png"/></p><p>Extracting out the active trail gives this useful information:</p><p><img alt="Active trail debug display" src="https://selwynpolit.github.io/d9book/assets/images/active_trail_debug.png"/></p><h2 id="get-a-nodes-menu-item-and-more"> <a aria-labelledby="get-a-nodes-menu-item-and-more" class="anchor-heading" href="https://selwynpolit.github.io/d9book/menus#get-a-nodes-menu-item-and-more"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Get a node’s menu item and more</h2><p>Here we get the current route’s menu item using its nid then pull the link from the array using reset, and we can extract the URL as well as other exciting things. Mostly we want to check its children, parents etc. In the code below, we grab its URL as well as its parent and its title.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cd">/** @var \Drupal\Core\Menu\MenuLinkManagerInterface $menu_link_manager */</span>
<span class="nv">$menu_link_manager</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">service</span><span class="p">(</span><span class="s1">'plugin.manager.menu.link'</span><span class="p">);</span>
<span class="nv">$links</span> <span class="o">=</span> <span class="nv">$menu_link_manager</span><span class="o">-&gt;</span><span class="nf">loadLinksByRoute</span><span class="p">(</span><span class="s1">'entity.node.canonical'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'node'</span> <span class="o">=&gt;</span> <span class="nv">$nid</span><span class="p">]);</span>
<span class="nv">$link</span> <span class="o">=</span> <span class="nb">reset</span><span class="p">(</span><span class="nv">$links</span><span class="p">);</span>
<span class="nv">$urlobject</span> <span class="o">=</span> <span class="nv">$link</span><span class="o">-&gt;</span><span class="nf">getUrlObject</span><span class="p">();</span>
<span class="nv">$url_string</span> <span class="o">=</span> <span class="nv">$urlobject</span><span class="o">-&gt;</span><span class="nf">toString</span><span class="p">();</span>
<span class="nv">$x</span> <span class="o">=</span> <span class="nv">$link</span><span class="o">-&gt;</span><span class="nf">getParent</span><span class="p">();</span> <span class="c1">//get the parent menu item GUID.</span>
<span class="nv">$y</span> <span class="o">=</span> <span class="nv">$link</span><span class="o">-&gt;</span><span class="nf">getTitle</span><span class="p">();</span> <span class="c1">// get the title of the menu item.</span>

<span class="nv">$menu_name</span> <span class="o">=</span> <span class="nv">$link</span><span class="o">-&gt;</span><span class="nf">getMenuName</span><span class="p">();</span> <span class="c1">// get the menu name e.g. "main"</span>
</code></pre></div></div><h2 id="create-menu-items-in-your-custom-module"> <a aria-labelledby="create-menu-items-in-your-custom-module" class="anchor-heading" href="https://selwynpolit.github.io/d9book/menus#create-menu-items-in-your-custom-module"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Create menu items in your custom module</h2><p>When creating a menu for your module, you need a YAML file like this from dev1 pageexample. The names (e.g. pageexample.description and pageexample.simple) are arbitrary, the title is the menu text, and the route_name comes from the routing yml file (<code class="language-plaintext highlighter-rouge">web/modules/custom/pageexample/pageexample.routing.yml</code>). The parent value is interesting.</p><div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">pageexample_description</span><span class="pi">:</span>
  <span class="na">title</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Page</span><span class="nv"> </span><span class="s">Example'</span>
  <span class="na">route_name</span><span class="pi">:</span> <span class="s">pageexample_description</span>
  <span class="na">parent</span><span class="pi">:</span> <span class="s">system.admin_reports</span>
<span class="na">pageexample.simple</span><span class="pi">:</span>
  <span class="na">title</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Simple</span><span class="nv"> </span><span class="s">page</span><span class="nv"> </span><span class="s">example</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">no</span><span class="nv"> </span><span class="s">arguments'</span>
  <span class="na">route_name</span><span class="pi">:</span> <span class="s">pageexample_simple</span>
  <span class="na">parent</span><span class="pi">:</span> <span class="s">system.admin_reports</span>
</code></pre></div></div><p>The parent values are defined in other *.links.menu.yml files and especially the Structure link, which is defined in the core System module in system.links.menu.yml. Here we are adding a link to appear under the Reports menu of Drupal.</p><p>To create menu links programmatically, see <a href="https://drupal.stackexchange.com/questions/197073/how-do-i-create-menu-links-programmatically/197076#197076">https://drupal.stackexchange.com/questions/197073/how-do-i-create-menu-links-programmatically/197076#197076</a></p><p>To edit menu links programmatically, see <a href="https://drupal.stackexchange.com/questions/235516/how-do-i-programmatically-update-or-delete-menu-items">https://drupal.stackexchange.com/questions/235516/how-do-i-programmatically-update-or-delete-menu-items</a></p><p>First you will have to load the entity. Either way works:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$menu_link</span> <span class="o">=</span> <span class="nc">MenuLinkContent</span><span class="o">::</span><span class="nf">load</span><span class="p">(</span><span class="nv">$menu_link_id</span><span class="p">);</span>
</code></pre></div></div><p>or ...</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$menu_link</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityTypeManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getStorage</span><span class="p">(</span><span class="s1">'menu_link_content'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">load</span><span class="p">(</span><span class="nv">$menu_link_id</span><span class="p">);</span>
</code></pre></div></div><p>Next you can update value using set() method or through the magic method __set...</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$menu_link</span><span class="o">-&gt;</span><span class="n">expanded</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">;</span>
</code></pre></div></div><p>To save, simply call the <code class="language-plaintext highlighter-rouge">save()</code> method. To delete, call the <code class="language-plaintext highlighter-rouge">delete()</code> method.</p><h2 id="resources"> <a aria-labelledby="resources" class="anchor-heading" href="https://selwynpolit.github.io/d9book/menus#resources"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Resources</h2><ul><li><p>To create menu links programmatically see <a href="https://drupal.stackexchange.com/questions/197073/how-do-i-create-menu-links-programmatically/197076#197076">https://drupal.stackexchange.com/questions/197073/how-do-i-create-menu-links-programmatically/197076#197076</a></p><li><p>To edit menu links programmatically, see <a href="https://drupal.stackexchange.com/questions/235516/how-do-i-programmatically-update-or-delete-menu-items">https://drupal.stackexchange.com/questions/235516/how-do-i-programmatically-update-or-delete-menu-items</a></p><li><p>Active Trail <a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Menu%21MenuTreeParameters.php/property/MenuTreeParameters%3A%3AactiveTrail/9.3.x">https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Menu%21MenuTreeParameters.php/property/MenuTreeParameters%3A%3AactiveTrail/9.3.x</a></p><li><p>The <a href="https://www.drupal.org/project/twig_tweak">Twig_Tweak module</a> can do some great menu magic. Cheat sheet at <a href="https://www.drupal.org/docs/8/modules/twig-tweak/cheat-sheet">https://www.drupal.org/docs/8/modules/twig-tweak/cheat-sheet</a></p><li><p><a href="https://www.hashbangcode.com/article/drupal-9-creating-category-menu-using-derivers">#! code: Drupal 9: Creating A Category Menu Using Derivers, August 2022</a></p></li></li></li></li></li></ul><hr/> <script async="" crossorigin="anonymous" data-category="Q&amp;A" data-category-id="MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMyMjY2NDE4" data-emit-metadata="0" data-input-position="bottom" data-lang="en" data-mapping="title" data-reactions-enabled="1" data-repo="selwynpolit/d9book" data-repo-id="MDEwOlJlcG9zaXRvcnkzMjUxNTQ1Nzg=" data-strict="0" data-theme="preferred_color_scheme" src="https://giscus.app/client.js"> </script><hr/><footer><p><a href="https://selwynpolit.github.io/d9book/menus#top" id="back-to-top">Back to top</a></p><p class="text-small text-grey-dk-100 mb-0"><span xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/"> <a href="http://www.selwynpolit.github.io/d9book" property="dct:title" rel="cc:attributionURL">Drupal at your fingertips</a> by <a href="http://www.drupal.org/u/selwynpolit" property="cc:attributionName" rel="cc:attributionURL dct:creator">Selwyn Polit</a> is licensed under <a href="http://creativecommons.org/licenses/by/4.0/" rel="license noopener noreferrer" target="_blank">CC BY 4.0 <img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg" style="height:16px!important;vertical-align:text-bottom;"/> <img src="https://mirrors.creativecommons.org/presskit/icons/by.svg" style="height:16px!important;vertical-align:text-bottom;"/> </a></span></p><div class="d-flex mt-2"><p class="text-small text-grey-dk-000 mb-0 mr-2"> Page last modified: <span class="d-inline-block">Apr 13 2023</span>.</p><p class="text-small text-grey-dk-000 mb-0"> <a href="https://github.com/selwynpolit/d9book/tree/gh-pages/book/menus.md" id="edit-this-page">Edit this page on GitHub</a></p></div></footer></div></div><div class="search-overlay"></div></div>
</body></link></meta></meta></meta></head></html>