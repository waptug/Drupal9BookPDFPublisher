<!DOCTYPE html>
<html lang="en-US"><head><meta charset="utf-8"/><meta content="IE=Edge" http-equiv="X-UA-Compatible"/><link href="https://selwynpolit.github.io/d9book/assets/css/just-the-docs-default.css" rel="stylesheet"/> <script async="" src="https://www.googletagmanager.com/gtag/js?id=8V22RQEJ71"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', '8V22RQEJ71', { 'anonymize_ip': true }); </script> <script src="https://selwynpolit.github.io/d9book/assets/js/vendor/lunr.min.js"></script> <script src="https://selwynpolit.github.io/d9book/assets/js/just-the-docs.js"></script><meta content="width=device-width, initial-scale=1" name="viewport"/><link href="https://selwynpolit.github.io/d9book/assets/images/favicon.ico" rel="icon" type="image/x-icon"/><title>Composer | Drupal Book</title><meta content="Jekyll v4.3.2" name="generator"><meta content="Composer" property="og:title"><meta content="en_US" property="og:locale"><meta content="Drupal at your fingertips" name="description"/><meta content="Drupal at your fingertips" property="og:description"/><link href="https://selwynpolit.github.io/d9book/d9book/composer" rel="canonical"><meta content="https://selwynpolit.github.io/d9book/d9book/composer" property="og:url"/><meta content="Drupal Book" property="og:site_name"/><meta content="website" property="og:type"/><meta content="summary" name="twitter:card"/><meta content="Composer" property="twitter:title"/> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Drupal at your fingertips","headline":"Composer","url":"https://selwynpolit.github.io/d9book/d9book/composer"}</script><body> <a class="skip-to-main" href="https://selwynpolit.github.io/d9book/composer#main-content">Skip to main content</a> <svg class="d-none" xmlns="http://www.w3.org/2000/svg"> <symbol id="svg-link" viewbox="0 0 24 24"><title>Link</title><svg class="feather feather-link" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewbox="0 0 24 24"><title>Menu</title><svg class="feather feather-menu" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><line x1="3" x2="21" y1="12" y2="12"></line><line x1="3" x2="21" y1="6" y2="6"></line><line x1="3" x2="21" y1="18" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewbox="0 0 24 24"><title>Expand</title><svg class="feather feather-chevron-right" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol class="feather feather-external-link" fill="none" height="24" id="svg-external-link" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24"><title id="svg-external-link-title">(external link)</title><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" x2="21" y1="14" y2="3"></line> </symbol> <symbol id="svg-doc" viewbox="0 0 24 24"><title>Document</title><svg class="feather feather-file" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewbox="0 0 24 24"><title>Search</title><svg class="feather feather-search" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"> <circle cx="11" cy="11" r="8"></circle><line x1="21" x2="16.65" y1="21" y2="16.65"></line> </svg> </symbol> <symbol id="svg-copy" viewbox="0 0 16 16"><title>Copy</title><svg class="bi bi-clipboard" fill="currentColor" height="16" viewbox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"></path><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"></path> </svg> </symbol> <symbol id="svg-copied" viewbox="0 0 16 16"><title>Copied</title><svg class="bi bi-clipboard-check-fill" fill="currentColor" height="16" viewbox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"></path><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"></path> </svg> </symbol> </svg><div class="side-bar"><div class="site-header"> <a class="site-title lh-tight" href="https://selwynpolit.github.io/d9book/"> Drupal Book </a> <a class="site-button" href="https://selwynpolit.github.io/d9book/composer" id="menu-button"> <svg class="icon" viewbox="0 0 24 24"><use xlink:href="#svg-menu"></use></svg> </a></div><nav aria-label="Main" class="site-nav" id="site-nav"><ul class="nav-list"><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/">Home</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/actions">Actions</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/attribution">Attribution</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/bq">Batch and Queue</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/blocks">Blocks</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/caching">Caching</a><li class="nav-list-item active"><a class="nav-list-link active" href="https://selwynpolit.github.io/d9book/composer">Composer</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/config">Config</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/cron">Cron</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/dates">Dates and Times</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/debugging">Debugging</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/development">Development</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/drush">Drush</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/email">Email</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/entities">Entities</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/forms">Forms</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/general">General</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/off-island">Getting off the Island</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/hooks">Hooks</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/learn">Learning</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/links">Links</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/logging">Logging</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/menus">Menus</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/migrate">Migrate</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/modals">Modals</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/nodes-and-fields">Nodes and Fields</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/queries">Queries</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/redirects">Redirects</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/render">Render Arrays</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/routes">Routes</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/security">Security</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/services">Services</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/state">State</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/taxonomy">Taxonomy</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/dtt">Tests</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/twig">Twig</a></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></ul><ul class="nav-list"><li class="nav-list-item external"> <a class="nav-list-link external" href="https://github.com/selwynpolit/d9book/fork"> Fork me on GitHub <svg aria-labelledby="svg-external-link-title" viewbox="0 0 24 24"><use xlink:href="#svg-external-link"></use></svg> </a></li></ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer></div><div class="main" id="top"><div class="main-header" id="main-header"><div class="search"><div class="search-input-wrap"> <input aria-label="Search Drupal Book" autocomplete="off" class="search-input" id="search-input" placeholder="Search Drupal Book" tabindex="0" type="text"/> <label class="search-label" for="search-input"><svg class="search-icon" viewbox="0 0 24 24"><use xlink:href="#svg-search"></use></svg></label></div><div class="search-results" id="search-results"></div></div><nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a class="site-button" href="https://twitter.com/selwynpolit" rel="noopener noreferrer" target="_blank"> <img alt="Twitter logo" src="https://atuin.ru/demo/simple-icons/icons/twitter.svg" style="width: 30px; height: 30px;" title="Author in Twitter"/> </a><li class="aux-nav-list-item"> <a class="site-button" href="https://github.com/selwynpolit/d9book/tree/gh-pages" rel="noopener noreferrer" target="_blank"> <img alt="GitHub logo" src="https://atuin.ru/demo/simple-icons/icons/github.svg" style="width: 30px; height: 30px;" title="D9Book on GitHub"/> </a></li></li></ul></nav></div><div class="main-content-wrap" id="main-content-wrap"><div class="main-content" id="main-content" role="main"><h1 class="no_toc fw-500" id="composer-updates-and-patches"> <a aria-labelledby="composer-updates-and-patches" class="anchor-heading" href="https://selwynpolit.github.io/d9book/composer#composer-updates-and-patches"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Composer, Updates and Patches</h1><h2 class="no_toc text-delta" id="table-of-contents"> <a aria-labelledby="table-of-contents" class="anchor-heading" href="https://selwynpolit.github.io/d9book/composer#table-of-contents"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Table of contents</h2><ul id="markdown-toc"><li><a href="https://selwynpolit.github.io/d9book/composer#creating-a-local-patch-to-a-contrib-module" id="markdown-toc-creating-a-local-patch-to-a-contrib-module">Creating a local patch to a contrib module</a><li><a href="https://selwynpolit.github.io/d9book/composer#composerjson-patches-in-separate-file" id="markdown-toc-composerjson-patches-in-separate-file">composer.json patches in separate file</a><li><a href="https://selwynpolit.github.io/d9book/composer#stop-files-being-overwritten-during-composer-operations" id="markdown-toc-stop-files-being-overwritten-during-composer-operations">Stop files being overwritten during composer operations</a><li><a href="https://selwynpolit.github.io/d9book/composer#updating-drupal-core" id="markdown-toc-updating-drupal-core">Updating Drupal Core</a><li><a href="https://selwynpolit.github.io/d9book/composer#test-composer-dry-run" id="markdown-toc-test-composer-dry-run">Test composer (dry run)</a><li><a href="https://selwynpolit.github.io/d9book/composer#version-constraints" id="markdown-toc-version-constraints">Version constraints</a><li><a href="https://selwynpolit.github.io/d9book/composer#troubleshooting" id="markdown-toc-troubleshooting">Troubleshooting</a><ul><li><a href="https://selwynpolit.github.io/d9book/composer#composer-wont-update-drupal-core" id="markdown-toc-composer-wont-update-drupal-core">Composer won't update Drupal core</a><li><a href="https://selwynpolit.github.io/d9book/composer#the-big-reset-button" id="markdown-toc-the-big-reset-button">The big reset button</a></li></li></ul><li><a href="https://selwynpolit.github.io/d9book/composer#reference" id="markdown-toc-reference">Reference</a></li></li></li></li></li></li></li></li></ul><p><img alt="views" src="https://api.visitor.plantree.me/visitor-badge/pv?label=views&amp;color=informational&amp;namespace=d9book&amp;key=composer.md"/></p><hr/><h2 id="creating-a-local-patch-to-a-contrib-module"> <a aria-labelledby="creating-a-local-patch-to-a-contrib-module" class="anchor-heading" href="https://selwynpolit.github.io/d9book/composer#creating-a-local-patch-to-a-contrib-module"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Creating a local patch to a contrib module</h2><p>See Making a patch at <a href="https://www.drupal.org/node/707484">https://www.drupal.org/node/707484</a></p><p>In this case, I had the file_entity module installed and wanted to hide the tab “[files.]{.underline}” The tab item is provided by a task (read “menu tab”) in the web/modules/contrib/file_entity/file_entity.links.task.yml</p><div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">entity.file.collection</span><span class="pi">:</span>
  <span class="na">route_name</span><span class="pi">:</span> <span class="s">entity.file.collection</span>
  <span class="na">base_route</span><span class="pi">:</span> <span class="s">system.admin_content</span>
  <span class="na">title</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Files'</span>
  <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Manage</span><span class="nv"> </span><span class="s">files</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">your</span><span class="nv"> </span><span class="s">site.'</span>
</code></pre></div></div><p>For my patch, I want to remove this section of the <code class="language-plaintext highlighter-rouge">file_entity.links.task.yml</code> file.</p><p>First get the repo/git version of the module</p><div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>composer update drupal/file_entity <span class="nt">--prefer-source</span>
</code></pre></div></div><p>Change the file in the text editor</p><p>Run git diff to see the changes:</p><div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git diff
</code></pre></div></div><p>The output shows:</p><div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gh">diff --git a/file_entity.links.task.yml b/file_entity.links.task.yml
index 3ea93fc..039f7f9 100644
</span><span class="gd">--- a/file_entity.links.task.yml
</span><span class="gi">+++ b/file_entity.links.task.yml
</span><span class="p">@@ -15,12 +15,6 @@</span> entity.file.edit_form:
   base_route: entity.file.canonical
   weight: 0
 
<span class="gd">-entity.file.collection:
-  route_name: entity.file.collection
-  base_route: system.admin_content
-  title: 'Files'
-  description: 'Manage files for your site.'
-
</span> entity.file.add_form:
   route_name: entity.file.add_form
   base_route: entity.file.add_form
<span class="err">
</span></code></pre></div></div><p>Create the patch</p><div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git diff <span class="o">&gt;</span>file_entity_disable_file_menu_tab.patch
</code></pre></div></div><p>Add the patch to the patches section of composer.json. Notice below the line starting with "drupal/file_entity":</p><div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">"patches"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"drupal/commerce"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Allow order types to have no carts"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://www.drupal.org/files/issues/2018-03-16/commerce-direct-checkout-50.patch"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"drupal/views_load_more"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Template change to keep up with core"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://www.drupal.org/files/issues/views-load-more-pager-class-2543714-02.patch"</span><span class="w"> </span><span class="p">,</span><span class="w">
        </span><span class="nl">"Problems with exposed filters"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://www.drupal.org/files/issues/views_load_more-problems-with-exposed-filters-2630306-4.patch"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"drupal/easy_breadcrumb"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Titles in breadcrumbs are double-escaped"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://www.drupal.org/files/issues/2018-06-21/2979389-7-easy-breadcrumb--double-escaped-titles.patch"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"drupal/file_entity"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Temporarily disable the files menu tab"</span><span class="p">:</span><span class="w"> </span><span class="s2">"./patches/file_entity_disable_file_menu_tab.patch"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div><p>Revert the file in git and then try to apply the patch.</p><p>Here is the patch command way to un-apply or revert a patch (-R means revert)</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>patch -p1 -R &lt; ./patches/fix_scary_module.patch
</code></pre></div></div><p>To apply the patch:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>patch -p1 &lt; ./patches/fix_scary_module.patch
</code></pre></div></div><h2 id="composerjson-patches-in-separate-file"> <a aria-labelledby="composerjson-patches-in-separate-file" class="anchor-heading" href="https://selwynpolit.github.io/d9book/composer#composerjson-patches-in-separate-file"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> composer.json patches in separate file</h2><p>To separate patches into a different file other than composer json add <code class="language-plaintext highlighter-rouge">"patches-file"</code> section under <code class="language-plaintext highlighter-rouge">"extra"</code>. See example below:</p><div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">"extra"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"installer-paths"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"web/core"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"type:drupal-core"</span><span class="p">],</span><span class="w">
        </span><span class="nl">"web/libraries/{$name}"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"type:drupal-library"</span><span class="p">],</span><span class="w">
        </span><span class="nl">"web/modules/contrib/{$name}"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"type:drupal-module"</span><span class="p">],</span><span class="w">
        </span><span class="nl">"web/profiles/contrib/{$name}"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"type:drupal-profile"</span><span class="p">],</span><span class="w">
        </span><span class="nl">"web/themes/contrib/{$name}"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"type:drupal-theme"</span><span class="p">],</span><span class="w">
        </span><span class="nl">"drush/Commands/contrib/{$name}"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"type:drupal-drush"</span><span class="p">],</span><span class="w">
        </span><span class="nl">"web/modules/custom/{$name}"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"type:drupal-custom-module"</span><span class="p">],</span><span class="w">
        </span><span class="nl">"web/themes/custom/{$name}"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"type:drupal-custom-theme"</span><span class="p">]</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"drupal-scaffold"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"locations"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"web-root"</span><span class="p">:</span><span class="w"> </span><span class="s2">"web/"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"excludes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"robots.txt"</span><span class="p">,</span><span class="w">
            </span><span class="s2">".htaccess"</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"patches-file"</span><span class="p">:</span><span class="w"> </span><span class="s2">"patches/composer.patches.json"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div><p>If composer install fails, try <code class="language-plaintext highlighter-rouge">composer -vvv</code> for verbose output</p><p>If the issue is that it can’t find the file for example if it displays the following:</p><div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  - Applying patches <span class="k">for </span>drupal/addtocalendar
    ./patches/add_to_calendar_smart_date_handling.patch <span class="o">(</span>Add support <span class="k">for </span>smart_date fields<span class="o">)</span>
patch <span class="s1">'-p1'</span> <span class="nt">--no-backup-if-mismatch</span> <span class="nt">-d</span> <span class="s1">'web/modules/contrib/addtocalendar'</span> &lt; <span class="s1">'/Users/selwyn/Sites/txglobal/patches/add_to_calendar_smart_date_handling.patch'</span>
Executing <span class="nb">command</span> <span class="o">(</span>CWD<span class="o">)</span>: patch <span class="s1">'-p1'</span> <span class="nt">--no-backup-if-mismatch</span> <span class="nt">-d</span> <span class="s1">'web/modules/contrib/addtocalendar'</span> &lt; <span class="s1">'/Users/selwyn/Sites/txglobal/patches/add_to_calendar_smart_date_handling.patch'</span>
can<span class="s1">'t find file to patch at input line 5
Perhaps you used the wrong -p or --strip option?
</span></code></pre></div></div><p>This means the patch is trying to run the patch in the directory <code class="language-plaintext highlighter-rouge">web/modules/contrib/addtocalendar</code> (notice the <code class="language-plaintext highlighter-rouge">-d web/modules/contrib/addtocalendar</code> above</p><p>In this case, recreate the patch with the <code class="language-plaintext highlighter-rouge">--no-prefix</code> option i.e.</p><div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git diff <span class="nt">--no-prefix</span> <span class="o">&gt;</span>./patches/patch2.patch
</code></pre></div></div><p>Then composer install will apply the patch correctly</p><p>More at <a href="https://github.com/cweagans/composer-patches/issues/146">https://github.com/cweagans/composer-patches/issues/146</a></p><h2 id="stop-files-being-overwritten-during-composer-operations"> <a aria-labelledby="stop-files-being-overwritten-during-composer-operations" class="anchor-heading" href="https://selwynpolit.github.io/d9book/composer#stop-files-being-overwritten-during-composer-operations"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Stop files being overwritten during composer operations</h2><p>Depending on your composer.json, files like development.services.yml may be overwritten from during scaffolding. To prevent certain scaffold files from being overwritten every time you run a Composer command you can specify them in the “extra” section of your project’s composer.json. See the docs on Excluding scaffold files.</p><p>The following snippet prevents the development.services.yml from being regularly overwritten:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"drupal-scaffold": {
    "locations": {
        "web-root": "web/"
    },
    "file-mapping": {
        "[web-root]/sites/development.services.yml": false
    }
},
</code></pre></div></div><p>The code above is from <a href="https://www.drupal.org/docs/develop/development-tools/disable-caching#s-beware-of-scaffolding">https://www.drupal.org/docs/develop/development-tools/disable-caching#s-beware-of-scaffolding</a></p><p>and from <a href="https://www.drupal.org/docs/develop/using-composer/using-drupals-composer-scaffold#toc_6">https://www.drupal.org/docs/develop/using-composer/using-drupals-composer-scaffold#toc_6</a>: Sometimes, a project might prefer to entirely replace a scaffold file provided by a dependency, and receive no further updates for it. This can be done by setting the value for the scaffold file to exclude to false. In the example below, three files are excluded from being overwritten:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  "name": "my/project",
  ...
  "extra": {
    "drupal-scaffold": {
      "locations": {
        "web-root": "web/"
      },
      "file-mapping": {
        "[web-root]/robots.txt": false
        "[web-root]/.htaccess": false,
        "[web-root]/sites/development.services.yml": false
      },
      ...
    }
  }
</code></pre></div></div><p>More at <a href="https://drupal.stackexchange.com/questions/290989/composer-keeps-overwriting-htaccess-and-other-files-every-time-i-do-anything">https://drupal.stackexchange.com/questions/290989/composer-keeps-overwriting-htaccess-and-other-files-every-time-i-do-anything</a></p><h2 id="updating-drupal-core"> <a aria-labelledby="updating-drupal-core" class="anchor-heading" href="https://selwynpolit.github.io/d9book/composer#updating-drupal-core"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Updating Drupal Core</h2><p>if there is <code class="language-plaintext highlighter-rouge">drupal/core-recommended</code> in your <code class="language-plaintext highlighter-rouge">composer.json</code> use:</p><div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>composer update drupal/core-recommended <span class="nt">-W</span>
</code></pre></div></div><p>if there is no <code class="language-plaintext highlighter-rouge">drupal/core-recommended</code> in your <code class="language-plaintext highlighter-rouge">composer.json</code> use:</p><div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>composer update drupal/core <span class="nt">-W</span>
</code></pre></div></div><p>Note <code class="language-plaintext highlighter-rouge">composer update -W</code> is the same as <code class="language-plaintext highlighter-rouge">composer update --with-dependencies</code></p><h2 id="test-composer-dry-run"> <a aria-labelledby="test-composer-dry-run" class="anchor-heading" href="https://selwynpolit.github.io/d9book/composer#test-composer-dry-run"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Test composer (dry run)</h2><p>If you want to run through an installation without actually installing a package, you can use –dry-run. This will simulate the installation and show you what would happen.</p><div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>composer update <span class="nt">--dry-run</span> <span class="s2">"drupal/*"</span>
</code></pre></div></div><p>produces something like:</p><div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Package operations: 0 installs, 4 updates, 0 removals
  - Updating drupal/core <span class="o">(</span>8.8.2<span class="o">)</span> to drupal/core <span class="o">(</span>8.8.4<span class="o">)</span>
  - Updating drupal/config_direct_save <span class="o">(</span>1.0.0<span class="o">)</span> to drupal/config_direct_save <span class="o">(</span>1.1.0<span class="o">)</span>
  - Updating drupal/core-recommended <span class="o">(</span>8.8.2<span class="o">)</span> to drupal/core-recommended <span class="o">(</span>8.8.4<span class="o">)</span>
  - Updating drupal/crop <span class="o">(</span>1.5.0<span class="o">)</span> to drupal/crop <span class="o">(</span>2.0.0<span class="o">)</span>
</code></pre></div></div><h2 id="version-constraints"> <a aria-labelledby="version-constraints" class="anchor-heading" href="https://selwynpolit.github.io/d9book/composer#version-constraints"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Version constraints</h2><p>1. The caret constraint (<code class="language-plaintext highlighter-rouge">^</code>): this will allow any new versions except BREAKING ones—in other words, the first number in the version cannot increase, but the others can. <code class="language-plaintext highlighter-rouge">drupal/foo:^1.0</code> would allow anything greater than or equal to 1.0 but less than 2.0.x . If you need to specify a version, this is the recommended method.</p><p>2. The tilde constraint (~): this is a bit more restrictive than the caret constraint. It means composer can download a higher version of the last digit specified only. For example, drupal/foo:~1.2 will allow anything greater than or equal to version 1.2 (i.e., 1.2.0, 1.3.0, 1.4.0,…,1.999.999), but it won’t allow that first 1 to increment to a 2.x release. Likewise, drupal/foo:~1.2.3 will allow anything from 1.2.3 to 1.2.999, but not 1.3.0.</p><p>3. The other constraints are a little more self-explanatory. You can specify a version range with operators, a specific stability level (e.g., -stable or -dev ), or even specify wildcards with *.</p><p>Version range: By using comparison operators you can specify ranges of valid versions. Valid operators are &gt;, &gt;=, &lt;, &lt;=, !=.</p><p>You can define multiple ranges. Ranges separated by a space ( ) or comma (,) will be treated as a logical AND. A double pipe (||) will be treated as a logical OR. AND has higher precedence than OR.</p><p>Note: Be careful when using unbounded ranges as you might end up unexpectedly installing versions that break backwards compatibility. Consider using the caret operator instead for safety.</p><p>Examples:</p><p>• &gt;=1.0</p><p>• &gt;=1.0 &lt;2.0</p><p>• &gt;=1.0 &lt;1.1 || &gt;=1.2</p><p>More at <a href="https://getcomposer.org/doc/articles/versions.md">https://getcomposer.org/doc/articles/versions.md</a></p><h2 id="troubleshooting"> <a aria-labelledby="troubleshooting" class="anchor-heading" href="https://selwynpolit.github.io/d9book/composer#troubleshooting"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Troubleshooting</h2><h3 id="composer-wont-update-drupal-core"> <a aria-labelledby="composer-wont-update-drupal-core" class="anchor-heading" href="https://selwynpolit.github.io/d9book/composer#composer-wont-update-drupal-core"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Composer won't update Drupal core</h3><p>The <code class="language-plaintext highlighter-rouge">prohibits</code> command tells you which packages are blocking a given package from being installed. Specify a version constraint to verify whether upgrades can be performed in your project, and if not why not.</p><p>Why won't composer install Drupal version 8.9.1.</p><p>composer why-not drupal/core:8.9.1</p><h3 id="the-big-reset-button"> <a aria-labelledby="the-big-reset-button" class="anchor-heading" href="https://selwynpolit.github.io/d9book/composer#the-big-reset-button"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> The big reset button</h3><p>If composer barfs with a bunch of errors, try removing vendor, /core, modules/contrib (and optionally composer.lock using:</p><div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">rm</span> <span class="nt">-fr</span> core/ modules/contrib/ vendor/
</code></pre></div></div><p>Then try run composer install again to see how it does:</p><div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>composer <span class="nb">install</span> <span class="nt">--ignore-platform-reqs</span>
</code></pre></div></div><p>Note <code class="language-plaintext highlighter-rouge">--ignore-platform-reqs</code> is only necessary if your php on your host computer is different to the version in your DDEV containers.</p><p>You could always use this for DDEV:</p><div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ddev composer <span class="nb">install</span>
</code></pre></div></div><h2 id="reference"> <a aria-labelledby="reference" class="anchor-heading" href="https://selwynpolit.github.io/d9book/composer#reference"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Reference</h2><ul><li>Drupal 8 composer best practices (Jan 2018) <a href="https://www.lullabot.com/articles/drupal-8-composer-best-practices">https://www.lullabot.com/articles/drupal-8-composer-best-practices</a><li>Making a patch (Dec 2022) <a href="https://www.drupal.org/node/707484">https://www.drupal.org/node/707484</a><li>Composer Documentation <a href="https://getcomposer.org/doc/">https://getcomposer.org/doc/</a><li>Composer documentation article on versions and constraints <a href="https://getcomposer.org/doc/articles/versions.md">https://getcomposer.org/doc/articles/versions.md</a><li>Using Drupal’s Composer Scaffold updated Dec 2922 <a href="https://www.drupal.org/docs/develop/using-composer/using-drupals-composer-scaffold#toc_6">https://www.drupal.org/docs/develop/using-composer/using-drupals-composer-scaffold#toc_6</a></li></li></li></li></li></ul><hr/> <script async="" crossorigin="anonymous" data-category="Q&amp;A" data-category-id="MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMyMjY2NDE4" data-emit-metadata="0" data-input-position="bottom" data-lang="en" data-mapping="title" data-reactions-enabled="1" data-repo="selwynpolit/d9book" data-repo-id="MDEwOlJlcG9zaXRvcnkzMjUxNTQ1Nzg=" data-strict="0" data-theme="preferred_color_scheme" src="https://giscus.app/client.js"> </script><hr/><footer><p><a href="https://selwynpolit.github.io/d9book/composer#top" id="back-to-top">Back to top</a></p><p class="text-small text-grey-dk-100 mb-0"><span xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/"> <a href="http://www.selwynpolit.github.io/d9book" property="dct:title" rel="cc:attributionURL">Drupal at your fingertips</a> by <a href="http://www.drupal.org/u/selwynpolit" property="cc:attributionName" rel="cc:attributionURL dct:creator">Selwyn Polit</a> is licensed under <a href="http://creativecommons.org/licenses/by/4.0/" rel="license noopener noreferrer" target="_blank">CC BY 4.0 <img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg" style="height:16px!important;vertical-align:text-bottom;"/> <img src="https://mirrors.creativecommons.org/presskit/icons/by.svg" style="height:16px!important;vertical-align:text-bottom;"/> </a></span></p><div class="d-flex mt-2"><p class="text-small text-grey-dk-000 mb-0 mr-2"> Page last modified: <span class="d-inline-block">Apr 28 2023</span>.</p><p class="text-small text-grey-dk-000 mb-0"> <a href="https://github.com/selwynpolit/d9book/tree/gh-pages/book/composer.md" id="edit-this-page">Edit this page on GitHub</a></p></div></footer></div></div><div class="search-overlay"></div></div>
</body></link></meta></meta></meta></head></html>