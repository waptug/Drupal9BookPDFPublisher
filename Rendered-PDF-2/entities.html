<!DOCTYPE html>
<html lang="en-US"><head><meta charset="utf-8"/><meta content="IE=Edge" http-equiv="X-UA-Compatible"/><link href="https://selwynpolit.github.io/d9book/assets/css/just-the-docs-default.css" rel="stylesheet"/> <script async="" src="https://www.googletagmanager.com/gtag/js?id=8V22RQEJ71"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', '8V22RQEJ71', { 'anonymize_ip': true }); </script> <script src="https://selwynpolit.github.io/d9book/assets/js/vendor/lunr.min.js"></script> <script src="https://selwynpolit.github.io/d9book/assets/js/just-the-docs.js"></script><meta content="width=device-width, initial-scale=1" name="viewport"/><link href="https://selwynpolit.github.io/d9book/assets/images/favicon.ico" rel="icon" type="image/x-icon"/><title>Entities | Drupal Book</title><meta content="Jekyll v4.3.2" name="generator"><meta content="Entities" property="og:title"><meta content="en_US" property="og:locale"><meta content="Drupal at your fingertips" name="description"/><meta content="Drupal at your fingertips" property="og:description"/><link href="https://selwynpolit.github.io/d9book/d9book/entities" rel="canonical"><meta content="https://selwynpolit.github.io/d9book/d9book/entities" property="og:url"/><meta content="Drupal Book" property="og:site_name"/><meta content="website" property="og:type"/><meta content="summary" name="twitter:card"/><meta content="Entities" property="twitter:title"/> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Drupal at your fingertips","headline":"Entities","url":"https://selwynpolit.github.io/d9book/d9book/entities"}</script><body> <a class="skip-to-main" href="https://selwynpolit.github.io/d9book/entities#main-content">Skip to main content</a> <svg class="d-none" xmlns="http://www.w3.org/2000/svg"> <symbol id="svg-link" viewbox="0 0 24 24"><title>Link</title><svg class="feather feather-link" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewbox="0 0 24 24"><title>Menu</title><svg class="feather feather-menu" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><line x1="3" x2="21" y1="12" y2="12"></line><line x1="3" x2="21" y1="6" y2="6"></line><line x1="3" x2="21" y1="18" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewbox="0 0 24 24"><title>Expand</title><svg class="feather feather-chevron-right" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol class="feather feather-external-link" fill="none" height="24" id="svg-external-link" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24"><title id="svg-external-link-title">(external link)</title><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" x2="21" y1="14" y2="3"></line> </symbol> <symbol id="svg-doc" viewbox="0 0 24 24"><title>Document</title><svg class="feather feather-file" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewbox="0 0 24 24"><title>Search</title><svg class="feather feather-search" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"> <circle cx="11" cy="11" r="8"></circle><line x1="21" x2="16.65" y1="21" y2="16.65"></line> </svg> </symbol> <symbol id="svg-copy" viewbox="0 0 16 16"><title>Copy</title><svg class="bi bi-clipboard" fill="currentColor" height="16" viewbox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"></path><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"></path> </svg> </symbol> <symbol id="svg-copied" viewbox="0 0 16 16"><title>Copied</title><svg class="bi bi-clipboard-check-fill" fill="currentColor" height="16" viewbox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"></path><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"></path> </svg> </symbol> </svg><div class="side-bar"><div class="site-header"> <a class="site-title lh-tight" href="https://selwynpolit.github.io/d9book/"> Drupal Book </a> <a class="site-button" href="https://selwynpolit.github.io/d9book/entities" id="menu-button"> <svg class="icon" viewbox="0 0 24 24"><use xlink:href="#svg-menu"></use></svg> </a></div><nav aria-label="Main" class="site-nav" id="site-nav"><ul class="nav-list"><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/">Home</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/actions">Actions</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/attribution">Attribution</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/bq">Batch and Queue</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/blocks">Blocks</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/caching">Caching</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/composer">Composer</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/config">Config</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/cron">Cron</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/dates">Dates and Times</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/debugging">Debugging</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/development">Development</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/drush">Drush</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/email">Email</a><li class="nav-list-item active"><a class="nav-list-link active" href="https://selwynpolit.github.io/d9book/entities">Entities</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/forms">Forms</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/general">General</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/off-island">Getting off the Island</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/hooks">Hooks</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/learn">Learning</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/links">Links</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/logging">Logging</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/menus">Menus</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/migrate">Migrate</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/modals">Modals</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/nodes-and-fields">Nodes and Fields</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/queries">Queries</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/redirects">Redirects</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/render">Render Arrays</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/routes">Routes</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/security">Security</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/services">Services</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/state">State</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/taxonomy">Taxonomy</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/dtt">Tests</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/twig">Twig</a></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></ul><ul class="nav-list"><li class="nav-list-item external"> <a class="nav-list-link external" href="https://github.com/selwynpolit/d9book/fork"> Fork me on GitHub <svg aria-labelledby="svg-external-link-title" viewbox="0 0 24 24"><use xlink:href="#svg-external-link"></use></svg> </a></li></ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer></div><div class="main" id="top"><div class="main-header" id="main-header"><div class="search"><div class="search-input-wrap"> <input aria-label="Search Drupal Book" autocomplete="off" class="search-input" id="search-input" placeholder="Search Drupal Book" tabindex="0" type="text"/> <label class="search-label" for="search-input"><svg class="search-icon" viewbox="0 0 24 24"><use xlink:href="#svg-search"></use></svg></label></div><div class="search-results" id="search-results"></div></div><nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a class="site-button" href="https://twitter.com/selwynpolit" rel="noopener noreferrer" target="_blank"> <img alt="Twitter logo" src="https://atuin.ru/demo/simple-icons/icons/twitter.svg" style="width: 30px; height: 30px;" title="Author in Twitter"/> </a><li class="aux-nav-list-item"> <a class="site-button" href="https://github.com/selwynpolit/d9book/tree/gh-pages" rel="noopener noreferrer" target="_blank"> <img alt="GitHub logo" src="https://atuin.ru/demo/simple-icons/icons/github.svg" style="width: 30px; height: 30px;" title="D9Book on GitHub"/> </a></li></li></ul></nav></div><div class="main-content-wrap" id="main-content-wrap"><div class="main-content" id="main-content" role="main"><h1 class="no_toc fw-500" id="entities"> <a aria-labelledby="entities" class="anchor-heading" href="https://selwynpolit.github.io/d9book/entities#entities"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Entities</h1><h2 class="no_toc text-delta" id="table-of-contents"> <a aria-labelledby="table-of-contents" class="anchor-heading" href="https://selwynpolit.github.io/d9book/entities#table-of-contents"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Table of contents</h2><ul id="markdown-toc"><li><a href="https://selwynpolit.github.io/d9book/entities#overview" id="markdown-toc-overview">Overview</a><li><a href="https://selwynpolit.github.io/d9book/entities#config-entity-types" id="markdown-toc-config-entity-types">Config entity types</a><li><a href="https://selwynpolit.github.io/d9book/entities#content-entity-types" id="markdown-toc-content-entity-types">Content entity types</a><li><a href="https://selwynpolit.github.io/d9book/entities#query-an-entity-by-title-and-type" id="markdown-toc-query-an-entity-by-title-and-type">Query an entity by title and type</a><li><a href="https://selwynpolit.github.io/d9book/entities#create-an-entity" id="markdown-toc-create-an-entity">Create an entity</a><li><a href="https://selwynpolit.github.io/d9book/entities#save-an-entity" id="markdown-toc-save-an-entity">Save an entity</a><li><a href="https://selwynpolit.github.io/d9book/entities#create-article-node-entity-with-attached-image" id="markdown-toc-create-article-node-entity-with-attached-image">Create article node entity with attached image</a><li><a href="https://selwynpolit.github.io/d9book/entities#update-a-node-entity-and-add-some-terms" id="markdown-toc-update-a-node-entity-and-add-some-terms">Update a node entity and add some terms</a><li><a href="https://selwynpolit.github.io/d9book/entities#get-the-entity-type-and-content-type-or-bundle-type" id="markdown-toc-get-the-entity-type-and-content-type-or-bundle-type">Get the entity type and content type (or bundle type)</a><li><a href="https://selwynpolit.github.io/d9book/entities#identify-entities" id="markdown-toc-identify-entities">Identify entities</a><li><a href="https://selwynpolit.github.io/d9book/entities#create-a-file-entity" id="markdown-toc-create-a-file-entity">Create a file entity</a><li><a href="https://selwynpolit.github.io/d9book/entities#entity-validation" id="markdown-toc-entity-validation">Entity Validation</a><li><a href="https://selwynpolit.github.io/d9book/entities#resources" id="markdown-toc-resources">Resources</a></li></li></li></li></li></li></li></li></li></li></li></li></li></ul><p><img alt="views" src="https://api.visitor.plantree.me/visitor-badge/pv?label=views&amp;color=informational&amp;namespace=d9book&amp;key=entities.md"/></p><hr/><h2 id="overview"> <a aria-labelledby="overview" class="anchor-heading" href="https://selwynpolit.github.io/d9book/entities#overview"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Overview</h2><p>The Entity API is used for manipulating entities (CRUD: create, read, update, delete). Entity validation has its own API (which could validate an Entity saved via REST, rather than a form, for example).</p><p>Entities come in two flavors: Content and Config(uration). The data storage mechanism moved from being field-centric in Drupal 7 to entity-centric in Drupal 8, 9 and 10. This implies that all fields attached to an entity share the same storage backend, making querying a lot easier. Entity types are registered with Drupal as plugins.</p><p>While Drupal supports custom entities, I haven't found a need for them in my projects. In most of my experience, just using real nodes (sometimes unpublished) has sufficed admirably.</p><h2 id="config-entity-types"> <a aria-labelledby="config-entity-types" class="anchor-heading" href="https://selwynpolit.github.io/d9book/entities#config-entity-types"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Config entity types</h2><p>They store configuration information e.g: views, imagestyles, roles, NodeType (which define node bundles).</p><ul><li>They are not revisionable<li>They don’t have fields/are not fieldable.<li>They don’t support entity translation interface(TranslatableInterface), but can still be translated using config’s translation API.</li></li></li></ul><h2 id="content-entity-types"> <a aria-labelledby="content-entity-types" class="anchor-heading" href="https://selwynpolit.github.io/d9book/entities#content-entity-types"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Content entity types</h2><p>e.g. comment, user, taxonomy term, node and now media (bundles for media are file, image, audio, video, remote video etc.)</p><p>more at <a href="https://www.drupal.org/docs/drupal-apis/entity-api/introduction-to-entity-api-in-drupal-8">https://www.drupal.org/docs/drupal-apis/entity-api/introduction-to-entity-api-in-drupal-8</a></p><h2 id="query-an-entity-by-title-and-type"> <a aria-labelledby="query-an-entity-by-title-and-type" class="anchor-heading" href="https://selwynpolit.github.io/d9book/entities#query-an-entity-by-title-and-type"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Query an entity by title and type</h2><p>This example counts the number of entities of type <code class="language-plaintext highlighter-rouge">article</code> with the name <code class="language-plaintext highlighter-rouge">$name</code>. Note that access checking must be <a href="https://www.drupal.org/node/3201242">explicitly specified on content entity queries</a>.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">nodeStorage</span><span class="o">-&gt;</span><span class="nf">getQuery</span><span class="p">()</span>
  <span class="o">-&gt;</span><span class="nf">accessCheck</span><span class="p">(</span><span class="kc">FALSE</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'type'</span><span class="p">,</span> <span class="s1">'article'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'title'</span><span class="p">,</span> <span class="nv">$name</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nb">count</span><span class="p">();</span>

<span class="nv">$count_nodes</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$count_nodes</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</code></pre></div></div><h2 id="create-an-entity"> <a aria-labelledby="create-an-entity" class="anchor-heading" href="https://selwynpolit.github.io/d9book/entities#create-an-entity"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Create an entity</h2><p>To create a new entity object, use the entity_create. <strong>NOTE</strong> that this only creates an entity object and does not persist it.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$node</span> <span class="o">=</span> <span class="nf">entity_create</span><span class="p">(</span><span class="s1">'node'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
  <span class="s1">'title'</span> <span class="o">=&gt;</span> <span class="s1">'New Article'</span><span class="p">,</span>
  <span class="s1">'body'</span> <span class="o">=&gt;</span> <span class="s1">'Article body'</span><span class="p">,</span>
  <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'article'</span><span class="p">,</span>
<span class="p">));</span>
</code></pre></div></div><p>If you know what the entity class name (bundle type) is, you can use it directly.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$node</span> <span class="o">=</span> <span class="nc">Node</span><span class="o">::</span><span class="nf">create</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
  <span class="s1">'title'</span> <span class="o">=&gt;</span> <span class="s1">'New Article'</span><span class="p">,</span>
  <span class="s1">'body'</span> <span class="o">=&gt;</span> <span class="s1">'Article body'</span><span class="p">,</span>
  <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'article'</span><span class="p">,</span>
<span class="p">));</span>
</code></pre></div></div><h2 id="save-an-entity"> <a aria-labelledby="save-an-entity" class="anchor-heading" href="https://selwynpolit.github.io/d9book/entities#save-an-entity"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Save an entity</h2><p>Entity save is done by calling the instance’s save method.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">save</span><span class="p">();</span>
</code></pre></div></div><h2 id="create-article-node-entity-with-attached-image"> <a aria-labelledby="create-article-node-entity-with-attached-image" class="anchor-heading" href="https://selwynpolit.github.io/d9book/entities#create-article-node-entity-with-attached-image"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Create article node entity with attached image</h2><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">Drupal\node\Entity\Node</span><span class="p">;</span>

  <span class="nv">$data</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="s1">'https://www.drupal.org/files/druplicon-small.png'</span><span class="p">);</span>
  <span class="nv">$file</span> <span class="o">=</span> <span class="nf">file_save_data</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="s1">'public://druplicon.png'</span><span class="p">,</span> <span class="no">FILE_EXISTS_RENAME</span><span class="p">);</span>

  <span class="nv">$node</span> <span class="o">=</span> <span class="nc">Node</span><span class="o">::</span><span class="nf">create</span><span class="p">([</span>
    <span class="s1">'type'</span>        <span class="o">=&gt;</span> <span class="s1">'article'</span><span class="p">,</span>
    <span class="s1">'title'</span>       <span class="o">=&gt;</span> <span class="s1">'A new article'</span><span class="p">,</span>
    <span class="s1">'field_image'</span> <span class="o">=&gt;</span> <span class="p">[</span>
      <span class="s1">'target_id'</span> <span class="o">=&gt;</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">(),</span>
      <span class="s1">'alt'</span> <span class="o">=&gt;</span> <span class="s1">'Drupal'</span><span class="p">,</span>
      <span class="s1">'title'</span> <span class="o">=&gt;</span> <span class="s1">'Drupal logo'</span>
    <span class="p">],</span>
  <span class="p">]);</span>
  <span class="nb">assert</span><span class="p">(</span><span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">isNew</span><span class="p">(),</span> <span class="kc">TRUE</span><span class="p">);</span>
  <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">save</span><span class="p">();</span>
  <span class="nb">assert</span><span class="p">(</span><span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">isNew</span><span class="p">(),</span> <span class="kc">FALSE</span><span class="p">);</span>
</code></pre></div></div><h2 id="update-a-node-entity-and-add-some-terms"> <a aria-labelledby="update-a-node-entity-and-add-some-terms" class="anchor-heading" href="https://selwynpolit.github.io/d9book/entities#update-a-node-entity-and-add-some-terms"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Update a node entity and add some terms</h2><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">Drupal\node\Entity\Node</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Drupal\taxonomy\Entity\Term</span><span class="p">;</span>

<span class="nv">$node</span> <span class="o">=</span> <span class="nc">Node</span><span class="o">::</span><span class="nf">load</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
<span class="nv">$term1</span> <span class="o">=</span> <span class="nc">Term</span><span class="o">::</span><span class="nf">load</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="nv">$term2</span> <span class="o">=</span> <span class="nc">Term</span><span class="o">::</span><span class="nf">load</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="nv">$node</span><span class="o">-&gt;</span><span class="n">field_tags</span><span class="o">-&gt;</span><span class="nf">setValue</span><span class="p">([</span><span class="nv">$term1</span><span class="p">,</span> <span class="nv">$term2</span><span class="p">]);</span>
<span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">save</span><span class="p">();</span>
</code></pre></div></div><h2 id="get-the-entity-type-and-content-type-or-bundle-type"> <a aria-labelledby="get-the-entity-type-and-content-type-or-bundle-type" class="anchor-heading" href="https://selwynpolit.github.io/d9book/entities#get-the-entity-type-and-content-type-or-bundle-type"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Get the entity type and content type (or bundle type)</h2><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">Drupal\Core\Entity\EntityInterface</span><span class="p">;</span>

<span class="k">function</span> <span class="n">hook_entity_presave</span><span class="p">(</span><span class="kt">EntityInterface</span> <span class="nv">$entity</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// getEntityTypeId() returns 'node'.</span>
  <span class="c1">// $entity-&gt;bundle() returns 'article'. </span>
  <span class="k">if</span><span class="p">(</span><span class="nv">$entity</span><span class="o">-&gt;</span><span class="nf">getEntityTypeId</span><span class="p">()</span> <span class="o">==</span> <span class="s1">'node'</span> <span class="o">&amp;&amp;</span> <span class="nv">$entity</span><span class="o">-&gt;</span><span class="nf">bundle</span><span class="p">()</span> <span class="o">==</span> <span class="s1">'article'</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Do your stuff here</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="identify-entities"> <a aria-labelledby="identify-entities" class="anchor-heading" href="https://selwynpolit.github.io/d9book/entities#identify-entities"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Identify entities</h2><p>from https://www.drupal.org/docs/drupal-apis/entity-api/working-with-the-entity-api</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Make sure that an object is an entity.</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$entity</span> <span class="k">instanceof</span> <span class="nc">\Drupal\Core\Entity\EntityInterface</span><span class="p">)</span> <span class="p">{</span>
<span class="p">}</span>

<span class="c1">// Make sure it's a content entity.</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$entity</span> <span class="k">instanceof</span> <span class="nc">\Drupal\Core\Entity\ContentEntityInterface</span><span class="p">)</span> <span class="p">{</span>
<span class="p">}</span>
<span class="c1">// or:</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$entity</span><span class="o">-&gt;</span><span class="nf">getEntityType</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getGroup</span><span class="p">()</span> <span class="o">==</span> <span class="s1">'content'</span><span class="p">)</span> <span class="p">{</span>
<span class="p">}</span>

<span class="c1">// Get the entity type or the entity type ID.</span>
<span class="nv">$entity</span><span class="o">-&gt;</span><span class="nf">getEntityType</span><span class="p">();</span>
<span class="nv">$entity</span><span class="o">-&gt;</span><span class="nf">getEntityTypeId</span><span class="p">();</span>

<span class="c1">// Make sure it's a node.</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$entity</span> <span class="k">instanceof</span> <span class="nc">\Drupal\node\NodeInterface</span><span class="p">)</span> <span class="p">{</span>
<span class="p">}</span>

<span class="c1">// Using entityType() works better when the needed entity type is dynamic.</span>
<span class="nv">$needed_type</span> <span class="o">=</span> <span class="s1">'node'</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$entity</span><span class="o">-&gt;</span><span class="nf">getEntityTypeId</span><span class="p">()</span> <span class="o">==</span> <span class="nv">$needed_type</span><span class="p">)</span> <span class="p">{</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="create-a-file-entity"> <a aria-labelledby="create-a-file-entity" class="anchor-heading" href="https://selwynpolit.github.io/d9book/entities#create-a-file-entity"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Create a file entity</h2><p>Note. Drupal is ok with files existing (for example in sites/default/files) without file entities but it probably makes more sense to have file entities connected with those files. When you create file entities, Drupal tracks the files in the tables: file_managed and file_usage. . You can also create media entities where bundle=’file’.</p><p>Once the file already exists, I write the file entity. I do need a mime type</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">switch</span> <span class="p">(</span><span class="nb">strtoupper</span><span class="p">(</span><span class="nv">$type</span><span class="p">)){</span>
  <span class="k">case</span> <span class="s1">'PDF'</span><span class="o">:</span>
    <span class="nv">$mimetype</span> <span class="o">=</span> <span class="s1">'application/pdf'</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">'JPG'</span><span class="o">:</span>
    <span class="nv">$mimetype</span> <span class="o">=</span> <span class="s1">'image/jpeg'</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">'POW'</span><span class="o">:</span>
    <span class="nv">$mimetype</span> <span class="o">=</span> <span class="s1">'application/vnd.ms-powerpoint'</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>


<span class="c1">// Create file entity.</span>
<span class="nv">$file</span> <span class="o">=</span> <span class="nc">File</span><span class="o">::</span><span class="nf">create</span><span class="p">();</span>
<span class="nv">$file</span><span class="o">-&gt;</span><span class="nf">setFileUri</span><span class="p">(</span><span class="nv">$destination</span><span class="p">);</span>
<span class="nv">$file</span><span class="o">-&gt;</span><span class="nf">setOwnerId</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="nv">$file</span><span class="o">-&gt;</span><span class="nf">setMimeType</span><span class="p">(</span><span class="nv">$mimetype</span><span class="p">);</span>
<span class="nv">$file</span><span class="o">-&gt;</span><span class="nf">setFileName</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">fileSystem</span><span class="o">-&gt;</span><span class="nb">basename</span><span class="p">(</span><span class="nv">$final_destination</span><span class="p">));</span>
<span class="nv">$file</span><span class="o">-&gt;</span><span class="nf">setPermanent</span><span class="p">();</span>
<span class="nv">$file</span><span class="o">-&gt;</span><span class="nf">save</span><span class="p">();</span>

<span class="nv">$fid</span> <span class="o">=</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">();</span>
<span class="k">return</span> <span class="nv">$fid</span><span class="p">;</span>
</code></pre></div></div><h2 id="entity-validation"> <a aria-labelledby="entity-validation" class="anchor-heading" href="https://selwynpolit.github.io/d9book/entities#entity-validation"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Entity Validation</h2><p>This looks quite interesting although I haven’t had an opportunity to try it yet.</p><p>From Entity Validation API overview at <a href="https://www.drupal.org/node/2015613">https://www.drupal.org/node/2015613</a></p><p>The <a href="https://www.drupal.org/docs/drupal-apis/entity-api/entity-validation-api">entity validation API</a> should be used to validate values on a node, like any other content entity. While that was already possible to define validation constraints for base fields and for a field type, there was no API to add constraints to a specific field. This has been addressed.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cd">/**
 * Implements hook_entity_bundle_field_info_alter().
 */</span>
<span class="k">function</span> <span class="n">mymodule_entity_bundle_field_info_alter</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$fields</span><span class="p">,</span> <span class="nc">\Drupal\Core\Entity\EntityTypeInterface</span> <span class="nv">$entity_type</span><span class="p">,</span> <span class="nv">$bundle</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$entity_type</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">()</span> <span class="o">==</span> <span class="s1">'node'</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$fields</span><span class="p">[</span><span class="s1">'myfield'</span><span class="p">]))</span> <span class="p">{</span>
    <span class="nv">$fields</span><span class="p">[</span><span class="s1">'myfield'</span><span class="p">]</span><span class="o">-&gt;</span><span class="nf">setPropertyConstraints</span><span class="p">(</span><span class="s1">'value'</span><span class="p">,</span> <span class="p">[</span>
      <span class="s1">'Range'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'min'</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">'max'</span> <span class="o">=&gt;</span> <span class="mi">32</span><span class="p">,</span>
      <span class="p">],</span>
    <span class="p">]);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p>Custom validation constraints can also be defined. These links may be useful: <a href="https://api.drupal.org/api/drupal/core%21modules%21forum%21src%21Plugin%21Validation%21Constraint%21ForumLeafConstraint.php/class/ForumLeafConstraint/8">ForumLeafConstraint</a>/ and <a href="https://api.drupal.org/api/drupal/core%21modules%21forum%21src%21Plugin%21Validation%21Constraint%21ForumLeafConstraintValidator.php/class/ForumLeafConstraintValidator/8">ForumLeafConstraintValidator</a></p><p>Also from https://drupalize.me/tutorial/entity-validation-api?p=2792 (you need a paid membership to read the whole tutorial): Drupal includes the <a href="https://symfony.com/doc/2.8/components/validator.html">Symfony Validator component</a>, and provides an Entity Validation API to assist in validating the values of fields in an entity. By using the Entity Validation API you can ensure that you'r validation logic is applied to Entity CRUD operations regardless of how they are triggered. Whether editing an Entity via a Form API form, or creating a new Entity via the REST API, the same validation code will be used.</p><h2 id="resources"> <a aria-labelledby="resources" class="anchor-heading" href="https://selwynpolit.github.io/d9book/entities#resources"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Resources</h2><ul><li><a href="https://www.drupal.org/docs/drupal-apis/entity-api">Entity API on Drupal.org updated Jan 2021</a><li><a href="https://www.drupal.org/docs/drupal-apis/entity-api/introduction-to-entity-api-in-drupal-8">Introduction to Drupal Entity API from Drupal.org updated Sep 2022</a><li><a href="https://drupalsun.com/zhilevan/2018/07/21/drupal-entity-api-cheat-sheet">Drupal entity API cheat sheet Updated July 2018</a><li><a href="https://www.metaltoad.com/blog/drupal-8-entity-api-cheat-sheet">Drupal 8 Entity query API cheat sheet by Keith Dechant , Software Architect - updated February 2021</a><li><a href="https://drupalize.me/tutorial/entity-validation-api?p=2792">Entity Validation API tutorial from <a href="https://drupalize.me">https://drupalize.me</a> (requires paid membership to read the whole tutorial) updated February 2022 at</a></li></li></li></li></li></ul><hr/> <script async="" crossorigin="anonymous" data-category="Q&amp;A" data-category-id="MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMyMjY2NDE4" data-emit-metadata="0" data-input-position="bottom" data-lang="en" data-mapping="title" data-reactions-enabled="1" data-repo="selwynpolit/d9book" data-repo-id="MDEwOlJlcG9zaXRvcnkzMjUxNTQ1Nzg=" data-strict="0" data-theme="preferred_color_scheme" src="https://giscus.app/client.js"> </script><hr/><footer><p><a href="https://selwynpolit.github.io/d9book/entities#top" id="back-to-top">Back to top</a></p><p class="text-small text-grey-dk-100 mb-0"><span xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/"> <a href="http://www.selwynpolit.github.io/d9book" property="dct:title" rel="cc:attributionURL">Drupal at your fingertips</a> by <a href="http://www.drupal.org/u/selwynpolit" property="cc:attributionName" rel="cc:attributionURL dct:creator">Selwyn Polit</a> is licensed under <a href="http://creativecommons.org/licenses/by/4.0/" rel="license noopener noreferrer" target="_blank">CC BY 4.0 <img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg" style="height:16px!important;vertical-align:text-bottom;"/> <img src="https://mirrors.creativecommons.org/presskit/icons/by.svg" style="height:16px!important;vertical-align:text-bottom;"/> </a></span></p><div class="d-flex mt-2"><p class="text-small text-grey-dk-000 mb-0 mr-2"> Page last modified: <span class="d-inline-block">Apr 13 2023</span>.</p><p class="text-small text-grey-dk-000 mb-0"> <a href="https://github.com/selwynpolit/d9book/tree/gh-pages/book/entities.md" id="edit-this-page">Edit this page on GitHub</a></p></div></footer></div></div><div class="search-overlay"></div></div>
</body></link></meta></meta></meta></head></html>