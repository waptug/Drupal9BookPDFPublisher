<!DOCTYPE html>
<html lang="en-US"><head><meta charset="utf-8"/><meta content="IE=Edge" http-equiv="X-UA-Compatible"/><link href="https://selwynpolit.github.io/d9book/assets/css/just-the-docs-default.css" rel="stylesheet"/> <script async="" src="https://www.googletagmanager.com/gtag/js?id=8V22RQEJ71"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', '8V22RQEJ71', { 'anonymize_ip': true }); </script> <script src="https://selwynpolit.github.io/d9book/assets/js/vendor/lunr.min.js"></script> <script src="https://selwynpolit.github.io/d9book/assets/js/just-the-docs.js"></script><meta content="width=device-width, initial-scale=1" name="viewport"/><link href="https://selwynpolit.github.io/d9book/assets/images/favicon.ico" rel="icon" type="image/x-icon"/><title>Queries | Drupal Book</title><meta content="Jekyll v4.3.2" name="generator"><meta content="Queries" property="og:title"><meta content="en_US" property="og:locale"><meta content="Drupal at your fingertips" name="description"/><meta content="Drupal at your fingertips" property="og:description"/><link href="https://selwynpolit.github.io/d9book/d9book/queries" rel="canonical"><meta content="https://selwynpolit.github.io/d9book/d9book/queries" property="og:url"/><meta content="Drupal Book" property="og:site_name"/><meta content="website" property="og:type"/><meta content="summary" name="twitter:card"/><meta content="Queries" property="twitter:title"/> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Drupal at your fingertips","headline":"Queries","url":"https://selwynpolit.github.io/d9book/d9book/queries"}</script><body> <a class="skip-to-main" href="https://selwynpolit.github.io/d9book/queries#main-content">Skip to main content</a> <svg class="d-none" xmlns="http://www.w3.org/2000/svg"> <symbol id="svg-link" viewbox="0 0 24 24"><title>Link</title><svg class="feather feather-link" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewbox="0 0 24 24"><title>Menu</title><svg class="feather feather-menu" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><line x1="3" x2="21" y1="12" y2="12"></line><line x1="3" x2="21" y1="6" y2="6"></line><line x1="3" x2="21" y1="18" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewbox="0 0 24 24"><title>Expand</title><svg class="feather feather-chevron-right" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol class="feather feather-external-link" fill="none" height="24" id="svg-external-link" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24"><title id="svg-external-link-title">(external link)</title><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" x2="21" y1="14" y2="3"></line> </symbol> <symbol id="svg-doc" viewbox="0 0 24 24"><title>Document</title><svg class="feather feather-file" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewbox="0 0 24 24"><title>Search</title><svg class="feather feather-search" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"> <circle cx="11" cy="11" r="8"></circle><line x1="21" x2="16.65" y1="21" y2="16.65"></line> </svg> </symbol> <symbol id="svg-copy" viewbox="0 0 16 16"><title>Copy</title><svg class="bi bi-clipboard" fill="currentColor" height="16" viewbox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"></path><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"></path> </svg> </symbol> <symbol id="svg-copied" viewbox="0 0 16 16"><title>Copied</title><svg class="bi bi-clipboard-check-fill" fill="currentColor" height="16" viewbox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"></path><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"></path> </svg> </symbol> </svg><div class="side-bar"><div class="site-header"> <a class="site-title lh-tight" href="https://selwynpolit.github.io/d9book/"> Drupal Book </a> <a class="site-button" href="https://selwynpolit.github.io/d9book/queries" id="menu-button"> <svg class="icon" viewbox="0 0 24 24"><use xlink:href="#svg-menu"></use></svg> </a></div><nav aria-label="Main" class="site-nav" id="site-nav"><ul class="nav-list"><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/">Home</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/actions">Actions</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/attribution">Attribution</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/bq">Batch and Queue</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/blocks">Blocks</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/caching">Caching</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/composer">Composer</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/config">Config</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/cron">Cron</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/dates">Dates and Times</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/debugging">Debugging</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/development">Development</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/drush">Drush</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/email">Email</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/entities">Entities</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/forms">Forms</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/general">General</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/off-island">Getting off the Island</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/hooks">Hooks</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/learn">Learning</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/links">Links</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/logging">Logging</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/menus">Menus</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/migrate">Migrate</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/modals">Modals</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/nodes-and-fields">Nodes and Fields</a><li class="nav-list-item active"><a class="nav-list-link active" href="https://selwynpolit.github.io/d9book/queries">Queries</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/redirects">Redirects</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/render">Render Arrays</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/routes">Routes</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/security">Security</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/services">Services</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/state">State</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/taxonomy">Taxonomy</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/dtt">Tests</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/twig">Twig</a></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></ul><ul class="nav-list"><li class="nav-list-item external"> <a class="nav-list-link external" href="https://github.com/selwynpolit/d9book/fork"> Fork me on GitHub <svg aria-labelledby="svg-external-link-title" viewbox="0 0 24 24"><use xlink:href="#svg-external-link"></use></svg> </a></li></ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer></div><div class="main" id="top"><div class="main-header" id="main-header"><div class="search"><div class="search-input-wrap"> <input aria-label="Search Drupal Book" autocomplete="off" class="search-input" id="search-input" placeholder="Search Drupal Book" tabindex="0" type="text"/> <label class="search-label" for="search-input"><svg class="search-icon" viewbox="0 0 24 24"><use xlink:href="#svg-search"></use></svg></label></div><div class="search-results" id="search-results"></div></div><nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a class="site-button" href="https://twitter.com/selwynpolit" rel="noopener noreferrer" target="_blank"> <img alt="Twitter logo" src="https://atuin.ru/demo/simple-icons/icons/twitter.svg" style="width: 30px; height: 30px;" title="Author in Twitter"/> </a><li class="aux-nav-list-item"> <a class="site-button" href="https://github.com/selwynpolit/d9book/tree/gh-pages" rel="noopener noreferrer" target="_blank"> <img alt="GitHub logo" src="https://atuin.ru/demo/simple-icons/icons/github.svg" style="width: 30px; height: 30px;" title="D9Book on GitHub"/> </a></li></li></ul></nav></div><div class="main-content-wrap" id="main-content-wrap"><div class="main-content" id="main-content" role="main"><h1 class="no_toc fw-500" id="queries"> <a aria-labelledby="queries" class="anchor-heading" href="https://selwynpolit.github.io/d9book/queries#queries"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Queries</h1><h2 class="no_toc text-delta" id="table-of-contents"> <a aria-labelledby="table-of-contents" class="anchor-heading" href="https://selwynpolit.github.io/d9book/queries#table-of-contents"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Table of contents</h2><ul id="markdown-toc"><li><a href="https://selwynpolit.github.io/d9book/queries#entityquery" id="markdown-toc-entityquery">entityQuery</a><ul><li><a href="https://selwynpolit.github.io/d9book/queries#find-matching-nodes---example-1" id="markdown-toc-find-matching-nodes---example-1">Find matching nodes - example 1</a><li><a href="https://selwynpolit.github.io/d9book/queries#find-matching-nodes---example-2" id="markdown-toc-find-matching-nodes---example-2">Find matching nodes - example 2</a><li><a href="https://selwynpolit.github.io/d9book/queries#find-matching-article-nodes--example-3" id="markdown-toc-find-matching-article-nodes--example-3">Find matching article nodes – example 3</a><li><a href="https://selwynpolit.github.io/d9book/queries#find-nodes-that-match-a-taxonomy-term" id="markdown-toc-find-nodes-that-match-a-taxonomy-term">Find nodes that match a taxonomy term</a><li><a href="https://selwynpolit.github.io/d9book/queries#find-5-nodes-that-have-a-matching-taxonomy-term" id="markdown-toc-find-5-nodes-that-have-a-matching-taxonomy-term">Find 5 nodes that have a matching taxonomy term</a><li><a href="https://selwynpolit.github.io/d9book/queries#find-matching-nodes-and-delete-them" id="markdown-toc-find-matching-nodes-and-delete-them">Find matching nodes and delete them</a><li><a href="https://selwynpolit.github.io/d9book/queries#slice-up-entityquery-results-into-batches-of-100-nodes" id="markdown-toc-slice-up-entityquery-results-into-batches-of-100-nodes">Slice up entityQuery results into batches of 100 nodes</a><li><a href="https://selwynpolit.github.io/d9book/queries#query-the-creation-date-among-other-things-using-entityquery" id="markdown-toc-query-the-creation-date-among-other-things-using-entityquery">Query the creation date (among other things) using entityQuery</a><li><a href="https://selwynpolit.github.io/d9book/queries#entityquery-frequently-used-conditions" id="markdown-toc-entityquery-frequently-used-conditions">entityQuery frequently used conditions</a><li><a href="https://selwynpolit.github.io/d9book/queries#update-menu-items-programatically" id="markdown-toc-update-menu-items-programatically">Update menu items programatically</a><li><a href="https://selwynpolit.github.io/d9book/queries#query-multi-value-fields" id="markdown-toc-query-multi-value-fields">Query multi-value fields</a><li><a href="https://selwynpolit.github.io/d9book/queries#query-entity-reference-fields-if-they-have-a-value-or-no-value" id="markdown-toc-query-entity-reference-fields-if-they-have-a-value-or-no-value">Query entity reference fields if they have a value or no value</a><li><a href="https://selwynpolit.github.io/d9book/queries#query-entity-reference-fields" id="markdown-toc-query-entity-reference-fields">Query entity reference fields</a></li></li></li></li></li></li></li></li></li></li></li></li></li></ul><li><a href="https://selwynpolit.github.io/d9book/queries#static-and-dynamic-queries" id="markdown-toc-static-and-dynamic-queries">Static and dynamic Queries</a><ul><li><a href="https://selwynpolit.github.io/d9book/queries#static-queries" id="markdown-toc-static-queries">Static Queries</a><li><a href="https://selwynpolit.github.io/d9book/queries#get-a-connection-object" id="markdown-toc-get-a-connection-object">Get a connection object</a><li><a href="https://selwynpolit.github.io/d9book/queries#sql-select-example" id="markdown-toc-sql-select-example">SQL select example</a><li><a href="https://selwynpolit.github.io/d9book/queries#find-the-biggest-value-in-a-field" id="markdown-toc-find-the-biggest-value-in-a-field">Find the biggest value in a field</a><li><a href="https://selwynpolit.github.io/d9book/queries#sql-update-query---example-1" id="markdown-toc-sql-update-query---example-1">SQL update query - example 1</a><li><a href="https://selwynpolit.github.io/d9book/queries#sql-update-query---example-2" id="markdown-toc-sql-update-query---example-2">SQL update query - example 2</a><li><a href="https://selwynpolit.github.io/d9book/queries#sql-update-query---example-3" id="markdown-toc-sql-update-query---example-3">SQL update query - example 3</a><li><a href="https://selwynpolit.github.io/d9book/queries#sql-insert" id="markdown-toc-sql-insert">SQL insert</a><li><a href="https://selwynpolit.github.io/d9book/queries#sql-insert-query" id="markdown-toc-sql-insert-query">SQL Insert Query</a><li><a href="https://selwynpolit.github.io/d9book/queries#sql-delete-query" id="markdown-toc-sql-delete-query">SQL Delete query</a><li><a href="https://selwynpolit.github.io/d9book/queries#paragraph-query" id="markdown-toc-paragraph-query">Paragraph query</a><li><a href="https://selwynpolit.github.io/d9book/queries#create-a-custom-table-for-your-module" id="markdown-toc-create-a-custom-table-for-your-module">Create a custom table for your module</a></li></li></li></li></li></li></li></li></li></li></li></li></ul><li><a href="https://selwynpolit.github.io/d9book/queries#reference" id="markdown-toc-reference">Reference</a></li></li></li></ul><p><img alt="views" src="https://api.visitor.plantree.me/visitor-badge/pv?label=views&amp;color=informational&amp;namespace=d9book&amp;key=queries.md"/></p><hr/><p>For most work, I use entityQueries. There are a few circumstances where I’ve needed to get into the SQL which meant using static or dynamic queries. There are examples of these different techniques below.</p><h1 id="entityquery"> <a aria-labelledby="entityquery" class="anchor-heading" href="https://selwynpolit.github.io/d9book/queries#entityquery"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> entityQuery</h1><h2 id="find-matching-nodes---example-1"> <a aria-labelledby="find-matching-nodes---example-1" class="anchor-heading" href="https://selwynpolit.github.io/d9book/queries#find-matching-nodes---example-1"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Find matching nodes - example 1</h2><p>In this EntityQuery example we search for nodes of content type (bundle) ws_product and match field_product_sku with the $sku variable.</p><p>use Drupal\node\Entity\Node;</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">getProductId</span><span class="p">(</span><span class="nv">$sku</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$productId</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nv">$query</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityQuery</span><span class="p">(</span><span class="s1">'node'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'type'</span><span class="p">,</span> <span class="s1">'ws_product'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'field_product_sku'</span><span class="p">,</span> <span class="nv">$sku</span><span class="p">);</span>

  <span class="nv">$nids</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$nids</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$nid</span> <span class="o">=</span> <span class="nb">array_values</span><span class="p">(</span><span class="nv">$nids</span><span class="p">);</span>
    <span class="nv">$node</span> <span class="o">=</span> <span class="nc">Node</span><span class="o">::</span><span class="nf">load</span><span class="p">(</span><span class="nv">$nid</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="nv">$productId</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'field_product_id'</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nv">$productId</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="find-matching-nodes---example-2"> <a aria-labelledby="find-matching-nodes---example-2" class="anchor-heading" href="https://selwynpolit.github.io/d9book/queries#find-matching-nodes---example-2"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Find matching nodes - example 2</h2><p>In this entityQuery we search for published nodes of type contract with field_contract_status having the value “Active”. This puts the resulting nids and node titles in a render array for display.</p><p>This is a simple query which outputs a bunch of nids and titles</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="n">loadRawSalesforceData</span><span class="p">()</span> <span class="p">{</span>
  <span class="nv">$node_storage</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityTypeManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getStorage</span><span class="p">(</span><span class="s1">'node'</span><span class="p">);</span>
  <span class="nv">$query</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityQuery</span><span class="p">(</span><span class="s1">'node'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'type'</span><span class="p">,</span> <span class="s1">'contract'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'status'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'field_contract_status'</span><span class="p">,</span> <span class="s1">'Active'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nb">sort</span><span class="p">(</span><span class="s1">'title'</span><span class="p">,</span> <span class="s1">'DESC'</span><span class="p">);</span>

  <span class="nv">$nids</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$nids</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$nodes</span> <span class="o">=</span> <span class="nv">$node_storage</span><span class="o">-&gt;</span><span class="nf">loadMultiple</span><span class="p">(</span><span class="nv">$nids</span><span class="p">);</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$nodes</span> <span class="k">as</span> <span class="nv">$node</span><span class="p">)</span> <span class="p">{</span>
       <span class="nv">$nid</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">();</span>
       <span class="nv">$titles</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[</span>
         <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'markup'</span><span class="p">,</span>
          <span class="s1">'#markup'</span> <span class="o">=&gt;</span> <span class="s2">"&lt;p&gt;"</span> <span class="mf">.</span> <span class="s2">"nid=</span><span class="nv">$nid</span><span class="s2"> "</span> <span class="mf">.</span> <span class="s2">"Title="</span> <span class="mf">.</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">getTitle</span><span class="p">()</span><span class="mf">.</span> <span class="s2">"&lt;/p&gt;"</span><span class="p">,</span>
       <span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">$titles</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="p">[</span>
    <span class="s1">'#markup'</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">t</span><span class="p">(</span><span class="s1">'nothing, nada, not a sausage'</span><span class="p">),</span>
    <span class="p">];</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="find-matching-article-nodes--example-3"> <a aria-labelledby="find-matching-article-nodes--example-3" class="anchor-heading" href="https://selwynpolit.github.io/d9book/queries#find-matching-article-nodes--example-3"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Find matching article nodes – example 3</h2><p>This example looks for an entity of type ‘article’ with the name $name</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="n">entityExists</span><span class="p">()</span> <span class="p">{</span>

  <span class="nv">$name</span> <span class="o">=</span> <span class="s1">'hello'</span><span class="p">;</span>
  <span class="c1">// See if the article named hello exists.</span>
  <span class="nv">$query</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityQuery</span><span class="p">(</span><span class="s1">'node'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'type'</span><span class="p">,</span> <span class="s1">'article'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'title'</span><span class="p">,</span> <span class="nv">$name</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nb">count</span><span class="p">();</span>

  <span class="nv">$count_nodes</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>

  <span class="k">if</span> <span class="p">(</span><span class="nv">$count_nodes</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$str</span> <span class="o">=</span> <span class="s2">"Found no articles"</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">elseif</span> <span class="p">(</span><span class="nv">$count_nodes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$str</span> <span class="o">=</span> <span class="s2">"Found </span><span class="nv">$count_nodes</span><span class="s2"> articles"</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nv">$render_array</span><span class="p">[</span><span class="s1">'content'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'item'</span><span class="p">,</span>
    <span class="s1">'#markup'</span> <span class="o">=&gt;</span> <span class="nv">$str</span><span class="p">,</span>
  <span class="p">];</span>

  <span class="k">return</span> <span class="nv">$render_array</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="find-nodes-that-match-a-taxonomy-term"> <a aria-labelledby="find-nodes-that-match-a-taxonomy-term" class="anchor-heading" href="https://selwynpolit.github.io/d9book/queries#find-nodes-that-match-a-taxonomy-term"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Find nodes that match a taxonomy term</h2><p>Find all nodes that match a term_id and retrieve the first 5 nodes sorted by title. This code also puts them into a render array for display.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">protected</span> <span class="k">function</span> <span class="n">loadFirstOpinion</span><span class="p">(</span><span class="nv">$term_id</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$storage</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityTypeManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getStorage</span><span class="p">(</span><span class="s1">'node'</span><span class="p">);</span>
  <span class="nv">$query</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityQuery</span><span class="p">(</span><span class="s1">'node'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'status'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'type'</span><span class="p">,</span> <span class="s1">'opinion'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'field_category'</span><span class="p">,</span> <span class="nv">$term_id</span><span class="p">,</span> <span class="s1">'='</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nb">sort</span><span class="p">(</span><span class="s1">'title'</span><span class="p">,</span> <span class="s1">'ASC'</span><span class="p">)</span> <span class="c1">//or DESC</span>
    <span class="o">-&gt;</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
  <span class="nv">$nids</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>
  <span class="nv">$nodes</span> <span class="o">=</span> <span class="nv">$storage</span><span class="o">-&gt;</span><span class="nf">loadMultiple</span><span class="p">(</span><span class="nv">$nids</span><span class="p">);</span>

  <span class="nv">$render_array</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">foreach</span> <span class="p">(</span><span class="nv">$nodes</span> <span class="k">as</span> <span class="nv">$node</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$render_array</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[</span>
      <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'markup'</span><span class="p">,</span>
      <span class="s1">'#markup'</span> <span class="o">=&gt;</span> <span class="s1">'&lt;p&gt;'</span> <span class="mf">.</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">getTitle</span><span class="p">(),</span>
    <span class="p">];</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nv">$render_array</span><span class="p">;</span>
</code></pre></div></div><h2 id="find-5-nodes-that-have-a-matching-taxonomy-term"> <a aria-labelledby="find-5-nodes-that-have-a-matching-taxonomy-term" class="anchor-heading" href="https://selwynpolit.github.io/d9book/queries#find-5-nodes-that-have-a-matching-taxonomy-term"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Find 5 nodes that have a matching taxonomy term</h2><p>We look for published nodes of node type <code class="language-plaintext highlighter-rouge">opinion</code> that have a term in the category field, sorted by title ascending, starting with the first result and giving us 5 results. The resulting titles are put into a render array.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">protected</span> <span class="k">function</span> <span class="n">loadFirstOpinion</span><span class="p">(</span><span class="nv">$term_id</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$storage</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityTypeManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getStorage</span><span class="p">(</span><span class="s1">'node'</span><span class="p">);</span>
  <span class="nv">$query</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityQuery</span><span class="p">(</span><span class="s1">'node'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'status'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'type'</span><span class="p">,</span> <span class="s1">'opinion'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'field_category'</span><span class="p">,</span> <span class="nv">$term_id</span><span class="p">,</span> <span class="s1">'='</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nb">sort</span><span class="p">(</span><span class="s1">'title'</span><span class="p">,</span> <span class="s1">'ASC'</span><span class="p">)</span> <span class="c1">//or DESC</span>
    <span class="o">-&gt;</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
  <span class="nv">$nids</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>
  <span class="nv">$nodes</span> <span class="o">=</span> <span class="nv">$storage</span><span class="o">-&gt;</span><span class="nf">loadMultiple</span><span class="p">(</span><span class="nv">$nids</span><span class="p">);</span>

  <span class="nv">$render_array</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">foreach</span> <span class="p">(</span><span class="nv">$nodes</span> <span class="k">as</span> <span class="nv">$node</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$render_array</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[</span>
      <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'markup'</span><span class="p">,</span>
      <span class="s1">'#markup'</span> <span class="o">=&gt;</span> <span class="s1">'&lt;p&gt;'</span> <span class="mf">.</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">getTitle</span><span class="p">(),</span>
    <span class="p">];</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nv">$render_array</span><span class="p">;</span>
</code></pre></div></div><h2 id="find-matching-nodes-and-delete-them"> <a aria-labelledby="find-matching-nodes-and-delete-them" class="anchor-heading" href="https://selwynpolit.github.io/d9book/queries#find-matching-nodes-and-delete-them"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Find matching nodes and delete them</h2><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="n">deleteQuery1</span><span class="p">()</span> <span class="p">{</span>
  <span class="nv">$results</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityQuery</span><span class="p">(</span><span class="s1">'node'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'type'</span><span class="p">,</span> <span class="s1">'event'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>

  <span class="k">if</span> <span class="p">(</span><span class="nv">$results</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$results</span> <span class="k">as</span> <span class="nv">$result</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$node</span> <span class="o">=</span> <span class="nc">Node</span><span class="o">::</span><span class="nf">load</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>
      <span class="nv">$node</span><span class="o">-&gt;</span><span class="nb">delete</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nv">$render_array</span><span class="p">[</span><span class="s1">'content'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'item'</span><span class="p">,</span>
    <span class="s1">'#markup'</span> <span class="o">=&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="s2">"10 nodes deleted."</span><span class="p">),</span>
  <span class="p">];</span>

  <span class="k">return</span> <span class="nv">$render_array</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="slice-up-entityquery-results-into-batches-of-100-nodes"> <a aria-labelledby="slice-up-entityquery-results-into-batches-of-100-nodes" class="anchor-heading" href="https://selwynpolit.github.io/d9book/queries#slice-up-entityquery-results-into-batches-of-100-nodes"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Slice up entityQuery results into batches of 100 nodes</h2><p>This is often used for batch API operations.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$query</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityQuery</span><span class="p">(</span><span class="s1">'node'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'type'</span><span class="p">,</span> <span class="s1">'contract'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'status'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nb">sort</span><span class="p">(</span><span class="s1">'title'</span><span class="p">,</span> <span class="s1">'ASC'</span><span class="p">);</span>
<span class="nv">$nids</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>
<span class="nv">$nid_count</span> <span class="o">=</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$nids</span><span class="p">);</span>

<span class="c1">// Grab 100 nids at a time to batch process.</span>
<span class="nv">$batches</span> <span class="o">=</span> <span class="p">[];</span>
<span class="k">for</span> <span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nv">$i</span><span class="o">&lt;=</span><span class="nv">$nid_count</span><span class="p">;</span><span class="nv">$i</span><span class="o">+=</span><span class="mi">100</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$batches</span><span class="p">[]</span> <span class="o">=</span> <span class="nb">array_slice</span><span class="p">(</span><span class="nv">$nids</span><span class="p">,</span> <span class="nv">$i</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="query-the-creation-date-among-other-things-using-entityquery"> <a aria-labelledby="query-the-creation-date-among-other-things-using-entityquery" class="anchor-heading" href="https://selwynpolit.github.io/d9book/queries#query-the-creation-date-among-other-things-using-entityquery"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Query the creation date (among other things) using entityQuery</h2><p>Note. The created (and changed) field uses a unix timestamp. This is an int 11 field in the db with a value like 1525302749 If you add a Drupal date field, its data looks like 2019-05-15T21:32:00 (varchar 20)</p><p>If you want to query a date field in a content type, you will have to fiddle around with the setTimezone stuff that is commented out below. The date field referenced below (field_date) is a standard Drupal date field.</p><p>More at <a href="https://blog.werk21.de/en/2018/02/05/date-range-fields-and-entity-query-update">https://blog.werk21.de/en/2018/02/05/date-range-fields-and-entity-query-update</a> and <a href="https://drupal.stackexchange.com/questions/198324/how-to-do-a-date-range-entityquery-with-a-date-only-field-in-drupal-8">https://drupal.stackexchange.com/questions/198324/how-to-do-a-date-range-entityquery-with-a-date-only-field-in-drupal-8</a></p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">protected</span> <span class="k">function</span> <span class="n">loadOpinionForAYear</span><span class="p">(</span><span class="nv">$year</span><span class="p">,</span> <span class="nv">$term_id</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$storage</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityTypeManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getStorage</span><span class="p">(</span><span class="s1">'node'</span><span class="p">);</span>

    <span class="c1">// Get a date string suitable for use with entity query.</span>
    <span class="c1">//    $date = new DrupalDateTime();  // now</span>
    <span class="nv">$format</span> <span class="o">=</span> <span class="s1">'Y-m-d H:i'</span><span class="p">;</span>
    <span class="nv">$start_date</span> <span class="o">=</span> <span class="nc">DrupalDateTime</span><span class="o">::</span><span class="nf">createFromFormat</span><span class="p">(</span><span class="nv">$format</span><span class="p">,</span> <span class="nv">$year</span> <span class="mf">.</span> <span class="s2">"-01-01 00:00"</span><span class="p">);</span>
    <span class="nv">$end_date</span> <span class="o">=</span> <span class="nc">DrupalDateTime</span><span class="o">::</span><span class="nf">createFromFormat</span><span class="p">(</span><span class="nv">$format</span><span class="p">,</span> <span class="nv">$year</span> <span class="mf">.</span> <span class="s2">"-12-31 23:59"</span><span class="p">);</span>

    <span class="nv">$start_date</span> <span class="o">=</span> <span class="nv">$start_date</span><span class="o">-&gt;</span><span class="nf">getTimestamp</span><span class="p">();</span>
    <span class="nv">$end_date</span> <span class="o">=</span> <span class="nv">$end_date</span><span class="o">-&gt;</span><span class="nf">getTimestamp</span><span class="p">();</span>

<span class="c1">//    $start_date-&gt;setTimezone(new \DateTimeZone(DateTimeItemInterface::STORAGE_TIMEZONE));</span>
<span class="c1">//    $end_date-&gt;setTimezone(new \DateTimeZone(DateTimeItemInterface::STORAGE_TIMEZONE));</span>
<span class="c1">//    $start_date = $start_date-&gt;format(DateTimeItemInterface::DATETIME_STORAGE_FORMAT);</span>
<span class="c1">//    $end_date = $end_date-&gt;format(DateTimeItemInterface::DATETIME_STORAGE_FORMAT);</span>

<span class="c1">// Set the condition.</span>
<span class="c1">//    $query-&gt;condition('field_date.value', $start_date, '&gt;=');</span>
<span class="c1">//    $query-&gt;condition('field_date.value', $end_date, '&lt;=');</span>


    <span class="nv">$query</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityQuery</span><span class="p">(</span><span class="s1">'node'</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'status'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'type'</span><span class="p">,</span> <span class="s1">'opinion'</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'field_category'</span><span class="p">,</span> <span class="nv">$term_id</span><span class="p">,</span> <span class="s1">'='</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'created'</span><span class="p">,</span> <span class="nv">$start_date</span><span class="p">,</span> <span class="s1">'&gt;='</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'created'</span><span class="p">,</span> <span class="nv">$end_date</span><span class="p">,</span> <span class="s1">'&lt;='</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="nb">sort</span><span class="p">(</span><span class="s1">'title'</span><span class="p">,</span> <span class="s1">'DESC'</span><span class="p">);</span>
    <span class="nv">$nids</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>
    <span class="nv">$titles</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$nids</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$nodes</span> <span class="o">=</span> <span class="nv">$storage</span><span class="o">-&gt;</span><span class="nf">loadMultiple</span><span class="p">(</span><span class="nv">$nids</span><span class="p">);</span>
      <span class="k">foreach</span> <span class="p">(</span><span class="nv">$nodes</span> <span class="k">as</span> <span class="nv">$node</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$titles</span><span class="p">[]</span><span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">getTitle</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">$titles</span><span class="p">;</span>

  <span class="p">}</span>
</code></pre></div></div><h2 id="entityquery-frequently-used-conditions"> <a aria-labelledby="entityquery-frequently-used-conditions" class="anchor-heading" href="https://selwynpolit.github.io/d9book/queries#entityquery-frequently-used-conditions"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> entityQuery frequently used conditions</h2><ul><li><p>Published: <code class="language-plaintext highlighter-rouge">-&gt;condition('status', 1)</code></p><li><p>Text field not empty: <code class="language-plaintext highlighter-rouge">-&gt;condition('field_source_url', '', '&lt;&gt;')</code></p><li><p>Field value &gt; 14: <code class="language-plaintext highlighter-rouge">-&gt;condition('field_some_field', 14, '&gt;')</code></p><li><p>Reference field empty: <code class="language-plaintext highlighter-rouge">-&gt;notExists('field_sf_account_ref');</code></p><li><p>Null: <code class="language-plaintext highlighter-rouge">-&gt;condition(\$field,NULL, \'IS NULL\');</code></p><li><p>Not Null: <code class="language-plaintext highlighter-rouge">-&gt;condition(\$field,NULL, \'IS NOT NULL\');</code></p></li></li></li></li></li></li></ul><p>Lots more at <a href="https://www.drupal.org/docs/8/api/database-api/dynamic-queries/conditions">https://www.drupal.org/docs/8/api/database-api/dynamic-queries/conditions</a></p><h2 id="update-menu-items-programatically"> <a aria-labelledby="update-menu-items-programatically" class="anchor-heading" href="https://selwynpolit.github.io/d9book/queries#update-menu-items-programatically"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Update menu items programatically</h2><p>To update several items in a menu use hook_update.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">park_academy_update_8002</span><span class="p">()</span> <span class="p">{</span>

  <span class="nv">$mids</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityQuery</span><span class="p">(</span><span class="s1">'menu_link_content'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'menu_name'</span><span class="p">,</span> <span class="s1">'park-wide-utility'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>

  <span class="k">foreach</span><span class="p">(</span><span class="nv">$mids</span> <span class="k">as</span> <span class="nv">$mid</span><span class="p">)</span> <span class="p">{</span>

    <span class="nv">$menu_link</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityTypeManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getStorage</span><span class="p">(</span><span class="s1">'menu_link_content'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">load</span><span class="p">(</span><span class="nv">$mid</span><span class="p">);</span>

    <span class="nv">$title</span> <span class="o">=</span> <span class="nv">$menu_link</span><span class="o">-&gt;</span><span class="nf">getTitle</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$title</span> <span class="o">===</span> <span class="s1">'Support'</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$menu_link</span><span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="s1">'weight'</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
      <span class="nv">$menu_link</span><span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="s1">'expanded'</span><span class="p">,</span> <span class="kc">TRUE</span><span class="p">);</span>
<span class="c1">//      $menu_link-&gt;set('title','yomama');</span>
      <span class="nv">$menu_link</span><span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="s1">'link'</span><span class="p">,</span> <span class="s1">'https://www.google.com'</span><span class="p">);</span>
      <span class="nv">$menu_link</span><span class="o">-&gt;</span><span class="nf">save</span><span class="p">();</span>

    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="query-multi-value-fields"> <a aria-labelledby="query-multi-value-fields" class="anchor-heading" href="https://selwynpolit.github.io/d9book/queries#query-multi-value-fields"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Query multi-value fields</h2><p>When querying multivalue fields, you need to use <code class="language-plaintext highlighter-rouge">%delta</code> to specify the position (or delta) for the value you are looking for. You also have to identify to the query which position (or delta) you want to query. In the example below, we specify <code class="language-plaintext highlighter-rouge">field_srp_voting_status.%delta</code> as 1 - indicating the second position (0 based always) and <code class="language-plaintext highlighter-rouge">field_srp_voting_status.%delta.value</code> for the actual value we are looking for (either accepted, rejected or incomplete):</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nv">$vote_number</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nv">$query</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityQuery</span><span class="p">(</span><span class="s1">'node'</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'type'</span><span class="p">,</span> <span class="s1">'correlation'</span><span class="p">,</span> <span class="s1">'='</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="nf">accessCheck</span><span class="p">(</span><span class="kc">FALSE</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'field_program'</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">programNid</span><span class="p">,</span> <span class="s1">'='</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'field_voting_status.%delta'</span><span class="p">,</span> <span class="nv">$vote_number</span><span class="p">,</span> <span class="s1">'='</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'field_voting_status.%delta.value'</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">'accepted'</span><span class="p">,</span>
        <span class="s1">'rejected'</span><span class="p">,</span>
        <span class="s1">'incomplete'</span>
      <span class="p">],</span> <span class="s1">'IN'</span><span class="p">);</span>
    <span class="nv">$correlation_nids</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>
    <span class="nv">$correlation_nids</span> <span class="o">=</span> <span class="nb">array_values</span><span class="p">(</span><span class="nv">$correlation_nids</span><span class="p">);</span>
    <span class="k">return</span> <span class="nv">$correlation_nids</span><span class="p">;</span>
</code></pre></div></div><h2 id="query-entity-reference-fields-if-they-have-a-value-or-no-value"> <a aria-labelledby="query-entity-reference-fields-if-they-have-a-value-or-no-value" class="anchor-heading" href="https://selwynpolit.github.io/d9book/queries#query-entity-reference-fields-if-they-have-a-value-or-no-value"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Query entity reference fields if they have a value or no value</h2><p>To check if there is a value in an entity reference fields, use the following code</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$query</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityQuery</span><span class="p">(</span><span class="s1">'node'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'type'</span><span class="p">,</span> <span class="s1">'srp_voting_record'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">accessCheck</span><span class="p">(</span><span class="kc">FALSE</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$vote_type</span> <span class="o">==</span> <span class="s1">'citation'</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Check for empty entity reference field.</span>
  <span class="nv">$query</span><span class="o">-&gt;</span><span class="nf">notExists</span><span class="p">(</span><span class="s1">'field_ref_error_feedback'</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$vote_type</span> <span class="o">==</span> <span class="s1">'feedback_error'</span><span class="p">){</span>
  <span class="c1">// Check for filled entity reference field.</span>
  <span class="nv">$query</span><span class="o">-&gt;</span><span class="nf">exists</span><span class="p">(</span><span class="s1">'field_ref_error_feedback'</span><span class="p">);</span>
<span class="p">}</span>

</code></pre></div></div><h2 id="query-entity-reference-fields"> <a aria-labelledby="query-entity-reference-fields" class="anchor-heading" href="https://selwynpolit.github.io/d9book/queries#query-entity-reference-fields"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Query entity reference fields</h2><p>In the following query, we check for a value in the entity that is referenced in the entity reference field? For example, if you have an entity reference field which references node (entity) 27. This query can look in node 27 and check a field value in that node. Here we check in field_first_name for the the value <code class="language-plaintext highlighter-rouge">Fred</code>:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'field_tks_pub_expectation.entity.field_first_name'</span><span class="p">,</span> <span class="s1">'Fred'</span><span class="p">,</span> <span class="s1">'='</span><span class="p">)</span>
</code></pre></div></div><p>For querying for a user id, we query the <code class="language-plaintext highlighter-rouge">field_voter.entity:user.uid</code> value. See code below:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">protected</span> <span class="k">function</span> <span class="n">loadErrorFeedbackVotingRecordNode</span><span class="p">(</span><span class="kt">int</span> <span class="nv">$user_id</span><span class="p">,</span> <span class="kt">int</span> <span class="nv">$error_feedback_nid</span><span class="p">,</span> <span class="kt">int</span> <span class="nv">$vote_number</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$node</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="nv">$query</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityQuery</span><span class="p">(</span><span class="s1">'node'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'type'</span><span class="p">,</span> <span class="s1">'srp_voting_record'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'field_voter.entity:user.uid'</span><span class="p">,</span> <span class="nv">$user_id</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'field_ref_error_feedback'</span><span class="p">,</span> <span class="nv">$error_feedback_nid</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'field_srp_vote_number'</span><span class="p">,</span> <span class="nv">$vote_number</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">accessCheck</span><span class="p">(</span><span class="kc">FALSE</span><span class="p">);</span>
  <span class="nv">$nids</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$nids</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$nid</span> <span class="o">=</span> <span class="nb">reset</span><span class="p">(</span><span class="nv">$nids</span><span class="p">);</span>
    <span class="nv">$node</span> <span class="o">=</span> <span class="nc">Node</span><span class="o">::</span><span class="nf">load</span><span class="p">(</span><span class="nv">$nid</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nv">$node</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><h1 id="static-and-dynamic-queries"> <a aria-labelledby="static-and-dynamic-queries" class="anchor-heading" href="https://selwynpolit.github.io/d9book/queries#static-and-dynamic-queries"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Static and dynamic Queries</h1><p>Sometimes you will use static or dynamic queries rather than entityQueries. These use actual SQL versus the entityQuery approach where you build the various parts of the query.</p><h2 id="static-queries"> <a aria-labelledby="static-queries" class="anchor-heading" href="https://selwynpolit.github.io/d9book/queries#static-queries"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Static Queries</h2><p>See <a href="https://www.drupal.org/docs/drupal-apis/database-api/static-queries">https://www.drupal.org/docs/drupal-apis/database-api/static-queries</a></p><h2 id="get-a-connection-object"> <a aria-labelledby="get-a-connection-object" class="anchor-heading" href="https://selwynpolit.github.io/d9book/queries#get-a-connection-object"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Get a connection object</h2><p>There are two ways to get a connection object:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cd">/** @var \Drupal\Core\Database\Connection $connection */</span>
<span class="nv">$connection</span> <span class="o">=</span> <span class="nc">Database</span><span class="o">::</span><span class="nf">getConnection</span><span class="p">();</span>

<span class="c1">//OR </span>

<span class="cd">/** @var \Drupal\Core\Database\Connection $connection */</span>
<span class="nv">$connection</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">service</span><span class="p">(</span><span class="s1">'database'</span><span class="p">);</span>
</code></pre></div></div><h2 id="sql-select-example"> <a aria-labelledby="sql-select-example" class="anchor-heading" href="https://selwynpolit.github.io/d9book/queries#sql-select-example"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> SQL select example</h2><p>Static query example from a controller. This loads some fields from the donors table and returns a render array with a count of how many results it found.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="n">queryBuild1</span><span class="p">()</span> <span class="p">{</span>
  <span class="nv">$database</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">database</span><span class="p">();</span>
  <span class="nv">$query</span> <span class="o">=</span> <span class="nv">$database</span><span class="o">-&gt;</span><span class="nf">query</span><span class="p">(</span><span class="s2">"SELECT id, name, amount  FROM </span><span class="si">{</span><span class="nv">donors</span><span class="si">}</span><span class="s2">"</span><span class="p">);</span>
  <span class="nv">$results</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="nf">fetchAll</span><span class="p">();</span>

  <span class="nv">$result_count</span> <span class="o">=</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$results</span><span class="p">);</span>

  <span class="nv">$str</span> <span class="o">=</span> <span class="s2">"Results from db query"</span><span class="p">;</span>
  <span class="nv">$str</span> <span class="mf">.</span><span class="o">=</span> <span class="s2">"&lt;br/&gt; Result count = </span><span class="nv">$result_count</span><span class="s2">"</span><span class="p">;</span>

  <span class="nv">$render_array</span><span class="p">[</span><span class="s1">'content'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'item'</span><span class="p">,</span>
    <span class="s1">'#markup'</span> <span class="o">=&gt;</span> <span class="nv">$str</span><span class="p">,</span>
  <span class="p">];</span>

  <span class="k">return</span> <span class="nv">$render_array</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="find-the-biggest-value-in-a-field"> <a aria-labelledby="find-the-biggest-value-in-a-field" class="anchor-heading" href="https://selwynpolit.github.io/d9book/queries#find-the-biggest-value-in-a-field"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Find the biggest value in a field</h2><p>We make a quick query and retrieve the result. In this case we are finding the highest value for the id column.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="n">highestId</span><span class="p">()</span> <span class="p">{</span>
  <span class="nv">$database</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">database</span><span class="p">();</span>
  <span class="nv">$connection</span> <span class="o">=</span> <span class="nc">Database</span><span class="o">::</span><span class="nf">getConnection</span><span class="p">();</span>

  <span class="nv">$query</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="nf">select</span><span class="p">(</span><span class="s1">'donors'</span><span class="p">,</span> <span class="s1">'n'</span><span class="p">);</span>
  <span class="nv">$query</span><span class="o">-&gt;</span><span class="nf">addExpression</span><span class="p">(</span><span class="s1">'MAX(id)'</span><span class="p">,</span> <span class="s1">'id'</span><span class="p">);</span>
  <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>
  <span class="nv">$highest_id</span> <span class="o">=</span> <span class="nb">intval</span><span class="p">(</span><span class="nv">$result</span><span class="o">-&gt;</span><span class="nf">fetchField</span><span class="p">());</span>

  <span class="nv">$str</span> <span class="o">=</span> <span class="s2">"Highest id = </span><span class="nv">$highest_id</span><span class="s2">"</span><span class="p">;</span>
  <span class="nv">$render_array</span><span class="p">[</span><span class="s1">'content'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'item'</span><span class="p">,</span>
    <span class="s1">'#markup'</span> <span class="o">=&gt;</span> <span class="nv">$str</span><span class="p">,</span>
  <span class="p">];</span>

  <span class="k">return</span> <span class="nv">$render_array</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="sql-update-query---example-1"> <a aria-labelledby="sql-update-query---example-1" class="anchor-heading" href="https://selwynpolit.github.io/d9book/queries#sql-update-query---example-1"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> SQL update query - example 1</h2><p>This shows how to update a status field to the new value $status when the uuid matches, the event is either update or add and the status is new.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="n">setUpdateStatus</span><span class="p">(</span><span class="kt">string</span> <span class="nv">$uuid</span><span class="p">,</span> <span class="kt">string</span> <span class="nv">$status</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$db_connection</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">database</span><span class="p">();</span>
  <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$db_connection</span><span class="o">-&gt;</span><span class="nf">update</span><span class="p">(</span><span class="s1">'nocs_info'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">fields</span><span class="p">([</span><span class="s1">'status'</span> <span class="o">=&gt;</span> <span class="nv">$status</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'uuid'</span><span class="p">,</span> <span class="nv">$uuid</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'event'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'UPDATE'</span><span class="p">,</span> <span class="s1">'ADD'</span><span class="p">],</span> <span class="s1">'IN'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'status'</span><span class="p">,</span> <span class="s1">'new'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>

  <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="sql-update-query---example-2"> <a aria-labelledby="sql-update-query---example-2" class="anchor-heading" href="https://selwynpolit.github.io/d9book/queries#sql-update-query---example-2"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> SQL update query - example 2</h2><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cd">/**
 * Converts imported eventlog item/s from UPDATE to ADD by uuid.
 *
 * @param string $uuid
 *   UUID for events to convert from UPDATE to ADD.
 *
 * @return mixed
 *   Results of update query.
 */</span>
<span class="k">public</span> <span class="k">function</span> <span class="n">convertUpdateToAddEvent</span><span class="p">(</span><span class="kt">string</span> <span class="nv">$uuid</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$update_connection</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">database</span><span class="p">();</span>
  <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$update_connection</span><span class="o">-&gt;</span><span class="nf">update</span><span class="p">(</span><span class="s1">'nocs_connect'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">fields</span><span class="p">([</span>
      <span class="s1">'event'</span> <span class="o">=&gt;</span> <span class="s1">'ADD'</span><span class="p">,</span>
    <span class="p">])</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'uuid'</span><span class="p">,</span> <span class="nv">$uuid</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'event'</span><span class="p">,</span> <span class="s1">'UPDATE'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'status'</span><span class="p">,</span> <span class="s1">'new'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>

  <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="sql-update-query---example-3"> <a aria-labelledby="sql-update-query---example-3" class="anchor-heading" href="https://selwynpolit.github.io/d9book/queries#sql-update-query---example-3"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> SQL update query - example 3</h2><p>This will update values in a table and return the number of rows updated.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//use Drupal\Core\Database\Database;</span>

<span class="k">public</span> <span class="k">function</span> <span class="n">updateQuery1</span><span class="p">()</span> <span class="p">{</span>
  <span class="nv">$database</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">database</span><span class="p">();</span>
  <span class="nv">$query_string</span> <span class="o">=</span> <span class="s2">"Update </span><span class="si">{</span><span class="nv">donors</span><span class="si">}</span><span class="s2"> set amount=amount+1 where id&lt;=10 "</span><span class="p">;</span>
  <span class="nv">$affectedRows</span> <span class="o">=</span> <span class="nv">$database</span><span class="o">-&gt;</span><span class="nf">query</span><span class="p">(</span><span class="nv">$query_string</span><span class="p">,[],</span>
    <span class="p">[</span><span class="s1">'return'</span> <span class="o">=&gt;</span> <span class="nc">Database</span><span class="o">::</span><span class="no">RETURN_AFFECTED</span><span class="p">]);</span>
  <span class="nv">$str</span> <span class="o">=</span> <span class="s2">"Affected rows = </span><span class="nv">$affectedRows</span><span class="s2">"</span><span class="p">;</span>
  <span class="nv">$render_array</span><span class="p">[</span><span class="s1">'content'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'item'</span><span class="p">,</span>
    <span class="s1">'#markup'</span> <span class="o">=&gt;</span> <span class="nv">$str</span><span class="p">,</span>
  <span class="p">];</span>

  <span class="k">return</span> <span class="nv">$render_array</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><p>Note. This will be deprecated in Drupal 11. See <a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Database%21Statement.php/function/Statement%3A%3ArowCount/9.3.x">https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Database%21Statement.php/function/Statement%3A%3ArowCount/9.3.x</a></p><p>and</p><p><a href="https://git.drupalcode.org/project/drupal/-/blob/9.5.x/core/lib/Drupal/Core/Database/Connection.php#L968">https://git.drupalcode.org/project/drupal/-/blob/9.5.x/core/lib/Drupal/Core/Database/Connection.php#L968</a></p><h2 id="sql-insert"> <a aria-labelledby="sql-insert" class="anchor-heading" href="https://selwynpolit.github.io/d9book/queries#sql-insert"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> SQL insert</h2><p>From <a href="https://www.drupal.org/docs/drupal-apis/database-api/insert-queries">https://www.drupal.org/docs/drupal-apis/database-api/insert-queries</a></p><p>Which to use? $connection-&gt;insert() or $connection-&gt;query() or what are the difference between insert() and query()?</p><ul><li><p>insert() has each column specified as a separate entry in the fields array and the code can clean each column value. query() has an SQL string with no way of checking individual columns.</p><li><p>If you use query() with placeholders, the code can check the column values but placeholders are just an option, there is no way to ensure your SQL does not contain values not passed through placeholders.</p><li><p>insert() passes the request through a set of hooks to let other modules check and modify your requests. This is the right way to work with other modules.</p><li><p>query() is slightly faster because query() does not pass the request through the hooks. You might save processing time but your code will not let other modules help your code.</p><li><p>insert() is more likely to work with other databases and future versions of Drupal.</p></li></li></li></li></li></ul><h2 id="sql-insert-query"> <a aria-labelledby="sql-insert-query" class="anchor-heading" href="https://selwynpolit.github.io/d9book/queries#sql-insert-query"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> SQL Insert Query</h2><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cd">/**
 * @throws \Exception
 */</span>
<span class="k">public</span> <span class="k">function</span> <span class="n">insert</span><span class="p">()</span> <span class="p">{</span>

  <span class="cd">/** @var \Drupal\Core\Database\Connection $connection */</span>
  <span class="nv">$connection</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">service</span><span class="p">(</span><span class="s1">'database'</span><span class="p">);</span>

  <span class="c1">//    $query = $connection-&gt;insert('donors', $options);</span>

  <span class="c1">// single insert.</span>
  <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="nf">insert</span><span class="p">(</span><span class="s1">'donors'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">fields</span><span class="p">([</span>
      <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Singleton'</span><span class="p">,</span>
      <span class="s1">'amount'</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">])</span>
    <span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>
  <span class="c1">// Note. there is an auto-increment field so insert() returns  the value</span>
  <span class="c1">// for the new row in $result.</span>
  <span class="nv">$str</span> <span class="o">=</span> <span class="s2">"Single insert returned auto-increment value of </span><span class="nv">$result</span><span class="s2">"</span><span class="p">;</span>

  <span class="c1">// Multi-insert1.</span>
  <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="nf">insert</span><span class="p">(</span><span class="s1">'donors'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">fields</span><span class="p">([</span><span class="s1">'name'</span><span class="p">,</span> <span class="s1">'amount'</span><span class="p">,])</span>
    <span class="o">-&gt;</span><span class="nf">values</span><span class="p">([</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Multiton1'</span><span class="p">,</span> <span class="s1">'amount'</span> <span class="o">=&gt;</span> <span class="mi">11</span><span class="p">,])</span>
    <span class="o">-&gt;</span><span class="nf">values</span><span class="p">([</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Multiton1'</span><span class="p">,</span> <span class="s1">'amount'</span> <span class="o">=&gt;</span> <span class="mi">22</span><span class="p">,])</span>
    <span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>
  <span class="nv">$str</span> <span class="mf">.</span><span class="o">=</span> <span class="s2">"&lt;br/&gt;Multi-insert1 added 2 rows"</span><span class="p">;</span>

  <span class="c1">// Multi-insert2.</span>
  <span class="nv">$values</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Multiton2'</span><span class="p">,</span> <span class="s1">'amount'</span> <span class="o">=&gt;</span> <span class="mi">111</span><span class="p">,],</span>
    <span class="p">[</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Multiton2'</span><span class="p">,</span> <span class="s1">'amount'</span> <span class="o">=&gt;</span> <span class="mi">222</span><span class="p">,],</span>
    <span class="p">[</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Multiton2'</span><span class="p">,</span> <span class="s1">'amount'</span> <span class="o">=&gt;</span> <span class="mi">333</span><span class="p">,],</span>
    <span class="p">[</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Multiton2'</span><span class="p">,</span> <span class="s1">'amount'</span> <span class="o">=&gt;</span> <span class="mi">444</span><span class="p">,],</span>
    <span class="p">[</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Multiton2'</span><span class="p">,</span> <span class="s1">'amount'</span> <span class="o">=&gt;</span> <span class="mi">555</span><span class="p">,],</span>
  <span class="p">];</span>
  <span class="nv">$query</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="nf">insert</span><span class="p">(</span><span class="s1">'donors'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">fields</span><span class="p">([</span><span class="s1">'name'</span><span class="p">,</span> <span class="s1">'amount'</span><span class="p">,]);</span>
  <span class="k">foreach</span> <span class="p">(</span><span class="nv">$values</span> <span class="k">as</span> <span class="nv">$record</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$query</span><span class="o">-&gt;</span><span class="nf">values</span><span class="p">(</span><span class="nv">$record</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>
  <span class="nv">$str</span> <span class="mf">.</span><span class="o">=</span> <span class="s2">"&lt;br/&gt;Multi-insert2 added 5 rows"</span><span class="p">;</span>

  <span class="nv">$render_array</span><span class="p">[</span><span class="s1">'content'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'item'</span><span class="p">,</span>
    <span class="s1">'#markup'</span> <span class="o">=&gt;</span> <span class="nv">$str</span><span class="p">,</span>
  <span class="p">];</span>

  <span class="k">return</span> <span class="nv">$render_array</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><p>More at <a href="https://www.drupal.org/docs/drupal-apis/database-api/insert-queries">https://www.drupal.org/docs/drupal-apis/database-api/insert-queries</a></p><h2 id="sql-delete-query"> <a aria-labelledby="sql-delete-query" class="anchor-heading" href="https://selwynpolit.github.io/d9book/queries#sql-delete-query"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> SQL Delete query</h2><p>This will return the number of rows affected by the SQL delete query.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">Drupal\Core\Database\Database</span><span class="p">;</span>

<span class="k">public</span> <span class="k">function</span> <span class="n">deleteQuery2</span><span class="p">()</span> <span class="p">{</span>

  <span class="nv">$database</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">database</span><span class="p">();</span>
  <span class="nv">$query_string</span> <span class="o">=</span> <span class="s2">"Delete FROM </span><span class="si">{</span><span class="nv">donors</span><span class="si">}</span><span class="s2"> where id&gt;10 "</span><span class="p">;</span>
  <span class="nv">$affectedRows</span> <span class="o">=</span> <span class="nv">$database</span><span class="o">-&gt;</span><span class="nf">query</span><span class="p">(</span><span class="nv">$query_string</span><span class="p">,[],[</span><span class="s1">'return'</span> <span class="o">=&gt;</span> <span class="nc">Database</span><span class="o">::</span><span class="no">RETURN_AFFECTED</span><span class="p">]);</span>

  <span class="nv">$str</span> <span class="o">=</span> <span class="s2">"Affected rows = </span><span class="nv">$affectedRows</span><span class="s2">"</span><span class="p">;</span>
  <span class="nv">$render_array</span><span class="p">[</span><span class="s1">'content'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'item'</span><span class="p">,</span>
    <span class="s1">'#markup'</span> <span class="o">=&gt;</span> <span class="nv">$str</span><span class="p">,</span>
  <span class="p">];</span>

  <span class="k">return</span> <span class="nv">$render_array</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><p>Note. This will be deprecated in Drupal 11. See <a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Database%21Statement.php/function/Statement%3A%3ArowCount/9.3.x">https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Database%21Statement.php/function/Statement%3A%3ArowCount/9.3.x</a> also <a href="https://git.drupalcode.org/project/drupal/-/blob/9.5.x/core/lib/Drupal/Core/Database/Connection.php#L968">https://git.drupalcode.org/project/drupal/-/blob/9.5.x/core/lib/Drupal/Core/Database/Connection.php#L968</a>.</p><h2 id="paragraph-query"> <a aria-labelledby="paragraph-query" class="anchor-heading" href="https://selwynpolit.github.io/d9book/queries#paragraph-query"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Paragraph query</h2><p>In the txg.theme file this code digs into a table for a paragraph field and grabbing the delta field value.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">txg_preprocess_paragraph__simple_card</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$variables</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$card_parent</span> <span class="o">=</span> <span class="nv">$variables</span><span class="p">[</span><span class="s1">'paragraph'</span><span class="p">]</span><span class="o">-&gt;</span><span class="nf">getParentEntity</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$card_parent</span><span class="o">-&gt;</span><span class="nf">bundle</span><span class="p">()</span> <span class="o">==</span> <span class="s1">'home_aof_card'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$variables</span><span class="p">[</span><span class="s1">'parent_delta'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nv">$database</span> <span class="o">=</span> <span class="nc">Database</span><span class="o">::</span><span class="nf">getConnection</span><span class="p">();</span>
    <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$database</span><span class="o">-&gt;</span><span class="nf">query</span><span class="p">(</span><span class="s2">"
      Select delta from node__field_para_aofs n where n.bundle = 'home_page' AND n.field_para_aofs_target_id = :target_id"</span><span class="p">,</span> <span class="p">[</span><span class="s1">':target_id'</span> <span class="o">=&gt;</span> <span class="nv">$card_parent</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">()]</span>
    <span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$result</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">while</span> <span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="nf">fetchAssoc</span><span class="p">())</span> <span class="p">{</span>
        <span class="nv">$variables</span><span class="p">[</span><span class="s1">'parent_delta'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'delta'</span><span class="p">];</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nv">$parent_label</span> <span class="o">=</span> <span class="nv">$card_parent</span><span class="o">-&gt;</span><span class="n">field_ref_aof</span><span class="o">-&gt;</span><span class="n">entity</span><span class="o">-&gt;</span><span class="nf">label</span><span class="p">();</span>
    <span class="nv">$parent_path</span> <span class="o">=</span> <span class="nv">$card_parent</span><span class="o">-&gt;</span><span class="n">field_ref_aof</span><span class="o">-&gt;</span><span class="n">entity</span><span class="o">-&gt;</span><span class="nf">toUrl</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">toString</span><span class="p">();</span>
    <span class="nv">$variables</span><span class="p">[</span><span class="s1">'parent_label'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$parent_label</span><span class="p">;</span>
    <span class="nv">$variables</span><span class="p">[</span><span class="s1">'parent_path'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$parent_path</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="create-a-custom-table-for-your-module"> <a aria-labelledby="create-a-custom-table-for-your-module" class="anchor-heading" href="https://selwynpolit.github.io/d9book/queries#create-a-custom-table-for-your-module"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Create a custom table for your module</h2><p>If you need a custom database table (or two) for use in a custom module, you can use hook_schema in your module.install file. This will cause the table(s) to be created at module install time and <strong>removed</strong> at module uninstall time.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">nocs_connect_schema</span><span class="p">()</span> <span class="p">{</span>
  <span class="nv">$schema</span><span class="p">[</span><span class="s1">'nocs_connect'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'description'</span> <span class="o">=&gt;</span> <span class="s1">'Stores data from event log used to import/update content to site.'</span><span class="p">,</span>
    <span class="s1">'fields'</span> <span class="o">=&gt;</span> <span class="p">[</span>
      <span class="s1">'id'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'int'</span><span class="p">,</span>
        <span class="s1">'not null'</span> <span class="o">=&gt;</span> <span class="kc">TRUE</span><span class="p">,</span>
        <span class="s1">'description'</span> <span class="o">=&gt;</span> <span class="s1">'Primary Key: Unique ID of event log event.'</span><span class="p">,</span>
      <span class="p">],</span>
      <span class="s1">'uuid'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'varchar'</span><span class="p">,</span>
        <span class="s1">'length'</span> <span class="o">=&gt;</span> <span class="mi">255</span><span class="p">,</span>
        <span class="s1">'not null'</span> <span class="o">=&gt;</span> <span class="kc">TRUE</span><span class="p">,</span>
        <span class="s1">'description'</span> <span class="o">=&gt;</span> <span class="s2">"Unique ID for content created or updated."</span><span class="p">,</span>
      <span class="p">],</span>
      <span class="s1">'nid'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'varchar'</span><span class="p">,</span>
        <span class="s1">'length'</span> <span class="o">=&gt;</span> <span class="mi">255</span><span class="p">,</span>
        <span class="s1">'not null'</span> <span class="o">=&gt;</span> <span class="kc">FALSE</span><span class="p">,</span>
        <span class="s1">'description'</span> <span class="o">=&gt;</span> <span class="s2">"Unique ID for content created or updated."</span><span class="p">,</span>
      <span class="p">],</span>
      <span class="s1">'event'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'varchar'</span><span class="p">,</span>
        <span class="s1">'length'</span> <span class="o">=&gt;</span> <span class="mi">255</span><span class="p">,</span>
        <span class="s1">'not null'</span> <span class="o">=&gt;</span> <span class="kc">TRUE</span><span class="p">,</span>
        <span class="s1">'description'</span> <span class="o">=&gt;</span> <span class="s1">'Type of event e.g. UPDATE or ADD.'</span><span class="p">,</span>
      <span class="p">],</span>
      <span class="s1">'created'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'int'</span><span class="p">,</span>
        <span class="s1">'not null'</span> <span class="o">=&gt;</span> <span class="kc">TRUE</span><span class="p">,</span>
        <span class="s1">'description'</span> <span class="o">=&gt;</span> <span class="s1">'Content creation date.'</span><span class="p">,</span>
      <span class="p">],</span>
      <span class="s1">'updated'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'int'</span><span class="p">,</span>
        <span class="s1">'not null'</span> <span class="o">=&gt;</span> <span class="kc">TRUE</span><span class="p">,</span>
        <span class="s1">'description'</span> <span class="o">=&gt;</span> <span class="s1">'Content update date.'</span><span class="p">,</span>
      <span class="p">],</span>
      <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'varchar'</span><span class="p">,</span>
        <span class="s1">'length'</span> <span class="o">=&gt;</span> <span class="mi">255</span><span class="p">,</span>
        <span class="s1">'not null'</span> <span class="o">=&gt;</span> <span class="kc">TRUE</span><span class="p">,</span>
        <span class="s1">'description'</span> <span class="o">=&gt;</span> <span class="s1">'Type of content created or updated.'</span><span class="p">,</span>
      <span class="p">],</span>
      <span class="s1">'version'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'int'</span><span class="p">,</span>
        <span class="s1">'not null'</span> <span class="o">=&gt;</span> <span class="kc">TRUE</span><span class="p">,</span>
        <span class="s1">'description'</span> <span class="o">=&gt;</span> <span class="s1">'Content version number.'</span><span class="p">,</span>
      <span class="p">],</span>
      <span class="s1">'status'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'varchar'</span><span class="p">,</span>
        <span class="s1">'length'</span> <span class="o">=&gt;</span> <span class="mi">255</span><span class="p">,</span>
        <span class="s1">'not null'</span> <span class="o">=&gt;</span> <span class="kc">TRUE</span><span class="p">,</span>
        <span class="s1">'default'</span> <span class="o">=&gt;</span> <span class="s1">'NEW'</span><span class="p">,</span>
        <span class="s1">'description'</span> <span class="o">=&gt;</span> <span class="s1">'Status of event log row - NEW, PROCESSING, COMPLETE, or ERROR.'</span><span class="p">,</span>
      <span class="p">],</span>
    <span class="p">],</span>
    <span class="s1">'primary key'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'id'</span><span class="p">],</span>
    <span class="s1">'indexes'</span> <span class="o">=&gt;</span> <span class="p">[</span>
      <span class="s1">'uuid'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'uuid'</span><span class="p">],</span>
      <span class="s1">'event'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'event'</span><span class="p">],</span>
      <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'type'</span><span class="p">],</span>
    <span class="p">],</span>
  <span class="p">];</span>

  <span class="k">return</span> <span class="nv">$schema</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><h1 id="reference"> <a aria-labelledby="reference" class="anchor-heading" href="https://selwynpolit.github.io/d9book/queries#reference"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Reference</h1><ul><li><a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Database%21Query%21Condition.php/class/Condition/9.3.x">API documentation for query conditions</a><li><a href="https://www.metaltoad.com/blog/drupal-8-entity-api-cheat-sheet">Entity query cheat sheet</a><li><a href="https://www.drupal.org/docs/drupal-apis/database-api/static-queries">Static queries</a><li><a href="https://www.drupal.org/docs/8/api/database-api/dynamic-queries/introduction-to-dynamic-queries">Dynamic Queries</a><li><a href="https://www.drupal.org/docs/drupal-apis/database-api/insert-queries">Insert Queries</a><li><a href="https://blog.werk21.de/en/2018/02/05/date-range-fields-and-entity-query-update">Querying date fields from 2018</a><li><a href="https://drupal.stackexchange.com/questions/198324/how-to-do-a-date-range-entityquery-with-a-date-only-field-in-drupal-8">Querying date fields</a></li></li></li></li></li></li></li></ul><hr/> <script async="" crossorigin="anonymous" data-category="Q&amp;A" data-category-id="MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMyMjY2NDE4" data-emit-metadata="0" data-input-position="bottom" data-lang="en" data-mapping="title" data-reactions-enabled="1" data-repo="selwynpolit/d9book" data-repo-id="MDEwOlJlcG9zaXRvcnkzMjUxNTQ1Nzg=" data-strict="0" data-theme="preferred_color_scheme" src="https://giscus.app/client.js"> </script><hr/><footer><p><a href="https://selwynpolit.github.io/d9book/queries#top" id="back-to-top">Back to top</a></p><p class="text-small text-grey-dk-100 mb-0"><span xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/"> <a href="http://www.selwynpolit.github.io/d9book" property="dct:title" rel="cc:attributionURL">Drupal at your fingertips</a> by <a href="http://www.drupal.org/u/selwynpolit" property="cc:attributionName" rel="cc:attributionURL dct:creator">Selwyn Polit</a> is licensed under <a href="http://creativecommons.org/licenses/by/4.0/" rel="license noopener noreferrer" target="_blank">CC BY 4.0 <img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg" style="height:16px!important;vertical-align:text-bottom;"/> <img src="https://mirrors.creativecommons.org/presskit/icons/by.svg" style="height:16px!important;vertical-align:text-bottom;"/> </a></span></p><div class="d-flex mt-2"><p class="text-small text-grey-dk-000 mb-0 mr-2"> Page last modified: <span class="d-inline-block">Jul 23 2023</span>.</p><p class="text-small text-grey-dk-000 mb-0"> <a href="https://github.com/selwynpolit/d9book/tree/gh-pages/book/queries.md" id="edit-this-page">Edit this page on GitHub</a></p></div></footer></div></div><div class="search-overlay"></div></div>
</body></link></meta></meta></meta></head></html>