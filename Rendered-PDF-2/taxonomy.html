<!DOCTYPE html>
<html lang="en-US"><head><meta charset="utf-8"/><meta content="IE=Edge" http-equiv="X-UA-Compatible"/><link href="https://selwynpolit.github.io/d9book/assets/css/just-the-docs-default.css" rel="stylesheet"/> <script async="" src="https://www.googletagmanager.com/gtag/js?id=8V22RQEJ71"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', '8V22RQEJ71', { 'anonymize_ip': true }); </script> <script src="https://selwynpolit.github.io/d9book/assets/js/vendor/lunr.min.js"></script> <script src="https://selwynpolit.github.io/d9book/assets/js/just-the-docs.js"></script><meta content="width=device-width, initial-scale=1" name="viewport"/><link href="https://selwynpolit.github.io/d9book/assets/images/favicon.ico" rel="icon" type="image/x-icon"/><title>Taxonomy | Drupal Book</title><meta content="Jekyll v4.3.2" name="generator"><meta content="Taxonomy" property="og:title"><meta content="en_US" property="og:locale"><meta content="Drupal at your fingertips" name="description"/><meta content="Drupal at your fingertips" property="og:description"/><link href="https://selwynpolit.github.io/d9book/d9book/taxonomy" rel="canonical"><meta content="https://selwynpolit.github.io/d9book/d9book/taxonomy" property="og:url"/><meta content="Drupal Book" property="og:site_name"/><meta content="website" property="og:type"/><meta content="summary" name="twitter:card"/><meta content="Taxonomy" property="twitter:title"/> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Drupal at your fingertips","headline":"Taxonomy","url":"https://selwynpolit.github.io/d9book/d9book/taxonomy"}</script><body> <a class="skip-to-main" href="https://selwynpolit.github.io/d9book/taxonomy#main-content">Skip to main content</a> <svg class="d-none" xmlns="http://www.w3.org/2000/svg"> <symbol id="svg-link" viewbox="0 0 24 24"><title>Link</title><svg class="feather feather-link" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewbox="0 0 24 24"><title>Menu</title><svg class="feather feather-menu" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><line x1="3" x2="21" y1="12" y2="12"></line><line x1="3" x2="21" y1="6" y2="6"></line><line x1="3" x2="21" y1="18" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewbox="0 0 24 24"><title>Expand</title><svg class="feather feather-chevron-right" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol class="feather feather-external-link" fill="none" height="24" id="svg-external-link" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24"><title id="svg-external-link-title">(external link)</title><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" x2="21" y1="14" y2="3"></line> </symbol> <symbol id="svg-doc" viewbox="0 0 24 24"><title>Document</title><svg class="feather feather-file" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewbox="0 0 24 24"><title>Search</title><svg class="feather feather-search" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"> <circle cx="11" cy="11" r="8"></circle><line x1="21" x2="16.65" y1="21" y2="16.65"></line> </svg> </symbol> <symbol id="svg-copy" viewbox="0 0 16 16"><title>Copy</title><svg class="bi bi-clipboard" fill="currentColor" height="16" viewbox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"></path><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"></path> </svg> </symbol> <symbol id="svg-copied" viewbox="0 0 16 16"><title>Copied</title><svg class="bi bi-clipboard-check-fill" fill="currentColor" height="16" viewbox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"></path><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"></path> </svg> </symbol> </svg><div class="side-bar"><div class="site-header"> <a class="site-title lh-tight" href="https://selwynpolit.github.io/d9book/"> Drupal Book </a> <a class="site-button" href="https://selwynpolit.github.io/d9book/taxonomy" id="menu-button"> <svg class="icon" viewbox="0 0 24 24"><use xlink:href="#svg-menu"></use></svg> </a></div><nav aria-label="Main" class="site-nav" id="site-nav"><ul class="nav-list"><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/">Home</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/actions">Actions</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/attribution">Attribution</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/bq">Batch and Queue</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/blocks">Blocks</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/caching">Caching</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/composer">Composer</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/config">Config</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/cron">Cron</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/dates">Dates and Times</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/debugging">Debugging</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/development">Development</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/drush">Drush</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/email">Email</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/entities">Entities</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/forms">Forms</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/general">General</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/off-island">Getting off the Island</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/hooks">Hooks</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/learn">Learning</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/links">Links</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/logging">Logging</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/menus">Menus</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/migrate">Migrate</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/modals">Modals</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/nodes-and-fields">Nodes and Fields</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/queries">Queries</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/redirects">Redirects</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/render">Render Arrays</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/routes">Routes</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/security">Security</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/services">Services</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/state">State</a><li class="nav-list-item active"><a class="nav-list-link active" href="https://selwynpolit.github.io/d9book/taxonomy">Taxonomy</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/dtt">Tests</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/twig">Twig</a></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></ul><ul class="nav-list"><li class="nav-list-item external"> <a class="nav-list-link external" href="https://github.com/selwynpolit/d9book/fork"> Fork me on GitHub <svg aria-labelledby="svg-external-link-title" viewbox="0 0 24 24"><use xlink:href="#svg-external-link"></use></svg> </a></li></ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer></div><div class="main" id="top"><div class="main-header" id="main-header"><div class="search"><div class="search-input-wrap"> <input aria-label="Search Drupal Book" autocomplete="off" class="search-input" id="search-input" placeholder="Search Drupal Book" tabindex="0" type="text"/> <label class="search-label" for="search-input"><svg class="search-icon" viewbox="0 0 24 24"><use xlink:href="#svg-search"></use></svg></label></div><div class="search-results" id="search-results"></div></div><nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a class="site-button" href="https://twitter.com/selwynpolit" rel="noopener noreferrer" target="_blank"> <img alt="Twitter logo" src="https://atuin.ru/demo/simple-icons/icons/twitter.svg" style="width: 30px; height: 30px;" title="Author in Twitter"/> </a><li class="aux-nav-list-item"> <a class="site-button" href="https://github.com/selwynpolit/d9book/tree/gh-pages" rel="noopener noreferrer" target="_blank"> <img alt="GitHub logo" src="https://atuin.ru/demo/simple-icons/icons/github.svg" style="width: 30px; height: 30px;" title="D9Book on GitHub"/> </a></li></li></ul></nav></div><div class="main-content-wrap" id="main-content-wrap"><div class="main-content" id="main-content" role="main"><h1 class="no_toc fw-500" id="taxonomy"> <a aria-labelledby="taxonomy" class="anchor-heading" href="https://selwynpolit.github.io/d9book/taxonomy#taxonomy"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Taxonomy</h1><h2 class="no_toc text-delta" id="table-of-contents"> <a aria-labelledby="table-of-contents" class="anchor-heading" href="https://selwynpolit.github.io/d9book/taxonomy#table-of-contents"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Table of contents</h2><ul id="markdown-toc"><li><a href="https://selwynpolit.github.io/d9book/taxonomy#lookup-term-by-name" id="markdown-toc-lookup-term-by-name">Lookup term by name</a><li><a href="https://selwynpolit.github.io/d9book/taxonomy#lookup-term-name-using-its-tid" id="markdown-toc-lookup-term-name-using-its-tid">Lookup term name using its tid</a><li><a href="https://selwynpolit.github.io/d9book/taxonomy#lookup-term-using-its-uuid" id="markdown-toc-lookup-term-using-its-uuid">Lookup term using its uuid</a><li><a href="https://selwynpolit.github.io/d9book/taxonomy#load-terms-from-a-term-reference-field" id="markdown-toc-load-terms-from-a-term-reference-field">Load terms from a term reference field</a><li><a href="https://selwynpolit.github.io/d9book/taxonomy#find-terms-referenced-in-a-paragraph-in-a-term-reference-field" id="markdown-toc-find-terms-referenced-in-a-paragraph-in-a-term-reference-field">Find terms referenced in a paragraph in a term reference field</a><li><a href="https://selwynpolit.github.io/d9book/taxonomy#get-url-alias-from-a-term-id" id="markdown-toc-get-url-alias-from-a-term-id">Get URL alias from a term ID</a><li><a href="https://selwynpolit.github.io/d9book/taxonomy#load-all-terms-for-a-vocabulary" id="markdown-toc-load-all-terms-for-a-vocabulary">Load all terms for a vocabulary</a><li><a href="https://selwynpolit.github.io/d9book/taxonomy#load-all-terms-for-a-vocabulary-and-put-them-in-a-select-dropdown" id="markdown-toc-load-all-terms-for-a-vocabulary-and-put-them-in-a-select-dropdown">Load all terms for a vocabulary and put them in a select (dropdown)</a><li><a href="https://selwynpolit.github.io/d9book/taxonomy#create-taxonomy-term-programatically" id="markdown-toc-create-taxonomy-term-programatically">Create taxonomy term programatically</a><li><a href="https://selwynpolit.github.io/d9book/taxonomy#find-all-nodes-with-a-matching-term" id="markdown-toc-find-all-nodes-with-a-matching-term">Find all nodes with a matching term</a><li><a href="https://selwynpolit.github.io/d9book/taxonomy#find-nodes-with-a-matching-term-using-entityquery" id="markdown-toc-find-nodes-with-a-matching-term-using-entityquery">Find nodes with a matching term using entityQuery</a></li></li></li></li></li></li></li></li></li></li></li></ul><p><img alt="views" src="https://api.visitor.plantree.me/visitor-badge/pv?label=views&amp;color=informational&amp;namespace=d9book&amp;key=taxonomy.md"/></p><hr/><h2 id="lookup-term-by-name"> <a aria-labelledby="lookup-term-by-name" class="anchor-heading" href="https://selwynpolit.github.io/d9book/taxonomy#lookup-term-by-name"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Lookup term by name</h2><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="n">loadTermByName</span><span class="p">()</span> <span class="p">{</span>
  <span class="nv">$vocabulary_id</span> <span class="o">=</span> <span class="s1">'event_category'</span><span class="p">;</span>
  <span class="nv">$term_name</span> <span class="o">=</span> <span class="s1">'protest'</span><span class="p">;</span>
  <span class="nv">$terms</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityTypeManager</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="nf">getStorage</span><span class="p">(</span><span class="s1">'taxonomy_term'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">loadByProperties</span><span class="p">([</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="nv">$term_name</span><span class="p">]);</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$terms</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$build</span><span class="p">[</span><span class="s1">'result'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
      <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'item'</span><span class="p">,</span>
      <span class="s1">'#markup'</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">t</span><span class="p">(</span><span class="s1">'No terms found'</span><span class="p">),</span>
    <span class="p">];</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="cd">/** @var Term $term */</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$terms</span> <span class="k">as</span> <span class="nv">$term</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$term_name</span> <span class="o">=</span> <span class="nv">$term</span><span class="o">-&gt;</span><span class="nf">getName</span><span class="p">();</span>
      <span class="nv">$build</span><span class="p">[</span><span class="nv">$term_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'item'</span><span class="p">,</span>
        <span class="s1">'#markup'</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">t</span><span class="p">(</span><span class="s1">'Term name: @term_name. Term id: @term_id'</span><span class="p">,</span> <span class="p">[</span>
          <span class="s1">'@term_name'</span> <span class="o">=&gt;</span> <span class="nv">$term_name</span><span class="p">,</span>
          <span class="s1">'@term_id'</span> <span class="o">=&gt;</span> <span class="nv">$term</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">(),</span>
        <span class="p">]),</span>
      <span class="p">];</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nv">$build</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Or the deprecated version.</span>

<span class="nv">$terms</span> <span class="o">=</span> <span class="nf">taxonomy_term_load_multiple_by_name</span><span class="p">(</span><span class="nv">$term_name</span><span class="p">,</span> <span class="s1">'opinion_categories'</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$terms</span><span class="p">))</span> <span class="p">{</span>
  <span class="nv">$ra</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'#markup'</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">t</span><span class="p">(</span><span class="s1">'Invalid term: @term'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'@term'</span> <span class="o">=&gt;</span> <span class="nv">$category</span><span class="p">])</span>
  <span class="p">];</span>
  <span class="k">return</span> <span class="nv">$ra</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// pop off the first one and grab it's term_id</span>
<span class="nv">$term</span> <span class="o">=</span> <span class="nb">reset</span><span class="p">(</span><span class="nv">$terms</span><span class="p">);</span>
<span class="nv">$term_id</span> <span class="o">=</span> <span class="nv">$term</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'tid'</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
</code></pre></div></div><h2 id="lookup-term-name-using-its-tid"> <a aria-labelledby="lookup-term-name-using-its-tid" class="anchor-heading" href="https://selwynpolit.github.io/d9book/taxonomy#lookup-term-name-using-its-tid"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Lookup term name using its tid</h2><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">Drupal\taxonomy\Entity\Term</span><span class="p">;</span>
<span class="nv">$term</span> <span class="o">=</span> <span class="nc">Term</span><span class="o">::</span><span class="nf">load</span><span class="p">(</span><span class="nv">$term_id</span><span class="p">);</span>

<span class="c1">// OR</span>

<span class="nv">$term_name</span> <span class="o">=</span> <span class="nc">\Drupal\taxonomy\Entity\Term</span><span class="o">::</span><span class="nf">load</span><span class="p">(</span><span class="nv">$term_id</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">label</span><span class="p">();</span>

<span class="c1">// Or</span>

<span class="nv">$term_name</span> <span class="o">=</span> <span class="nc">\Drupal\taxonomy\Entity\Term</span><span class="o">::</span><span class="nf">load</span><span class="p">(</span><span class="nv">$term_id</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'name'</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>

<span class="c1">// Or</span>

<span class="nv">$term</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityTypeManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getStorage</span><span class="p">(</span><span class="s1">'taxonomy_term'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">load</span><span class="p">(</span><span class="nv">$term_id</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$term</span><span class="p">))</span> <span class="p">{</span>
  <span class="nv">$render_array</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'#markup'</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">t</span><span class="p">(</span><span class="s1">'Invalid term id: @termid'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'@termid'</span> <span class="o">=&gt;</span> <span class="nv">$term_id</span><span class="p">])</span>
  <span class="p">];</span>
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
  <span class="nv">$term_name</span> <span class="o">=</span> <span class="nv">$term</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">;</span>
  <span class="nv">$render_array</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'#markup'</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">t</span><span class="p">(</span><span class="s1">'Term name: @term_name'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'@term_name'</span> <span class="o">=&gt;</span> <span class="nv">$term_name</span><span class="p">])</span>
  <span class="p">];</span>

<span class="p">}</span>
  <span class="k">return</span> <span class="nv">$render_array</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="lookup-term-using-its-uuid"> <a aria-labelledby="lookup-term-using-its-uuid" class="anchor-heading" href="https://selwynpolit.github.io/d9book/taxonomy#lookup-term-using-its-uuid"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Lookup term using its uuid</h2><p>Each taxonomy term has a UUID. See the taxonomy_term_data table uuid field. We can load a taxonomy term by it’s uuid as shown below:</p><p>Here we load a taxonomy term, get it’s name and it’s tid.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="n">loadByUUID</span><span class="p">()</span> <span class="p">{</span>
  <span class="nv">$uuid</span> <span class="o">=</span> <span class="s1">'d4a7bbc5-3b1b-46a4-bea4-01255365999f'</span><span class="p">;</span>

  <span class="nv">$storage</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityTypeManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getStorage</span><span class="p">(</span><span class="s1">'taxonomy_term'</span><span class="p">);</span>
  <span class="nv">$term_loaded_by_uuid</span> <span class="o">=</span> <span class="nv">$storage</span><span class="o">-&gt;</span><span class="nf">loadByProperties</span><span class="p">([</span><span class="s1">'uuid'</span> <span class="o">=&gt;</span> <span class="nv">$uuid</span><span class="p">]);</span>
  <span class="nv">$term</span> <span class="o">=</span> <span class="nb">reset</span><span class="p">(</span><span class="nv">$term_loaded_by_uuid</span><span class="p">);</span>
  <span class="nv">$str</span> <span class="o">=</span> <span class="s2">"Term not found"</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$term</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$term_name</span> <span class="o">=</span> <span class="nv">$term</span><span class="o">-&gt;</span><span class="nf">getName</span><span class="p">();</span>
    <span class="nv">$term_id</span> <span class="o">=</span> <span class="nv">$term</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">();</span>
    <span class="nv">$str</span> <span class="o">=</span>  <span class="s2">"Term uuid = </span><span class="nv">$uuid</span><span class="s2">&lt;br&gt;"</span><span class="p">;</span>
    <span class="nv">$str</span> <span class="mf">.</span><span class="o">=</span>  <span class="s2">"Term name = </span><span class="nv">$term_name</span><span class="s2">&lt;br&gt;"</span><span class="p">;</span>
    <span class="nv">$str</span> <span class="mf">.</span><span class="o">=</span> <span class="s2">"Term id = </span><span class="nv">$term_id</span><span class="s2">&lt;br&gt;"</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nv">$build</span><span class="p">[</span><span class="s1">'content'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'item'</span><span class="p">,</span>
    <span class="s1">'#markup'</span> <span class="o">=&gt;</span> <span class="nv">$str</span><span class="p">,</span>
  <span class="p">];</span>

  <span class="k">return</span> <span class="nv">$build</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="load-terms-from-a-term-reference-field"> <a aria-labelledby="load-terms-from-a-term-reference-field" class="anchor-heading" href="https://selwynpolit.github.io/d9book/taxonomy#load-terms-from-a-term-reference-field"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Load terms from a term reference field</h2><p>Retrieve the values in the field_event_category and display their term name, term id and their uuid. The call to referencedEntities() returns an array of term objects, so no need to call load() on them separately.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="n">loadTermRef</span><span class="p">()</span> <span class="p">{</span>
  <span class="nv">$nid</span> <span class="o">=</span> <span class="mi">24</span><span class="p">;</span>
  <span class="nv">$event_node</span> <span class="o">=</span> <span class="nc">Node</span><span class="o">::</span><span class="nf">load</span><span class="p">(</span><span class="nv">$nid</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$event_node</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$categories</span> <span class="o">=</span> <span class="nv">$event_node</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'field_event_category'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">referencedEntities</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="nv">$str</span> <span class="o">=</span> <span class="s2">"Terms:&lt;br&gt;"</span><span class="p">;</span>

  <span class="cd">/** @var \Drupal\Core\Entity\EntityInterface $category */</span>
  <span class="k">foreach</span> <span class="p">(</span><span class="nv">$categories</span> <span class="k">as</span> <span class="nv">$category</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$term_id</span> <span class="o">=</span> <span class="nv">$category</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">();</span>
    <span class="nv">$term_name</span> <span class="o">=</span> <span class="nv">$category</span><span class="o">-&gt;</span><span class="nf">getName</span><span class="p">();</span>
    <span class="nv">$uuid</span> <span class="o">=</span> <span class="nv">$category</span><span class="o">-&gt;</span><span class="nf">uuid</span><span class="p">();</span>
    <span class="nv">$str</span> <span class="mf">.</span><span class="o">=</span> <span class="s2">"Term name = </span><span class="nv">$term_name</span><span class="s2">&lt;br&gt;"</span><span class="p">;</span>
    <span class="nv">$str</span> <span class="mf">.</span><span class="o">=</span> <span class="s2">"Term id = </span><span class="nv">$term_id</span><span class="s2">&lt;br&gt;"</span><span class="p">;</span>
    <span class="nv">$str</span> <span class="mf">.</span><span class="o">=</span> <span class="s2">"Term uuid = </span><span class="nv">$uuid</span><span class="s2">&lt;br&gt;"</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nv">$build</span><span class="p">[</span><span class="s1">'content'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'item'</span><span class="p">,</span>
    <span class="s1">'#markup'</span> <span class="o">=&gt;</span> <span class="nv">$str</span><span class="p">,</span>
  <span class="p">];</span>

  <span class="k">return</span> <span class="nv">$build</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="find-terms-referenced-in-a-paragraph-in-a-term-reference-field"> <a aria-labelledby="find-terms-referenced-in-a-paragraph-in-a-term-reference-field" class="anchor-heading" href="https://selwynpolit.github.io/d9book/taxonomy#find-terms-referenced-in-a-paragraph-in-a-term-reference-field"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Find terms referenced in a paragraph in a term reference field</h2><p>Loop thru all the instances of a paragraph reference and grab the term in the paragraph.</p><p>use Drupal\taxonomy\Entity\Term;</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">foreach</span> <span class="p">(</span><span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'field_my_para'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">referencedEntities</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$ent</span><span class="p">){</span>
  <span class="nv">$term</span> <span class="o">=</span> <span class="nc">Term</span><span class="o">::</span><span class="nf">load</span><span class="p">(</span><span class="nv">$ent</span><span class="o">-&gt;</span><span class="nv">$field_in_paragraph</span><span class="o">-&gt;</span><span class="n">target_id</span><span class="p">);</span>
  <span class="nv">$name</span> <span class="o">=</span> <span class="nv">$term</span><span class="o">-&gt;</span><span class="nf">getName</span><span class="p">();</span>
  <span class="nb">print_r</span><span class="p">(</span><span class="nv">$name</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="get-url-alias-from-a-term-id"> <a aria-labelledby="get-url-alias-from-a-term-id" class="anchor-heading" href="https://selwynpolit.github.io/d9book/taxonomy#get-url-alias-from-a-term-id"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Get URL alias from a term ID</h2><p>This will return something like:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>URL Alias for tid 3 = https://d9book2.ddev.site/category/rally
</code></pre></div></div><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="n">getTaxonomyAlias</span><span class="p">()</span> <span class="p">{</span>
  <span class="nv">$tid</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
  <span class="c1">//return taxonomy alias</span>
  <span class="nv">$options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'absolute'</span> <span class="o">=&gt;</span> <span class="kc">TRUE</span><span class="p">];</span>  <span class="c1">//FALSE will return relative path.</span>

  <span class="c1">// Build a URL.</span>
  <span class="cd">/** @var \Drupal\Core\Url $url */</span>
  <span class="nv">$url</span> <span class="o">=</span> <span class="nc">Url</span><span class="o">::</span><span class="nf">fromRoute</span><span class="p">(</span><span class="s1">'entity.taxonomy_term.canonical'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'taxonomy_term'</span> <span class="o">=&gt;</span> <span class="nv">$tid</span><span class="p">],</span> <span class="nv">$options</span><span class="p">);</span>
  <span class="nv">$path_string</span> <span class="o">=</span> <span class="nv">$url</span><span class="o">-&gt;</span><span class="nf">toString</span><span class="p">();</span>
  <span class="nv">$str</span> <span class="o">=</span> <span class="s2">"URL Alias for tid </span><span class="nv">$tid</span><span class="s2"> = </span><span class="nv">$path_string</span><span class="s2">"</span><span class="p">;</span>

  <span class="nv">$build</span><span class="p">[</span><span class="s1">'content'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'item'</span><span class="p">,</span>
    <span class="s1">'#markup'</span> <span class="o">=&gt;</span> <span class="nv">$str</span><span class="p">,</span>
  <span class="p">];</span>

  <span class="k">return</span> <span class="nv">$build</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="load-all-terms-for-a-vocabulary"> <a aria-labelledby="load-all-terms-for-a-vocabulary" class="anchor-heading" href="https://selwynpolit.github.io/d9book/taxonomy#load-all-terms-for-a-vocabulary"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Load all terms for a vocabulary</h2><p>This code loads the terms into an array and displays them on screen. Note that you can’t use id() or getName() on the objects returned from loadTree() as they are standard objects. If you load the actual term entities using Term::load(), then you can use entity functions like id() and getName(). It returns this:</p><p>Found 5 terms in vocabulary event_category<br/> Term: Hunger strike term_id: 5<br/> Term: Protest term_id: 4<br/> Term: Rally term_id: 3<br/> Term: Training term_id: 2<br/> Term: Webinar term_id: 1</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="n">loadTerms</span><span class="p">()</span> <span class="p">{</span>
  <span class="nv">$vocabulary_id</span> <span class="o">=</span> <span class="s1">'event_category'</span><span class="p">;</span>

  <span class="nv">$terms</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityTypeManager</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="nf">getStorage</span><span class="p">(</span><span class="s1">'taxonomy_term'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">loadTree</span><span class="p">(</span><span class="nv">$vocabulary_id</span><span class="p">);</span>

  <span class="cd">/** @var \Drupal\taxonomy\Entity\Term $term */</span>
  <span class="k">foreach</span> <span class="p">(</span><span class="nv">$terms</span> <span class="k">as</span> <span class="nv">$term</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$terms_array</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[</span>
      <span class="s1">'id'</span> <span class="o">=&gt;</span> <span class="nv">$term</span><span class="o">-&gt;</span><span class="n">tid</span><span class="p">,</span>
      <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="nv">$term</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span>
      <span class="s1">'weight'</span> <span class="o">=&gt;</span> <span class="nv">$term</span><span class="o">-&gt;</span><span class="n">weight</span><span class="p">,</span>
    <span class="p">];</span>
   <span class="p">}</span>
   <span class="nv">$length</span> <span class="o">=</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$terms_array</span><span class="p">);</span>
   <span class="nv">$str</span> <span class="o">=</span> <span class="s2">"Found </span><span class="nv">$length</span><span class="s2"> terms in vocabulary </span><span class="nv">$vocabulary_id</span><span class="s2">&lt;br&gt;"</span><span class="p">;</span>

  <span class="k">foreach</span> <span class="p">(</span><span class="nv">$terms</span> <span class="k">as</span> <span class="nv">$term</span><span class="p">)</span> <span class="p">{</span>
   <span class="nv">$str</span> <span class="mf">.</span><span class="o">=</span> <span class="s1">'Term: '</span> <span class="mf">.</span> <span class="nv">$term</span><span class="o">-&gt;</span><span class="n">name</span> <span class="mf">.</span> <span class="s1">' term_id: '</span> <span class="mf">.</span> <span class="nv">$term</span><span class="o">-&gt;</span><span class="n">tid</span> <span class="mf">.</span> <span class="s1">'&lt;br&gt;'</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nv">$build</span><span class="p">[</span><span class="s1">'content'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'item'</span><span class="p">,</span>
    <span class="s1">'#markup'</span> <span class="o">=&gt;</span> <span class="nv">$str</span><span class="p">,</span>
  <span class="p">];</span>
  <span class="k">return</span> <span class="nv">$build</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="load-all-terms-for-a-vocabulary-and-put-them-in-a-select-dropdown"> <a aria-labelledby="load-all-terms-for-a-vocabulary-and-put-them-in-a-select-dropdown" class="anchor-heading" href="https://selwynpolit.github.io/d9book/taxonomy#load-all-terms-for-a-vocabulary-and-put-them-in-a-select-dropdown"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Load all terms for a vocabulary and put them in a select (dropdown)</h2><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nv">$vid</span> <span class="o">=</span> <span class="s1">'event_format'</span><span class="p">;</span>
    <span class="nv">$terms</span> <span class="o">=</span><span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityTypeManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getStorage</span><span class="p">(</span><span class="s1">'taxonomy_term'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">loadTree</span><span class="p">(</span><span class="nv">$vid</span><span class="p">);</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$terms</span> <span class="k">as</span> <span class="nv">$term</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$options</span><span class="p">[</span><span class="nv">$term</span><span class="o">-&gt;</span><span class="n">tid</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$term</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nv">$form</span><span class="p">[</span><span class="s1">'event_format'</span><span class="p">][</span><span class="s1">'active'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
      <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'radios'</span><span class="p">,</span>
      <span class="s1">'#title'</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">t</span><span class="p">(</span><span class="s1">'Event Format'</span><span class="p">),</span>
      <span class="s1">'#default_value'</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
      <span class="s1">'#options'</span> <span class="o">=&gt;</span> <span class="nv">$options</span><span class="p">,</span>
<span class="c1">//      '#options' =&gt; [</span>
<span class="c1">//        0 =&gt; $this-&gt;t('In-Person'),</span>
<span class="c1">//        1 =&gt; $this-&gt;t('Online'),</span>
<span class="c1">//        2 =&gt; $this-&gt;t('In-Person &amp; Online'),</span>
<span class="c1">//      ],</span>
    <span class="p">];</span>
</code></pre></div></div><h2 id="create-taxonomy-term-programatically"> <a aria-labelledby="create-taxonomy-term-programatically" class="anchor-heading" href="https://selwynpolit.github.io/d9book/taxonomy#create-taxonomy-term-programatically"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Create taxonomy term programatically</h2><p>Vid is the vocabulary id e.g. event_category or type</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$term</span> <span class="o">=</span> <span class="nc">Term</span><span class="o">::</span><span class="nf">create</span><span class="p">([</span>
  <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'protest'</span><span class="p">,</span>
  <span class="s1">'vid'</span> <span class="o">=&gt;</span> <span class="s1">'event_category'</span><span class="p">,</span>
<span class="p">])</span><span class="o">-&gt;</span><span class="nf">save</span><span class="p">();</span>
</code></pre></div></div><h2 id="find-all-nodes-with-a-matching-term"> <a aria-labelledby="find-all-nodes-with-a-matching-term" class="anchor-heading" href="https://selwynpolit.github.io/d9book/taxonomy#find-all-nodes-with-a-matching-term"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Find all nodes with a matching term</h2><p>See the queries chapter for other ways to do this.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="n">getMatchingNodes</span><span class="p">()</span> <span class="p">{</span>
  <span class="nv">$term_id</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

  <span class="nv">$nodes</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityTypeManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getStorage</span><span class="p">(</span><span class="s1">'node'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">loadByProperties</span><span class="p">([</span>
    <span class="s1">'field_event_category'</span> <span class="o">=&gt;</span> <span class="nv">$term_id</span><span class="p">,</span>
  <span class="p">]);</span>

  <span class="nv">$length</span> <span class="o">=</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$nodes</span><span class="p">);</span>
  <span class="nv">$str</span> <span class="o">=</span> <span class="s2">"Found </span><span class="nv">$length</span><span class="s2"> nodes matching term_id </span><span class="nv">$term_id</span><span class="s2">&lt;br&gt;"</span><span class="p">;</span>

  <span class="cd">/** @var Node $node */</span>
  <span class="k">foreach</span> <span class="p">(</span><span class="nv">$nodes</span> <span class="k">as</span> <span class="nv">$node</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$str</span> <span class="mf">.</span><span class="o">=</span> <span class="s2">"Node "</span><span class="mf">.</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">()</span> <span class="mf">.</span> <span class="s2">": Title: "</span> <span class="mf">.</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">getTitle</span><span class="p">()</span> <span class="mf">.</span> <span class="s2">"&lt;br&gt;"</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nv">$build</span><span class="p">[</span><span class="s1">'content'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'item'</span><span class="p">,</span>
    <span class="s1">'#markup'</span> <span class="o">=&gt;</span> <span class="nv">$str</span><span class="p">,</span>
  <span class="p">];</span>

  <span class="k">return</span> <span class="nv">$build</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="find-nodes-with-a-matching-term-using-entityquery"> <a aria-labelledby="find-nodes-with-a-matching-term-using-entityquery" class="anchor-heading" href="https://selwynpolit.github.io/d9book/taxonomy#find-nodes-with-a-matching-term-using-entityquery"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Find nodes with a matching term using entityQuery</h2><p>This finds the first 5 nodes that have the matching term.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">protected</span> <span class="k">function</span> <span class="n">loadFirstOpinion</span><span class="p">(</span><span class="nv">$term_id</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$storage</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityTypeManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getStorage</span><span class="p">(</span><span class="s1">'node'</span><span class="p">);</span>
  <span class="nv">$query</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityQuery</span><span class="p">(</span><span class="s1">'node'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'status'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'type'</span><span class="p">,</span> <span class="s1">'opinion'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'field_category'</span><span class="p">,</span> <span class="nv">$term_id</span><span class="p">,</span> <span class="s1">'='</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
  <span class="nv">$nids</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>
  <span class="nv">$nodes</span> <span class="o">=</span> <span class="nv">$storage</span><span class="o">-&gt;</span><span class="nf">loadMultiple</span><span class="p">(</span><span class="nv">$nids</span><span class="p">);</span>

  <span class="nv">$ra</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">foreach</span> <span class="p">(</span><span class="nv">$nodes</span> <span class="k">as</span> <span class="nv">$node</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$ra</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[</span>
      <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'markup'</span><span class="p">,</span>
      <span class="s1">'#markup'</span> <span class="o">=&gt;</span> <span class="s1">'&lt;p&gt;'</span> <span class="mf">.</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">getTitle</span><span class="p">(),</span>
    <span class="p">];</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nv">$ra</span><span class="p">;</span>
</code></pre></div></div><hr/> <script async="" crossorigin="anonymous" data-category="Q&amp;A" data-category-id="MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMyMjY2NDE4" data-emit-metadata="0" data-input-position="bottom" data-lang="en" data-mapping="title" data-reactions-enabled="1" data-repo="selwynpolit/d9book" data-repo-id="MDEwOlJlcG9zaXRvcnkzMjUxNTQ1Nzg=" data-strict="0" data-theme="preferred_color_scheme" src="https://giscus.app/client.js"> </script><hr/><footer><p><a href="https://selwynpolit.github.io/d9book/taxonomy#top" id="back-to-top">Back to top</a></p><p class="text-small text-grey-dk-100 mb-0"><span xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/"> <a href="http://www.selwynpolit.github.io/d9book" property="dct:title" rel="cc:attributionURL">Drupal at your fingertips</a> by <a href="http://www.drupal.org/u/selwynpolit" property="cc:attributionName" rel="cc:attributionURL dct:creator">Selwyn Polit</a> is licensed under <a href="http://creativecommons.org/licenses/by/4.0/" rel="license noopener noreferrer" target="_blank">CC BY 4.0 <img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg" style="height:16px!important;vertical-align:text-bottom;"/> <img src="https://mirrors.creativecommons.org/presskit/icons/by.svg" style="height:16px!important;vertical-align:text-bottom;"/> </a></span></p><div class="d-flex mt-2"><p class="text-small text-grey-dk-000 mb-0 mr-2"> Page last modified: <span class="d-inline-block">Apr 14 2023</span>.</p><p class="text-small text-grey-dk-000 mb-0"> <a href="https://github.com/selwynpolit/d9book/tree/gh-pages/book/taxonomy.md" id="edit-this-page">Edit this page on GitHub</a></p></div></footer></div></div><div class="search-overlay"></div></div>
</body></link></meta></meta></meta></head></html>