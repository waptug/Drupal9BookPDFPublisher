<!DOCTYPE html>
<html lang="en-US"><head><meta charset="utf-8"/><meta content="IE=Edge" http-equiv="X-UA-Compatible"/><link href="https://selwynpolit.github.io/d9book/assets/css/just-the-docs-default.css" rel="stylesheet"/> <script async="" src="https://www.googletagmanager.com/gtag/js?id=8V22RQEJ71"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', '8V22RQEJ71', { 'anonymize_ip': true }); </script> <script src="https://selwynpolit.github.io/d9book/assets/js/vendor/lunr.min.js"></script> <script src="https://selwynpolit.github.io/d9book/assets/js/just-the-docs.js"></script><meta content="width=device-width, initial-scale=1" name="viewport"/><link href="https://selwynpolit.github.io/d9book/assets/images/favicon.ico" rel="icon" type="image/x-icon"/><title>Cron | Drupal Book</title><meta content="Jekyll v4.3.2" name="generator"><meta content="Cron" property="og:title"><meta content="en_US" property="og:locale"><meta content="Drupal at your fingertips" name="description"/><meta content="Drupal at your fingertips" property="og:description"/><link href="https://selwynpolit.github.io/d9book/d9book/cron" rel="canonical"><meta content="https://selwynpolit.github.io/d9book/d9book/cron" property="og:url"/><meta content="Drupal Book" property="og:site_name"/><meta content="website" property="og:type"/><meta content="summary" name="twitter:card"/><meta content="Cron" property="twitter:title"/> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Drupal at your fingertips","headline":"Cron","url":"https://selwynpolit.github.io/d9book/d9book/cron"}</script><body> <a class="skip-to-main" href="https://selwynpolit.github.io/d9book/cron#main-content">Skip to main content</a> <svg class="d-none" xmlns="http://www.w3.org/2000/svg"> <symbol id="svg-link" viewbox="0 0 24 24"><title>Link</title><svg class="feather feather-link" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewbox="0 0 24 24"><title>Menu</title><svg class="feather feather-menu" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><line x1="3" x2="21" y1="12" y2="12"></line><line x1="3" x2="21" y1="6" y2="6"></line><line x1="3" x2="21" y1="18" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewbox="0 0 24 24"><title>Expand</title><svg class="feather feather-chevron-right" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol class="feather feather-external-link" fill="none" height="24" id="svg-external-link" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24"><title id="svg-external-link-title">(external link)</title><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" x2="21" y1="14" y2="3"></line> </symbol> <symbol id="svg-doc" viewbox="0 0 24 24"><title>Document</title><svg class="feather feather-file" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewbox="0 0 24 24"><title>Search</title><svg class="feather feather-search" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"> <circle cx="11" cy="11" r="8"></circle><line x1="21" x2="16.65" y1="21" y2="16.65"></line> </svg> </symbol> <symbol id="svg-copy" viewbox="0 0 16 16"><title>Copy</title><svg class="bi bi-clipboard" fill="currentColor" height="16" viewbox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"></path><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"></path> </svg> </symbol> <symbol id="svg-copied" viewbox="0 0 16 16"><title>Copied</title><svg class="bi bi-clipboard-check-fill" fill="currentColor" height="16" viewbox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"></path><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"></path> </svg> </symbol> </svg><div class="side-bar"><div class="site-header"> <a class="site-title lh-tight" href="https://selwynpolit.github.io/d9book/"> Drupal Book </a> <a class="site-button" href="https://selwynpolit.github.io/d9book/cron" id="menu-button"> <svg class="icon" viewbox="0 0 24 24"><use xlink:href="#svg-menu"></use></svg> </a></div><nav aria-label="Main" class="site-nav" id="site-nav"><ul class="nav-list"><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/">Home</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/actions">Actions</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/attribution">Attribution</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/bq">Batch and Queue</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/blocks">Blocks</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/caching">Caching</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/composer">Composer</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/config">Config</a><li class="nav-list-item active"><a class="nav-list-link active" href="https://selwynpolit.github.io/d9book/cron">Cron</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/dates">Dates and Times</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/debugging">Debugging</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/development">Development</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/drush">Drush</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/email">Email</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/entities">Entities</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/forms">Forms</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/general">General</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/off-island">Getting off the Island</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/hooks">Hooks</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/learn">Learning</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/links">Links</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/logging">Logging</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/menus">Menus</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/migrate">Migrate</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/modals">Modals</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/nodes-and-fields">Nodes and Fields</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/queries">Queries</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/redirects">Redirects</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/render">Render Arrays</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/routes">Routes</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/security">Security</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/services">Services</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/state">State</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/taxonomy">Taxonomy</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/dtt">Tests</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/twig">Twig</a></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></ul><ul class="nav-list"><li class="nav-list-item external"> <a class="nav-list-link external" href="https://github.com/selwynpolit/d9book/fork"> Fork me on GitHub <svg aria-labelledby="svg-external-link-title" viewbox="0 0 24 24"><use xlink:href="#svg-external-link"></use></svg> </a></li></ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer></div><div class="main" id="top"><div class="main-header" id="main-header"><div class="search"><div class="search-input-wrap"> <input aria-label="Search Drupal Book" autocomplete="off" class="search-input" id="search-input" placeholder="Search Drupal Book" tabindex="0" type="text"/> <label class="search-label" for="search-input"><svg class="search-icon" viewbox="0 0 24 24"><use xlink:href="#svg-search"></use></svg></label></div><div class="search-results" id="search-results"></div></div><nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a class="site-button" href="https://twitter.com/selwynpolit" rel="noopener noreferrer" target="_blank"> <img alt="Twitter logo" src="https://atuin.ru/demo/simple-icons/icons/twitter.svg" style="width: 30px; height: 30px;" title="Author in Twitter"/> </a><li class="aux-nav-list-item"> <a class="site-button" href="https://github.com/selwynpolit/d9book/tree/gh-pages" rel="noopener noreferrer" target="_blank"> <img alt="GitHub logo" src="https://atuin.ru/demo/simple-icons/icons/github.svg" style="width: 30px; height: 30px;" title="D9Book on GitHub"/> </a></li></li></ul></nav></div><div class="main-content-wrap" id="main-content-wrap"><div class="main-content" id="main-content" role="main"><h1 class="no_toc fw-500" id="cron"> <a aria-labelledby="cron" class="anchor-heading" href="https://selwynpolit.github.io/d9book/cron#cron"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> CRON</h1><h2 class="no_toc text-delta" id="table-of-contents"> <a aria-labelledby="table-of-contents" class="anchor-heading" href="https://selwynpolit.github.io/d9book/cron#table-of-contents"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Table of contents</h2><ul id="markdown-toc"><li><a href="https://selwynpolit.github.io/d9book/cron#overview" id="markdown-toc-overview">Overview</a><li><a href="https://selwynpolit.github.io/d9book/cron#how-does-it-work" id="markdown-toc-how-does-it-work">How does it work?</a><li><a href="https://selwynpolit.github.io/d9book/cron#enable-drupal-cron" id="markdown-toc-enable-drupal-cron">Enable Drupal Cron</a><li><a href="https://selwynpolit.github.io/d9book/cron#the-cron-command" id="markdown-toc-the-cron-command">The cron command</a><li><a href="https://selwynpolit.github.io/d9book/cron#setting-up-cron" id="markdown-toc-setting-up-cron">Setting up cron</a><li><a href="https://selwynpolit.github.io/d9book/cron#disable-drupal-cron" id="markdown-toc-disable-drupal-cron">Disable Drupal cron</a><li><a href="https://selwynpolit.github.io/d9book/cron#hook_cron" id="markdown-toc-hook_cron">hook_cron()</a><li><a href="https://selwynpolit.github.io/d9book/cron#common-inquiries-regarding-cron-jobs" id="markdown-toc-common-inquiries-regarding-cron-jobs">Common inquiries regarding cron jobs</a><ul><li><a href="https://selwynpolit.github.io/d9book/cron#when-did-the-cron-job-last-run" id="markdown-toc-when-did-the-cron-job-last-run">When did the cron job last run?</a><li><a href="https://selwynpolit.github.io/d9book/cron#how-to-stop-cron-from-continuously-executing-things" id="markdown-toc-how-to-stop-cron-from-continuously-executing-things">How to stop Cron from continuously executing things?</a><li><a href="https://selwynpolit.github.io/d9book/cron#resolving-the-ip-and-name-for-cron" id="markdown-toc-resolving-the-ip-and-name-for-cron">Resolving the ip and name for cron</a></li></li></li></ul><li><a href="https://selwynpolit.github.io/d9book/cron#resources" id="markdown-toc-resources">Resources:</a></li></li></li></li></li></li></li></li></li></ul><p><img alt="views" src="https://api.visitor.plantree.me/visitor-badge/pv?label=views&amp;color=informational&amp;namespace=d9book&amp;key=cron.md"/></p><hr/><h2 id="overview"> <a aria-labelledby="overview" class="anchor-heading" href="https://selwynpolit.github.io/d9book/cron#overview"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Overview</h2><p>Cron is a time-based task scheduler that executes commands at specified intervals, called <strong><em>cron jobs</em></strong>. Cron is available on Unix, Linux, and Mac servers, and Windows servers use a Scheduled Task to execute commands. Cron jobs are used in Drupal to handle maintenance tasks such as cleaning up log files and checking for updates.</p><h2 id="how-does-it-work"> <a aria-labelledby="how-does-it-work" class="anchor-heading" href="https://selwynpolit.github.io/d9book/cron#how-does-it-work"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> How does it work?</h2><p>Drupal provides an automated cron system that works with all operating systems because it does not involve the operating system’s cron daemon. Instead, it works by checking at the end of each Drupal request to see when the cron last ran. If it has been too long, cron tasks are processed as part of that request.</p><p>Module <code class="language-plaintext highlighter-rouge">automated_cron</code> subscribes to the <a href="https://symfony.com/doc/current/components/http_kernel.html#8-the-kernel-terminate-event">onTerminate</a> event for request. You can read more about how this component works in Symfony [here].</p><p>File <em>core/modules/automated_cron/src/EventSubscriber/AutomatedCron.php</em>:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cd">/**
 * Registers the methods in this class that should be listeners.
 *
 * @return array
 *   An array of event listener definitions.
 */</span>
<span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="n">getSubscribedEvents</span><span class="p">():</span> <span class="kt">array</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">[</span><span class="nc">KernelEvents</span><span class="o">::</span><span class="no">TERMINATE</span> <span class="o">=&gt;</span> <span class="p">[[</span><span class="s1">'onTerminate'</span><span class="p">,</span> <span class="mi">100</span><span class="p">]]];</span>
<span class="p">}</span>
</code></pre></div></div><p>Drupal then keeps track of when the cron ran and ensures that the next time it runs is only after the configured amount of time has elapsed.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cd">/**
 * Run the automated cron if enabled.
 *
 * @param \Symfony\Component\HttpKernel\Event\TerminateEvent $event
 *   The Event to process.
 */</span>
<span class="k">public</span> <span class="k">function</span> <span class="n">onTerminate</span><span class="p">(</span><span class="kt">TerminateEvent</span> <span class="nv">$event</span><span class="p">):</span> <span class="kt">void</span> <span class="p">{</span>
  <span class="nv">$interval</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">config</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'interval'</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$interval</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$cron_next</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">state</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'system.cron_last'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="nv">$interval</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">int</span><span class="p">)</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="nf">getRequest</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">server</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'REQUEST_TIME'</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nv">$cron_next</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">cron</span><span class="o">-&gt;</span><span class="nf">run</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p>So, in essence, if the cron is set to run every hour but the next visitor only comes in three hours, it will only run then.</p><h2 id="enable-drupal-cron"> <a aria-labelledby="enable-drupal-cron" class="anchor-heading" href="https://selwynpolit.github.io/d9book/cron#enable-drupal-cron"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Enable Drupal Cron</h2><ul><li><p>One way to enable cron is through the administration page. By default, Drupal has a built-in core <code class="language-plaintext highlighter-rouge">automated cron</code> system that manages cron. You can access this system by navigating to <strong><em>Configuration &gt; System &gt; Cron</em></strong> (<code class="language-plaintext highlighter-rouge">/admin/config/system/cron</code>). If you have just installed Drupal, this option should be enabled by default. You can confirm this by checking the status of the Automated Cron module at <code class="language-plaintext highlighter-rouge">/admin/modules</code>.</p><li><p>Another way to enable cron is to run it manually from the <strong><em>Reports &gt; Status report page</em></strong>. By default, cron runs every 3 hours, but you can change this to run every hour or every 6 hours. You can also use contributed modules for additional cron functions.</p><li><p>To run cron using Drush, open a terminal or command prompt and navigate to your Drupal site’s root directory. Then, enter the command <code class="language-plaintext highlighter-rouge">drush cron</code>. This will run cron for your site.</p></li></li></li></ul><h2 id="the-cron-command"> <a aria-labelledby="the-cron-command" class="anchor-heading" href="https://selwynpolit.github.io/d9book/cron#the-cron-command"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> The cron command</h2><p>To get Drupal to take care of its maintenance you should have the server execute Drupal’s cron periodically. This is done by logging in to the server directly and settings the crontab file.</p><p><strong>Crontab</strong> (CRON TABle) - is a text file that contains the schedule of cron entries to be run at specified times This file can be created and edited either through the command line interface.</p><p>In the following example, the crontab command shown below will activate the cron tasks automatically on the hour:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0 * * * * wget -O - -q -t 1 http://www.example.com/cron/&lt;key&gt;
</code></pre></div></div><p>In the above sample, the <code class="language-plaintext highlighter-rouge">0 * * * *</code> represents when the task should happen. The first figure represents minutes – in this case, on the ‘zero’ minute, or top of the hour. The other figures represent the hour, day, month, and day of the week. A <code class="language-plaintext highlighter-rouge">*</code> is a wildcard, meaning ‘every time’. The minimum is every minute <code class="language-plaintext highlighter-rouge">* * * * *</code>.</p><p>The rest of the line wget <code class="language-plaintext highlighter-rouge">-O - -q -t</code> 1 tells the server to request a URL, so the server executes the cron script.</p><p>Here is a diagram of the general crontab syntax, for illustration:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># +-------------- minute (0 - 59)
# |  +----------- hour (0 - 23)
# |  |  +-------- day of the month (1 - 31)
# |  |  |  +----- month (1 - 12)
# |  |  |  |  +-- day of the week (0 - 6) (Sunday=0)
# |  |  |  |  |
  *  *  *  *  *   command to be executed
</code></pre></div></div><p>Thus, the cron command example above means <code class="language-plaintext highlighter-rouge">ping http://www.example.com/cron/&lt;key&gt;</code> at the zero minutes on every hour of every day of every month of every day of the week.</p><h2 id="setting-up-cron"> <a aria-labelledby="setting-up-cron" class="anchor-heading" href="https://selwynpolit.github.io/d9book/cron#setting-up-cron"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Setting up cron</h2><p>To edit a crontab through the command line, type:</p><ol><li><p>At the Linux command prompt, type: <code class="language-plaintext highlighter-rouge">sudo crontab -e</code></p><li><p>Add ONE of the following lines:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>45 * * * * wget -O - -q -t 1 http://www.example.com/cron/&lt;key&gt;
45 * * * * curl -s http://example.com/cron/&lt;key&gt;
</code></pre></div></div><p>This would have a wget or curl visit your cron page 45 minutes after every hour.</p><li><p>Save and exit the file. Check the Drupal status report, which shows the time of the cron execution.</p></li></li></li></ol><blockquote class="note"><p>Use <a href="https://crontab.guru">crontab guru</a> - it’s a quick and easy editor for cron schedule expressions.</p></blockquote><h2 id="disable-drupal-cron"> <a aria-labelledby="disable-drupal-cron" class="anchor-heading" href="https://selwynpolit.github.io/d9book/cron#disable-drupal-cron"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Disable Drupal cron</h2><p>For performance reasons, or if you want to ensure that cron can only ever run from an external trigger (not from Drupal), it may be desirable to disable Drupal’s automated cron system, in one of three ways:</p><ol><li><p>The preferred way to disable Drupal’s core <code class="language-plaintext highlighter-rouge">automated cron</code> module is by unchecking it at <code class="language-plaintext highlighter-rouge">/admin/modules</code>.</p><li><p>To temporarily disable cron, set the ‘Run cron every’ value to ‘Never’ (e.g., at <strong><em>Administration &gt; Configuration &gt; System &gt; Cron</em></strong> (<code class="language-plaintext highlighter-rouge">/admin/config/system/cron</code>)).</p><li><p>For advanced reasons, another way to disable cron in Drupal is to add the following line to your settings.php. Note that this fixes the setting at <code class="language-plaintext highlighter-rouge">/admin/config/system/cron</code> to ‘Never’, and administrative users cannot override it.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$config</span><span class="p">[</span><span class="s1">'automated_cron.settings'</span><span class="p">][</span><span class="s1">'interval'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</code></pre></div></div></li></li></li></ol><h2 id="hook_cron"> <a aria-labelledby="hook_cron" class="anchor-heading" href="https://selwynpolit.github.io/d9book/cron#hook_cron"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> hook_cron()</h2><p>Gets fired every time the cron runs, so basically, Drupal’s cron is a collection of function calls to various modules. For this reason, we must avoid overloading the request with heavy processing; otherwise, the request might crash.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">announcements_feed_cron</span><span class="p">()</span> <span class="p">{</span>
  <span class="nv">$config</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">config</span><span class="p">(</span><span class="s1">'announcements_feed.settings'</span><span class="p">);</span>
  <span class="nv">$interval</span> <span class="o">=</span> <span class="nv">$config</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'cron_interval'</span><span class="p">);</span>
  <span class="nv">$last_check</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">state</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'announcements_feed.last_fetch'</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="nv">$time</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nb">time</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getRequestTime</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$time</span> <span class="o">-</span> <span class="nv">$last_check</span> <span class="o">&gt;</span> <span class="nv">$interval</span><span class="p">)</span> <span class="p">{</span>
    <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">service</span><span class="p">(</span><span class="s1">'announcements_feed.fetcher'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">fetch</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">);</span>
    <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">state</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="s1">'announcements_feed.last_fetch'</span><span class="p">,</span> <span class="nv">$time</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="common-inquiries-regarding-cron-jobs"> <a aria-labelledby="common-inquiries-regarding-cron-jobs" class="anchor-heading" href="https://selwynpolit.github.io/d9book/cron#common-inquiries-regarding-cron-jobs"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Common inquiries regarding cron jobs</h2><h3 id="when-did-the-cron-job-last-run"> <a aria-labelledby="when-did-the-cron-job-last-run" class="anchor-heading" href="https://selwynpolit.github.io/d9book/cron#when-did-the-cron-job-last-run"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> When did the cron job last run?</h3><p>We can use this in .module files (which don’t allow dependency injection) in this way.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Find out when cron was last run; the key is 'system.cron_last'.</span>
<span class="nv">$cron_last</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">state</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'system.cron_last'</span><span class="p">);</span>
</code></pre></div></div><p>Or in another file, we need to use dependency injection.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$cron_last</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">state</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'system.cron_last'</span><span class="p">)</span>
</code></pre></div></div><h3 id="how-to-stop-cron-from-continuously-executing-things"> <a aria-labelledby="how-to-stop-cron-from-continuously-executing-things" class="anchor-heading" href="https://selwynpolit.github.io/d9book/cron#how-to-stop-cron-from-continuously-executing-things"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> How to stop Cron from continuously executing things?</h3><p>To stop cron from endlessly executing pending cron tasks truncate the queue table e.g. if you have queued up work such as in the salesforce module.</p><h3 id="resolving-the-ip-and-name-for-cron"> <a aria-labelledby="resolving-the-ip-and-name-for-cron" class="anchor-heading" href="https://selwynpolit.github.io/d9book/cron#resolving-the-ip-and-name-for-cron"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Resolving the ip and name for cron</h3><p>Here is a Drupal cron job on a prod server where it uses a <code class="language-plaintext highlighter-rouge">--resolve</code> param to resolve the IP and the name. This task runs every 15 minutes.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>*/15 * * * * curl -svo /dev/null http://prod.ddd.test.gov:8080/cron/&lt;key&gt; --resolve prod.ddd.test.gov:8080:201.86.28.12
</code></pre></div></div><h2 id="resources"> <a aria-labelledby="resources" class="anchor-heading" href="https://selwynpolit.github.io/d9book/cron#resources"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Resources:</h2><ul><li><li><li><li><li><li><li><li></li></li></li></li></li></li></li></li></ul><hr/> <script async="" crossorigin="anonymous" data-category="Q&amp;A" data-category-id="MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMyMjY2NDE4" data-emit-metadata="0" data-input-position="bottom" data-lang="en" data-mapping="title" data-reactions-enabled="1" data-repo="selwynpolit/d9book" data-repo-id="MDEwOlJlcG9zaXRvcnkzMjUxNTQ1Nzg=" data-strict="0" data-theme="preferred_color_scheme" src="https://giscus.app/client.js"> </script><hr/><footer><p><a href="https://selwynpolit.github.io/d9book/cron#top" id="back-to-top">Back to top</a></p><p class="text-small text-grey-dk-100 mb-0"><span xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/"> <a href="http://www.selwynpolit.github.io/d9book" property="dct:title" rel="cc:attributionURL">Drupal at your fingertips</a> by <a href="http://www.drupal.org/u/selwynpolit" property="cc:attributionName" rel="cc:attributionURL dct:creator">Selwyn Polit</a> is licensed under <a href="http://creativecommons.org/licenses/by/4.0/" rel="license noopener noreferrer" target="_blank">CC BY 4.0 <img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg" style="height:16px!important;vertical-align:text-bottom;"/> <img src="https://mirrors.creativecommons.org/presskit/icons/by.svg" style="height:16px!important;vertical-align:text-bottom;"/> </a></span></p><div class="d-flex mt-2"><p class="text-small text-grey-dk-000 mb-0 mr-2"> Page last modified: <span class="d-inline-block">May 2 2023</span>.</p><p class="text-small text-grey-dk-000 mb-0"> <a href="https://github.com/selwynpolit/d9book/tree/gh-pages/book/cron.md" id="edit-this-page">Edit this page on GitHub</a></p></div></footer></div></div><div class="search-overlay"></div></div>
</body></link></meta></meta></meta></head></html>