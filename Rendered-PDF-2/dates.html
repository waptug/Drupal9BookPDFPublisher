<!DOCTYPE html>
<html lang="en-US"><head><meta charset="utf-8"/><meta content="IE=Edge" http-equiv="X-UA-Compatible"/><link href="https://selwynpolit.github.io/d9book/assets/css/just-the-docs-default.css" rel="stylesheet"/> <script async="" src="https://www.googletagmanager.com/gtag/js?id=8V22RQEJ71"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', '8V22RQEJ71', { 'anonymize_ip': true }); </script> <script src="https://selwynpolit.github.io/d9book/assets/js/vendor/lunr.min.js"></script> <script src="https://selwynpolit.github.io/d9book/assets/js/just-the-docs.js"></script><meta content="width=device-width, initial-scale=1" name="viewport"/><link href="https://selwynpolit.github.io/d9book/assets/images/favicon.ico" rel="icon" type="image/x-icon"/><title>Dates and Times | Drupal Book</title><meta content="Jekyll v4.3.2" name="generator"><meta content="Dates and Times" property="og:title"><meta content="en_US" property="og:locale"><meta content="Drupal at your fingertips" name="description"/><meta content="Drupal at your fingertips" property="og:description"/><link href="https://selwynpolit.github.io/d9book/d9book/dates" rel="canonical"><meta content="https://selwynpolit.github.io/d9book/d9book/dates" property="og:url"/><meta content="Drupal Book" property="og:site_name"/><meta content="website" property="og:type"/><meta content="summary" name="twitter:card"/><meta content="Dates and Times" property="twitter:title"/> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Drupal at your fingertips","headline":"Dates and Times","url":"https://selwynpolit.github.io/d9book/d9book/dates"}</script><body> <a class="skip-to-main" href="https://selwynpolit.github.io/d9book/dates#main-content">Skip to main content</a> <svg class="d-none" xmlns="http://www.w3.org/2000/svg"> <symbol id="svg-link" viewbox="0 0 24 24"><title>Link</title><svg class="feather feather-link" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewbox="0 0 24 24"><title>Menu</title><svg class="feather feather-menu" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><line x1="3" x2="21" y1="12" y2="12"></line><line x1="3" x2="21" y1="6" y2="6"></line><line x1="3" x2="21" y1="18" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewbox="0 0 24 24"><title>Expand</title><svg class="feather feather-chevron-right" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol class="feather feather-external-link" fill="none" height="24" id="svg-external-link" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24"><title id="svg-external-link-title">(external link)</title><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" x2="21" y1="14" y2="3"></line> </symbol> <symbol id="svg-doc" viewbox="0 0 24 24"><title>Document</title><svg class="feather feather-file" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewbox="0 0 24 24"><title>Search</title><svg class="feather feather-search" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"> <circle cx="11" cy="11" r="8"></circle><line x1="21" x2="16.65" y1="21" y2="16.65"></line> </svg> </symbol> <symbol id="svg-copy" viewbox="0 0 16 16"><title>Copy</title><svg class="bi bi-clipboard" fill="currentColor" height="16" viewbox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"></path><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"></path> </svg> </symbol> <symbol id="svg-copied" viewbox="0 0 16 16"><title>Copied</title><svg class="bi bi-clipboard-check-fill" fill="currentColor" height="16" viewbox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"></path><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"></path> </svg> </symbol> </svg><div class="side-bar"><div class="site-header"> <a class="site-title lh-tight" href="https://selwynpolit.github.io/d9book/"> Drupal Book </a> <a class="site-button" href="https://selwynpolit.github.io/d9book/dates" id="menu-button"> <svg class="icon" viewbox="0 0 24 24"><use xlink:href="#svg-menu"></use></svg> </a></div><nav aria-label="Main" class="site-nav" id="site-nav"><ul class="nav-list"><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/">Home</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/actions">Actions</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/attribution">Attribution</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/bq">Batch and Queue</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/blocks">Blocks</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/caching">Caching</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/composer">Composer</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/config">Config</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/cron">Cron</a><li class="nav-list-item active"><a class="nav-list-link active" href="https://selwynpolit.github.io/d9book/dates">Dates and Times</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/debugging">Debugging</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/development">Development</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/drush">Drush</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/email">Email</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/entities">Entities</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/forms">Forms</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/general">General</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/off-island">Getting off the Island</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/hooks">Hooks</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/learn">Learning</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/links">Links</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/logging">Logging</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/menus">Menus</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/migrate">Migrate</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/modals">Modals</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/nodes-and-fields">Nodes and Fields</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/queries">Queries</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/redirects">Redirects</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/render">Render Arrays</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/routes">Routes</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/security">Security</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/services">Services</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/state">State</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/taxonomy">Taxonomy</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/dtt">Tests</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/twig">Twig</a></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></ul><ul class="nav-list"><li class="nav-list-item external"> <a class="nav-list-link external" href="https://github.com/selwynpolit/d9book/fork"> Fork me on GitHub <svg aria-labelledby="svg-external-link-title" viewbox="0 0 24 24"><use xlink:href="#svg-external-link"></use></svg> </a></li></ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer></div><div class="main" id="top"><div class="main-header" id="main-header"><div class="search"><div class="search-input-wrap"> <input aria-label="Search Drupal Book" autocomplete="off" class="search-input" id="search-input" placeholder="Search Drupal Book" tabindex="0" type="text"/> <label class="search-label" for="search-input"><svg class="search-icon" viewbox="0 0 24 24"><use xlink:href="#svg-search"></use></svg></label></div><div class="search-results" id="search-results"></div></div><nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a class="site-button" href="https://twitter.com/selwynpolit" rel="noopener noreferrer" target="_blank"> <img alt="Twitter logo" src="https://atuin.ru/demo/simple-icons/icons/twitter.svg" style="width: 30px; height: 30px;" title="Author in Twitter"/> </a><li class="aux-nav-list-item"> <a class="site-button" href="https://github.com/selwynpolit/d9book/tree/gh-pages" rel="noopener noreferrer" target="_blank"> <img alt="GitHub logo" src="https://atuin.ru/demo/simple-icons/icons/github.svg" style="width: 30px; height: 30px;" title="D9Book on GitHub"/> </a></li></li></ul></nav></div><div class="main-content-wrap" id="main-content-wrap"><div class="main-content" id="main-content" role="main"><h1 class="no_toc fw-500" id="dates-and-times"> <a aria-labelledby="dates-and-times" class="anchor-heading" href="https://selwynpolit.github.io/d9book/dates#dates-and-times"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Dates and Times</h1><h2 class="no_toc text-delta" id="table-of-contents"> <a aria-labelledby="table-of-contents" class="anchor-heading" href="https://selwynpolit.github.io/d9book/dates#table-of-contents"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Table of contents</h2><ul id="markdown-toc"><li><a href="https://selwynpolit.github.io/d9book/dates#overview" id="markdown-toc-overview">Overview</a><li><a href="https://selwynpolit.github.io/d9book/dates#retrieve-a-date-field" id="markdown-toc-retrieve-a-date-field">Retrieve a date field</a><li><a href="https://selwynpolit.github.io/d9book/dates#retrieve-date-range-field" id="markdown-toc-retrieve-date-range-field">Retrieve date range field</a><li><a href="https://selwynpolit.github.io/d9book/dates#formatting-date-range-fields" id="markdown-toc-formatting-date-range-fields">Formatting date range fields</a><li><a href="https://selwynpolit.github.io/d9book/dates#formatting-a-date-string-with-an-embedded-timezone" id="markdown-toc-formatting-a-date-string-with-an-embedded-timezone">Formatting a date string with an embedded timezone</a><li><a href="https://selwynpolit.github.io/d9book/dates#formatting-a-date-range-for-display" id="markdown-toc-formatting-a-date-range-for-display">Formatting a date range for display</a><li><a href="https://selwynpolit.github.io/d9book/dates#saving-date-fields" id="markdown-toc-saving-date-fields">Saving date fields</a><li><a href="https://selwynpolit.github.io/d9book/dates#create-drupaldatetime-objects" id="markdown-toc-create-drupaldatetime-objects">Create DrupalDateTime objects</a><ul><li><a href="https://selwynpolit.github.io/d9book/dates#create-drupaldatetime-objects-with-timezones" id="markdown-toc-create-drupaldatetime-objects-with-timezones">Create DrupalDateTime objects with timezones</a></li></ul><li><a href="https://selwynpolit.github.io/d9book/dates#create-a-drupaldatetime-object-and-display-as-a-year-only" id="markdown-toc-create-a-drupaldatetime-object-and-display-as-a-year-only">Create a DrupalDateTime object and display as a year only</a><li><a href="https://selwynpolit.github.io/d9book/dates#formatting-node-created-time-with-drupal-dateformatter-service" id="markdown-toc-formatting-node-created-time-with-drupal-dateformatter-service">Formatting node created time with Drupal date.formatter service</a><li><a href="https://selwynpolit.github.io/d9book/dates#date-arithmetic-example-1" id="markdown-toc-date-arithmetic-example-1">Date arithmetic example 1</a><li><a href="https://selwynpolit.github.io/d9book/dates#date-arithmetic-example-2" id="markdown-toc-date-arithmetic-example-2">Date arithmetic example 2</a><li><a href="https://selwynpolit.github.io/d9book/dates#comparing-drupaldatetime-values" id="markdown-toc-comparing-drupaldatetime-values">Comparing DrupalDateTime values</a><li><a href="https://selwynpolit.github.io/d9book/dates#comparing-dates-without-comparing-times" id="markdown-toc-comparing-dates-without-comparing-times">Comparing dates (without comparing times)</a><li><a href="https://selwynpolit.github.io/d9book/dates#comparing-dates-to-see-if-a-node-has-expired" id="markdown-toc-comparing-dates-to-see-if-a-node-has-expired">Comparing Dates to see if a node has expired</a><li><a href="https://selwynpolit.github.io/d9book/dates#node-creation-and-changed-dates" id="markdown-toc-node-creation-and-changed-dates">Node creation and changed dates</a><li><a href="https://selwynpolit.github.io/d9book/dates#query-the-creation-date-using-entityquery" id="markdown-toc-query-the-creation-date-using-entityquery">Query the creation date using entityQuery</a><li><a href="https://selwynpolit.github.io/d9book/dates#query-a-date-field-with-no-time" id="markdown-toc-query-a-date-field-with-no-time">Query a date field with no time</a><li><a href="https://selwynpolit.github.io/d9book/dates#query-a-date-field-with-a-time" id="markdown-toc-query-a-date-field-with-a-time">Query a date field with a time</a><li><a href="https://selwynpolit.github.io/d9book/dates#smart-date" id="markdown-toc-smart-date">Smart Date</a><ul><li><a href="https://selwynpolit.github.io/d9book/dates#smart-date-load-and-format" id="markdown-toc-smart-date-load-and-format">Smart date: Load and format</a><li><a href="https://selwynpolit.github.io/d9book/dates#smart-date-all-day" id="markdown-toc-smart-date-all-day">Smart date: all-day</a><li><a href="https://selwynpolit.github.io/d9book/dates#smart-date-range-of-values" id="markdown-toc-smart-date-range-of-values">Smart date: Range of values</a></li></li></li></ul><li><a href="https://selwynpolit.github.io/d9book/dates#reference" id="markdown-toc-reference">Reference</a><ul><li><a href="https://selwynpolit.github.io/d9book/dates#date-field-storage" id="markdown-toc-date-field-storage">Date field storage</a><li><a href="https://selwynpolit.github.io/d9book/dates#drupaldatetime-api-reference" id="markdown-toc-drupaldatetime-api-reference">DrupalDateTime API reference</a><li><a href="https://selwynpolit.github.io/d9book/dates#utc" id="markdown-toc-utc">UTC</a><li><a href="https://selwynpolit.github.io/d9book/dates#unix-epoch-timestamps" id="markdown-toc-unix-epoch-timestamps">Unix epoch timestamps</a><li><a href="https://selwynpolit.github.io/d9book/dates#links" id="markdown-toc-links">Links</a></li></li></li></li></li></ul></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></ul><p><img alt="views" src="https://api.visitor.plantree.me/visitor-badge/pv?label=views&amp;color=informational&amp;namespace=d9book&amp;key=dates.md"/></p><hr/><h2 id="overview"> <a aria-labelledby="overview" class="anchor-heading" href="https://selwynpolit.github.io/d9book/dates#overview"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Overview</h2><p>Drupal Date fields are stored as varchar 20 UTC date strings (e.g. <code class="language-plaintext highlighter-rouge">2022-06-30T12:00:00</code>) while node <code class="language-plaintext highlighter-rouge">created</code> and <code class="language-plaintext highlighter-rouge">changed</code> fields are stored as int 11 containing Unix epoch timestamps (e.g. <code class="language-plaintext highlighter-rouge">1656379475</code>) in the <code class="language-plaintext highlighter-rouge">node_field_data table</code> (fields: <code class="language-plaintext highlighter-rouge">created</code> and <code class="language-plaintext highlighter-rouge">changed</code>).</p><p>Accessing date fields comes in many flavors:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Returns 2021-12-27 for a date only field.</span>
<span class="nv">$event_date</span> <span class="o">=</span> <span class="nv">$event_node</span><span class="o">-&gt;</span><span class="n">field_event_date</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>

<span class="c1">// Returns 2021-12-28T16:00:00 for a date field with time.</span>
<span class="nv">$event_datetime</span> <span class="o">=</span> <span class="nv">$event_node</span><span class="o">-&gt;</span><span class="n">field_event_datetime</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>

<span class="c1">// Return a Unix epoch timestamp.</span>
<span class="nv">$timestamp</span> <span class="o">=</span> <span class="nv">$event_node</span><span class="o">-&gt;</span><span class="n">field_date</span><span class="o">-&gt;</span><span class="n">date</span><span class="o">-&gt;</span><span class="nf">getTimestamp</span><span class="p">();</span>

<span class="c1">// Return a formatted date string.</span>
<span class="nv">$date_formatted</span> <span class="o">=</span> <span class="nv">$event_node</span><span class="o">-&gt;</span><span class="n">field_date</span><span class="o">-&gt;</span><span class="n">date</span><span class="o">-&gt;</span><span class="nf">format</span><span class="p">(</span><span class="s1">'Y-m-d H:i:s'</span><span class="p">);</span>
</code></pre></div></div><p>Using <code class="language-plaintext highlighter-rouge">$node-&gt;field_mydatefield-&gt;date</code> is ideal as it returns a <code class="language-plaintext highlighter-rouge">DrupalDateTime</code> class which gives you all sorts of goodness including date math capabilities and formatting.</p><p>If you need to do calculations involving Unix timestamps, then using <code class="language-plaintext highlighter-rouge">$node-&gt;field_mydatefield-&gt;getTimestamp()</code> is useful although <code class="language-plaintext highlighter-rouge">DrupalDateTime</code> is probably better. More about DrupalDateTime at <a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Datetime%21DrupalDateTime.php/class/DrupalDateTime/9.4.x">https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Datetime%21DrupalDateTime.php/class/DrupalDateTime/9.4.x</a>. Also at <a href="https://drupal.stackexchange.com/questions/252333/how-to-get-formatted-date-string-from-a-datetimeitem-object">https://drupal.stackexchange.com/questions/252333/how-to-get-formatted-date-string-from-a-datetimeitem-object</a></p><p>See <a href="https://selwynpolit.github.io/d9book/book/nodes_n_fields.html#date-fields">Nodes and Fields chapter Date fields section </a> for more on date fields</p><h2 id="retrieve-a-date-field"> <a aria-labelledby="retrieve-a-date-field" class="anchor-heading" href="https://selwynpolit.github.io/d9book/dates#retrieve-a-date-field"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Retrieve a date field</h2><p>You can retrieve date fields a few different ways. They are stored as varchar 20 UTC date strings e.g. <code class="language-plaintext highlighter-rouge">2022-06-30T12:00:00</code></p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// For a date only field, this returns a string like: 2024-08-31.</span>
<span class="c1">// For a date field with time, this returns: 2021-12-28T16:00:00.</span>
<span class="nv">$end_date</span> <span class="o">=</span> <span class="nv">$contract_node</span><span class="o">-&gt;</span><span class="n">field_contract_date</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>

<span class="c1">// Returns unix timestamp e.g. 1725105600</span>
<span class="nv">$end_date</span> <span class="o">=</span> <span class="nv">$contract_node</span><span class="o">-&gt;</span><span class="n">field_contract_date</span><span class="o">-&gt;</span><span class="n">date</span><span class="o">-&gt;</span><span class="nf">getTimestamp</span><span class="p">();</span>

<span class="c1">// Returns a DrupalDateTime object with all its goodness which you can format.</span>
 <span class="nv">$end_date</span> <span class="o">=</span> <span class="nv">$contract_node</span><span class="o">-&gt;</span><span class="n">field_contract_date</span><span class="o">-&gt;</span><span class="n">date</span><span class="p">;</span>
 <span class="nv">$formatted_date</span> <span class="o">=</span> <span class="nv">$end_date</span><span class="o">-&gt;</span><span class="nf">format</span><span class="p">(</span><span class="s1">'m/d/y'</span><span class="p">);</span>
</code></pre></div></div><h2 id="retrieve-date-range-field"> <a aria-labelledby="retrieve-date-range-field" class="anchor-heading" href="https://selwynpolit.github.io/d9book/dates#retrieve-date-range-field"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Retrieve date range field</h2><p>To retrieve a date range field from a node, use <code class="language-plaintext highlighter-rouge">value</code> and <code class="language-plaintext highlighter-rouge">end_value</code> for the stand and end dates:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Magic getters.</span>
<span class="nv">$start</span> <span class="o">=</span> <span class="nv">$event_node</span><span class="o">-&gt;</span><span class="n">field_event_date_range</span><span class="o">-&gt;</span><span class="n">value</span>
<span class="nv">$end</span> <span class="o">=</span> <span class="nv">$event_node</span><span class="o">-&gt;</span><span class="n">field_event_date_range</span><span class="o">-&gt;</span><span class="n">end_value</span>

<span class="c1">// Using get().</span>
<span class="nv">$start</span> <span class="o">=</span> <span class="nv">$event_node</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'field_event_date_range'</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">value</span>
<span class="nv">$end</span> <span class="o">=</span> <span class="nv">$event_node</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'field_event_date_range'</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">end_value</span>
  
<span class="c1">// Using getValue().</span>
<span class="nv">$start</span> <span class="o">=</span> <span class="nv">$event_node</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'field_event_date_range'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">getValue</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'value'</span><span class="p">];</span>
<span class="nv">$end</span> <span class="o">=</span> <span class="nv">$event_node</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'field_event_date_range'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">getValue</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'end_value'</span><span class="p">];</span>
</code></pre></div></div><h2 id="formatting-date-range-fields"> <a aria-labelledby="formatting-date-range-fields" class="anchor-heading" href="https://selwynpolit.github.io/d9book/dates#formatting-date-range-fields"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Formatting date range fields</h2><p>Here are two different examples for formatting date fields:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// formatted start date</span>
<span class="nv">$start_date_formatted</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="n">field_date</span><span class="o">-&gt;</span><span class="n">start_date</span><span class="o">-&gt;</span><span class="nf">format</span><span class="p">(</span><span class="s1">'Y-m-d H:i:s'</span><span class="p">);</span>
<span class="c1">// formatted end date</span>
<span class="nv">$end_date_formatted</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="n">field_date</span><span class="o">-&gt;</span><span class="n">end_date</span><span class="o">-&gt;</span><span class="nf">format</span><span class="p">(</span><span class="s1">'Y-m-d H:i:s'</span><span class="p">);</span>
</code></pre></div></div><p>Use this link at php.net for date format strings <a href="https://www.php.net/manual/en/datetime.format.php#:~:text=format%20parameter%20string-,format,-character">https://www.php.net/manual/en/datetime.format.php#:~:text=format%20parameter%20string-,format,-character</a></p><h2 id="formatting-a-date-string-with-an-embedded-timezone"> <a aria-labelledby="formatting-a-date-string-with-an-embedded-timezone" class="anchor-heading" href="https://selwynpolit.github.io/d9book/dates#formatting-a-date-string-with-an-embedded-timezone"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Formatting a date string with an embedded timezone</h2><p>Here a date string with an embedded timezone is used to create a <code class="language-plaintext highlighter-rouge">DrupalDateTime</code> object which is then converted to be stored into a node.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">Drupal\Core\Datetime\DrupalDateTime</span><span class="p">;</span>

<span class="nv">$date_string</span> <span class="o">=</span> <span class="s2">"2020-08-24T15:28:04+00:00"</span><span class="p">;</span>
<span class="nv">$ddt</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DrupalDateTime</span><span class="p">(</span><span class="nv">$date_string</span><span class="p">);</span>
<span class="nv">$newstring</span> <span class="o">=</span> <span class="nv">$ddt</span><span class="o">-&gt;</span><span class="nf">format</span><span class="p">(</span><span class="s2">"Y-m-d\Th:i:s"</span><span class="p">);</span>
<span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="s1">'field_date'</span><span class="p">,</span> <span class="nv">$newstring</span><span class="p">);</span>
</code></pre></div></div><h2 id="formatting-a-date-range-for-display"> <a aria-labelledby="formatting-a-date-range-for-display" class="anchor-heading" href="https://selwynpolit.github.io/d9book/dates#formatting-a-date-range-for-display"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Formatting a date range for display</h2><p>This code shows how to load a date range field from a node. It will ordinarily display like <code class="language-plaintext highlighter-rouge">3/30/2019 - 3/31/2023</code> however we want it to display like <code class="language-plaintext highlighter-rouge">Mar 30-31, 2023</code>.</p><p>First we retrieve the starting and ending value like this:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$from</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'field_date'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">getValue</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'value'</span><span class="p">];</span>
<span class="nv">$to</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'field_date'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">getValue</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'end_value'</span><span class="p">];</span>
</code></pre></div></div><p>Here is the entire function as implemented as a <code class="language-plaintext highlighter-rouge">hook_preprocess_node</code> function in a <code class="language-plaintext highlighter-rouge">.theme</code> file. We are creating a <code class="language-plaintext highlighter-rouge">scrunch_date</code> variable to be rendered via a Twig template as shown below:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">Drupal\Core\Datetime\DrupalDateTime</span><span class="p">;</span>

<span class="cd">/**
 * Implements hook_preprocess_node
 *
 * @param $variables
 */</span>
<span class="k">function</span> <span class="n">vst_preprocess_node</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$variables</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$variables</span><span class="p">[</span><span class="s1">'content'</span><span class="p">][</span><span class="s1">'field_date'</span><span class="p">]))</span> <span class="p">{</span>
    <span class="nv">$date</span> <span class="o">=</span> <span class="nv">$variables</span><span class="p">[</span><span class="s1">'content'</span><span class="p">][</span><span class="s1">'field_date'</span><span class="p">];</span>

    <span class="nv">$from</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DrupalDateTime</span><span class="p">(</span><span class="nv">$variables</span><span class="p">[</span><span class="s2">"node"</span><span class="p">]</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'field_date'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">getValue</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'value'</span><span class="p">]);</span>
    <span class="nv">$date_array</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s2">"-"</span><span class="p">,</span> <span class="nv">$from</span><span class="p">);</span>
    <span class="nv">$from_day</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$date_array</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
    <span class="nv">$from_month</span> <span class="o">=</span> <span class="nv">$date_array</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

    <span class="nv">$to</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DrupalDateTime</span><span class="p">(</span><span class="nv">$variables</span><span class="p">[</span><span class="s2">"node"</span><span class="p">]</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'field_date'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">getValue</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'end_value'</span><span class="p">]);</span>
    <span class="nv">$date_array</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s2">"-"</span><span class="p">,</span> <span class="nv">$to</span><span class="p">);</span>
    <span class="nv">$to_day</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$date_array</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
    <span class="nv">$to_month</span> <span class="o">=</span> <span class="nv">$date_array</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$from_month</span> <span class="o">===</span> <span class="nv">$to_month</span> <span class="o">&amp;&amp;</span> <span class="nv">$from_day</span> <span class="o">!=</span> <span class="nv">$to_day</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$variables</span><span class="p">[</span><span class="s1">'scrunch_date'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'markup'</span><span class="p">,</span>
        <span class="s1">'#markup'</span> <span class="o">=&gt;</span> <span class="nv">$from</span><span class="o">-&gt;</span><span class="nf">format</span><span class="p">(</span><span class="s2">"M j-"</span><span class="p">)</span> <span class="mf">.</span> <span class="nv">$to</span><span class="o">-&gt;</span><span class="nf">format</span><span class="p">(</span><span class="s2">"j, Y"</span><span class="p">),</span>
      <span class="p">];</span>
    <span class="p">}</span>

  <span class="p">}</span>
<span class="c1">//  For debugging</span>
<span class="c1">// kint($variables);</span>
<span class="c1">// or </span>
<span class="c1">// kpm($variables);</span>
<span class="p">}</span>
</code></pre></div></div><p>Now in the twig node template we can output the <code class="language-plaintext highlighter-rouge">scrunch_date</code> we created.</p><p>From <code class="language-plaintext highlighter-rouge">/web/themes/verygood/templates/node/node--seminar--teaser.html.twig</code>.</p><div class="language-twig highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="cp">{%</span>  <span class="k">if</span> <span class="nv">content.field_date</span> <span class="cp">%}</span>
  <span class="cp">{%</span> <span class="k">if</span> <span class="nv">scrunch_date</span> <span class="cp">%}</span>
    <span class="nt">&lt;div&gt;</span>
      <span class="cp">{{</span> <span class="nv">scrunch_date</span> <span class="cp">}}</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
    <span class="nt">&lt;div&gt;</span>
      <span class="cp">{{</span> <span class="nv">content.field_date</span> <span class="cp">}}</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>

</code></pre></div></div><h2 id="saving-date-fields"> <a aria-labelledby="saving-date-fields" class="anchor-heading" href="https://selwynpolit.github.io/d9book/dates#saving-date-fields"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Saving date fields</h2><p>Date fields in Drupal are stored as UTC date strings (e.g. <code class="language-plaintext highlighter-rouge">2022-06-30T12:00:00</code>) and when you use <code class="language-plaintext highlighter-rouge">get()</code> or <code class="language-plaintext highlighter-rouge">set()</code>, they return strings. If you want to manipulate them, convert them to DrupalDateTime objects, then convert them back to strings for saving.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="s1">'field_date'</span><span class="p">,</span> <span class="s1">'2025-12-31'</span><span class="p">);</span>
<span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="s1">'field_datetime'</span><span class="p">,</span> <span class="s1">'2025-12-31T23:59:59'</span><span class="p">);</span>
<span class="c1">// Use this for storing created and changed.</span>
<span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="s1">'created'</span><span class="p">,</span> <span class="s1">'1760140799'</span><span class="p">);</span>
<span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">save</span><span class="p">();</span>
</code></pre></div></div><h2 id="create-drupaldatetime-objects"> <a aria-labelledby="create-drupaldatetime-objects" class="anchor-heading" href="https://selwynpolit.github.io/d9book/dates#create-drupaldatetime-objects"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Create DrupalDateTime objects</h2><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">Drupal\Core\Datetime\DrupalDateTime</span><span class="p">;</span>

<span class="nv">$date</span> <span class="o">=</span> <span class="nc">DrupalDateTime</span><span class="o">::</span><span class="nf">createFromFormat</span><span class="p">(</span><span class="s1">'j-M-Y'</span><span class="p">,</span> <span class="s1">'20-Jul-2022'</span><span class="p">);</span>

<span class="c1">// Use current date and time </span>
<span class="nv">$date</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DrupalDateTime</span><span class="p">(</span><span class="s1">'now'</span><span class="p">);</span>  
<span class="c1">// Format like Tue, Jul 16, 2022 - 11:34:am</span>
<span class="k">print</span> <span class="nv">$date</span><span class="o">-&gt;</span><span class="nf">format</span><span class="p">(</span><span class="s1">'l, F j, Y - H:i'</span><span class="p">);</span> 
<span class="c1">// OR</span>
<span class="c1">// Format like 16-07-2022: 11:43 AM</span>
<span class="k">print</span> <span class="nv">$date</span><span class="o">-&gt;</span><span class="nf">format</span><span class="p">(</span><span class="s1">'d-m-Y: H:i A'</span><span class="p">);</span>
</code></pre></div></div><h3 id="create-drupaldatetime-objects-with-timezones"> <a aria-labelledby="create-drupaldatetime-objects-with-timezones" class="anchor-heading" href="https://selwynpolit.github.io/d9book/dates#create-drupaldatetime-objects-with-timezones"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Create DrupalDateTime objects with timezones</h3><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Use current date &amp; time.</span>
<span class="nv">$date</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DrupalDateTime</span><span class="p">();</span>
<span class="nv">$date</span><span class="o">-&gt;</span><span class="nf">setTimezone</span><span class="p">(</span><span class="k">new</span> <span class="nc">\DateTimeZone</span><span class="p">(</span><span class="s1">'America/Chicago'</span><span class="p">));</span>
<span class="c1">// Print current time for the given time zone e.g. 01/23/2023 10:00 pm</span>
<span class="k">print</span> <span class="nv">$date</span><span class="o">-&gt;</span><span class="nf">format</span><span class="p">(</span><span class="s1">'m/d/Y g:i a'</span><span class="p">);</span>

<span class="c1">// Another variation using specific date and UTC zone</span>
<span class="nv">$date</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DrupalDateTime</span><span class="p">(</span><span class="s1">'2019-07-31 11:30:00'</span><span class="p">,</span> <span class="s1">'UTC'</span><span class="p">);</span>
<span class="nv">$date</span><span class="o">-&gt;</span><span class="nf">setTimezone</span><span class="p">(</span><span class="k">new</span> <span class="nc">\DateTimeZone</span><span class="p">(</span><span class="s1">'America/Chicago'</span><span class="p">));</span>
<span class="c1">// prints 07/31/2019 6:30 am</span>
<span class="k">print</span> <span class="nv">$date</span><span class="o">-&gt;</span><span class="nf">format</span><span class="p">(</span><span class="s1">'m/d/Y g:i a'</span><span class="p">);</span>
</code></pre></div></div><p>UTC: <a href="https://en.wikipedia.org/wiki/Coordinated_Universal_Time">https://en.wikipedia.org/wiki/Coordinated_Universal_Time</a></p><p>Nice article on writing date fields programmatically with more info on UTC timezone at <a href="https://gorannikolovski.com/blog/set-date-field-programmatically#:~:text=Get%20the%20date%20field%20programmatically,)%3B%20%2F%2F%20For%20datetime%20fields">https://gorannikolovski.com/blog/set-date-field-programmatically#:~:text=Get%20the%20date%20field%20programmatically,)%3B%20%2F%2F%20For%20datetime%20fields</a>.</p><h2 id="create-a-drupaldatetime-object-and-display-as-a-year-only"> <a aria-labelledby="create-a-drupaldatetime-object-and-display-as-a-year-only" class="anchor-heading" href="https://selwynpolit.github.io/d9book/dates#create-a-drupaldatetime-object-and-display-as-a-year-only"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Create a DrupalDateTime object and display as a year only</h2><p>This code creates a <code class="language-plaintext highlighter-rouge">Drupal\Core\Datetime\DrupalDateTime</code> object and returns the year in a render array with some markup. <code class="language-plaintext highlighter-rouge">DrupalDateTimes</code> are derived from <code class="language-plaintext highlighter-rouge">DateTimePlus</code> which is a wrapper for PHP <code class="language-plaintext highlighter-rouge">DateTime</code> class.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">Drupal\Core\Datetime\DrupalDateTime</span><span class="p">;</span>

<span class="k">public</span> <span class="k">function</span> <span class="n">build</span><span class="p">()</span> <span class="p">{</span>
  <span class="nv">$date</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DrupalDateTime</span><span class="p">();</span>
  <span class="k">return</span> <span class="p">[</span>
    <span class="s1">'#markup'</span> <span class="o">=&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'Copyright @year&amp;copy; My Company'</span><span class="p">,</span> <span class="p">[</span>
      <span class="s1">'@year'</span> <span class="o">=&gt;</span> <span class="nv">$date</span><span class="o">-&gt;</span><span class="nf">format</span><span class="p">(</span><span class="s1">'Y'</span><span class="p">),</span>
    <span class="p">]),</span> <span class="p">];</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="formatting-node-created-time-with-drupal-dateformatter-service"> <a aria-labelledby="formatting-node-created-time-with-drupal-dateformatter-service" class="anchor-heading" href="https://selwynpolit.github.io/d9book/dates#formatting-node-created-time-with-drupal-dateformatter-service"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Formatting node created time with Drupal date.formatter service</h2><p>If you want to use a custom date format for your created node date/time you can use one of the methods shown below:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$created_date</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">getCreatedTime</span><span class="p">();</span>

<span class="c1">// Displays 05/04/2022 3:49 pm</span>
<span class="nv">$formatted_created_date</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">service</span><span class="p">(</span><span class="s1">'date.formatter'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">format</span><span class="p">(</span><span class="nv">$created_date</span><span class="p">,</span> <span class="s1">'custom'</span><span class="p">,</span> <span class="s1">'m/d/Y g:i a'</span><span class="p">);</span>

<span class="c1">// Displays 2022-05-04 15:49:30</span>
<span class="nv">$formatted_created_date</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">service</span><span class="p">(</span><span class="s1">'date.formatter'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">format</span><span class="p">(</span><span class="nv">$created_date</span><span class="p">,</span> <span class="s1">'custom'</span><span class="p">,</span> <span class="s1">'Y-m-d H:i:s'</span><span class="p">);</span>

<span class="c1">// Displays Wed, 05/04/2022 - 15:49</span>
<span class="nv">$formatted_created_date</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">service</span><span class="p">(</span><span class="s1">'date.formatter'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">format</span><span class="p">(</span><span class="nv">$created_date</span><span class="p">);</span>


<span class="c1">// Create a DrupalDateTime object and use -&gt;format()</span>
<span class="nv">$created_date</span> <span class="o">=</span> <span class="nv">$event_node</span><span class="o">-&gt;</span><span class="nf">getCreatedTime</span><span class="p">();</span>
<span class="nv">$cdt</span> <span class="o">=</span> <span class="nc">DrupalDateTime</span><span class="o">::</span><span class="nf">createFromTimestamp</span><span class="p">(</span><span class="nv">$created_date</span><span class="p">);</span>
<span class="nv">$formatted_created_date</span> <span class="o">=</span> <span class="nv">$cdt</span><span class="o">-&gt;</span><span class="nf">format</span><span class="p">(</span><span class="s1">'m/d/Y g:i a'</span><span class="p">);</span>
</code></pre></div></div><p>See PHP Date format strings: <a href="https://www.php.net/manual/en/datetime.format.php#:~:text=format%20parameter%20string-,format,-character">https://www.php.net/manual/en/datetime.format.php#:~:text=format%20parameter%20string-,format,-character</a></p><h2 id="date-arithmetic-example-1"> <a aria-labelledby="date-arithmetic-example-1" class="anchor-heading" href="https://selwynpolit.github.io/d9book/dates#date-arithmetic-example-1"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Date arithmetic example 1</h2><p>The code below shows how to add <code class="language-plaintext highlighter-rouge">$days</code> (an integer) to the date value retrieved from the field: <code class="language-plaintext highlighter-rouge">field_cn_start_date</code> and save that to the field <code class="language-plaintext highlighter-rouge">field_cn_end_date</code>.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">Drupal\Core\Datetime\DrupalDateTime</span><span class="p">;</span>

<span class="nv">$start_date_val</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'field_cn_start_date'</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
<span class="nv">$days</span> <span class="o">=</span> <span class="nb">intval</span><span class="p">(</span><span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'field_cn_suspension_length'</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
<span class="nv">$end_date</span> <span class="o">=</span> <span class="nc">DrupalDateTime</span><span class="o">::</span><span class="nf">createFromFormat</span><span class="p">(</span><span class="s1">'Y-m-d'</span><span class="p">,</span> <span class="nv">$start_date_val</span> <span class="p">);</span>
<span class="nv">$end_date</span><span class="o">-&gt;</span><span class="nf">modify</span><span class="p">(</span><span class="s2">"+</span><span class="nv">$days</span><span class="s2"> days"</span><span class="p">);</span>
<span class="nv">$end_date</span> <span class="o">=</span> <span class="nv">$end_date</span><span class="o">-&gt;</span><span class="nf">format</span><span class="p">(</span><span class="s2">"Y-m-d"</span><span class="p">);</span>

<span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="s1">'field_cn_end_date'</span><span class="p">,</span> <span class="nv">$end_date</span><span class="p">);</span>
<span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">save</span><span class="p">();</span>
</code></pre></div></div><h2 id="date-arithmetic-example-2"> <a aria-labelledby="date-arithmetic-example-2" class="anchor-heading" href="https://selwynpolit.github.io/d9book/dates#date-arithmetic-example-2"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Date arithmetic example 2</h2><p>Here is an example from a module showing a <code class="language-plaintext highlighter-rouge">hook_entity_type_presave()</code> where some data is changed as the node is being saved. The date arithmetic is pretty simple but the rest of the code is kinda messy.</p><p>This is the date arithmetic part:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$end_date</span> <span class="o">=</span> <span class="nc">DrupalDateTime</span><span class="o">::</span><span class="nf">createFromFormat</span><span class="p">(</span><span class="s1">'Y-m-d'</span><span class="p">,</span> <span class="nv">$start_date_val</span><span class="p">);</span>
<span class="nv">$end_date</span><span class="o">-&gt;</span><span class="nf">modify</span><span class="p">(</span><span class="s2">"+</span><span class="nv">$days</span><span class="s2"> days"</span><span class="p">);</span>
<span class="nv">$end_date</span> <span class="o">=</span> <span class="nv">$end_date</span><span class="o">-&gt;</span><span class="nf">format</span><span class="p">(</span><span class="s2">"Y-m-d"</span><span class="p">);</span>
<span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="s1">'field_cn_end_date'</span><span class="p">,</span> <span class="nv">$end_date</span><span class="p">);</span>
</code></pre></div></div><p>The rest of this code does some convoluted wrangling to figure out end dates based on user permissions, changes a node title, looks to see if this is an extension of a previously submitted notice and grabs some date fields from the original notice for use those in the current node.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cd">/**
 * Implements hook_ENTITY_TYPE_presave().
 */</span>
<span class="k">function</span> <span class="n">ogg_mods_node_presave</span><span class="p">(</span><span class="kt">NodeInterface</span> <span class="nv">$node</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nv">$node</span><span class="o">-&gt;</span><span class="nb">getType</span><span class="p">())</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s1">'cat_notice'</span><span class="o">:</span>
      <span class="nv">$end_date</span> <span class="o">=</span> <span class="kc">NULL</span> <span class="o">!=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'field_cn_start_end_dates'</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">end_value</span> <span class="o">?</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'field_cn_start_end_dates'</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">end_value</span> <span class="o">:</span> <span class="s1">'n/a'</span><span class="p">;</span>
      <span class="nv">$govt_body</span> <span class="o">=</span> <span class="kc">NULL</span> <span class="o">!=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="n">field_cn_governmental_body</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">?</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="n">field_cn_governmental_body</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">:</span> <span class="s1">'Unnamed Government Body'</span><span class="p">;</span>
      <span class="nv">$start_date_val</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'field_cn_start_date'</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>

      <span class="nv">$accountProxy</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">currentUser</span><span class="p">();</span>
      <span class="nv">$account</span> <span class="o">=</span> <span class="nv">$accountProxy</span><span class="o">-&gt;</span><span class="nf">getAccount</span><span class="p">();</span>
      <span class="c1">// Anonymous users automatically fill out the end_date.</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$account</span><span class="o">-&gt;</span><span class="nf">hasPermission</span><span class="p">(</span><span class="s1">'administer cat notice'</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">$days</span> <span class="o">=</span> <span class="nb">intval</span><span class="p">(</span><span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'field_cn_suspension_length'</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>

        <span class="nv">$end_date</span> <span class="o">=</span> <span class="nc">DrupalDateTime</span><span class="o">::</span><span class="nf">createFromFormat</span><span class="p">(</span><span class="s1">'Y-m-d'</span><span class="p">,</span> <span class="nv">$start_date_val</span><span class="p">);</span>
        <span class="nv">$end_date</span><span class="o">-&gt;</span><span class="nf">modify</span><span class="p">(</span><span class="s2">"+</span><span class="nv">$days</span><span class="s2"> days"</span><span class="p">);</span>
        <span class="nv">$end_date</span> <span class="o">=</span> <span class="nv">$end_date</span><span class="o">-&gt;</span><span class="nf">format</span><span class="p">(</span><span class="s2">"Y-m-d"</span><span class="p">);</span>
        <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="s1">'field_cn_end_date'</span><span class="p">,</span> <span class="nv">$end_date</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="c1">// Always reset the title.</span>
      <span class="nv">$title</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$govt_body</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span> <span class="mf">.</span> <span class="s2">" - </span><span class="nv">$start_date_val</span><span class="s2">"</span><span class="p">;</span>
      <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">setTitle</span><span class="p">(</span><span class="nv">$title</span><span class="p">);</span>

      <span class="cm">/*
       *  Fill in Initial start and end dates if this is an extension of
       * a previously submitted notice.
       */</span>
      <span class="nv">$extension</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'field_cn_extension'</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nv">$extension</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$previous_notice_nid</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'field_cn_original_notice'</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">target_id</span><span class="p">;</span>
        <span class="nv">$previous_notice</span> <span class="o">=</span> <span class="nc">Node</span><span class="o">::</span><span class="nf">load</span><span class="p">(</span><span class="nv">$previous_notice_nid</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$previous_notice</span><span class="p">)</span> <span class="p">{</span>
          <span class="nv">$initial_start</span> <span class="o">=</span> <span class="nv">$previous_notice</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'field_cn_start_date'</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
          <span class="nv">$initial_end</span> <span class="o">=</span> <span class="nv">$previous_notice</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'field_cn_end_date'</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
          <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="s1">'field_cn_initial_start_date'</span><span class="p">,</span> <span class="nv">$initial_start</span><span class="p">);</span>
          <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="s1">'field_cn_initial_end_date'</span><span class="p">,</span> <span class="nv">$initial_end</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="comparing-drupaldatetime-values"> <a aria-labelledby="comparing-drupaldatetime-values" class="anchor-heading" href="https://selwynpolit.github.io/d9book/dates#comparing-drupaldatetime-values"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Comparing DrupalDateTime values</h2><p>The <code class="language-plaintext highlighter-rouge">DrupalDateTime</code> class extends the <code class="language-plaintext highlighter-rouge">DateTimePlus</code> class which is a wrapper for PHP <code class="language-plaintext highlighter-rouge">DateTime</code> class. That functionality allows you to do comparisons. It is probably better manners to use <code class="language-plaintext highlighter-rouge">DrupalDateTime</code> instead of <code class="language-plaintext highlighter-rouge">DateTime</code> but here is some <code class="language-plaintext highlighter-rouge">DateTime</code> code showing how to compare <code class="language-plaintext highlighter-rouge">DateTimes</code>.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">date_default_timezone_set</span><span class="p">(</span><span class="s1">'Europe/London'</span><span class="p">);</span>

<span class="nv">$d1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DateTime</span><span class="p">(</span><span class="s1">'2008-08-03 14:52:10'</span><span class="p">);</span>
<span class="nv">$d2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DateTime</span><span class="p">(</span><span class="s1">'2008-01-03 11:11:10'</span><span class="p">);</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$d1</span> <span class="o">==</span> <span class="nv">$d2</span><span class="p">);</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$d1</span> <span class="o">&gt;</span> <span class="nv">$d2</span><span class="p">);</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$d1</span> <span class="o">&lt;</span> <span class="nv">$d2</span><span class="p">);</span>

<span class="c1">// Returns.</span>
<span class="nf">bool</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
<span class="nf">bool</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
<span class="nf">bool</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
</code></pre></div></div><h2 id="comparing-dates-without-comparing-times"> <a aria-labelledby="comparing-dates-without-comparing-times" class="anchor-heading" href="https://selwynpolit.github.io/d9book/dates#comparing-dates-without-comparing-times"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Comparing dates (without comparing times)</h2><p>Use the setTime() function to remove the time part of a datetime so we can make comparisons of just the date.</p><p>From a form validation in a <code class="language-plaintext highlighter-rouge">.module</code> file.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">ogg_mods_cn_form_validate</span><span class="p">(</span><span class="nv">$form</span><span class="p">,</span> <span class="kt">FormStateInterface</span> <span class="nv">$form_state</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$start_date</span> <span class="o">=</span> <span class="nv">$form_state</span><span class="o">-&gt;</span><span class="nf">getValue</span><span class="p">(</span><span class="s1">'field_cn_start_date'</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$start_date</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$start_date</span> <span class="o">=</span> <span class="nv">$start_date</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'value'</span><span class="p">];</span>
      <span class="nv">$start_date</span><span class="o">-&gt;</span><span class="nf">setTime</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
      <span class="nv">$now</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Drupal\Core\Datetime\DrupalDateTime</span><span class="p">();</span>
      <span class="c1">// Subtract 2 days.</span>
      <span class="nv">$now</span><span class="o">-&gt;</span><span class="nf">modify</span><span class="p">(</span><span class="s2">"-2 days"</span><span class="p">);</span>
      <span class="c1">// Clear the time.</span>
      <span class="nv">$now</span><span class="o">-&gt;</span><span class="nf">setTime</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

      <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">messenger</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">addMessage</span><span class="p">(</span><span class="s2">"Start date = </span><span class="nv">$start_date</span><span class="s2">"</span><span class="p">);</span>
      <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">messenger</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">addMessage</span><span class="p">(</span><span class="s2">"Now date - 2 days = </span><span class="nv">$now</span><span class="s2">"</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="nv">$start_date</span> <span class="o">&lt;</span> <span class="nv">$now</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$form_state</span><span class="o">-&gt;</span><span class="nf">setErrorByName</span><span class="p">(</span><span class="s1">'edit-field-cn-start-date-0-value-date'</span><span class="p">,</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'The starting date is more than 2 days in the past. Please select a later date'</span><span class="p">));</span>
      <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="comparing-dates-to-see-if-a-node-has-expired"> <a aria-labelledby="comparing-dates-to-see-if-a-node-has-expired" class="anchor-heading" href="https://selwynpolit.github.io/d9book/dates#comparing-dates-to-see-if-a-node-has-expired"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Comparing Dates to see if a node has expired</h2><p>This code is used to check if the value in the field <code class="language-plaintext highlighter-rouge">field_expiration_date</code> has passed. The <code class="language-plaintext highlighter-rouge">field_expiration_date</code> is a standard Drupal date field in a node. In this example, the client wanted to be able to specify the expiration date for nodes.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$source_node</span> <span class="o">=</span> <span class="nv">$node_storage</span><span class="o">-&gt;</span><span class="nf">load</span><span class="p">(</span><span class="nv">$nid</span><span class="p">);</span>
<span class="nv">$expiration_date</span> <span class="o">=</span> <span class="nv">$source_node</span><span class="o">-&gt;</span><span class="n">field_expiration_date</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>

<span class="c1">// Use expiration date to un-publish expired reseller nodes to hide them.</span>
<span class="nv">$status</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$expiration_date</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$expirationDate</span> <span class="o">=</span> <span class="nc">DrupalDateTime</span><span class="o">::</span><span class="nf">createFromFormat</span><span class="p">(</span><span class="s1">'Y-m-d'</span><span class="p">,</span> <span class="nv">$expiration_date</span><span class="p">);</span>
  <span class="nv">$now</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DrupalDateTime</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$expiration_date</span> <span class="o">&lt;</span> <span class="nv">$now</span><span class="p">)</span> <span class="p">{</span>
 		<span class="c1">// When expired, unpublish the node.</span>
    <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="s1">'status'</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">save</span><span class="p">();</span>  <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p>It might be interesting to factor in the timezone as date fields are stored in UTC. See https://en.wikipedia.org/wiki/Coordinated_Universal_Time</p><h2 id="node-creation-and-changed-dates"> <a aria-labelledby="node-creation-and-changed-dates" class="anchor-heading" href="https://selwynpolit.github.io/d9book/dates#node-creation-and-changed-dates"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Node creation and changed dates</h2><p>Here is a function which does an <code class="language-plaintext highlighter-rouge">entityQuery</code> for a node and returns a formatted string version of the creation date. Both <code class="language-plaintext highlighter-rouge">created</code> and <code class="language-plaintext highlighter-rouge">changed</code> are stored as Unix epoch timestamps in the <code class="language-plaintext highlighter-rouge">node_field_data</code> table (int 11).</p><p>Note. This will handle epoch dates before 1970. You can also use <code class="language-plaintext highlighter-rouge">$node-&gt;get('changed')</code> to retrieve the changed date.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">Drupal\Core\Datetime\DrupalDateTime</span><span class="p">;</span>

<span class="k">protected</span> <span class="k">function</span> <span class="n">loadFirstOpinionYear</span><span class="p">(</span><span class="nv">$term_id</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$storage</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityTypeManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getStorage</span><span class="p">(</span><span class="s1">'node'</span><span class="p">);</span>
  <span class="nv">$query</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityQuery</span><span class="p">(</span><span class="s1">'node'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'status'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'type'</span><span class="p">,</span> <span class="s1">'opinion'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'field_category'</span><span class="p">,</span> <span class="nv">$term_id</span><span class="p">,</span> <span class="s1">'='</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nb">sort</span><span class="p">(</span><span class="s1">'title'</span><span class="p">,</span> <span class="s1">'ASC'</span><span class="p">)</span> <span class="c1">// or DESC</span>
    <span class="o">-&gt;</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
  <span class="nv">$nids</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$nids</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$node</span> <span class="o">=</span> <span class="nv">$storage</span><span class="o">-&gt;</span><span class="nf">load</span><span class="p">(</span><span class="nb">reset</span><span class="p">(</span><span class="nv">$nids</span><span class="p">));</span>
  <span class="p">}</span>
  <span class="nv">$time</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'created'</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>

  <span class="nv">$d</span> <span class="o">=</span> <span class="nc">DrupalDateTime</span><span class="o">::</span><span class="nf">createFromTimestamp</span><span class="p">(</span><span class="nv">$time</span><span class="p">);</span>
  <span class="nv">$str</span> <span class="o">=</span> <span class="nv">$d</span><span class="o">-&gt;</span><span class="nf">format</span><span class="p">(</span><span class="s1">'Y-m-d H:i:s'</span><span class="p">);</span>
  <span class="k">return</span> <span class="nv">$str</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><p>To find any nodes that were changed in the last 7 days, use the following:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$query</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityQuery</span><span class="p">(</span><span class="s1">'node'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'field_tks_program_status'</span><span class="p">,</span> <span class="s1">'ready_for_release'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">accessCheck</span><span class="p">(</span><span class="kc">FALSE</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'type'</span><span class="p">,</span> <span class="s1">'teks_pub_program'</span><span class="p">);</span>
  <span class="c1">// Query changed date within 7 days of today.</span>
  <span class="nv">$query</span><span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'changed'</span><span class="p">,</span> <span class="nb">strtotime</span><span class="p">(</span><span class="s1">'-7 days'</span><span class="p">),</span> <span class="s1">'&gt;='</span><span class="p">);</span>

  <span class="nv">$program_nids</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>
  <span class="nv">$program_nids</span> <span class="o">=</span> <span class="nb">array_values</span><span class="p">(</span><span class="nv">$program_nids</span><span class="p">);</span>
</code></pre></div></div><h2 id="query-the-creation-date-using-entityquery"> <a aria-labelledby="query-the-creation-date-using-entityquery" class="anchor-heading" href="https://selwynpolit.github.io/d9book/dates#query-the-creation-date-using-entityquery"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Query the creation date using entityQuery</h2><p>This controller example queries for any events for year 2022 with a matching taxonomy term id of 5.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">public</span> <span class="k">function</span> <span class="n">test2</span><span class="p">()</span> <span class="p">{</span>

    <span class="nv">$str</span> <span class="o">=</span> <span class="s2">"Results"</span><span class="p">;</span>
    <span class="nv">$year</span> <span class="o">=</span> <span class="s1">'2022'</span><span class="p">;</span>
    <span class="nv">$term_id</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
    <span class="nv">$titles</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">eventsForYear</span><span class="p">(</span><span class="nv">$year</span><span class="p">,</span> <span class="nv">$term_id</span><span class="p">);</span>
    <span class="nv">$count</span> <span class="o">=</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$titles</span><span class="p">);</span>
    <span class="nv">$str</span> <span class="mf">.</span><span class="o">=</span> <span class="s2">"&lt;br/&gt;Found </span><span class="nv">$count</span><span class="s2"> titles for query </span><span class="nv">$year</span><span class="s2">, term_id </span><span class="nv">$term_id</span><span class="s2">"</span><span class="p">;</span>

    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$titles</span> <span class="k">as</span> <span class="nv">$title</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$str</span> <span class="mf">.</span><span class="o">=</span> <span class="s2">"&lt;br/&gt;</span><span class="nv">$title</span><span class="s2">"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nv">$render_array</span><span class="p">[</span><span class="s1">'content'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
      <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'item'</span><span class="p">,</span>
      <span class="s1">'#markup'</span> <span class="o">=&gt;</span> <span class="nv">$str</span><span class="p">,</span>
    <span class="p">];</span>
    <span class="k">return</span> <span class="nv">$render_array</span><span class="p">;</span>
  <span class="p">}</span>


  <span class="k">private</span> <span class="k">function</span> <span class="n">eventsForYear</span><span class="p">(</span><span class="nv">$year</span><span class="p">,</span> <span class="nv">$term_id</span><span class="p">):</span> <span class="kt">array</span> <span class="p">{</span>
    <span class="c1">// Build valid range of start dates/times.</span>
    <span class="nv">$format</span> <span class="o">=</span> <span class="s1">'Y-m-d H:i'</span><span class="p">;</span>
    <span class="nv">$start_date</span> <span class="o">=</span> <span class="nc">DrupalDateTime</span><span class="o">::</span><span class="nf">createFromFormat</span><span class="p">(</span><span class="nv">$format</span><span class="p">,</span> <span class="nv">$year</span> <span class="mf">.</span> <span class="s2">"-01-01 00:00"</span><span class="p">);</span>
    <span class="nv">$end_date</span> <span class="o">=</span> <span class="nc">DrupalDateTime</span><span class="o">::</span><span class="nf">createFromFormat</span><span class="p">(</span><span class="nv">$format</span><span class="p">,</span> <span class="nv">$year</span> <span class="mf">.</span> <span class="s2">"-12-31 23:59"</span><span class="p">);</span>

    <span class="nv">$start_date_ts</span> <span class="o">=</span> <span class="nv">$start_date</span><span class="o">-&gt;</span><span class="nf">getTimestamp</span><span class="p">();</span>
    <span class="nv">$end_date_ts</span> <span class="o">=</span> <span class="nv">$end_date</span><span class="o">-&gt;</span><span class="nf">getTimestamp</span><span class="p">();</span>

    <span class="nv">$query</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityQuery</span><span class="p">(</span><span class="s1">'node'</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'status'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'type'</span><span class="p">,</span> <span class="s1">'event'</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'field_event_category'</span><span class="p">,</span> <span class="nv">$term_id</span><span class="p">,</span> <span class="s1">'='</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'created'</span><span class="p">,</span> <span class="nv">$start_date_ts</span><span class="p">,</span> <span class="s1">'&gt;='</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'created'</span><span class="p">,</span> <span class="nv">$end_date_ts</span><span class="p">,</span> <span class="s1">'&lt;='</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="nb">sort</span><span class="p">(</span><span class="s1">'title'</span><span class="p">,</span> <span class="s1">'DESC'</span><span class="p">);</span>
    <span class="nv">$nids</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>
    <span class="nv">$titles</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$nids</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">foreach</span> <span class="p">(</span><span class="nv">$nids</span> <span class="k">as</span> <span class="nv">$nid</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$node</span> <span class="o">=</span> <span class="nc">Node</span><span class="o">::</span><span class="nf">load</span><span class="p">(</span><span class="nv">$nid</span><span class="p">);</span>
        <span class="nv">$titles</span><span class="p">[]</span><span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">getTitle</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">$titles</span><span class="p">;</span>
  <span class="p">}</span>

</code></pre></div></div><p>Read more in the article: Date (range) fields and Entity Query from February 2018 at <a href="https://blog.werk21.de/en/2018/02/05/date-range-fields-and-entity-query-update">https://blog.werk21.de/en/2018/02/05/date-range-fields-and-entity-query-update</a></p><p>and</p><p>this Stack exchange question at <a href="https://drupal.stackexchange.com/questions/198324/how-to-do-a-date-range-entityquery-with-a-date-only-field-in-drupal-8">https://drupal.stackexchange.com/questions/198324/how-to-do-a-date-range-entityquery-with-a-date-only-field-in-drupal-8</a></p><h2 id="query-a-date-field-with-no-time"> <a aria-labelledby="query-a-date-field-with-no-time" class="anchor-heading" href="https://selwynpolit.github.io/d9book/dates#query-a-date-field-with-no-time"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Query a date field with no time</h2><p>Drupal date fields can be configured to store the <code class="language-plaintext highlighter-rouge">date and time</code> or only the <code class="language-plaintext highlighter-rouge">date</code>. Looking in the database, you might notice that a date-only field is stored like: <code class="language-plaintext highlighter-rouge">2021-12-27</code> which means you can query just using a string. It probably is wiser to use DrupalDateTime like this:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">Drupal\Core\Datetime\DrupalDateTime</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Drupal\datetime\Plugin\Field\FieldType\DateTimeItemInterface</span><span class="p">;</span>

<span class="k">public</span> <span class="k">function</span> <span class="n">test4</span><span class="p">()</span> <span class="p">{</span>

  <span class="c1">// Date-only fields are stored in the database like: '2021-12-27';</span>

  <span class="c1">// Get a date string suitable for use with entity query.</span>
  <span class="nv">$date</span> <span class="o">=</span> <span class="nc">DrupalDateTime</span><span class="o">::</span><span class="nf">createFromFormat</span><span class="p">(</span><span class="s1">'j-M-Y'</span><span class="p">,</span> <span class="s1">'27-Dec-2021'</span><span class="p">);</span>
  <span class="nv">$date</span><span class="o">-&gt;</span><span class="nf">setTimezone</span><span class="p">(</span><span class="k">new</span> <span class="nc">\DateTimeZone</span><span class="p">(</span><span class="nc">DateTimeItemInterface</span><span class="o">::</span><span class="no">STORAGE_TIMEZONE</span><span class="p">));</span>
  <span class="c1">// NB. Specify the date-only storage format - not the datetime storage format!</span>
  <span class="nv">$query_date</span> <span class="o">=</span> <span class="nv">$date</span><span class="o">-&gt;</span><span class="nf">format</span><span class="p">(</span><span class="nc">DateTimeItemInterface</span><span class="o">::</span><span class="no">DATE_STORAGE_FORMAT</span><span class="p">);</span>

  <span class="c1">// Query using =.</span>
  <span class="nv">$query</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityQuery</span><span class="p">(</span><span class="s1">'node'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'type'</span><span class="p">,</span> <span class="s1">'event'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'status'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'field_event_date.value'</span><span class="p">,</span> <span class="nv">$query_date</span><span class="p">,</span> <span class="s1">'='</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nb">sort</span><span class="p">(</span><span class="s1">'title'</span><span class="p">,</span> <span class="s1">'ASC'</span><span class="p">);</span>
  <span class="nv">$nids</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>
  <span class="nv">$count</span> <span class="o">=</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$nids</span><span class="p">);</span>

  <span class="nv">$str</span> <span class="o">=</span> <span class="s2">"Results"</span><span class="p">;</span>
  <span class="nv">$str</span> <span class="mf">.</span><span class="o">=</span> <span class="s2">"&lt;br/&gt;Found </span><span class="nv">$count</span><span class="s2"> events for field_event_date = </span><span class="nv">$query_date</span><span class="s2">"</span><span class="p">;</span>
  <span class="k">foreach</span> <span class="p">(</span><span class="nv">$nids</span> <span class="k">as</span> <span class="nv">$nid</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$event_node</span> <span class="o">=</span> <span class="nc">Node</span><span class="o">::</span><span class="nf">load</span><span class="p">(</span><span class="nv">$nid</span><span class="p">);</span>
    <span class="nv">$title</span> <span class="o">=</span> <span class="nv">$event_node</span><span class="o">-&gt;</span><span class="nf">getTitle</span><span class="p">();</span>
    <span class="nv">$date</span> <span class="o">=</span> <span class="nv">$event_node</span><span class="o">-&gt;</span><span class="n">field_event_date</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
    <span class="nv">$str</span> <span class="mf">.</span><span class="o">=</span> <span class="s2">"&lt;br/&gt;</span><span class="nv">$title</span><span class="s2"> - date: </span><span class="nv">$date</span><span class="s2">"</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nv">$str</span> <span class="mf">.</span><span class="o">=</span> <span class="s2">"&lt;br/&gt;"</span><span class="p">;</span>

	<span class="c1">// Query using &gt;.</span>
  <span class="nv">$query</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityQuery</span><span class="p">(</span><span class="s1">'node'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'type'</span><span class="p">,</span> <span class="s1">'event'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'status'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'field_event_date.value'</span><span class="p">,</span> <span class="nv">$query_date</span><span class="p">,</span> <span class="s1">'&gt;'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nb">sort</span><span class="p">(</span><span class="s1">'title'</span><span class="p">,</span> <span class="s1">'ASC'</span><span class="p">);</span>
  <span class="nv">$nids</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>
  <span class="nv">$count</span> <span class="o">=</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$nids</span><span class="p">);</span>

  <span class="nv">$str</span> <span class="mf">.</span><span class="o">=</span> <span class="s2">"&lt;br/&gt;Found </span><span class="nv">$count</span><span class="s2"> events for field_event_date &gt; </span><span class="nv">$query_date</span><span class="s2">"</span><span class="p">;</span>

  <span class="k">foreach</span> <span class="p">(</span><span class="nv">$nids</span> <span class="k">as</span> <span class="nv">$nid</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$event_node</span> <span class="o">=</span> <span class="nc">Node</span><span class="o">::</span><span class="nf">load</span><span class="p">(</span><span class="nv">$nid</span><span class="p">);</span>
    <span class="nv">$title</span> <span class="o">=</span> <span class="nv">$event_node</span><span class="o">-&gt;</span><span class="nf">getTitle</span><span class="p">();</span>
    <span class="nv">$date</span> <span class="o">=</span> <span class="nv">$event_node</span><span class="o">-&gt;</span><span class="n">field_event_date</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
    <span class="nv">$str</span> <span class="mf">.</span><span class="o">=</span> <span class="s2">"&lt;br/&gt;</span><span class="nv">$title</span><span class="s2"> - date: </span><span class="nv">$date</span><span class="s2">"</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nv">$render_array</span><span class="p">[</span><span class="s1">'content'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'item'</span><span class="p">,</span>
    <span class="s1">'#markup'</span> <span class="o">=&gt;</span> <span class="nv">$str</span><span class="p">,</span>
  <span class="p">];</span>
  <span class="k">return</span> <span class="nv">$render_array</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="query-a-date-field-with-a-time"> <a aria-labelledby="query-a-date-field-with-a-time" class="anchor-heading" href="https://selwynpolit.github.io/d9book/dates#query-a-date-field-with-a-time"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Query a date field with a time</h2><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">Drupal\Core\Datetime\DrupalDateTime</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Drupal\datetime\Plugin\Field\FieldType\DateTimeItemInterface</span><span class="p">;</span>
  
	<span class="cm">/*
   * Query a date field with a time.
   */</span>
  <span class="k">public</span> <span class="k">function</span> <span class="n">test3</span><span class="p">()</span> <span class="p">{</span>

    <span class="c1">// Get a date string suitable for use with entity query.</span>
    <span class="nv">$date</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DrupalDateTime</span><span class="p">();</span>
    <span class="c1">// This is a date/time from my local timezone.</span>
    <span class="nv">$date</span> <span class="o">=</span> <span class="nc">DrupalDateTime</span><span class="o">::</span><span class="nf">createFromFormat</span><span class="p">(</span><span class="s1">'d-m-Y: H:i A'</span><span class="p">,</span> <span class="s1">'28-12-2021: 10:00 AM'</span><span class="p">);</span>
    <span class="nv">$date</span><span class="o">-&gt;</span><span class="nf">setTimezone</span><span class="p">(</span><span class="k">new</span> <span class="nc">\DateTimeZone</span><span class="p">(</span><span class="nc">DateTimeItemInterface</span><span class="o">::</span><span class="no">STORAGE_TIMEZONE</span><span class="p">));</span>
    <span class="nv">$query_date</span> <span class="o">=</span> <span class="nv">$date</span><span class="o">-&gt;</span><span class="nf">format</span><span class="p">(</span><span class="nc">DateTimeItemInterface</span><span class="o">::</span><span class="no">DATETIME_STORAGE_FORMAT</span><span class="p">);</span>

    <span class="nv">$str</span> <span class="o">=</span> <span class="s2">"Results"</span><span class="p">;</span>

    <span class="nv">$query</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityQuery</span><span class="p">(</span><span class="s1">'node'</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'type'</span><span class="p">,</span> <span class="s1">'event'</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'status'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'field_event_datetime.value'</span><span class="p">,</span> <span class="nv">$query_date</span><span class="p">,</span> <span class="s1">'='</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="nb">sort</span><span class="p">(</span><span class="s1">'title'</span><span class="p">,</span> <span class="s1">'ASC'</span><span class="p">);</span>
    <span class="nv">$nids</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>
    <span class="nv">$count</span> <span class="o">=</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$nids</span><span class="p">);</span>

    <span class="nv">$print_date</span> <span class="o">=</span> <span class="nv">$date</span><span class="o">-&gt;</span><span class="nf">format</span><span class="p">(</span><span class="s1">'d-m-Y: H:i A'</span><span class="p">);</span>
    <span class="nv">$str</span> <span class="mf">.</span><span class="o">=</span> <span class="s2">"&lt;br/&gt;&lt;strong&gt;</span><span class="nv">$count</span><span class="s2"> event(s) for field_event_datetime = </span><span class="nv">$print_date</span><span class="s2"> (UTC)&lt;/strong&gt; "</span><span class="p">;</span>
    <span class="nv">$date</span><span class="o">-&gt;</span><span class="nf">setTimezone</span><span class="p">(</span><span class="k">new</span> <span class="nc">\DateTimeZone</span><span class="p">(</span><span class="s1">'America/Chicago'</span><span class="p">));</span>
    <span class="nv">$print_date</span> <span class="o">=</span> <span class="nv">$date</span><span class="o">-&gt;</span><span class="nf">format</span><span class="p">(</span><span class="s1">'d-m-Y: H:i A'</span><span class="p">);</span>
    <span class="nv">$str</span> <span class="mf">.</span><span class="o">=</span> <span class="s2">"&lt;br/&gt;For my timezone (America/Chicago), that is </span><span class="nv">$print_date</span><span class="s2">"</span><span class="p">;</span>

    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$nids</span> <span class="k">as</span> <span class="nv">$nid</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$event_node</span> <span class="o">=</span> <span class="nc">Node</span><span class="o">::</span><span class="nf">load</span><span class="p">(</span><span class="nv">$nid</span><span class="p">);</span>
      <span class="nv">$title</span> <span class="o">=</span> <span class="nv">$event_node</span><span class="o">-&gt;</span><span class="nf">getTitle</span><span class="p">();</span>
      <span class="nv">$display_date</span> <span class="o">=</span> <span class="nv">$event_node</span><span class="o">-&gt;</span><span class="n">field_event_datetime</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
      <span class="nv">$str</span> <span class="mf">.</span><span class="o">=</span> <span class="s2">"&lt;br/&gt;</span><span class="nv">$title</span><span class="s2"> - date: </span><span class="nv">$display_date</span><span class="s2">"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nv">$str</span> <span class="mf">.</span><span class="o">=</span> <span class="s2">"&lt;br/&gt;"</span><span class="p">;</span>

    <span class="nv">$query</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityQuery</span><span class="p">(</span><span class="s1">'node'</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'type'</span><span class="p">,</span> <span class="s1">'event'</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'status'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'field_event_datetime.value'</span><span class="p">,</span> <span class="nv">$query_date</span><span class="p">,</span> <span class="s1">'&gt;'</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="nb">sort</span><span class="p">(</span><span class="s1">'title'</span><span class="p">,</span> <span class="s1">'ASC'</span><span class="p">);</span>
    <span class="nv">$nids</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>
    <span class="nv">$count</span> <span class="o">=</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$nids</span><span class="p">);</span>

    <span class="nv">$print_date</span> <span class="o">=</span> <span class="nv">$date</span><span class="o">-&gt;</span><span class="nf">format</span><span class="p">(</span><span class="s1">'d-m-Y: H:i A'</span><span class="p">);</span>
    <span class="nv">$str</span> <span class="mf">.</span><span class="o">=</span> <span class="s2">"&lt;br/&gt;&lt;strong&gt;</span><span class="nv">$count</span><span class="s2"> event(s) for field_event_datetime &gt; </span><span class="nv">$print_date</span><span class="s2"> (UTC)&lt;/strong&gt; "</span><span class="p">;</span>
    <span class="nv">$date</span><span class="o">-&gt;</span><span class="nf">setTimezone</span><span class="p">(</span><span class="k">new</span> <span class="nc">\DateTimeZone</span><span class="p">(</span><span class="s1">'America/Chicago'</span><span class="p">));</span>
    <span class="nv">$print_date</span> <span class="o">=</span> <span class="nv">$date</span><span class="o">-&gt;</span><span class="nf">format</span><span class="p">(</span><span class="s1">'d-m-Y: H:i A'</span><span class="p">);</span>
    <span class="nv">$str</span> <span class="mf">.</span><span class="o">=</span> <span class="s2">"&lt;br/&gt;For my timezone (America/Chicago), that is </span><span class="nv">$print_date</span><span class="s2">"</span><span class="p">;</span>

    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$nids</span> <span class="k">as</span> <span class="nv">$nid</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$event_node</span> <span class="o">=</span> <span class="nc">Node</span><span class="o">::</span><span class="nf">load</span><span class="p">(</span><span class="nv">$nid</span><span class="p">);</span>
      <span class="nv">$title</span> <span class="o">=</span> <span class="nv">$event_node</span><span class="o">-&gt;</span><span class="nf">getTitle</span><span class="p">();</span>
      <span class="nv">$display_date</span> <span class="o">=</span> <span class="nv">$event_node</span><span class="o">-&gt;</span><span class="n">field_event_datetime</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
      <span class="nv">$str</span> <span class="mf">.</span><span class="o">=</span> <span class="s2">"&lt;br/&gt;</span><span class="nv">$title</span><span class="s2"> - date: </span><span class="nv">$display_date</span><span class="s2">"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nv">$str</span> <span class="mf">.</span><span class="o">=</span> <span class="s2">"&lt;br/&gt;"</span><span class="p">;</span>


    <span class="nv">$render_array</span><span class="p">[</span><span class="s1">'content'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
      <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'item'</span><span class="p">,</span>
      <span class="s1">'#markup'</span> <span class="o">=&gt;</span> <span class="nv">$str</span><span class="p">,</span>
    <span class="p">];</span>
    <span class="k">return</span> <span class="nv">$render_array</span><span class="p">;</span>
  <span class="p">}</span>
</code></pre></div></div><p>More in the article: Date (range) fields and Entity Query from February 2018 at <a href="https://blog.werk21.de/en/2018/02/05/date-range-fields-and-entity-query-update">https://blog.werk21.de/en/2018/02/05/date-range-fields-and-entity-query-update</a></p><p>and</p><p>this Stack exchange question at <a href="https://drupal.stackexchange.com/questions/198324/how-to-do-a-date-range-entityquery-with-a-date-only-field-in-drupal-8">https://drupal.stackexchange.com/questions/198324/how-to-do-a-date-range-entityquery-with-a-date-only-field-in-drupal-8</a></p><h2 id="smart-date"> <a aria-labelledby="smart-date" class="anchor-heading" href="https://selwynpolit.github.io/d9book/dates#smart-date"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Smart Date</h2><p>This module provides the date field that fills in all the gaps in functionality that Drupal core dates lack. Maybe someday it will make it into Drupal core.</p><p>This module attempts to provide a more user-friendly date field, by upgrading the functionality of core in several ways:</p><p>Easy Admin UI: Includes the concept of duration, so that a field can have a configurable default duration (e.g. 1 hour) and the end time will be auto-populated based on the start. The overall goal is to provide a smart interface for time range/event data entry, more inline with calendar applications which editors will be familiar with.</p><p>All Day Events Most calendar applications provide a one-click option to make a an event, appointment, or other time-related content span a full day. This module brings that same capability to Drupal.</p><p>Zero Duration Events Show only a single time for events that dont need a duration.</p><p>Formatting: More sophisticated output formatting, for example to show the times as a range but with a single output of the date. In the settings a site builder can control how date the ranges will be output, at a very granular level.</p><p>Performance: Dates are stored as timestamps to improve performance, especially when filtering or sorting. Concerns with the performance of cores date range have been documented in <a href="https://www.drupal.org/project/drupal/issues/3048072">#3048072: Date Range field creates very slow queries in Views</a>.</p><p>Overall, the approach in this module is to leverage cores existing Datetime functionality, using the timestamp storage capability also in core, with some custom Javascript to add intelligence to the admin interface, and a suite of options to ensure dates can be formatted to suit any sites needs.</p><p>Display configuration is managed through translatable Smart Date Formats, so your detailed display setup is easily portable between fields, views, and so on. (From <a href="https://www.drupal.org/project/smart_date">https://www.drupal.org/project/smart_date</a>)</p><h3 id="smart-date-load-and-format"> <a aria-labelledby="smart-date-load-and-format" class="anchor-heading" href="https://selwynpolit.github.io/d9book/dates#smart-date-load-and-format"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Smart date: Load and format</h3><p>Load the smart date field and use the Drupal date formatting service (<code class="language-plaintext highlighter-rouge">date.formatter</code>). Smart date fields are always stored as unix timestamp values e.g. <code class="language-plaintext highlighter-rouge">1608566400</code> which need conversion for human consumption.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$start</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="n">field_when</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
<span class="nv">$formatter</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">service</span><span class="p">(</span><span class="s1">'date.formatter'</span><span class="p">);</span>

<span class="c1">//returns something like 12/21/2020 10:00 am</span>
<span class="nv">$start_time</span> <span class="o">=</span> <span class="nv">$formatter</span><span class="o">-&gt;</span><span class="nf">format</span><span class="p">(</span><span class="nv">$start</span><span class="p">,</span> <span class="s1">'custom'</span><span class="p">,</span> <span class="s1">'m/d/Y g:ia'</span><span class="p">);</span> 
</code></pre></div></div><p>Alternatively, you could load it, create a DrupalDateTime and then format it:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$start</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="n">field_when</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
<span class="nv">$dt</span> <span class="o">=</span> <span class="nc">DrupalDateTime</span><span class="o">::</span><span class="nf">createFromTimestamp</span><span class="p">(</span><span class="nv">$start</span><span class="p">);</span>
<span class="nv">$start_date</span> <span class="o">=</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="nf">format</span><span class="p">(</span><span class="s1">'m/d/y'</span><span class="p">);</span> <span class="c1">//returns 12/21/22</span>
<span class="nv">$start_time</span> <span class="o">=</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="nf">format</span><span class="p">(</span><span class="s1">'g:ia'</span><span class="p">);</span> <span class="c1">// returns 10:00am</span>
</code></pre></div></div><h3 id="smart-date-all-day"> <a aria-labelledby="smart-date-all-day" class="anchor-heading" href="https://selwynpolit.github.io/d9book/dates#smart-date-all-day"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Smart date: all-day</h3><p>To check if a smart date is set to all day, check the duration. If it is 1439, that means all day.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$start_ts</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="n">field_when</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
<span class="nv">$start_dt</span> <span class="o">=</span> <span class="nc">DrupalDateTime</span><span class="o">::</span><span class="nf">createFromTimestamp</span><span class="p">(</span><span class="nv">$start_ts</span><span class="p">);</span>
<span class="nv">$start_date</span> <span class="o">=</span> <span class="nv">$start_dt</span><span class="o">-&gt;</span><span class="nf">format</span><span class="p">(</span><span class="s1">'m/d/Y'</span><span class="p">);</span>
<span class="nv">$duration</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="n">field_when</span><span class="o">-&gt;</span><span class="n">duration</span><span class="p">;</span>  <span class="c1">//1439 = all day</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$duration</span> <span class="o">==</span> <span class="mi">1439</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$start_time</span> <span class="o">=</span> <span class="s2">"all day"</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
  <span class="nv">$start_time</span> <span class="o">=</span> <span class="nv">$start_dt</span><span class="o">-&gt;</span><span class="nf">format</span><span class="p">(</span><span class="s1">'g:ia'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div><h3 id="smart-date-range-of-values"> <a aria-labelledby="smart-date-range-of-values" class="anchor-heading" href="https://selwynpolit.github.io/d9book/dates#smart-date-range-of-values"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Smart date: Range of values</h3><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//Event start date.</span>

<span class="c1">//returns a SmartDateFieldItemList</span>
<span class="nv">$whens</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'field_when'</span><span class="p">);</span> 

<span class="c1">// Each $when is a \Drupal\smart_date\Plugin\Field\FieldType\SmartDateItem.</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$whens</span> <span class="k">as</span> <span class="nv">$when</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$start</span> <span class="o">=</span> <span class="nv">$when</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
  <span class="nv">$end</span> <span class="o">=</span> <span class="nv">$when</span><span class="o">-&gt;</span><span class="n">end_value</span><span class="p">;</span>
  <span class="nv">$duration</span> <span class="o">=</span> <span class="nv">$when</span><span class="o">-&gt;</span><span class="n">duration</span><span class="p">;</span>  <span class="c1">//1439 = all day</span>
  <span class="nv">$tz</span> <span class="o">=</span> <span class="nv">$when</span><span class="o">-&gt;</span><span class="n">timezone</span><span class="p">;</span>  <span class="c1">//"" means default. Uses America/Chicago type format.</span>
<span class="p">}</span>
</code></pre></div></div><p>You can also peek into the repeating rule and repeating rule index. These are in the <code class="language-plaintext highlighter-rouge">smart_date_rule</code> table and I believe the <code class="language-plaintext highlighter-rouge">index</code> column identifies which item is in the instances column.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$rrule</span> <span class="o">=</span> <span class="nv">$when</span><span class="o">-&gt;</span><span class="n">rrule</span><span class="p">;</span>
<span class="nv">$rrule_index</span> <span class="o">=</span> <span class="nv">$when</span><span class="o">-&gt;</span><span class="n">rrule_index</span><span class="p">;</span>
</code></pre></div></div><h2 id="reference"> <a aria-labelledby="reference" class="anchor-heading" href="https://selwynpolit.github.io/d9book/dates#reference"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Reference</h2><h3 id="date-field-storage"> <a aria-labelledby="date-field-storage" class="anchor-heading" href="https://selwynpolit.github.io/d9book/dates#date-field-storage"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Date field storage</h3><p>Note. The node <code class="language-plaintext highlighter-rouge">created</code> and <code class="language-plaintext highlighter-rouge">changed</code> fields (int 11) use a Unix epoch timestamp stored in the <code class="language-plaintext highlighter-rouge">node_field_data</code> table. These have values like <code class="language-plaintext highlighter-rouge">1525302749</code>. Drupal date fields (with times) are stored as UTC strings in varchar 20 fields which look like <code class="language-plaintext highlighter-rouge">2019-05-15T21:32:00</code>.</p><h3 id="drupaldatetime-api-reference"> <a aria-labelledby="drupaldatetime-api-reference" class="anchor-heading" href="https://selwynpolit.github.io/d9book/dates#drupaldatetime-api-reference"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> DrupalDateTime API reference</h3><p>The <code class="language-plaintext highlighter-rouge">DrupalDateTime</code> class extends the <code class="language-plaintext highlighter-rouge">DateTimePlus</code> class which is a wrapper for PHP <code class="language-plaintext highlighter-rouge">DateTime</code> class. It extends the basic component and adds in Drupal-specific handling, like translation of the format() method.</p><p><code class="language-plaintext highlighter-rouge">DateTimePlus</code> has some static methods to create <code class="language-plaintext highlighter-rouge">DrupalDateTime</code> objects e.g.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nc">DrupalDateTime</span><span class="o">::</span><span class="nf">createFromArray</span><span class="p">([</span><span class="s1">'year'</span> <span class="o">=&gt;</span> <span class="mi">2010</span><span class="p">,</span> <span class="s1">'month'</span> <span class="o">=&gt;</span> <span class="mi">9</span><span class="p">,</span> <span class="s1">'day'</span> <span class="o">=&gt;</span> <span class="mi">28</span><span class="p">]);</span>
</code></pre></div></div><p>From https://git.drupalcode.org/project/drupal/-/blob/10.1.x/core/lib/Drupal/Component/Datetime/DateTimePlus.php:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cd">/**
 * Wraps DateTime().
 *
 * This class wraps the PHP DateTime class with more flexible initialization
 * parameters, allowing a date to be created from an existing date object,
 * a timestamp, a string with an unknown format, a string with a known
 * format, or an array of date parts. It also adds an errors array
 * and a __toString() method to the date object.
 *
 * This class is less lenient than the DateTime class. It changes
 * the default behavior for handling date values like '2011-00-00'.
 * The DateTime class would convert that value to '2010-11-30' and report
 * a warning but not an error. This extension treats that as an error.
 *
 * As with the DateTime class, a date object may be created even if it has
 * errors. It has an errors array attached to it that explains what the
 * errors are. This is less disruptive than allowing datetime exceptions
 * to abort processing. The calling script can decide what to do about
 * errors using hasErrors() and getErrors().
 *
 * @method $this add(\DateInterval $interval)
 * @method static array getLastErrors()
 * @method $this modify(string $modify)
 * @method $this setDate(int $year, int $month, int $day)
 * @method $this setISODate(int $year, int $week, int $day = 1)
 * @method $this setTime(int $hour, int $minute, int $second = 0, int $microseconds = 0)
 * @method $this setTimestamp(int $unixtimestamp)
 * @method $this setTimezone(\DateTimeZone $timezone)
 * @method $this sub(\DateInterval $interval)
 * @method int getOffset()
 * @method int getTimestamp()
 * @method \DateTimeZone getTimezone()
 */</span>
</code></pre></div></div><p>(More at https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Datetime%21DrupalDateTime.php/class/DrupalDateTime/9.4.x )</p><h3 id="utc"> <a aria-labelledby="utc" class="anchor-heading" href="https://selwynpolit.github.io/d9book/dates#utc"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> UTC</h3><p>Coordinated Universal Time or UTC is the primary time standard by which the world regulates clocks and time. It is within about 1 second of mean solar time at 0 longitude (at the IERS Reference Meridian as the currently used prime meridian) such as UT1 and is not adjusted for daylight saving time. It is effectively a successor to Greenwich Mean Time (GMT). From From <a href="https://en.wikipedia.org/wiki/Coordinated_Universal_Time">https://en.wikipedia.org/wiki/Coordinated_Universal_Time</a></p><h3 id="unix-epoch-timestamps"> <a aria-labelledby="unix-epoch-timestamps" class="anchor-heading" href="https://selwynpolit.github.io/d9book/dates#unix-epoch-timestamps"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Unix epoch timestamps</h3><p>From https://www.unixtimestamp.com/ - The unix time stamp is a way to track time as a running total of seconds. This count starts at the Unix Epoch on January 1st, 1970 at UTC. Therefore, the unix time stamp is merely the number of seconds between a particular date and the Unix Epoch. It should also be pointed out (thanks to the comments from visitors to this site) that this point in time technically does not change no matter where you are located on the globe. This is very useful to computer systems for tracking and sorting dated information in dynamic and distributed applications both online and client side.</p><h3 id="links"> <a aria-labelledby="links" class="anchor-heading" href="https://selwynpolit.github.io/d9book/dates#links"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Links</h3><ul><li><p>Drupal API DrupalDateTime Class https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Datetime%21DrupalDateTime.php/class/DrupalDateTime/9.4.x</p><li><p>From php.net, the definitive documentation on date format strings <a href="https://www.php.net/manual/en/datetime.format.php#:~:text=format%20parameter%20string-,format,-character">https://www.php.net/manual/en/datetime.format.php#:~:text=format%20parameter%20string-,format,-character</a></p><li><p>Coordinated Universal Time or UTC Wikipedia article <a href="https://en.wikipedia.org/wiki/Coordinated_Universal_Time">https://en.wikipedia.org/wiki/Coordinated_Universal_Time</a></p><li><p>Goran Nikolovskis article: Set date programatically from January 2019 <a href="https://gorannikolovski.com/blog/set-date-field-programmatically#:~:text=Get%20the%20date%20field%20programmatically,)%3B%20%2F%2F%20For%20datetime%20fields">https://gorannikolovski.com/blog/set-date-field-programmatically#:~:text=Get%20the%20date%20field%20programmatically,)%3B%20%2F%2F%20For%20datetime%20fields</a></p><li><p>Patricks article: Date (range) fields and Entity Query from February 2018 <a href="https://blog.werk21.de/en/2018/02/05/date-range-fields-and-entity-query-update">https://blog.werk21.de/en/2018/02/05/date-range-fields-and-entity-query-update</a></p><li><p>Drupal APIS <a href="https://www.drupal.org/docs/drupal-apis">https://www.drupal.org/docs/drupal-apis</a></p></li></li></li></li></li></li></ul><hr/> <script async="" crossorigin="anonymous" data-category="Q&amp;A" data-category-id="MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMyMjY2NDE4" data-emit-metadata="0" data-input-position="bottom" data-lang="en" data-mapping="title" data-reactions-enabled="1" data-repo="selwynpolit/d9book" data-repo-id="MDEwOlJlcG9zaXRvcnkzMjUxNTQ1Nzg=" data-strict="0" data-theme="preferred_color_scheme" src="https://giscus.app/client.js"> </script><hr/><footer><p><a href="https://selwynpolit.github.io/d9book/dates#top" id="back-to-top">Back to top</a></p><p class="text-small text-grey-dk-100 mb-0"><span xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/"> <a href="http://www.selwynpolit.github.io/d9book" property="dct:title" rel="cc:attributionURL">Drupal at your fingertips</a> by <a href="http://www.drupal.org/u/selwynpolit" property="cc:attributionName" rel="cc:attributionURL dct:creator">Selwyn Polit</a> is licensed under <a href="http://creativecommons.org/licenses/by/4.0/" rel="license noopener noreferrer" target="_blank">CC BY 4.0 <img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg" style="height:16px!important;vertical-align:text-bottom;"/> <img src="https://mirrors.creativecommons.org/presskit/icons/by.svg" style="height:16px!important;vertical-align:text-bottom;"/> </a></span></p><div class="d-flex mt-2"><p class="text-small text-grey-dk-000 mb-0 mr-2"> Page last modified: <span class="d-inline-block">Apr 13 2023</span>.</p><p class="text-small text-grey-dk-000 mb-0"> <a href="https://github.com/selwynpolit/d9book/tree/gh-pages/book/dates.md" id="edit-this-page">Edit this page on GitHub</a></p></div></footer></div></div><div class="search-overlay"></div></div>
</body></link></meta></meta></meta></head></html>