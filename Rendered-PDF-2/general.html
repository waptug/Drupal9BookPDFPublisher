<!DOCTYPE html>
<html lang="en-US"><head><meta charset="utf-8"/><meta content="IE=Edge" http-equiv="X-UA-Compatible"/><link href="https://selwynpolit.github.io/d9book/assets/css/just-the-docs-default.css" rel="stylesheet"/> <script async="" src="https://www.googletagmanager.com/gtag/js?id=8V22RQEJ71"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', '8V22RQEJ71', { 'anonymize_ip': true }); </script> <script src="https://selwynpolit.github.io/d9book/assets/js/vendor/lunr.min.js"></script> <script src="https://selwynpolit.github.io/d9book/assets/js/just-the-docs.js"></script><meta content="width=device-width, initial-scale=1" name="viewport"/><link href="https://selwynpolit.github.io/d9book/assets/images/favicon.ico" rel="icon" type="image/x-icon"/><title>General | Drupal Book</title><meta content="Jekyll v4.3.2" name="generator"><meta content="General" property="og:title"><meta content="en_US" property="og:locale"><meta content="Drupal at your fingertips" name="description"/><meta content="Drupal at your fingertips" property="og:description"/><link href="https://selwynpolit.github.io/d9book/d9book/general" rel="canonical"><meta content="https://selwynpolit.github.io/d9book/d9book/general" property="og:url"/><meta content="Drupal Book" property="og:site_name"/><meta content="website" property="og:type"/><meta content="summary" name="twitter:card"/><meta content="General" property="twitter:title"/> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Drupal at your fingertips","headline":"General","url":"https://selwynpolit.github.io/d9book/d9book/general"}</script><body> <a class="skip-to-main" href="https://selwynpolit.github.io/d9book/general#main-content">Skip to main content</a> <svg class="d-none" xmlns="http://www.w3.org/2000/svg"> <symbol id="svg-link" viewbox="0 0 24 24"><title>Link</title><svg class="feather feather-link" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewbox="0 0 24 24"><title>Menu</title><svg class="feather feather-menu" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><line x1="3" x2="21" y1="12" y2="12"></line><line x1="3" x2="21" y1="6" y2="6"></line><line x1="3" x2="21" y1="18" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewbox="0 0 24 24"><title>Expand</title><svg class="feather feather-chevron-right" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol class="feather feather-external-link" fill="none" height="24" id="svg-external-link" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24"><title id="svg-external-link-title">(external link)</title><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" x2="21" y1="14" y2="3"></line> </symbol> <symbol id="svg-doc" viewbox="0 0 24 24"><title>Document</title><svg class="feather feather-file" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewbox="0 0 24 24"><title>Search</title><svg class="feather feather-search" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"> <circle cx="11" cy="11" r="8"></circle><line x1="21" x2="16.65" y1="21" y2="16.65"></line> </svg> </symbol> <symbol id="svg-copy" viewbox="0 0 16 16"><title>Copy</title><svg class="bi bi-clipboard" fill="currentColor" height="16" viewbox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"></path><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"></path> </svg> </symbol> <symbol id="svg-copied" viewbox="0 0 16 16"><title>Copied</title><svg class="bi bi-clipboard-check-fill" fill="currentColor" height="16" viewbox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"></path><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"></path> </svg> </symbol> </svg><div class="side-bar"><div class="site-header"> <a class="site-title lh-tight" href="https://selwynpolit.github.io/d9book/"> Drupal Book </a> <a class="site-button" href="https://selwynpolit.github.io/d9book/general" id="menu-button"> <svg class="icon" viewbox="0 0 24 24"><use xlink:href="#svg-menu"></use></svg> </a></div><nav aria-label="Main" class="site-nav" id="site-nav"><ul class="nav-list"><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/">Home</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/actions">Actions</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/attribution">Attribution</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/bq">Batch and Queue</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/blocks">Blocks</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/caching">Caching</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/composer">Composer</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/config">Config</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/cron">Cron</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/dates">Dates and Times</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/debugging">Debugging</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/development">Development</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/drush">Drush</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/email">Email</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/entities">Entities</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/forms">Forms</a><li class="nav-list-item active"><a class="nav-list-link active" href="https://selwynpolit.github.io/d9book/general">General</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/off-island">Getting off the Island</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/hooks">Hooks</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/learn">Learning</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/links">Links</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/logging">Logging</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/menus">Menus</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/migrate">Migrate</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/modals">Modals</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/nodes-and-fields">Nodes and Fields</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/queries">Queries</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/redirects">Redirects</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/render">Render Arrays</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/routes">Routes</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/security">Security</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/services">Services</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/state">State</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/taxonomy">Taxonomy</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/dtt">Tests</a><li class="nav-list-item"><a class="nav-list-link" href="https://selwynpolit.github.io/d9book/twig">Twig</a></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></ul><ul class="nav-list"><li class="nav-list-item external"> <a class="nav-list-link external" href="https://github.com/selwynpolit/d9book/fork"> Fork me on GitHub <svg aria-labelledby="svg-external-link-title" viewbox="0 0 24 24"><use xlink:href="#svg-external-link"></use></svg> </a></li></ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer></div><div class="main" id="top"><div class="main-header" id="main-header"><div class="search"><div class="search-input-wrap"> <input aria-label="Search Drupal Book" autocomplete="off" class="search-input" id="search-input" placeholder="Search Drupal Book" tabindex="0" type="text"/> <label class="search-label" for="search-input"><svg class="search-icon" viewbox="0 0 24 24"><use xlink:href="#svg-search"></use></svg></label></div><div class="search-results" id="search-results"></div></div><nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a class="site-button" href="https://twitter.com/selwynpolit" rel="noopener noreferrer" target="_blank"> <img alt="Twitter logo" src="https://atuin.ru/demo/simple-icons/icons/twitter.svg" style="width: 30px; height: 30px;" title="Author in Twitter"/> </a><li class="aux-nav-list-item"> <a class="site-button" href="https://github.com/selwynpolit/d9book/tree/gh-pages" rel="noopener noreferrer" target="_blank"> <img alt="GitHub logo" src="https://atuin.ru/demo/simple-icons/icons/github.svg" style="width: 30px; height: 30px;" title="D9Book on GitHub"/> </a></li></li></ul></nav></div><div class="main-content-wrap" id="main-content-wrap"><div class="main-content" id="main-content" role="main"><h1 class="no_toc fw-500" id="general"> <a aria-labelledby="general" class="anchor-heading" href="https://selwynpolit.github.io/d9book/general#general"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> General</h1><h2 class="no_toc text-delta" id="table-of-contents"> <a aria-labelledby="table-of-contents" class="anchor-heading" href="https://selwynpolit.github.io/d9book/general#table-of-contents"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Table of contents</h2><ul id="markdown-toc"><li><a href="https://selwynpolit.github.io/d9book/general#get-the-current-user" id="markdown-toc-get-the-current-user">Get the current user</a><li><a href="https://selwynpolit.github.io/d9book/general#get-the-logged-in-user-name-and-email" id="markdown-toc-get-the-logged-in-user-name-and-email">Get the logged in user name and email</a><li><a href="https://selwynpolit.github.io/d9book/general#check-if-you-are-on-the-front-page" id="markdown-toc-check-if-you-are-on-the-front-page">Check if you are on the Front page</a><li><a href="https://selwynpolit.github.io/d9book/general#check-if-site-is-in-system-maintenance-mode" id="markdown-toc-check-if-site-is-in-system-maintenance-mode">Check if site is in system maintenance mode</a><li><a href="https://selwynpolit.github.io/d9book/general#get-node-url-alias-or-taxonomy-alias-by-node-id-or-term-id" id="markdown-toc-get-node-url-alias-or-taxonomy-alias-by-node-id-or-term-id">Get Node URL alias or Taxonomy Alias by Node id or Term ID</a><li><a href="https://selwynpolit.github.io/d9book/general#taxonomy-alias" id="markdown-toc-taxonomy-alias">Taxonomy alias</a><li><a href="https://selwynpolit.github.io/d9book/general#get-current-path" id="markdown-toc-get-current-path">Get current Path</a><li><a href="https://selwynpolit.github.io/d9book/general#get-current-nid-node-type-and-title" id="markdown-toc-get-current-nid-node-type-and-title">Get current nid, node type and title</a><li><a href="https://selwynpolit.github.io/d9book/general#how-to-check-whether-a-module-is-installed-or-not" id="markdown-toc-how-to-check-whether-a-module-is-installed-or-not">How to check whether a module is installed or not</a><li><a href="https://selwynpolit.github.io/d9book/general#get-current-route-name" id="markdown-toc-get-current-route-name">Get current Route name</a><li><a href="https://selwynpolit.github.io/d9book/general#get-the-current-page-title" id="markdown-toc-get-the-current-page-title">Get the current page title</a><li><a href="https://selwynpolit.github.io/d9book/general#get-the-current-user-1" id="markdown-toc-get-the-current-user-1">Get the current user</a><li><a href="https://selwynpolit.github.io/d9book/general#check-if-you-are-on-the-front-page-1" id="markdown-toc-check-if-you-are-on-the-front-page-1">Check if you are on the Front page</a><li><a href="https://selwynpolit.github.io/d9book/general#check-if-site-in-system-maintenance-mode" id="markdown-toc-check-if-site-in-system-maintenance-mode">Check if site in system maintenance mode</a><li><a href="https://selwynpolit.github.io/d9book/general#retrieve-query-and-get-or-post-parameters-_post-and-_get" id="markdown-toc-retrieve-query-and-get-or-post-parameters-_post-and-_get">Retrieve query and get or post parameters ($_POST and $_GET)</a><li><a href="https://selwynpolit.github.io/d9book/general#retrieve-url-argument-parameters" id="markdown-toc-retrieve-url-argument-parameters">Retrieve URL argument parameters</a><li><a href="https://selwynpolit.github.io/d9book/general#get-current-language-in-a-constructor" id="markdown-toc-get-current-language-in-a-constructor">Get Current Language in a constructor</a><li><a href="https://selwynpolit.github.io/d9book/general#add-a-variable-to-any-page-on-the-site" id="markdown-toc-add-a-variable-to-any-page-on-the-site">Add a variable to any page on the site</a><li><a href="https://selwynpolit.github.io/d9book/general#add-a-variable-to-be-rendered-in-a-node" id="markdown-toc-add-a-variable-to-be-rendered-in-a-node">Add a variable to be rendered in a node.</a><li><a href="https://selwynpolit.github.io/d9book/general#add-a-bunch-of-variables-to-be-rendered-in-a-node" id="markdown-toc-add-a-bunch-of-variables-to-be-rendered-in-a-node">Add a bunch of variables to be rendered in a node</a><li><a href="https://selwynpolit.github.io/d9book/general#grabbing-entity-reference-fields-in-hook_preprocess_node-for-injection-into-the-twig-template" id="markdown-toc-grabbing-entity-reference-fields-in-hook_preprocess_node-for-injection-into-the-twig-template">Grabbing entity reference fields in hook_preprocess_node for injection into the twig template</a><li><a href="https://selwynpolit.github.io/d9book/general#render-a-list-created-in-the-template_preprocess_node" id="markdown-toc-render-a-list-created-in-the-template_preprocess_node">Render a list created in the template_preprocess_node()</a><li><a href="https://selwynpolit.github.io/d9book/general#indexing-paragraphs-so-you-can-theme-the-first-one" id="markdown-toc-indexing-paragraphs-so-you-can-theme-the-first-one">Indexing paragraphs so you can theme the first one</a><li><a href="https://selwynpolit.github.io/d9book/general#add-meta-tags-using-template_preprocess_html" id="markdown-toc-add-meta-tags-using-template_preprocess_html">Add meta tags using template_preprocess_html</a><li><a href="https://selwynpolit.github.io/d9book/general#how-to-strip--characters-from-a-string" id="markdown-toc-how-to-strip--characters-from-a-string">How to strip % characters from a string</a><li><a href="https://selwynpolit.github.io/d9book/general#remote-media-entities" id="markdown-toc-remote-media-entities">Remote media entities</a><li><a href="https://selwynpolit.github.io/d9book/general#deprecated-functions-like-drupal_set_message" id="markdown-toc-deprecated-functions-like-drupal_set_message">Deprecated functions like drupal_set_message</a><li><a href="https://selwynpolit.github.io/d9book/general#block-excessive-crawling-of-drupal-views-or-search-results" id="markdown-toc-block-excessive-crawling-of-drupal-views-or-search-results">Block excessive crawling of Drupal Views or search results</a></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></li></ul><p><img alt="views" src="https://api.visitor.plantree.me/visitor-badge/pv?label=views&amp;color=informational&amp;namespace=d9book&amp;key=general.md"/></p><hr/><h2 id="get-the-current-user"> <a aria-labelledby="get-the-current-user" class="anchor-heading" href="https://selwynpolit.github.io/d9book/general#get-the-current-user"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Get the current user</h2><p>Note this will not get the user entity, but rather a user proxy with basic info but no fields or entity-specific data.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$user</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">currentUser</span><span class="p">();</span>
</code></pre></div></div><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$user</span> <span class="o">=</span> <span class="nc">\Drupal\user\Entity\User</span><span class="o">::</span><span class="nf">load</span><span class="p">(</span><span class="nc">\Drupal</span><span class="o">::</span><span class="nf">currentUser</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">());</span>
</code></pre></div></div><p>Or</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">\Drupal\user\Entity\User</span><span class="p">;</span>
<span class="nv">$user</span> <span class="o">=</span> <span class="nc">User</span><span class="o">::</span><span class="nf">load</span><span class="p">(</span><span class="nc">\Drupal</span><span class="o">::</span><span class="nf">currentUser</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">());</span>
</code></pre></div></div><h2 id="get-the-logged-in-user-name-and-email"> <a aria-labelledby="get-the-logged-in-user-name-and-email" class="anchor-heading" href="https://selwynpolit.github.io/d9book/general#get-the-logged-in-user-name-and-email"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Get the logged in user name and email</h2><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$username</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">currentUser</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getAccountName</span><span class="p">();</span>
</code></pre></div></div><p>or</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$account_proxy</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">currentUser</span><span class="p">();</span>
<span class="c1">//$account = $account_proxy-&gt;getAccount();</span>

<span class="c1">// load user entity</span>
<span class="nv">$user</span> <span class="o">=</span> <span class="nc">User</span><span class="o">::</span><span class="nf">load</span><span class="p">(</span><span class="nv">$account_proxy</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">());</span>

<span class="nv">$user</span> <span class="o">=</span> <span class="nc">User</span><span class="o">::</span><span class="nf">load</span><span class="p">(</span><span class="nc">\Drupal</span><span class="o">::</span><span class="nf">currentUser</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">());</span>
<span class="nv">$name</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'name'</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
</code></pre></div></div><p>Email</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$email</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">currentUser</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getEmail</span><span class="p">();</span>
</code></pre></div></div><p>or</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$user</span> <span class="o">=</span> <span class="nc">User</span><span class="o">::</span><span class="nf">load</span><span class="p">(</span><span class="nc">\Drupal</span><span class="o">::</span><span class="nf">currentUser</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">());</span>
<span class="nv">$email</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'mail'</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
</code></pre></div></div><h2 id="check-if-you-are-on-the-front-page"> <a aria-labelledby="check-if-you-are-on-the-front-page" class="anchor-heading" href="https://selwynpolit.github.io/d9book/general#check-if-you-are-on-the-front-page"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Check if you are on the Front page</h2><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$is_front</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">service</span><span class="p">(</span><span class="s1">'path.matcher'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">isFrontPage</span><span class="p">();</span>
</code></pre></div></div><p>The above statement will return either TRUE or FALSE. TRUE means you are on the front page.</p><h2 id="check-if-site-is-in-system-maintenance-mode"> <a aria-labelledby="check-if-site-is-in-system-maintenance-mode" class="anchor-heading" href="https://selwynpolit.github.io/d9book/general#check-if-site-is-in-system-maintenance-mode"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Check if site is in system maintenance mode</h2><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$is_maint_mode</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">state</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'system.maintenance_mode'</span><span class="p">);</span>
</code></pre></div></div><h2 id="get-node-url-alias-or-taxonomy-alias-by-node-id-or-term-id"> <a aria-labelledby="get-node-url-alias-or-taxonomy-alias-by-node-id-or-term-id" class="anchor-heading" href="https://selwynpolit.github.io/d9book/general#get-node-url-alias-or-taxonomy-alias-by-node-id-or-term-id"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Get Node URL alias or Taxonomy Alias by Node id or Term ID</h2><p>Sometimes we need a relative path and sometimes we need an absolute path. There is an $options parameter in the fromRoute() function where specify which you need.</p><p>Parameters:</p><ul><li>absolute true will return absolute path.<li>absolute false will return relative path.</li></li></ul><p>Returns the node alias. Note. If a nice url is not set using pathauto, you get <code class="language-plaintext highlighter-rouge">/node/1234</code></p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">Drupal\Core\Url</span><span class="p">;</span>
<span class="nv">$options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'absolute'</span> <span class="o">=&gt;</span> <span class="kc">true</span><span class="p">];</span>  <span class="c1">//false will return relative path.</span>

<span class="nv">$url</span> <span class="o">=</span> <span class="nc">Url</span><span class="o">::</span><span class="nf">fromRoute</span><span class="p">(</span><span class="s1">'entity.node.canonical'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'node'</span> <span class="o">=&gt;</span> <span class="mi">1234</span><span class="p">],</span> <span class="nv">$options</span><span class="p">);</span>
<span class="nv">$url</span> <span class="o">=</span> <span class="nv">$url</span><span class="o">-&gt;</span><span class="nf">toString</span><span class="p">();</span> <span class="c1">// make a string</span>

<span class="c1">// OR</span>

<span class="nv">$node_path</span> <span class="o">=</span> <span class="s2">"/node/1"</span><span class="p">;</span>
<span class="nv">$alias</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">service</span><span class="p">(</span><span class="s1">'path_alias.manager'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">getAliasByPath</span><span class="p">(</span><span class="nv">$node_path</span><span class="p">);</span>

<span class="c1">// OR</span>

<span class="nv">$current_path</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">service</span><span class="p">(</span><span class="s1">'path.current'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">getPath</span><span class="p">();</span>
</code></pre></div></div><p>To get the full path with the host etc. this returns: https://ddev93.ddev.site/node/1</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$host</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">request</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getSchemeAndHttpHost</span><span class="p">();</span>
<span class="nv">$url</span> <span class="o">=</span> <span class="nc">\Drupal\Core\Url</span><span class="o">::</span><span class="nf">fromRoute</span><span class="p">(</span><span class="s1">'entity.node.canonical'</span><span class="p">,[</span><span class="s1">'node'</span><span class="o">=&gt;</span><span class="nv">$lab_home_nid</span><span class="p">]);</span>
<span class="nv">$url_alias</span> <span class="o">=</span> <span class="nv">$url</span><span class="o">-&gt;</span><span class="nf">toString</span><span class="p">();</span>
<span class="nv">$full_url</span> <span class="o">=</span> <span class="nv">$host</span> <span class="mf">.</span> <span class="nv">$url</span><span class="o">-&gt;</span><span class="nf">toString</span><span class="p">();</span>
</code></pre></div></div><p>You can get the hostname, e.g. "drupal8.local", directly from the getHost() request with:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$host</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">request</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getHost</span><span class="p">();</span>
</code></pre></div></div><h2 id="taxonomy-alias"> <a aria-labelledby="taxonomy-alias" class="anchor-heading" href="https://selwynpolit.github.io/d9book/general#taxonomy-alias"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Taxonomy alias</h2><p>Return taxonomy alias</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'absolute'</span> <span class="o">=&gt;</span> <span class="kc">true</span><span class="p">];</span>  <span class="c1">//false will return relative path.</span>
<span class="nv">$url</span> <span class="o">=</span> <span class="nc">Url</span><span class="o">::</span><span class="nf">fromRoute</span><span class="p">(</span><span class="s1">'entity.taxonomy_term.canonical'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'taxonomy_term'</span> <span class="o">=&gt;</span> <span class="mi">1234</span><span class="p">],</span> <span class="nv">$options</span><span class="p">);</span>
</code></pre></div></div><h2 id="get-current-path"> <a aria-labelledby="get-current-path" class="anchor-heading" href="https://selwynpolit.github.io/d9book/general#get-current-path"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Get current Path</h2><p>For node pages this will return <code class="language-plaintext highlighter-rouge">node/{node id}</code>, for taxonomy <code class="language-plaintext highlighter-rouge">taxonomy/term/{term id}</code>, for user <code class="language-plaintext highlighter-rouge">user/{user id}</code> if exists otherwise it will return the current request URI.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$currentPath</span>  <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">service</span><span class="p">(</span><span class="s1">'path.current'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">getPath</span><span class="p">();</span>
</code></pre></div></div><h2 id="get-current-nid-node-type-and-title"> <a aria-labelledby="get-current-nid-node-type-and-title" class="anchor-heading" href="https://selwynpolit.github.io/d9book/general#get-current-nid-node-type-and-title"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Get current nid, node type and title</h2><p>There are two ways to retrieve the current node – via the request or the route</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$node</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">request</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">attributes</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'node'</span><span class="p">);</span>
<span class="nv">$nid</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">();</span>
</code></pre></div></div><p>OR</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$node</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">routeMatch</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getParameter</span><span class="p">(</span><span class="s1">'node'</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$node</span> <span class="k">instanceof</span> <span class="nc">\Drupal\node\NodeInterface</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// You can get nid and anything else you need from the node object.</span>
  <span class="nv">$nid</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">();</span>
  <span class="nv">$nodeType</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">bundle</span><span class="p">();</span>
  <span class="nv">$nodeTitle</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">getTitle</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div><p>If you need to use the node object in <code class="language-plaintext highlighter-rouge">hook_preprocess_page</code> on the preview page, you will need to use the <code class="language-plaintext highlighter-rouge">node_preview</code> parameter, instead of the <code class="language-plaintext highlighter-rouge">node</code> parameter:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">mymodule_preprocess_page</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$vars</span><span class="p">)</span> <span class="p">{</span>

  <span class="nv">$route_name</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">routeMatch</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getRouteName</span><span class="p">();</span>

  <span class="k">if</span> <span class="p">(</span><span class="nv">$route_name</span> <span class="o">==</span> <span class="s1">'entity.node.canonical'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$node</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">routeMatch</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getParameter</span><span class="p">(</span><span class="s1">'node'</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">elseif</span> <span class="p">(</span><span class="nv">$route_name</span> <span class="o">==</span> <span class="s1">'entity.node.preview'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$node</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">routeMatch</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getParameter</span><span class="p">(</span><span class="s1">'node_preview'</span><span class="p">);</span>
  <span class="p">}</span>
</code></pre></div></div><p>And from <a href="https://drupal.stackexchange.com/questions/145823/how-do-i-get-the-current-node-id">https://drupal.stackexchange.com/questions/145823/how-do-i-get-the-current-node-id</a> when you are using or creating a custom block then you have to follow this code to get current node id. Not sure if it is correct.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">Drupal\Core\Cache\Cache</span><span class="p">;</span>

<span class="nv">$node</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">routeMatch</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getParameter</span><span class="p">(</span><span class="s1">'node'</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$node</span> <span class="k">instanceof</span> <span class="nc">\Drupal\node\NodeInterface</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$nid</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// for cache</span>
<span class="k">public</span> <span class="k">function</span> <span class="n">getCacheTags</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">//With this when your node changes your block will rebuild</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$node</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">routeMatch</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getParameter</span><span class="p">(</span><span class="s1">'node'</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//if there is node add its cachetag</span>
    <span class="k">return</span> <span class="nc">Cache</span><span class="o">::</span><span class="nf">mergeTags</span><span class="p">(</span><span class="k">parent</span><span class="o">::</span><span class="nf">getCacheTags</span><span class="p">(),</span> <span class="p">[</span><span class="s1">'node:'</span> <span class="mf">.</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">()]);</span>
  <span class="p">}</span> 
  <span class="k">else</span> <span class="p">{</span>
    <span class="c1">//Return default tags instead.</span>
    <span class="k">return</span> <span class="k">parent</span><span class="o">::</span><span class="nf">getCacheTags</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">function</span> <span class="n">getCacheContexts</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">//if you depend on \Drupal::routeMatch()</span>
  <span class="c1">//you must set context of this block with 'route' context tag.</span>
  <span class="c1">//Every new route this block will rebuild</span>
  <span class="k">return</span> <span class="nc">Cache</span><span class="o">::</span><span class="nf">mergeContexts</span><span class="p">(</span><span class="k">parent</span><span class="o">::</span><span class="nf">getCacheContexts</span><span class="p">(),</span> <span class="p">[</span><span class="s1">'route'</span><span class="p">]);</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="how-to-check-whether-a-module-is-installed-or-not"> <a aria-labelledby="how-to-check-whether-a-module-is-installed-or-not" class="anchor-heading" href="https://selwynpolit.github.io/d9book/general#how-to-check-whether-a-module-is-installed-or-not"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> How to check whether a module is installed or not</h2><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$moduleHandler</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">service</span><span class="p">(</span><span class="s1">'module_handler'</span><span class="p">);</span>
<span class="nv">$module_name</span> <span class="o">=</span> <span class="err">“</span><span class="n">views</span><span class="err">”</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$moduleHandler</span><span class="o">-&gt;</span><span class="nf">moduleExists</span><span class="p">(</span><span class="nv">$module_name</span><span class="p">))</span> <span class="p">{</span>
  <span class="k">echo</span> <span class="s2">"</span><span class="nv">$module_name</span><span class="s2"> installed"</span><span class="p">;</span>
<span class="p">}</span> 
<span class="k">else</span> <span class="p">{</span>
  <span class="k">echo</span> <span class="s2">"</span><span class="nv">$module_name</span><span class="s2"> not installed"</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="get-current-route-name"> <a aria-labelledby="get-current-route-name" class="anchor-heading" href="https://selwynpolit.github.io/d9book/general#get-current-route-name"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Get current Route name</h2><p>Routes are in the form: view.files_browser.page_1, test.example or test.settings_form</p><p>E.g from test.routing.yml</p><div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">test.example</span><span class="pi">:</span>
  <span class="na">path</span><span class="pi">:</span> <span class="s1">'</span><span class="s">/test/example'</span>
  <span class="na">defaults</span><span class="pi">:</span>
    <span class="na">_title</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Example'</span>
    <span class="na">_controller</span><span class="pi">:</span> <span class="s1">'</span><span class="s">\Drupal\test\Controller\TestController::build'</span>
  <span class="na">requirements</span><span class="pi">:</span>
    <span class="na">_permission</span><span class="pi">:</span> <span class="s1">'</span><span class="s">access</span><span class="nv"> </span><span class="s">content'</span>

<span class="na">test.settings_form</span><span class="pi">:</span>
  <span class="na">path</span><span class="pi">:</span> <span class="s1">'</span><span class="s">/admin/config/system/test'</span>
  <span class="na">defaults</span><span class="pi">:</span>
    <span class="na">_title</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Test</span><span class="nv"> </span><span class="s">settings'</span>
    <span class="na">_form</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Drupal\test\Form\SettingsForm'</span>
  <span class="na">requirements</span><span class="pi">:</span>
    <span class="na">_permission</span><span class="pi">:</span> <span class="s1">'</span><span class="s">administer</span><span class="nv"> </span><span class="s">test</span><span class="nv"> </span><span class="s">configuration'</span>
</code></pre></div></div><p>This will return Drupal route. It returns entity.node.canonical for the nodes, system.404 for the 404 pages, entity.taxonomy_term.canonical for the taxonomy pages, entity.user.canonical for the users and custom route name that we define in modulename.routing.yml file.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$current_route</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">routeMatch</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getRouteName</span><span class="p">();</span>
</code></pre></div></div><h2 id="get-the-current-page-title"> <a aria-labelledby="get-the-current-page-title" class="anchor-heading" href="https://selwynpolit.github.io/d9book/general#get-the-current-page-title"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Get the current page title</h2><p>You can use this in a controller, to return the current page title.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$request</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">request</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$route</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="n">attributes</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="nc">\Symfony\Cmf\Component\Routing\RouteObjectInterface</span><span class="o">::</span><span class="no">ROUTE_OBJECT</span><span class="p">))</span> <span class="p">{</span>
<span class="nv">$title</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">service</span><span class="p">(</span><span class="s1">'title_resolver'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">getTitle</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nv">$route</span><span class="p">);}</span>
</code></pre></div></div><h2 id="get-the-current-user-1"> <a aria-labelledby="get-the-current-user-1" class="anchor-heading" href="https://selwynpolit.github.io/d9book/general#get-the-current-user-1"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Get the current user</h2><p>Note this will not get the user entity, but rather a user proxy with basic info but no fields or entity-specific data.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$user</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">currentUser</span><span class="p">();</span>
</code></pre></div></div><p>To get the user entity, use this which gets the user service (<code class="language-plaintext highlighter-rouge">\Drupal::currentUser()</code>), gets the uid (<code class="language-plaintext highlighter-rouge">-&gt;id()</code>), then calls <code class="language-plaintext highlighter-rouge">load()</code> to load the real user object.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$user</span> <span class="o">=</span> <span class="nc">\Drupal\user\Entity\User</span><span class="o">::</span><span class="nf">load</span><span class="p">(</span><span class="nc">\Drupal</span><span class="o">::</span><span class="nf">currentUser</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">());</span>
</code></pre></div></div><p>Or</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">\Drupal\user\Entity\User</span><span class="p">;</span>
<span class="nv">$user</span> <span class="o">=</span> <span class="nc">User</span><span class="o">::</span><span class="nf">load</span><span class="p">(</span><span class="nc">\Drupal</span><span class="o">::</span><span class="nf">currentUser</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">());</span>
</code></pre></div></div><h2 id="check-if-you-are-on-the-front-page-1"> <a aria-labelledby="check-if-you-are-on-the-front-page-1" class="anchor-heading" href="https://selwynpolit.github.io/d9book/general#check-if-you-are-on-the-front-page-1"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Check if you are on the Front page</h2><p>This will return true for the front page otherwise false.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$is_front</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">service</span><span class="p">(</span><span class="s1">'path.matcher'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">isFrontPage</span><span class="p">();</span>
</code></pre></div></div><h2 id="check-if-site-in-system-maintenance-mode"> <a aria-labelledby="check-if-site-in-system-maintenance-mode" class="anchor-heading" href="https://selwynpolit.github.io/d9book/general#check-if-site-in-system-maintenance-mode"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Check if site in system maintenance mode</h2><p>From web/core/modules/system/src/Access/CronAccessCheck.php</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nc">\Drupal</span><span class="o">::</span><span class="nf">state</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'system.maintenance_mode'</span><span class="p">))</span> <span class="p">{</span>
</code></pre></div></div><h2 id="retrieve-query-and-get-or-post-parameters-_post-and-_get"> <a aria-labelledby="retrieve-query-and-get-or-post-parameters-_post-and-_get" class="anchor-heading" href="https://selwynpolit.github.io/d9book/general#retrieve-query-and-get-or-post-parameters-_post-and-_get"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Retrieve query and get or post parameters ($_POST and $_GET)</h2><p>Old style was:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$name</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'name'</span><span class="p">];</span>
</code></pre></div></div><p>Now use this for post vars:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$name</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">request</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">request</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'name'</span><span class="p">);</span>
</code></pre></div></div><p>And this for gets</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$query</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">request</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">query</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'name'</span><span class="p">);</span>
</code></pre></div></div><p>For all items in get:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$query</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">request</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">query</span><span class="o">-&gt;</span><span class="nf">all</span><span class="p">();</span>
<span class="nv">$search_term</span> <span class="o">=</span> <span class="nv">$query</span><span class="p">[</span><span class="s1">'query'</span><span class="p">];</span>
<span class="nv">$collection</span> <span class="o">=</span> <span class="nv">$query</span><span class="p">[</span><span class="s1">'collection'</span><span class="p">];</span>
</code></pre></div></div><p>Be wary about caching. From <a href="https://drupal.stackexchange.com/questions/231953/get-in-drupal-8/231954#231954">https://drupal.stackexchange.com/questions/231953/get-in-drupal-8/231954#231954</a> the code provided only works the first time so it is important to add a ‘#cache’ context in the markup.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">namespace</span> <span class="nn">Drupal\newday\Controller</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Drupal\Core\Controller\ControllerBase</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">NewdayController</span> <span class="kd">extends</span> <span class="nc">ControllerBase</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">new</span><span class="p">()</span> <span class="p">{</span>
      <span class="nv">$day</span><span class="o">=</span> <span class="p">[</span>
        <span class="s2">"#markup"</span> <span class="o">=&gt;</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">request</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">query</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'id'</span><span class="p">),</span>
       <span class="p">];</span>
      <span class="k">return</span> <span class="nv">$day</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p>The request is being cached, you need to tell the system to vary by the query arg:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$day</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'#markup'</span> <span class="o">=&gt;</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">request</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">query</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'id'</span><span class="p">),</span>
    <span class="s1">'#cache'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'contexts'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'url.query_args:id'</span><span class="p">],</span>
    <span class="p">],</span>
<span class="p">];</span>
</code></pre></div></div><p>More about caching render arrays: <a href="https://www.drupal.org/docs/8/api/render-api/cacheability-of-render-arrays">https://www.drupal.org/docs/8/api/render-api/cacheability-of-render-arrays</a></p><h2 id="retrieve-url-argument-parameters"> <a aria-labelledby="retrieve-url-argument-parameters" class="anchor-heading" href="https://selwynpolit.github.io/d9book/general#retrieve-url-argument-parameters"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Retrieve URL argument parameters</h2><p>You can extract the url arguments with</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$current_path</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">service</span><span class="p">(</span><span class="s1">'path.current'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">getPath</span><span class="p">();</span>
<span class="nv">$path_args</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="nv">$current_path</span><span class="p">);</span>
<span class="nv">$term_name</span> <span class="o">=</span> <span class="nv">$path_args</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
</code></pre></div></div><p>For https://txg.ddev.site/newsroom/search/?country=1206</p><p><img alt="Variables display in PHPStorm debug pane" src="https://selwynpolit.github.io/d9book/assets/images/image1-general.png"/></p><h2 id="get-current-language-in-a-constructor"> <a aria-labelledby="get-current-language-in-a-constructor" class="anchor-heading" href="https://selwynpolit.github.io/d9book/general#get-current-language-in-a-constructor"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Get Current Language in a constructor</h2><p>In dev1 - <code class="language-plaintext highlighter-rouge">/modules/custom/iai_wea/src/Plugin/rest/resource/WEAResource.php</code> we create the WeaResource class and using dependency injection, get the LanguageManagerInterface service passed in, then we call <code class="language-plaintext highlighter-rouge">getgetCurrentLanguage()</code>. This allows us to later retrieve the node</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">WEAResource</span> <span class="kd">extends</span> <span class="nc">ResourceBase</span> <span class="p">{</span>

  <span class="cd">/**
   * @var \Drupal\Core\Language\Language
   */</span>
  <span class="k">protected</span> <span class="nv">$currentLanguage</span><span class="p">;</span>

  <span class="cd">/**
   * WEAResource constructor.
   *
   * @param array $configuration
   * @param string $plugin_id
   * @param mixed $plugin_definition
   * @param array $serializer_formats
   * @param \Psr\Log\LoggerInterface $logger
   * @param \Drupal\Core\Language\LanguageManagerInterface $language_manager
   */</span>
  <span class="k">public</span> <span class="k">function</span> <span class="n">__construct</span><span class="p">(</span><span class="kt">array</span> <span class="nv">$configuration</span><span class="p">,</span> <span class="kt">string</span> <span class="nv">$plugin_id</span><span class="p">,</span> <span class="kt">mixed</span> <span class="nv">$plugin_definition</span><span class="p">,</span> <span class="kt">array</span> <span class="nv">$serializer_formats</span><span class="p">,</span> <span class="nc">\Psr\Log\LoggerInterface</span> <span class="nv">$logger</span><span class="p">,</span> <span class="nc">LanguageManagerInterface</span> <span class="nv">$language_manager</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">parent</span><span class="o">::</span><span class="nf">__construct</span><span class="p">(</span><span class="nv">$configuration</span><span class="p">,</span> <span class="nv">$plugin_id</span><span class="p">,</span> <span class="nv">$plugin_definition</span><span class="p">,</span> <span class="nv">$serializer_formats</span><span class="p">,</span> <span class="nv">$logger</span><span class="p">);</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">currentLanguage</span> <span class="o">=</span> <span class="nv">$language_manager</span><span class="o">-&gt;</span><span class="nf">getCurrentLanguage</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p>Later in the class, we can retrieve the correct language version of the node:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="n">get</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$node</span> <span class="o">=</span> <span class="nc">Node</span><span class="o">::</span><span class="nf">load</span><span class="p">(</span><span class="nv">$id</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$translatedNode</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">getTranslation</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">currentLanguage</span><span class="o">-&gt;</span><span class="nf">getId</span><span class="p">());</span>
</code></pre></div></div><p>Of course, you can also get the language statically by using:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Global</span> <span class="nv">$language</span> <span class="o">=</span> <span class="nc">Drupal</span><span class="o">::</span><span class="nf">languageManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getLanguage</span><span class="p">(</span><span class="nc">Language</span><span class="o">:</span><span class="no">TYPE_INTERFACE</span><span class="p">)</span>
</code></pre></div></div><p>This is part of the packt publishing Mastering Drupal 8 module development video series: https://www.packtpub.com/product/mastering-drupal-8-development-video/9781787124493</p><p>Note. To test this in modules/custom/pseudo_client/get/</p><blockquote><p>php -S localhost:8888</p><p>and put this in a browser:</p><p>http://localhost:8888/get_item_from_drupal_core.php?domain=dev1&amp;item=2716</p><p>or</p><p>http://localhost:8888/get_items_from_custom_code.php?domain=dev1</p><p>OR just put this in browser without running php -S:</p><p>http://dev1/iai_wea/actions/2716?_format=json</p></blockquote><h2 id="add-a-variable-to-any-page-on-the-site"> <a aria-labelledby="add-a-variable-to-any-page-on-the-site" class="anchor-heading" href="https://selwynpolit.github.io/d9book/general#add-a-variable-to-any-page-on-the-site"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Add a variable to any page on the site</h2><p>In the .theme file of the theme, add a <code class="language-plaintext highlighter-rouge">hook_preprocess_page</code> function like in themes/custom/dprime/dprime.theme:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">dprime_preprocess_page</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$variables</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$language_interface</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">languageManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getCurrentLanguage</span><span class="p">();</span>

  <span class="nv">$variables</span><span class="p">[</span><span class="s1">'footer_address1'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'#type'</span><span class="o">=&gt;</span><span class="s1">'markup'</span><span class="p">,</span>
    <span class="s1">'#markup'</span><span class="o">=&gt;</span><span class="s1">'123 Disk Drive, Sector 439'</span><span class="p">,</span>
  <span class="p">];</span>
  <span class="nv">$variables</span><span class="p">[</span><span class="s1">'footer_address2'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'#type'</span><span class="o">=&gt;</span><span class="s1">'markup'</span><span class="p">,</span>
    <span class="s1">'#markup'</span><span class="o">=&gt;</span><span class="s1">'Austin, Texas 78759'</span><span class="p">,</span>
  <span class="p">];</span>
</code></pre></div></div><p>Then in the template file e.g. themes/custom/dprime/templates/partials/footer.html.twig</p><div class="language-twig highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"cell xlarge-3 medium-4"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;address&gt;</span>
    <span class="nt">&lt;br</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;br</span> <span class="nt">/&gt;</span>
    Campus mail code: D9000<span class="nt">&lt;br</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"mailto:abc@example.com"</span><span class="nt">&gt;</span>abc@example.com <span class="nt">&lt;/a&gt;</span>
  <span class="nt">&lt;/address&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div><h2 id="add-a-variable-to-be-rendered-in-a-node"> <a aria-labelledby="add-a-variable-to-be-rendered-in-a-node" class="anchor-heading" href="https://selwynpolit.github.io/d9book/general#add-a-variable-to-be-rendered-in-a-node"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Add a variable to be rendered in a node.</h2><p>From dev1 custom theme burger_burgler.</p><p>Here two vars <code class="language-plaintext highlighter-rouge">stock_field</code> and <code class="language-plaintext highlighter-rouge">my_custom_field</code> are added and will be rendered by a normal node twig file. The function hook_preprocess_node is in the .theme file at <code class="language-plaintext highlighter-rouge">themes/custom/burger_burgler/burger_burgler.theme</code>.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">burger_burgler_preprocess_node</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$variables</span><span class="p">)</span> <span class="p">{</span>

  <span class="nv">$variables</span><span class="p">[</span><span class="s1">'content'</span><span class="p">][</span><span class="s1">'stock_field'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'#type'</span><span class="o">=&gt;</span><span class="s1">'markup'</span><span class="p">,</span> 
    <span class="s1">'#markup'</span><span class="o">=&gt;</span><span class="s1">'stock field here'</span><span class="p">,</span>
  <span class="p">];</span>

  <span class="nv">$variables</span><span class="p">[</span><span class="s1">'content'</span><span class="p">][</span><span class="s1">'my_custom_field'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'markup'</span><span class="p">,</span>
    <span class="s1">'#markup'</span> <span class="o">=&gt;</span> <span class="s1">'Hello - custom field here'</span><span class="p">,</span>
  <span class="p">];</span>
<span class="p">}</span>
</code></pre></div></div><p>If you’ve tweaked your node twig template, you’ll need to reference like this:</p><div class="language-twig highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"stock-field-class"</span><span class="nt">&gt;</span>
  <span class="cp">{{</span> <span class="nv">content</span><span class="p">[</span><span class="s1">'stock_field'</span><span class="p">]</span> <span class="cp">}}</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div><p>Note. You can always just add a variable like</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$variables</span><span class="p">[</span><span class="s1">'abc'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'hello'</span><span class="p">;</span>
</code></pre></div></div><p>which can be referenced in the template as <code class="language-plaintext highlighter-rouge">{{ abc }}</code> (or <code class="language-plaintext highlighter-rouge">{{ kint(abc) }}</code> )</p><h2 id="add-a-bunch-of-variables-to-be-rendered-in-a-node"> <a aria-labelledby="add-a-bunch-of-variables-to-be-rendered-in-a-node" class="anchor-heading" href="https://selwynpolit.github.io/d9book/general#add-a-bunch-of-variables-to-be-rendered-in-a-node"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Add a bunch of variables to be rendered in a node</h2><p>You can easily grab the node from the $variables with:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$node</span> <span class="o">=</span> <span class="nv">$variables</span><span class="p">[</span><span class="s1">'node'</span><span class="p">];</span>
</code></pre></div></div><p>Then to access a field in the node, you can just specify them by:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$node</span><span class="o">-&gt;</span><span class="n">field_ref_aof</span>
<span class="nv">$node</span><span class="o">-&gt;</span><span class="n">field_ref_topic</span>
</code></pre></div></div><p>Here we grab a bunch of variables, cycles through them (for multi-value fields, which most of them are and build an array that can be easily rendered by twig:</p><p>From: themes/custom/txg/txg.theme</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">txg_preprocess_node</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$variables</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$view_mode</span> <span class="o">=</span> <span class="nv">$variables</span><span class="p">[</span><span class="s1">'view_mode'</span><span class="p">];</span> <span class="c1">// Retrieve view mode</span>
  <span class="nv">$allowed_view_modes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'full'</span><span class="p">];</span> <span class="c1">// Array of allowed view modes (for performance so as to not execute on unneeded nodes)</span>
  <span class="nv">$node</span> <span class="o">=</span> <span class="nv">$variables</span><span class="p">[</span><span class="s1">'node'</span><span class="p">];</span>
  <span class="k">if</span> <span class="p">((</span><span class="nv">$node</span><span class="o">-&gt;</span><span class="nb">getType</span><span class="p">()</span> <span class="o">==</span> <span class="s1">'news_story'</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$view_mode</span> <span class="o">==</span> <span class="s1">'full'</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$aofs</span> <span class="o">=</span> <span class="nf">_txg_multival_ref_data</span><span class="p">(</span><span class="nv">$node</span><span class="o">-&gt;</span><span class="n">field_ref_aof</span><span class="p">,</span> <span class="s1">'aof'</span><span class="p">,</span> <span class="s1">'target_id'</span><span class="p">);</span>
    <span class="nv">$units</span> <span class="o">=</span> <span class="nf">_txg_multival_ref_data</span><span class="p">(</span><span class="nv">$node</span><span class="o">-&gt;</span><span class="n">field_ref_unit</span><span class="p">,</span> <span class="s1">'unit'</span><span class="p">,</span> <span class="s1">'target_id'</span><span class="p">);</span>
    <span class="nv">$audiences</span> <span class="o">=</span> <span class="nf">_txg_multival_ref_data</span><span class="p">(</span><span class="nv">$node</span><span class="o">-&gt;</span><span class="n">field_ref_audience</span><span class="p">,</span> <span class="s1">'audience'</span><span class="p">,</span> <span class="s1">'target_id'</span><span class="p">);</span>
    <span class="nv">$collections</span> <span class="o">=</span> <span class="nf">_txg_multival_ref_data</span><span class="p">(</span><span class="nv">$node</span><span class="o">-&gt;</span><span class="n">field_ref_program_collection</span><span class="p">,</span> <span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'target_id'</span><span class="p">);</span>
    <span class="nv">$topics</span> <span class="o">=</span> <span class="nf">_txg_multival_ref_data</span><span class="p">(</span><span class="nv">$node</span><span class="o">-&gt;</span><span class="n">field_ref_topic</span><span class="p">,</span>  <span class="s1">'topic'</span><span class="p">,</span> <span class="s1">'target_id'</span><span class="p">,</span> <span class="s1">'taxonomy'</span><span class="p">);</span>
    <span class="nv">$continents</span> <span class="o">=</span> <span class="nf">_txg_multival_ref_data</span><span class="p">(</span><span class="nv">$node</span><span class="o">-&gt;</span><span class="n">field_continent</span><span class="p">,</span> <span class="s1">'continent'</span><span class="p">,</span> <span class="s1">'value'</span><span class="p">,</span> <span class="s1">'list'</span><span class="p">);</span>
    <span class="nv">$countries</span> <span class="o">=</span> <span class="nf">_txg_multival_ref_data</span><span class="p">(</span><span class="nv">$node</span><span class="o">-&gt;</span><span class="n">field_ref_country</span><span class="p">,</span> <span class="s1">'country'</span><span class="p">,</span> <span class="s1">'target_id'</span><span class="p">);</span>
    <span class="nv">$related_news_items</span> <span class="o">=</span> <span class="nb">array_merge</span><span class="p">(</span><span class="nv">$topics</span><span class="p">,</span> <span class="nv">$aofs</span><span class="p">,</span> <span class="nv">$units</span><span class="p">,</span> <span class="nv">$audiences</span><span class="p">,</span> <span class="nv">$collections</span><span class="p">,</span> <span class="nv">$continents</span><span class="p">,</span>  <span class="nv">$countries</span><span class="p">);</span>
    <span class="nv">$variables</span><span class="p">[</span><span class="s1">'related_news_items'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$related_news_items</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cd">/**
 * Returns array of data for multivalue node reference fields
 * ref_field = entity reference field
 * param_name = parameter name to be passed as get value
 * value_type = indicates which field to retrieve from database
 * field_ref_type = variable to determine type of reference field
 * field_term_category =
 */</span>
<span class="k">function</span> <span class="n">_txg_multival_ref_data</span><span class="p">(</span><span class="nv">$ref_field</span><span class="p">,</span> <span class="nv">$param_name</span><span class="p">,</span> <span class="nv">$value_type</span><span class="p">,</span> <span class="nv">$field_ref_type</span> <span class="o">=</span> <span class="s1">'node'</span><span class="p">)</span> <span class="p">{</span>
   <span class="nv">$values</span> <span class="o">=</span> <span class="p">[];</span>
   <span class="k">foreach</span><span class="p">(</span><span class="nv">$ref_field</span> <span class="k">as</span> <span class="nv">$ref</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span> <span class="p">(</span><span class="nv">$field_ref_type</span> <span class="o">==</span> <span class="s1">'taxonomy'</span><span class="p">)</span> <span class="p">{</span>
       <span class="nv">$term</span> <span class="o">=</span> <span class="nc">Drupal</span><span class="o">::</span><span class="nf">entityTypeManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getStorage</span><span class="p">(</span><span class="s1">'taxonomy_term'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">load</span><span class="p">(</span><span class="nv">$ref</span><span class="o">-&gt;</span><span class="nv">$value_type</span><span class="p">);</span>
       <span class="nv">$title</span> <span class="o">=</span> <span class="nv">$term</span><span class="o">-&gt;</span><span class="nf">getName</span><span class="p">();</span>
     <span class="p">}</span>
     <span class="k">else</span> <span class="p">{</span>
       <span class="nv">$title</span> <span class="o">=</span> <span class="nv">$value_type</span> <span class="o">==</span> <span class="s1">'value'</span> <span class="o">?</span> <span class="nv">$ref</span><span class="o">-&gt;</span><span class="nv">$value_type</span> <span class="o">:</span> <span class="nv">$ref</span><span class="o">-&gt;</span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">title</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="nv">$id</span> <span class="o">=</span> <span class="nv">$ref</span><span class="o">-&gt;</span><span class="nv">$value_type</span><span class="p">;</span>
     <span class="nv">$values</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[</span>
       <span class="s1">'title'</span> <span class="o">=&gt;</span> <span class="nv">$title</span><span class="p">,</span>
       <span class="s1">'id'</span> <span class="o">=&gt;</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s1">' '</span><span class="p">,</span> <span class="s1">'+'</span><span class="p">,</span> <span class="nv">$id</span><span class="p">),</span>
       <span class="s1">'param_name'</span> <span class="o">=&gt;</span> <span class="nv">$param_name</span><span class="p">,</span>
     <span class="p">];</span>
   <span class="p">}</span>
  <span class="k">return</span> <span class="nv">$values</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="grabbing-entity-reference-fields-in-hook_preprocess_node-for-injection-into-the-twig-template"> <a aria-labelledby="grabbing-entity-reference-fields-in-hook_preprocess_node-for-injection-into-the-twig-template" class="anchor-heading" href="https://selwynpolit.github.io/d9book/general#grabbing-entity-reference-fields-in-hook_preprocess_node-for-injection-into-the-twig-template"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Grabbing entity reference fields in hook_preprocess_node for injection into the twig template</h2><p>You can easily pull in referenced fields by referring to them as</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$node</span><span class="o">-&gt;</span><span class="n">field_sf_contract_ref</span><span class="o">-&gt;</span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">field_how_to_order</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
</code></pre></div></div><p>Where <code class="language-plaintext highlighter-rouge">field_sf_contract_ref</code> is the reference field, which points to an entity which has a field called <code class="language-plaintext highlighter-rouge">field_how_to_order</code>. Then we can jam it into the <code class="language-plaintext highlighter-rouge">$variables</code> array and refer to it in the twig template as ``</p><p>From <code class="language-plaintext highlighter-rouge">web/themes/custom/dirt_bootstrap/dirt_bootstrap.theme</code></p><p>In <code class="language-plaintext highlighter-rouge">function dirt_bootstrap_preprocess_node(&amp;$variables)</code></p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nv">$type</span> <span class="o">===</span> <span class="s1">'contract'</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$view_mode</span> <span class="o">===</span> <span class="s1">'full'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$how_to_order_lookup</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="n">field_sf_contract_ref</span><span class="o">-&gt;</span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">field_how_to_order_lookup</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
    <span class="nv">$variables</span><span class="p">[</span><span class="s1">'how_to_order_lookup'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$how_to_order_lookup</span><span class="p">;</span>
    <span class="nv">$contract_type</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'field_contract_type'</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$how_to_order_lookup</span> <span class="o">===</span> <span class="s2">"Custom Text"</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nv">$contract_type</span> <span class="o">===</span> <span class="s2">"DIRT"</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$variables</span><span class="p">[</span><span class="s1">'how_to_order'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="n">field_sf_contract_ref</span><span class="o">-&gt;</span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">field_how_to_order</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$variables</span><span class="p">[</span><span class="s1">'how_to_order'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="n">field_sf_contract_ref</span><span class="o">-&gt;</span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">field_how_to_order_custom</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="render-a-list-created-in-the-template_preprocess_node"> <a aria-labelledby="render-a-list-created-in-the-template_preprocess_node" class="anchor-heading" href="https://selwynpolit.github.io/d9book/general#render-a-list-created-in-the-template_preprocess_node"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Render a list created in the template_preprocess_node()</h2><p>Here we create a list in the preprocess_node custom theme burger_burgler):</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">burger_burgler_preprocess_node</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$variables</span><span class="p">)</span> <span class="p">{</span>

  <span class="nv">$burger_list</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Cheesburger'</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Mushroom Swissburger'</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Jalapeno bugburger'</span><span class="p">],</span>
  <span class="p">];</span>
  <span class="nv">$variables</span><span class="p">[</span><span class="s1">'burgers'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$burger_list</span><span class="p">;</span>

<span class="p">}</span>
</code></pre></div></div><p>and render it in the twig template <code class="language-plaintext highlighter-rouge">node--article--full.html.twig</code></p><div class="language-twig highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;ol&gt;</span>
  <span class="cp">{%</span> <span class="k">for</span> <span class="nv">burger</span> <span class="ow">in</span> <span class="nv">burgers</span> <span class="cp">%}</span>
    <span class="nt">&lt;li&gt;</span> <span class="cp">{{</span> <span class="nv">burger</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span> <span class="cp">}}</span> <span class="nt">&lt;/li&gt;</span>
  <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="nt">&lt;/ol&gt;</span>
</code></pre></div></div><h2 id="indexing-paragraphs-so-you-can-theme-the-first-one"> <a aria-labelledby="indexing-paragraphs-so-you-can-theme-the-first-one" class="anchor-heading" href="https://selwynpolit.github.io/d9book/general#indexing-paragraphs-so-you-can-theme-the-first-one"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Indexing paragraphs so you can theme the first one</h2><p>Posted on <a href="https://www.drupal.org/project/paragraphs/issues/2881460#comment-13291215">https://www.drupal.org/project/paragraphs/issues/2881460#comment-13291215</a></p><p>From themes/custom/dprime/dprime.theme</p><p>Add this to the theme:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cd">/**
 * Implements hook_preprocess_field.
 *
 * Provides an index for these fields referenced as 
 * in twig template.
 *
 * @param $variables
 */</span>
<span class="k">function</span> <span class="n">dprime_preprocess_field</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$variables</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="nv">$variables</span><span class="p">[</span><span class="s1">'field_name'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'field_video_accordions'</span><span class="p">){</span>
    <span class="k">foreach</span><span class="p">(</span><span class="nv">$variables</span><span class="p">[</span><span class="s1">'items'</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$idx</span> <span class="o">=&gt;</span> <span class="nv">$item</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$variables</span><span class="p">[</span><span class="s1">'items'</span><span class="p">][</span><span class="nv">$idx</span><span class="p">][</span><span class="s1">'content'</span><span class="p">][</span><span class="s1">'#paragraph'</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">index</span> <span class="o">=</span> <span class="nv">$idx</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p><code class="language-plaintext highlighter-rouge">field_video_accordions</code> is the name of the field that holds the paragraph you want to count.</p><p>In the twig template for that paragraph, you can use the value <code class="language-plaintext highlighter-rouge">paragraph.index</code> as in:</p><div class="language-twig highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">{%</span> <span class="k">if</span> <span class="nv">paragraph.index</span> <span class="o">==</span> <span class="nv">0</span> <span class="cp">%}</span>
  <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"accordion-item is-active"</span> <span class="na">data-accordion-item=</span><span class="s">""</span><span class="nt">&gt;</span>
<span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
  <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"accordion-item"</span> <span class="na">data-accordion-item=</span><span class="s">""</span><span class="nt">&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</code></pre></div></div><h2 id="add-meta-tags-using-template_preprocess_html"> <a aria-labelledby="add-meta-tags-using-template_preprocess_html" class="anchor-heading" href="https://selwynpolit.github.io/d9book/general#add-meta-tags-using-template_preprocess_html"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Add meta tags using template_preprocess_html</h2><p>Also covered at <a href="https://drupal.stackexchange.com/questions/217880/how-do-i-add-a-meta-tag-in-inside-the-head-tag">https://drupal.stackexchange.com/questions/217880/how-do-i-add-a-meta-tag-in-inside-the-head-tag</a></p><p>If you need to make changes to the <code class="language-plaintext highlighter-rouge">&lt;head&gt;</code> element, the <code class="language-plaintext highlighter-rouge">hook_preprocess_html</code> is the place to do it in the <code class="language-plaintext highlighter-rouge">.theme</code> file. Here we check to see that the content type is contract and then we create a fake array of meta tags and jam them into the <code class="language-plaintext highlighter-rouge">$variables['page']['#attached']['html_head']</code> element. They are then rendered on the page.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cd">/**
 * Implements hook_preprocess_html().
 */</span>
<span class="k">function</span> <span class="n">dir_bootstrap_preprocess_html</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$variables</span><span class="p">)</span> <span class="p">{</span>

  <span class="nv">$node</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">routeMatch</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getParameter</span><span class="p">(</span><span class="s1">'node'</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$node</span> <span class="k">instanceof</span> <span class="nc">\Drupal\node\NodeInterface</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$node</span><span class="o">-&gt;</span><span class="nb">getType</span><span class="p">()</span> <span class="o">==</span> <span class="s1">'contract'</span><span class="p">)</span> <span class="p">{</span>

      <span class="nv">$brand_meta_tag</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[[</span>
        <span class="s1">'#tag'</span> <span class="o">=&gt;</span> <span class="s1">'meta'</span><span class="p">,</span>
        <span class="s1">'#attributes'</span> <span class="o">=&gt;</span> <span class="p">[</span>
          <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'brand'</span><span class="p">,</span>
          <span class="s1">'content'</span> <span class="o">=&gt;</span> <span class="s1">'Dell'</span><span class="p">,</span>
        <span class="p">]],</span>
        <span class="s1">'Dell'</span><span class="p">,</span>
      <span class="p">];</span>
<span class="mf">..</span>

<span class="nv">$variables</span><span class="p">[</span><span class="s1">'page'</span><span class="p">][</span><span class="s1">'#attached'</span><span class="p">][</span><span class="s1">'html_head'</span><span class="p">][]</span> <span class="o">=</span> <span class="nv">$brand_meta_tag</span><span class="p">;</span>
</code></pre></div></div><p>Note that the extra “Dell” low down in the array appears to be a description of some kind – it isn’t rendered. If you don’t include the second “Dell” you could rather use</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$page</span><span class="p">[</span><span class="s1">'#attached'</span><span class="p">][</span><span class="s1">'html_head'</span><span class="p">][]</span> <span class="o">=</span> <span class="p">[</span><span class="nv">$description</span><span class="p">,</span> <span class="s1">'description'</span><span class="p">];</span>
</code></pre></div></div><p>For multiple tags, I had to do this version:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$brand_meta_tags</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[[</span>
  <span class="s1">'#tag'</span> <span class="o">=&gt;</span> <span class="s1">'meta'</span><span class="p">,</span>
  <span class="s1">'#attributes'</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'brand'</span><span class="p">,</span>
    <span class="s1">'content'</span> <span class="o">=&gt;</span> <span class="s1">'Dell'</span><span class="p">,</span>
  <span class="p">]],</span>
  <span class="s1">'Dell'</span><span class="p">,</span>
<span class="p">];</span>
<span class="nv">$brand_meta_tags</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[[</span>
  <span class="s1">'#tag'</span> <span class="o">=&gt;</span> <span class="s1">'meta'</span><span class="p">,</span>
  <span class="s1">'#attributes'</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'brand'</span><span class="p">,</span>
    <span class="s1">'content'</span> <span class="o">=&gt;</span> <span class="s1">'Apple'</span><span class="p">,</span>
  <span class="p">]],</span>
  <span class="s1">'Apple'</span><span class="p">,</span>
<span class="p">];</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$brand_meta_tags</span> <span class="k">as</span> <span class="nv">$brand_meta_tag</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$variables</span><span class="p">[</span><span class="s1">'page'</span><span class="p">][</span><span class="s1">'#attached'</span><span class="p">][</span><span class="s1">'html_head'</span><span class="p">][]</span> <span class="o">=</span> <span class="nv">$brand_meta_tag</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><p>And here I do a query and build some new meta tags from <code class="language-plaintext highlighter-rouge">themes/custom/dirt_bootstrap/dirt_bootstrap.theme</code>.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$brand_meta_tags</span> <span class="o">=</span> <span class="p">[];</span>
<span class="nv">$contract_id</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="n">field_contract_id</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$contract_id</span><span class="p">)</span> <span class="p">{</span>

  <span class="c1">//Lookup dirt store brand records with this contract id.</span>
  <span class="nv">$storage</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityTypeManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getStorage</span><span class="p">(</span><span class="s1">'node'</span><span class="p">);</span>
  <span class="nv">$query</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityQuery</span><span class="p">(</span><span class="s1">'node'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'type'</span><span class="p">,</span> <span class="s1">'sf_store_brands'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'status'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'field_contract_id'</span><span class="p">,</span> <span class="nv">$contract_id</span><span class="p">);</span>
  <span class="nv">$nids</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>
  <span class="k">foreach</span> <span class="p">(</span><span class="nv">$nids</span> <span class="k">as</span> <span class="nv">$nid</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$store_brand_node</span> <span class="o">=</span> <span class="nc">Node</span><span class="o">::</span><span class="nf">load</span><span class="p">(</span><span class="nv">$nid</span><span class="p">);</span>
    <span class="nv">$brand</span> <span class="o">=</span> <span class="nv">$store_brand_node</span><span class="o">-&gt;</span><span class="n">field_brand</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$brand</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$brand_meta_tags</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[[</span>
        <span class="s1">'#tag'</span> <span class="o">=&gt;</span> <span class="s1">'meta'</span><span class="p">,</span>
        <span class="s1">'#attributes'</span> <span class="o">=&gt;</span> <span class="p">[</span>
          <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'brand'</span><span class="p">,</span>
          <span class="s1">'content'</span> <span class="o">=&gt;</span> <span class="nv">$brand</span><span class="p">,</span>
        <span class="p">]],</span>
        <span class="nv">$brand</span><span class="p">,</span>
      <span class="p">];</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">foreach</span> <span class="p">(</span><span class="nv">$brand_meta_tags</span> <span class="k">as</span> <span class="nv">$brand_meta_tag</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$variables</span><span class="p">[</span><span class="s1">'page'</span><span class="p">][</span><span class="s1">'#attached'</span><span class="p">][</span><span class="s1">'html_head'</span><span class="p">][]</span> <span class="o">=</span> <span class="nv">$brand_meta_tag</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="how-to-strip--characters-from-a-string"> <a aria-labelledby="how-to-strip--characters-from-a-string" class="anchor-heading" href="https://selwynpolit.github.io/d9book/general#how-to-strip--characters-from-a-string"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> How to strip % characters from a string</h2><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$str</span> <span class="o">=</span> <span class="s2">"threatgeek/2016/05/welcome-jungle-tips-staying-secure-when-you%E2%80%99re-road"</span><span class="p">;</span>
<span class="k">echo</span> <span class="nv">$str</span> <span class="mf">.</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
<span class="c1">//echo htmlspecialchars_decode($str) . "\n";</span>

<span class="k">echo</span> <span class="p">(</span><span class="nb">urldecode</span><span class="p">(</span><span class="nv">$str</span><span class="p">))</span> <span class="mf">.</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
<span class="k">echo</span> <span class="nb">urlencode</span><span class="p">(</span><span class="s2">"threatgeek/2016/05/welcome-jungle-tips-staying-secure-when-you're-road"</span><span class="p">);</span>

<span class="k">echo</span> <span class="nb">urldecode</span><span class="p">(</span><span class="s1">'We%27re%20proud%20to%20introduce%20the%20Amazing'</span><span class="p">);</span>
</code></pre></div></div><h2 id="remote-media-entities"> <a aria-labelledby="remote-media-entities" class="anchor-heading" href="https://selwynpolit.github.io/d9book/general#remote-media-entities"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Remote media entities</h2><p>For this project, I had to figure out a way to make media entities that really were remote images. i.e. the API provided images but we didn’t want to store them in Drupal</p><p>I started by looking at <a href="https://www.drupal.org/sandbox/nickhope/3001154">https://www.drupal.org/sandbox/nickhope/3001154</a> which was based on <a href="https://www.drupal.org/project/media_entity_flickr">https://www.drupal.org/project/media_entity_flickr</a>.</p><p>I tweaked the nickhope module (media_entity_remote_file) so it worked but it had some trouble with image styles and thumbnails</p><p>A good solution (thanks to Hugo) is:</p><p>https://www.drupal.org/project/remote_stream_wrapper_widget</p><p>https://www.drupal.org/project/remote_stream_wrapper</p><p>Hugo suggests using this to do migration:</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$uri</span> <span class="o">=</span> <span class="s1">'http://example.com/somefile.mp3'</span><span class="p">;</span>
<span class="nv">$file</span> <span class="o">=</span> <span class="nc">File</span><span class="o">::</span><span class="nf">Create</span><span class="p">([</span><span class="s1">'uri'</span> <span class="o">=&gt;</span> <span class="nv">$uri</span><span class="p">]);</span>
<span class="nv">$file</span><span class="o">-&gt;</span><span class="nf">save</span><span class="p">();</span>
<span class="nv">$node</span><span class="o">-&gt;</span><span class="n">field_file</span><span class="o">-&gt;</span><span class="nf">setValue</span><span class="p">([</span><span class="s1">'target_id'</span> <span class="o">=&gt;</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">()]);</span>
<span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">save</span><span class="p">();</span>
</code></pre></div></div><p>There was no documentation so I added some at <a href="https://www.drupal.org/project/remote_stream_wrapper/issues/2875444#comment-12881516">https://www.drupal.org/project/remote_stream_wrapper/issues/2875444#comment-12881516</a></p><h2 id="deprecated-functions-like-drupal_set_message"> <a aria-labelledby="deprecated-functions-like-drupal_set_message" class="anchor-heading" href="https://selwynpolit.github.io/d9book/general#deprecated-functions-like-drupal_set_message"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Deprecated functions like drupal_set_message</h2><p>Note. <code class="language-plaintext highlighter-rouge">drupal_set_message()</code> has been removed from the codebase so you should use <code class="language-plaintext highlighter-rouge">messenger()</code> but you can also use <code class="language-plaintext highlighter-rouge">dsm()</code> which is provided by the <a href="https://www.drupal.org/project/devel">devel</a> contrib module. This is useful when working through a problem if you want to display a message on a site during debugging.</p><p>From <a href="https://github.com/mglaman/drupal-check/wiki/Deprecation-Error-Solutions">https://github.com/mglaman/drupal-check/wiki/Deprecation-Error-Solutions</a></p><p>Before</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">drupal_set_message</span><span class="p">(</span><span class="nv">$message</span><span class="p">,</span> <span class="nv">$type</span><span class="p">,</span> <span class="nv">$repeat</span><span class="p">);</span>
</code></pre></div></div><p>After</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">\Drupal</span><span class="o">::</span><span class="nf">messenger</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">addMessage</span><span class="p">(</span><span class="nv">$message</span><span class="p">,</span> <span class="nv">$type</span><span class="p">,</span> <span class="nv">$repeat</span><span class="p">);</span>
</code></pre></div></div><p><a href="https://www.drupal.org/node/2774931">Read more</a>.</p><h2 id="block-excessive-crawling-of-drupal-views-or-search-results"> <a aria-labelledby="block-excessive-crawling-of-drupal-views-or-search-results" class="anchor-heading" href="https://selwynpolit.github.io/d9book/general#block-excessive-crawling-of-drupal-views-or-search-results"><svg aria-hidden="true" viewbox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a> Block excessive crawling of Drupal Views or search results</h2><p><a href="https://acquia.my.site.com/s/article/4408794498199-Block-excessive-crawling-of-Drupal-Views-or-search-results">From Acquia.com</a></p><p>Sometimes, robot webcrawlers (like Bing, Huwaei Cloud, Yandex, Semrush, etc) can attempt to crawl a Drupal View’s search results pages, and could also be following links to each of the view’s filtering options. This places extra load on your site. Additionally, the crawling (even if done by legitimate search engines) may not be increasing your site’s visibility to users of search engines.</p><p>Therefore, we suggest blocking or re-routing this traffic to reduce resource consumption at the Acquia platform, avoid overages to your Acquia entitlements (for Acquia Search, Views &amp; Visits, etc.), and to generally help your site perform better.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># EXAMPLE ROBOT BLOCKING CODE for Search pages or views. 
# From: https://support-acquia.force.com/s/article/4408794498199-Block-excessive-crawling-of-Drupal-Views-or-search-results
#   NOTE: May need editing depending on your use case(s).
#
# INSTRUCTIONS:
# PLACE THIS BLOCK directly after the "RewriteEngine on" line 
#   on your docroot/.htaccess file.
#
# This will block some known robots/crawlers on URLs when query arguments are present.
#   DOES allow basic URLs like /news/feed, /node/1 or /rss, etc.
#   BLOCKS only when search arguments are present like
#     /news/feed?search=XXX or /rss?page=21.
# Note: You can add more conditions if needed.
#   For example, to only block on URLs that begin with '/search', add this
#   line before the RewriteRule:
#     RewriteCond %{REQUEST_URI} ^/search
#
RewriteCond %{QUERY_STRING} .
RewriteCond %{HTTP_USER_AGENT} "11A465|AddThis.com|AdsBot-Google|Ahrefs|alexa site audit|Amazonbot|Amazon-Route53-Health-Check-Service|ApacheBench|AppDynamics|Applebot|ArchiveBot|AspiegelBot|Baiduspider|bingbot|BLEXBot|BluechipBacklinks|Buck|Bytespider|CCBot|check_http|cludo.com bot|contentkingapp|Cookiebot|CopperEgg|crawler4j|Csnibot|Curebot|curl|Daum|Datadog Agent|DataForSeoBot|Detectify|DotBot|DuckDuckBot|facebookexternalhit|Faraday|FeedFetcher-Google|feedonomics|Funnelback|GAChecker|Grapeshot|gobuster|gocolly|Googlebot|GoogleStackdriverMonitoring|Go-http-client|GuzzleHttp|HeadlessChrome|heritrix|hokifyBot|HTTrack|HubSpot Crawler|ICC-Crawler|Imperva|IonCrawl|KauaiBot|Kinza|LieBaoFast|Linespider|Linguee|LinkChecker|LinkedInBot|LinuxGetUrl|LMY47V|MacOutlook|Magus Bot|Mail.RU_Bot|MauiBot|Mb2345Browser|MegaIndex|Microsoft Office|Microsoft Outlook|Microsoft Word|MicroMessenger|mindbreeze-crawler|mirrorweb.com|MJ12bot|monitoring-plugins|Monsidobot|MQQBrowser|msnbot|MSOffice|MTRobot|nagios-plugins|nettle|Neevabot|newspaper|Nuclei|OnCrawl|Orbbot|PageFreezer|panscient.com|PetalBot|Pingdom.com|Pinterestbot|PiplBot|python-requests|Qwantify|Re-re Studio|Riddler|rogerbot|RustBot|Scrapy|Screaming Frog|Search365bot|SearchBlox|SearchmetricsBot|searchunify|Seekport|SemanticScholarBot|SemrushBot|SEOkicks|seoscanners|serpstatbot|SessionCam|SeznamBot|Site24x7|siteimprove|Siteimprove|SiteSucker|SkypeRoom|Sogou web spider|special_archiver|SpiderLing|StatusCake|Synack|Turnitin|trendictionbot|trendkite-akashic-crawler|UCBrowser|Uptime|UptimeRobot|UT-Dorkbot|weborama-fetcher|WhiteHat Security|Wget|www.loc.gov|Vagabondo|VelenPublicWebCrawler|Yeti|Veracode Security Scan|YandexBot|YandexImages|YisouSpider|Zabbix|ZoominfoBot" [NC]
RewriteRule ^.* - [F,L]
</code></pre></div></div><hr/> <script async="" crossorigin="anonymous" data-category="Q&amp;A" data-category-id="MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMyMjY2NDE4" data-emit-metadata="0" data-input-position="bottom" data-lang="en" data-mapping="title" data-reactions-enabled="1" data-repo="selwynpolit/d9book" data-repo-id="MDEwOlJlcG9zaXRvcnkzMjUxNTQ1Nzg=" data-strict="0" data-theme="preferred_color_scheme" src="https://giscus.app/client.js"> </script><hr/><footer><p><a href="https://selwynpolit.github.io/d9book/general#top" id="back-to-top">Back to top</a></p><p class="text-small text-grey-dk-100 mb-0"><span xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/"> <a href="http://www.selwynpolit.github.io/d9book" property="dct:title" rel="cc:attributionURL">Drupal at your fingertips</a> by <a href="http://www.drupal.org/u/selwynpolit" property="cc:attributionName" rel="cc:attributionURL dct:creator">Selwyn Polit</a> is licensed under <a href="http://creativecommons.org/licenses/by/4.0/" rel="license noopener noreferrer" target="_blank">CC BY 4.0 <img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg" style="height:16px!important;vertical-align:text-bottom;"/> <img src="https://mirrors.creativecommons.org/presskit/icons/by.svg" style="height:16px!important;vertical-align:text-bottom;"/> </a></span></p><div class="d-flex mt-2"><p class="text-small text-grey-dk-000 mb-0 mr-2"> Page last modified: <span class="d-inline-block">Jul 31 2023</span>.</p><p class="text-small text-grey-dk-000 mb-0"> <a href="https://github.com/selwynpolit/d9book/tree/gh-pages/book/general.md" id="edit-this-page">Edit this page on GitHub</a></p></div></footer></div></div><div class="search-overlay"></div></div>
</body></link></meta></meta></meta></head></html>